{"id":"046344ad-08ae-4136-a83e-1a4b8ec8da40","title":"Qu·∫£n L√Ω Thanh To√°n H√≥a ƒê∆°n","createdAt":1745254040873,"updatedAt":1745256517855,"isNameGenerated":true,"isRenamedByUser":false,"messages":[{"id":"e6f1c232-c540-4f19-b4e9-337d12b85351","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"ti·∫øp theo v·ªõi nhakhoaso h√£y t·∫°o cho t√¥i ch·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n s·∫Ω g·ªìm 2 ch·ª©c nƒÉng con ƒë√≥ l√† t·∫°o h√≥a ƒë∆°n thanh to√°n, danh s√°ch h√≥a ƒë∆°n"}]},{"type":"paragraph","content":[{"type":"text","text":"B√¢y gi·ªù h√£y thi·∫øt l·∫≠p ch·ª©c nƒÉng con: t·∫°o h√≥a ƒë∆°n ƒë∆∞·ª£c m√¥ t·∫£ nh∆∞ sau:"}]},{"type":"paragraph","content":[{"type":"text","text":"\"üßæ Ch·ª©c nƒÉng: T·∫°o h√≥a ƒë∆°n"}]},{"type":"paragraph","content":[{"type":"text","text":"Ph·∫ßn n·ªôi dung ch√≠nh b√™n ph·∫£i hi·ªÉn th·ªã form t·∫°o m·ªõi h√≥a ƒë∆°n, bao g·ªìm:"}]},{"type":"paragraph","content":[{"type":"text","text":"C√°c tr∆∞·ªùng th√¥ng tin c·∫ßn nh·∫≠p (b·∫Øt bu·ªôc c√≥ d·∫•u *):"}]},{"type":"paragraph","content":[{"type":"text","text":"M√£ H√≥a ƒê∆°n: Nh·∫≠p m√£ ƒë·ªãnh danh h√≥a ƒë∆°n, t·ª± ƒë·ªông ƒëi·ªÅn"}]},{"type":"paragraph","content":[{"type":"text","text":"M√£ Phi·∫øu Kh√°m: Li√™n k·∫øt ƒë·∫øn phi·∫øu kh√°m t∆∞∆°ng ·ª©ng"}]},{"type":"paragraph","content":[{"type":"text","text":"Ng√†y: Ch·ªçn ng√†y t·∫°o h√≥a ƒë∆°n (ƒë·ªãnh d·∫°ng dd/mm/yyyy)"}]},{"type":"paragraph","content":[{"type":"text","text":"B·ªánh nh√¢n: Nh·∫≠p t√™n b·ªánh nh√¢n ƒë∆∞·ª£c nh·∫≠p vs csdl"}]},{"type":"paragraph","content":[{"type":"text","text":"B√°c sƒ© kh√°m: Nh·∫≠p t√™n b√°c sƒ© nh·∫≠p t·ª´ csdl"}]},{"type":"paragraph","content":[{"type":"text","text":"D·ªãch v·ª•: Nh·∫≠p t√™n d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng nh·∫≠p t·ª´ csdl"}]},{"type":"paragraph","content":[{"type":"text","text":"Gi√° d·ªãch v·ª•: Nh·∫≠p s·ªë ti·ªÅn c·ªßa d·ªãch v·ª• t·ª´ csdl"}]},{"type":"paragraph","content":[{"type":"text","text":"Ph∆∞∆°ng th·ª©c thanh to√°n: Ch·ªçn t·ª´ danh s√°ch x·ªï xu·ªëng (v√≠ d·ª•: ti·ªÅn m·∫∑t, chuy·ªÉn kho·∫£n,...)"}]},{"type":"paragraph","content":[{"type":"text","text":"Hi·ªÉn th·ªã:"}]},{"type":"paragraph","content":[{"type":"text","text":"T·ªïng: th·ªÉ hi·ªán s·ªë ti·ªÅn d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng ·ªü phi·∫øu kh√°m ƒë√≥"}]},{"type":"paragraph","content":[{"type":"text","text":"üñ®Ô∏è N√∫t ch·ª©c nƒÉng:"}]},{"type":"paragraph","content":[{"type":"text","text":"In: N√∫t in h√≥a ƒë∆°n (n√∫t n√†y ƒëang c√≥ m√†u nh·∫°t, "}]},{"type":"paragraph","content":[{"type":"text","text":"L∆∞u th√¥ng tin: N√∫t x√°c nh·∫≠n l∆∞u h√≥a ƒë∆°n, n·ªïi b·∫≠t v·ªõi m√†u xanh d∆∞∆°ng"}]},{"type":"paragraph","content":[{"type":"text","text":"üîó Bi·ªÉu t∆∞·ª£ng g√≥c d∆∞·ªõi b√™n ph·∫£i:"}]},{"type":"paragraph","content":[{"type":"text","text":"N√∫t quay l·∫°i"}]},{"type":"paragraph","content":[{"type":"text","text":"N√∫t v·ªÅ trang ch·ªß"}]}]},"content":[{"type":"text","text":"ti·∫øp theo v·ªõi nhakhoaso h√£y t·∫°o cho t√¥i ch·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n s·∫Ω g·ªìm 2 ch·ª©c nƒÉng con ƒë√≥ l√† t·∫°o h√≥a ƒë∆°n thanh to√°n, danh s√°ch h√≥a ƒë∆°n"},{"type":"text","text":"B√¢y gi·ªù h√£y thi·∫øt l·∫≠p ch·ª©c nƒÉng con: t·∫°o h√≥a ƒë∆°n ƒë∆∞·ª£c m√¥ t·∫£ nh∆∞ sau:"},{"type":"text","text":"\"üßæ Ch·ª©c nƒÉng: T·∫°o h√≥a ƒë∆°n"},{"type":"text","text":"Ph·∫ßn n·ªôi dung ch√≠nh b√™n ph·∫£i hi·ªÉn th·ªã form t·∫°o m·ªõi h√≥a ƒë∆°n, bao g·ªìm:"},{"type":"text","text":"C√°c tr∆∞·ªùng th√¥ng tin c·∫ßn nh·∫≠p (b·∫Øt bu·ªôc c√≥ d·∫•u *):"},{"type":"text","text":"M√£ H√≥a ƒê∆°n: Nh·∫≠p m√£ ƒë·ªãnh danh h√≥a ƒë∆°n, t·ª± ƒë·ªông ƒëi·ªÅn"},{"type":"text","text":"M√£ Phi·∫øu Kh√°m: Li√™n k·∫øt ƒë·∫øn phi·∫øu kh√°m t∆∞∆°ng ·ª©ng"},{"type":"text","text":"Ng√†y: Ch·ªçn ng√†y t·∫°o h√≥a ƒë∆°n (ƒë·ªãnh d·∫°ng dd/mm/yyyy)"},{"type":"text","text":"B·ªánh nh√¢n: Nh·∫≠p t√™n b·ªánh nh√¢n ƒë∆∞·ª£c nh·∫≠p vs csdl"},{"type":"text","text":"B√°c sƒ© kh√°m: Nh·∫≠p t√™n b√°c sƒ© nh·∫≠p t·ª´ csdl"},{"type":"text","text":"D·ªãch v·ª•: Nh·∫≠p t√™n d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng nh·∫≠p t·ª´ csdl"},{"type":"text","text":"Gi√° d·ªãch v·ª•: Nh·∫≠p s·ªë ti·ªÅn c·ªßa d·ªãch v·ª• t·ª´ csdl"},{"type":"text","text":"Ph∆∞∆°ng th·ª©c thanh to√°n: Ch·ªçn t·ª´ danh s√°ch x·ªï xu·ªëng (v√≠ d·ª•: ti·ªÅn m·∫∑t, chuy·ªÉn kho·∫£n,...)"},{"type":"text","text":"Hi·ªÉn th·ªã:"},{"type":"text","text":"T·ªïng: th·ªÉ hi·ªán s·ªë ti·ªÅn d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng ·ªü phi·∫øu kh√°m ƒë√≥"},{"type":"text","text":"üñ®Ô∏è N√∫t ch·ª©c nƒÉng:"},{"type":"text","text":"In: N√∫t in h√≥a ƒë∆°n (n√∫t n√†y ƒëang c√≥ m√†u nh·∫°t, "},{"type":"text","text":"L∆∞u th√¥ng tin: N√∫t x√°c nh·∫≠n l∆∞u h√≥a ƒë∆°n, n·ªïi b·∫≠t v·ªõi m√†u xanh d∆∞∆°ng"},{"type":"text","text":"üîó Bi·ªÉu t∆∞·ª£ng g√≥c d∆∞·ªõi b√™n ph·∫£i:"},{"type":"text","text":"N√∫t quay l·∫°i"},{"type":"text","text":"N√∫t v·ªÅ trang ch·ªß"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/database/dich_vu.py","path":"nhakhoaso/database/dich_vu.py","displayPath":"nhakhoaso/database/dich_vu.py","content":"from .db import execute_query\nfrom .utils import get_next_dich_vu_id\n\ndef get_all_dich_vu():\n    \"\"\"\n    L·∫•y danh s√°ch t·∫•t c·∫£ d·ªãch v·ª•\n    \"\"\"\n    query = \"\"\"\n    SELECT * FROM DICHVU\n    ORDER BY MaDV\n    \"\"\"\n    return execute_query(query, fetch=True)\n\ndef get_dich_vu_by_id(ma_dv):\n    \"\"\"\n    L·∫•y th√¥ng tin d·ªãch v·ª• theo m√£\n    \"\"\"\n    query = \"\"\"\n    SELECT * FROM DICHVU\n    WHERE MaDV = %s\n    \"\"\"\n    result = execute_query(query, (ma_dv,), fetch=True)\n    return result[0] if result else None\n\ndef search_dich_vu(tu_khoa, loai_tim_kiem='ma_dv'):\n    \"\"\"\n    T√¨m ki·∫øm d·ªãch v·ª• theo t·ª´ kh√≥a v√† lo·∫°i t√¨m ki·∫øm\n    \n    Args:\n        tu_khoa (str): T·ª´ kh√≥a t√¨m ki·∫øm\n        loai_tim_kiem (str): Lo·∫°i t√¨m ki·∫øm (ma_dv, ten_dv, gia)\n        \n    Returns:\n        list: Danh s√°ch d·ªãch v·ª• t√¨m th·∫•y\n    \"\"\"\n    if loai_tim_kiem == 'ma_dv':\n        query = \"\"\"\n        SELECT * FROM DICHVU\n        WHERE MaDV LIKE %s\n        \"\"\"\n    elif loai_tim_kiem == 'ten_dv':\n        query = \"\"\"\n        SELECT * FROM DICHVU\n        WHERE TenDV LIKE %s\n        \"\"\"\n    elif loai_tim_kiem == 'gia':\n        # T√¨m ki·∫øm theo kho·∫£ng gi√°\n        try:\n            gia = float(tu_khoa)\n            query = \"\"\"\n            SELECT * FROM DICHVU\n            WHERE Gia = %s\n            \"\"\"\n            return execute_query(query, (gia,), fetch=True)\n        except ValueError:\n            # N·∫øu kh√¥ng ph·∫£i s·ªë, tr·∫£ v·ªÅ danh s√°ch r·ªóng\n            return []\n    else:\n        return []\n        \n    return execute_query(query, (f'%{tu_khoa}%',), fetch=True)\n\ndef create_dich_vu(ten_dv, gia, ma_dv=None):\n    \"\"\"\n    T·∫°o m·ªõi d·ªãch v·ª•\n    \n    Args:\n        ten_dv (str): T√™n d·ªãch v·ª•\n        gia (float): Gi√° d·ªãch v·ª•\n        ma_dv (str, optional): M√£ d·ªãch v·ª• (n·∫øu kh√¥ng cung c·∫•p s·∫Ω t·ª± ƒë·ªông t·∫°o)\n        \n    Returns:\n        tuple: (ma_dv, success) - M√£ d·ªãch v·ª• v√† k·∫øt qu·∫£ th√†nh c√¥ng hay kh√¥ng\n    \"\"\"\n    # N·∫øu kh√¥ng c√≥ m√£ d·ªãch v·ª•, t·∫°o m√£ m·ªõi\n    if not ma_dv:\n        ma_dv = get_next_dich_vu_id()\n        \n    query = \"\"\"\n    INSERT INTO DICHVU (MaDV, TenDV, Gia)\n    VALUES (%s, %s, %s)\n    \"\"\"\n    \n    try:\n        execute_query(query, (ma_dv, ten_dv, gia))\n        return ma_dv, True\n    except Exception as e:\n        print(f\"L·ªói khi t·∫°o d·ªãch v·ª•: {e}\")\n        return None, False\n\ndef update_dich_vu(ma_dv, ten_dv, gia):\n    \"\"\"\n    C·∫≠p nh·∫≠t th√¥ng tin d·ªãch v·ª•\n    \"\"\"\n    query = \"\"\"\n    UPDATE DICHVU\n    SET TenDV = %s, Gia = %s\n    WHERE MaDV = %s\n    \"\"\"\n    \n    try:\n        execute_query(query, (ten_dv, gia, ma_dv))\n        return True\n    except Exception as e:\n        print(f\"L·ªói khi c·∫≠p nh·∫≠t d·ªãch v·ª•: {e}\")\n        return False\n\ndef delete_dich_vu(ma_dv):\n    \"\"\"\n    X√≥a d·ªãch v·ª• theo m√£\n    \"\"\"\n    # Ki·ªÉm tra xem d·ªãch v·ª• c√≥ ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng trong phi·∫øu kh√°m kh√¥ng\n    check_query = \"\"\"\n    SELECT COUNT(*) as count FROM PHIEUKHAM\n    WHERE MaDV = %s\n    \"\"\"\n    result = execute_query(check_query, (ma_dv,), fetch=True)\n    \n    if result and result[0]['count'] > 0:\n        return False, \"Kh√¥ng th·ªÉ x√≥a d·ªãch v·ª• ƒëang ƒë∆∞·ª£c s·ª≠ d·ª•ng trong phi·∫øu kh√°m\"\n    \n    query = \"DELETE FROM DICHVU WHERE MaDV = %s\"\n    try:\n        execute_query(query, (ma_dv,))\n        return True, \"X√≥a d·ªãch v·ª• th√†nh c√¥ng\"\n    except Exception as e:\n        print(f\"L·ªói khi x√≥a d·ªãch v·ª•: {e}\")\n        return False, f\"L·ªói: {str(e)}\"","language":"python"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745254040873,"isInternal":false},{"id":"686e9bba-82d2-4989-9b11-8d64d70d9a83","role":"assistant","createdAt":1745254048501,"content":[{"type":"text","text":"T√¥i s·∫Ω gi√∫p b·∫°n thi·∫øt l·∫≠p ch·ª©c nƒÉng t·∫°o h√≥a ƒë∆°n thanh to√°n cho h·ªá th·ªëng nhakhoaso. ƒê·∫ßu ti√™n, t√¥i c·∫ßn t√¨m hi·ªÉu c·∫•u tr√∫c hi·ªán t·∫°i c·ªßa d·ª± √°n ƒë·ªÉ c√≥ th·ªÉ t√≠ch h·ª£p ch·ª©c nƒÉng m·ªõi m·ªôt c√°ch ph√π h·ª£p."},{"type":"toolCall","toolCallId":"toolu_018Y14gpcgW6fK61CHKdtfTt","isHidden":false,"title":"","statusText":"Viewed root folder","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong","path":"","displayPath":""}]}},{"type":"text","text":"T√¥i s·∫Ω t·∫≠p trung v√†o d·ª± √°n nhakhoaso. Tr∆∞·ªõc ti√™n, t√¥i c·∫ßn hi·ªÉu c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu hi·ªán t·∫°i ƒë·ªÉ xem c√°c b·∫£ng li√™n quan ƒë·∫øn h√≥a ƒë∆°n."},{"type":"toolCall","toolCallId":"toolu_01XQtLek1Lny5z8ZP59r4xaA","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/init_db.sql","path":"nhakhoaso/database/init_db.sql","displayPath":"nhakhoaso/database/init_db.sql"}]}},{"type":"text","text":"T√¥i th·∫•y r·∫±ng c∆° s·ªü d·ªØ li·ªáu hi·ªán t·∫°i ch∆∞a c√≥ b·∫£ng HOADON. T√¥i c·∫ßn t·∫°o b·∫£ng n√†y ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin h√≥a ƒë∆°n thanh to√°n. Ti·∫øp theo, t√¥i s·∫Ω xem c·∫•u tr√∫c c·ªßa ·ª©ng d·ª•ng ƒë·ªÉ hi·ªÉu c√°ch t√≠ch h·ª£p ch·ª©c nƒÉng m·ªõi."},{"type":"toolCall","toolCallId":"toolu_0186TJUsoPnGHncMXU87FHB8","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"text","text":"T√¥i c·∫ßn xem th√™m ph·∫ßn c√≤n l·∫°i c·ªßa file app.py ƒë·ªÉ hi·ªÉu c√°ch tri·ªÉn khai c√°c route v√† ch·ª©c nƒÉng:"},{"type":"toolCall","toolCallId":"toolu_01E9xT9LtZFu4V5jTfmrEcFW","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"text","text":"T√¥i c·∫ßn xem file utils.py ƒë·ªÉ hi·ªÉu c√°ch t·∫°o ID t·ª± ƒë·ªông cho c√°c ƒë·ªëi t∆∞·ª£ng:"},{"type":"toolCall","toolCallId":"toolu_01LU7EenXsuV5mrG7ZucpAiJ","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/utils.py","path":"nhakhoaso/database/utils.py","displayPath":"nhakhoaso/database/utils.py"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i c·∫ßn xem file phieu_kham.py ƒë·ªÉ hi·ªÉu c√°ch l·∫•y th√¥ng tin phi·∫øu kh√°m:"},{"type":"toolCall","toolCallId":"toolu_01XrxGVhSUjM7xa6w7ckCbQW","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/phieu_kham.py","path":"nhakhoaso/database/phieu_kham.py","displayPath":"nhakhoaso/database/phieu_kham.py"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i ƒë√£ c√≥ ƒë·ªß th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu tri·ªÉn khai ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n. T√¥i s·∫Ω th·ª±c hi·ªán c√°c b∆∞·ªõc sau:\n\n1. T·∫°o b·∫£ng HOADON trong c∆° s·ªü d·ªØ li·ªáu\n2. T·∫°o module database/hoa_don.py ƒë·ªÉ x·ª≠ l√Ω c√°c thao t√°c v·ªõi h√≥a ƒë∆°n\n3. C·∫≠p nh·∫≠t utils.py ƒë·ªÉ th√™m h√†m t·∫°o m√£ h√≥a ƒë∆°n t·ª± ƒë·ªông\n4. C·∫≠p nh·∫≠t app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng h√≥a ƒë∆°n\n5. T·∫°o c√°c template HTML cho ch·ª©c nƒÉng h√≥a ƒë∆°n\n\nB·∫Øt ƒë·∫ßu v·ªõi vi·ªác t·∫°o b·∫£ng HOADON trong c∆° s·ªü d·ªØ li·ªáu:"},{"type":"toolCall","toolCallId":"toolu_018uNYMcfvFj9i9MrCreBA3K","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/init_db.sql","path":"nhakhoaso/database/init_db.sql","displayPath":"nhakhoaso/database/init_db.sql"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/init_db.sql\n+++ nhakhoaso/database/init_db.sql\n@@ -44,6 +44,17 @@\n     FOREIGN KEY (MaDV) REFERENCES DICHVU(MaDV)\n );\n \n+-- B·∫£ng HOADON\n+CREATE TABLE IF NOT EXISTS HOADON (\n+    MaHD CHAR(10) NOT NULL PRIMARY KEY, -- M√£ h√≥a ƒë∆°n\n+    MaPK CHAR(10) NOT NULL, -- M√£ phi·∫øu kh√°m\n+    NgayLap DATETIME NOT NULL, -- Ng√†y l·∫≠p h√≥a ƒë∆°n\n+    TongTien DECIMAL(18,2) NOT NULL, -- T·ªïng ti·ªÅn\n+    PhuongThucThanhToan VARCHAR(50) NOT NULL, -- Ph∆∞∆°ng th·ª©c thanh to√°n\n+    TrangThai VARCHAR(50) DEFAULT 'ƒê√£ thanh to√°n', -- Tr·∫°ng th√°i h√≥a ƒë∆°n\n+    FOREIGN KEY (MaPK) REFERENCES PHIEUKHAM(MaPK)\n+);\n+\n -- Th√™m d·ªØ li·ªáu m·∫´u cho b·∫£ng BENHNHAN\n INSERT INTO BENHNHAN (MaBN, HoTen, NgaySinh, GioiTinh, Sdt) VALUES\n (\"BN00001\", \"Nguy·ªÖn Th·ªã Mai\", \"1992-03-10\", \"N·ªØ\", \"0901122334\"),","refToolCallId":"toolu_018uNYMcfvFj9i9MrCreBA3K"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω c·∫≠p nh·∫≠t utils.py ƒë·ªÉ th√™m h√†m t·∫°o m√£ h√≥a ƒë∆°n t·ª± ƒë·ªông:"},{"type":"toolCall","toolCallId":"toolu_018mhwdp5CAyc5zSvLGPn7ct","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/utils.py","path":"nhakhoaso/database/utils.py","displayPath":"nhakhoaso/database/utils.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/utils.py\n+++ nhakhoaso/database/utils.py\n@@ -93,3 +93,12 @@\n         str: M√£ phi·∫øu kh√°m m·ªõi\n     \"\"\"\n     return generate_next_id('PHIEUKHAM', 'MaPK', 'PK', 5)\n+\n+def get_next_hoa_don_id():\n+    \"\"\"\n+    T·∫°o m√£ h√≥a ƒë∆°n ti·∫øp theo\n+    \n+    Returns:\n+        str: M√£ h√≥a ƒë∆°n m·ªõi\n+    \"\"\"\n+    return generate_next_id('HOADON', 'MaHD', 'HD', 5)","refToolCallId":"toolu_018mhwdp5CAyc5zSvLGPn7ct"},{"type":"text","text":"B√¢y gi·ªù, t√¥i s·∫Ω t·∫°o module database/hoa_don.py ƒë·ªÉ x·ª≠ l√Ω c√°c thao t√°c v·ªõi h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01QQsqphSUjTrLwZGSKEaaPJ","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/hoa_don.py","path":"nhakhoaso/database/hoa_don.py","displayPath":"nhakhoaso/database/hoa_don.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/hoa_don.py\n+++ nhakhoaso/database/hoa_don.py\n@@ -0,0 +1,238 @@\n+from .db import execute_query\n+import datetime\n+from .utils import get_next_hoa_don_id\n+\n+def get_all_hoa_don():\n+    \"\"\"\n+    L·∫•y danh s√°ch t·∫•t c·∫£ h√≥a ƒë∆°n\n+    \n+    Returns:\n+        list: Danh s√°ch h√≥a ƒë∆°n\n+    \"\"\"\n+    query = \"\"\"\n+    SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, \n+           bn.HoTen as TenBenhNhan, \n+           bs.HoTen as TenBacSi,\n+           dv.TenDV, dv.Gia\n+    FROM HOADON h\n+    JOIN PHIEUKHAM p ON h.MaPK = p.MaPK\n+    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+    JOIN BACSI bs ON p.MaBS = bs.MaBS\n+    JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+    ORDER BY h.NgayLap DESC\n+    \"\"\"\n+    return execute_query(query, fetch=True)\n+\n+def get_hoa_don_by_id(ma_hd):\n+    \"\"\"\n+    L·∫•y th√¥ng tin h√≥a ƒë∆°n theo m√£\n+    \n+    Args:\n+        ma_hd (str): M√£ h√≥a ƒë∆°n\n+        \n+    Returns:\n+        dict: Th√¥ng tin h√≥a ƒë∆°n\n+    \"\"\"\n+    query = \"\"\"\n+    SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, \n+           bn.HoTen as TenBenhNhan, \n+           bs.HoTen as TenBacSi,\n+           dv.TenDV, dv.Gia\n+    FROM HOADON h\n+    JOIN PHIEUKHAM p ON h.MaPK = p.MaPK\n+    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+    JOIN BACSI bs ON p.MaBS = bs.MaBS\n+    JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+    WHERE h.MaHD = %s\n+    \"\"\"\n+    result = execute_query(query, (ma_hd,), fetch=True)\n+    return result[0] if result else None\n+\n+def search_hoa_don(tu_khoa, loai_tim_kiem='ma_hoa_don'):\n+    \"\"\"\n+    T√¨m ki·∫øm h√≥a ƒë∆°n theo t·ª´ kh√≥a v√† lo·∫°i t√¨m ki·∫øm\n+    \n+    Args:\n+        tu_khoa (str): T·ª´ kh√≥a t√¨m ki·∫øm\n+        loai_tim_kiem (str): Lo·∫°i t√¨m ki·∫øm (ma_hoa_don, ma_phieu_kham, ma_benh_nhan)\n+        \n+    Returns:\n+        list: Danh s√°ch h√≥a ƒë∆°n t√¨m th·∫•y\n+    \"\"\"\n+    if loai_tim_kiem == 'ma_hoa_don':\n+        query = \"\"\"\n+        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, \n+               bn.HoTen as TenBenhNhan, \n+               bs.HoTen as TenBacSi,\n+               dv.TenDV, dv.Gia\n+        FROM HOADON h\n+        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK\n+        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+        JOIN BACSI bs ON p.MaBS = bs.MaBS\n+        JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+        WHERE h.MaHD LIKE %s\n+        \"\"\"\n+    elif loai_tim_kiem == 'ma_phieu_kham':\n+        query = \"\"\"\n+        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, \n+               bn.HoTen as TenBenhNhan, \n+               bs.HoTen as TenBacSi,\n+               dv.TenDV, dv.Gia\n+        FROM HOADON h\n+        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK\n+        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+        JOIN BACSI bs ON p.MaBS = bs.MaBS\n+        JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+        WHERE h.MaPK LIKE %s\n+        \"\"\"\n+    elif loai_tim_kiem == 'ma_benh_nhan':\n+        query = \"\"\"\n+        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, \n+               bn.HoTen as TenBenhNhan, \n+               bs.HoTen as TenBacSi,\n+               dv.TenDV, dv.Gia\n+        FROM HOADON h\n+        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK\n+        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+        JOIN BACSI bs ON p.MaBS = bs.MaBS\n+        JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+        WHERE p.MaBN LIKE %s\n+        \"\"\"\n+    else:\n+        return []\n+        \n+    return execute_query(query, (f'%{tu_khoa}%',), fetch=True)\n+\n+def create_hoa_don(ma_pk, phuong_thuc_thanh_toan, ma_hd=None, ngay_lap=None):\n+    \"\"\"\n+    T·∫°o m·ªõi h√≥a ƒë∆°n\n+    \n+    Args:\n+        ma_pk (str): M√£ phi·∫øu kh√°m\n+        phuong_thuc_thanh_toan (str): Ph∆∞∆°ng th·ª©c thanh to√°n\n+        ma_hd (str, optional): M√£ h√≥a ƒë∆°n (n·∫øu kh√¥ng cung c·∫•p s·∫Ω t·ª± ƒë·ªông t·∫°o)\n+        ngay_lap (str, optional): Ng√†y l·∫≠p h√≥a ƒë∆°n (ƒë·ªãnh d·∫°ng YYYY-MM-DD HH:MM:SS)\n+        \n+    Returns:\n+        tuple: (ma_hd, success) - M√£ h√≥a ƒë∆°n v√† k·∫øt qu·∫£ th√†nh c√¥ng hay kh√¥ng\n+    \"\"\"\n+    # N·∫øu kh√¥ng c√≥ m√£ h√≥a ƒë∆°n, t·∫°o m√£ m·ªõi\n+    if not ma_hd:\n+        ma_hd = get_next_hoa_don_id()\n+        \n+    # N·∫øu kh√¥ng c√≥ ng√†y l·∫≠p, s·ª≠ d·ª•ng ng√†y hi·ªán t·∫°i\n+    if not ngay_lap:\n+        ngay_lap = datetime.datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n+    \n+    # L·∫•y th√¥ng tin gi√° d·ªãch v·ª• t·ª´ phi·∫øu kh√°m\n+    query_gia = \"\"\"\n+    SELECT dv.Gia\n+    FROM PHIEUKHAM pk\n+    JOIN DICHVU dv ON pk.MaDV = dv.MaDV\n+    WHERE pk.MaPK = %s\n+    \"\"\"\n+    result = execute_query(query_gia, (ma_pk,), fetch=True)\n+    \n+    if not result:\n+        return None, False\n+    \n+    tong_tien = result[0]['Gia']\n+    \n+    # T·∫°o h√≥a ƒë∆°n m·ªõi\n+    query = \"\"\"\n+    INSERT INTO HOADON (MaHD, MaPK, NgayLap, TongTien, PhuongThucThanhToan)\n+    VALUES (%s, %s, %s, %s, %s)\n+    \"\"\"\n+    \n+    try:\n+        execute_query(query, (ma_hd, ma_pk, ngay_lap, tong_tien, phuong_thuc_thanh_toan))\n+        return ma_hd, True\n+    except Exception as e:\n+        print(f\"L·ªói khi t·∫°o h√≥a ƒë∆°n: {e}\")\n+        return None, False\n+\n+def update_hoa_don(ma_hd, ma_pk, phuong_thuc_thanh_toan, trang_thai=None):\n+    \"\"\"\n+    C·∫≠p nh·∫≠t th√¥ng tin h√≥a ƒë∆°n\n+    \n+    Args:\n+        ma_hd (str): M√£ h√≥a ƒë∆°n\n+        ma_pk (str): M√£ phi·∫øu kh√°m\n+        phuong_thuc_thanh_toan (str): Ph∆∞∆°ng th·ª©c thanh to√°n\n+        trang_thai (str, optional): Tr·∫°ng th√°i h√≥a ƒë∆°n\n+        \n+    Returns:\n+        bool: K·∫øt qu·∫£ c·∫≠p nh·∫≠t\n+    \"\"\"\n+    # L·∫•y th√¥ng tin gi√° d·ªãch v·ª• t·ª´ phi·∫øu kh√°m\n+    query_gia = \"\"\"\n+    SELECT dv.Gia\n+    FROM PHIEUKHAM pk\n+    JOIN DICHVU dv ON pk.MaDV = dv.MaDV\n+    WHERE pk.MaPK = %s\n+    \"\"\"\n+    result = execute_query(query_gia, (ma_pk,), fetch=True)\n+    \n+    if not result:\n+        return False\n+    \n+    tong_tien = result[0]['Gia']\n+    \n+    # C·∫≠p nh·∫≠t h√≥a ƒë∆°n\n+    if trang_thai:\n+        query = \"\"\"\n+        UPDATE HOADON\n+        SET MaPK = %s, TongTien = %s, PhuongThucThanhToan = %s, TrangThai = %s\n+        WHERE MaHD = %s\n+        \"\"\"\n+        params = (ma_pk, tong_tien, phuong_thuc_thanh_toan, trang_thai, ma_hd)\n+    else:\n+        query = \"\"\"\n+        UPDATE HOADON\n+        SET MaPK = %s, TongTien = %s, PhuongThucThanhToan = %s\n+        WHERE MaHD = %s\n+        \"\"\"\n+        params = (ma_pk, tong_tien, phuong_thuc_thanh_toan, ma_hd)\n+    \n+    try:\n+        execute_query(query, params)\n+        return True\n+    except Exception as e:\n+        print(f\"L·ªói khi c·∫≠p nh·∫≠t h√≥a ƒë∆°n: {e}\")\n+        return False\n+\n+def delete_hoa_don(ma_hd):\n+    \"\"\"\n+    X√≥a h√≥a ƒë∆°n theo m√£\n+    \n+    Args:\n+        ma_hd (str): M√£ h√≥a ƒë∆°n\n+        \n+    Returns:\n+        tuple: (success, message) - K·∫øt qu·∫£ x√≥a v√† th√¥ng b√°o\n+    \"\"\"\n+    query = \"DELETE FROM HOADON WHERE MaHD = %s\"\n+    try:\n+        execute_query(query, (ma_hd,))\n+        return True, \"X√≥a h√≥a ƒë∆°n th√†nh c√¥ng\"\n+    except Exception as e:\n+        print(f\"L·ªói khi x√≥a h√≥a ƒë∆°n: {e}\")\n+        return False, f\"L·ªói: {str(e)}\"\n+\n+def get_phieu_kham_chua_thanh_toan():\n+    \"\"\"\n+    L·∫•y danh s√°ch phi·∫øu kh√°m ch∆∞a c√≥ h√≥a ƒë∆°n\n+    \n+    Returns:\n+        list: Danh s√°ch phi·∫øu kh√°m ch∆∞a thanh to√°n\n+    \"\"\"\n+    query = \"\"\"\n+    SELECT p.*, bn.HoTen as TenBenhNhan, bs.HoTen as TenBacSi, dv.TenDV, dv.Gia\n+    FROM PHIEUKHAM p\n+    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN\n+    JOIN BACSI bs ON p.MaBS = bs.MaBS\n+    JOIN DICHVU dv ON p.MaDV = dv.MaDV\n+    WHERE p.MaPK NOT IN (SELECT MaPK FROM HOADON)\n+    ORDER BY p.NgayKham DESC\n+    \"\"\"\n+    return execute_query(query, fetch=True)","refToolCallId":"toolu_01QQsqphSUjTrLwZGSKEaaPJ"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω c·∫≠p nh·∫≠t app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01T2Bdue26eTYy85EUZgKrZk","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -5,7 +5,8 @@\n from database.phieu_kham import get_all_phieu_kham, get_phieu_kham_by_id, search_phieu_kham, create_phieu_kham, update_phieu_kham, delete_phieu_kham\n from database.lich_hen import get_all_lich_hen, get_lich_hen_by_id, search_lich_hen, create_lich_hen, update_lich_hen, delete_lich_hen\n from database.dich_vu import get_all_dich_vu, get_dich_vu_by_id, search_dich_vu, create_dich_vu, update_dich_vu, delete_dich_vu\n-from database.utils import get_next_benh_nhan_id, get_next_bac_si_id, get_next_dich_vu_id, get_next_lich_hen_id, get_next_phieu_kham_id\n+from database.utils import get_next_benh_nhan_id, get_next_bac_si_id, get_next_dich_vu_id, get_next_lich_hen_id, get_next_phieu_kham_id, get_next_hoa_don_id\n+from database.hoa_don import get_all_hoa_don, get_hoa_don_by_id, search_hoa_don, create_hoa_don, update_hoa_don, delete_hoa_don, get_phieu_kham_chua_thanh_toan\n import datetime, json\n \n app = Flask(__name__)","refToolCallId":"toolu_01T2Bdue26eTYy85EUZgKrZk"},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω c·∫≠p nh·∫≠t route cho ch·ª©c nƒÉng thanh to√°n:"},{"type":"toolCall","toolCallId":"toolu_01AY1MkqaFhSZsjYPshYNXwK","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -324,6 +324,83 @@\n @app.route('/thanh-toan')\n def thanh_toan():\n     return render_template('thanh_toan.html')\n+\n+# Danh s√°ch h√≥a ƒë∆°n\n+@app.route('/hoa-don')\n+def hoa_don_list():\n+    hoa_don_list = get_all_hoa_don()\n+    return render_template('hoa_don.html', hoa_don_list=hoa_don_list)\n+\n+# T·∫°o m·ªõi h√≥a ƒë∆°n\n+@app.route('/hoa-don/them-moi', methods=['GET', 'POST'])\n+def them_moi_hoa_don():\n+    if request.method == 'POST':\n+        # X·ª≠ l√Ω d·ªØ li·ªáu form khi submit\n+        ma_hoa_don = request.form.get('ma_hoa_don')\n+        ma_phieu_kham = request.form.get('ma_phieu_kham')\n+        phuong_thuc_thanh_toan = request.form.get('phuong_thuc_thanh_toan')\n+        ngay_lap = request.form.get('ngay_lap')\n+        \n+        # Ki·ªÉm tra d·ªØ li·ªáu ƒë·∫ßu v√†o\n+        if not ma_phieu_kham or not phuong_thuc_thanh_toan:\n+            flash('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc', 'error')\n+        else:\n+            # L∆∞u v√†o database\n+            ma_hd, result = create_hoa_don(\n+                ma_phieu_kham,\n+                phuong_thuc_thanh_toan,\n+                ma_hoa_don,\n+                ngay_lap\n+            )\n+            \n+            if result:\n+                flash(f'T·∫°o h√≥a ƒë∆°n th√†nh c√¥ng v·ªõi m√£ {ma_hd}!', 'success')\n+                return redirect(url_for('hoa_don_list'))\n+            else:\n+                flash('C√≥ l·ªói x·∫£y ra khi t·∫°o h√≥a ƒë∆°n', 'error')\n+                    \n+    # GET request - hi·ªÉn th·ªã form v·ªõi m√£ h√≥a ƒë∆°n m·ªõi\n+    ma_hoa_don = get_next_hoa_don_id()\n+    phieu_kham_list = get_phieu_kham_chua_thanh_toan()\n+    \n+    return render_template('them_moi_hoa_don.html', \n+                          ma_hoa_don=ma_hoa_don,\n+                          phieu_kham_list=phieu_kham_list)\n+\n+# T√¨m ki·∫øm h√≥a ƒë∆°n\n+@app.route('/hoa-don/tim-kiem', methods=['GET', 'POST'])\n+def tim_kiem_hoa_don():\n+    # D·ªØ li·ªáu m·∫´u cho k·∫øt qu·∫£ t√¨m ki·∫øm\n+    ket_qua = []\n+\n+    if request.method == 'POST':\n+        tu_khoa = request.form.get('tu_khoa')\n+        loai_tim_kiem = request.form.get('loai_tim_kiem', 'ma_hoa_don')\n+        \n+        if tu_khoa:\n+            ket_qua = search_hoa_don(tu_khoa, loai_tim_kiem)\n+            \n+    return render_template('tim_kiem_hoa_don.html', ket_qua=ket_qua)\n+\n+# Chi ti·∫øt h√≥a ƒë∆°n\n+@app.route('/hoa-don/chi-tiet/<ma_hd>')\n+def chi_tiet_hoa_don(ma_hd):\n+    hd = get_hoa_don_by_id(ma_hd)\n+    if not hd:\n+        flash('Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n', 'error')\n+        return redirect(url_for('hoa_don_list'))\n+    return render_template('chi_tiet_hoa_don.html', hoa_don=hd)\n+\n+# API x√≥a h√≥a ƒë∆°n\n+@app.route('/api/hoa-don/<ma_hd>', methods=['DELETE'])\n+def api_delete_hoa_don(ma_hd):\n+    try:\n+        result, message = delete_hoa_don(ma_hd)\n+        if not result:\n+            return jsonify({\"success\": False, \"message\": message}), 404\n+        return jsonify({\"success\": True, \"message\": message})\n+    except Exception as e:\n+        return jsonify({\"success\": False, \"message\": str(e)}), 500\n \n # B√°o c√°o v√† th·ªëng k√™\n @app.route('/bao-cao')","refToolCallId":"toolu_01AY1MkqaFhSZsjYPshYNXwK"},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω t·∫°o template HTML cho ch·ª©c nƒÉng t·∫°o h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_013HjtpEKuGbV3A6P2HhyU63","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/layout.html","path":"nhakhoaso/templates/layout.html","displayPath":"nhakhoaso/templates/layout.html"}]}},{"type":"toolCall","toolCallId":"toolu_0152HhyyYKR7vn3nATd14geu","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/index.html","path":"nhakhoaso/templates/index.html","displayPath":"nhakhoaso/templates/index.html"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω t·∫°o template cho trang thanh to√°n:"},{"type":"toolCall","toolCallId":"toolu_01SJCNqzEKHCxQvSB3zLhrtE","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/thanh_toan.html","path":"nhakhoaso/templates/thanh_toan.html","displayPath":"nhakhoaso/templates/thanh_toan.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/thanh_toan.html\n+++ nhakhoaso/templates/thanh_toan.html\n@@ -0,0 +1,100 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Qu·∫£n l√Ω thanh to√°n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"page-header\">\n+    <h2>Qu·∫£n l√Ω thanh to√°n</h2>\n+    <div class=\"breadcrumb\">\n+        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / <span>Qu·∫£n l√Ω thanh to√°n</span>\n+    </div>\n+</div>\n+\n+<div class=\"dashboard-container\">\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-header\">\n+            <h3>Ch·ª©c nƒÉng</h3>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"active\">\n+                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"main-content\">\n+        <div class=\"welcome-section\">\n+            <h3>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Qu·∫£n l√Ω thanh to√°n</h3>\n+            <p>Vui l√≤ng ch·ªçn ch·ª©c nƒÉng t·ª´ menu b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>\n+            \n+            <div class=\"feature-cards\">\n+                <div class=\"feature-card\" onclick=\"window.location.href='{{ url_for('them_moi_hoa_don') }}'\">\n+                    <div class=\"feature-icon\">\n+                        <i class=\"fas fa-file-invoice-dollar\"></i>\n+                    </div>\n+                    <h4>T·∫°o h√≥a ƒë∆°n</h4>\n+                    <p>T·∫°o m·ªõi h√≥a ƒë∆°n thanh to√°n cho phi·∫øu kh√°m</p>\n+                </div>\n+                \n+                <div class=\"feature-card\" onclick=\"window.location.href='{{ url_for('hoa_don_list') }}'\">\n+                    <div class=\"feature-icon\">\n+                        <i class=\"fas fa-list-alt\"></i>\n+                    </div>\n+                    <h4>Danh s√°ch h√≥a ƒë∆°n</h4>\n+                    <p>Xem danh s√°ch t·∫•t c·∫£ h√≥a ƒë∆°n ƒë√£ t·∫°o</p>\n+                </div>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .feature-cards {\n+        display: flex;\n+        gap: 20px;\n+        margin-top: 30px;\n+    }\n+    \n+    .feature-card {\n+        flex: 1;\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 25px;\n+        text-align: center;\n+        transition: all 0.3s ease;\n+        cursor: pointer;\n+    }\n+    \n+    .feature-card:hover {\n+        transform: translateY(-5px);\n+        box-shadow: 0 5px 15px rgba(0,0,0,0.15);\n+    }\n+    \n+    .feature-icon {\n+        font-size: 40px;\n+        color: #4a90e2;\n+        margin-bottom: 15px;\n+    }\n+    \n+    .feature-card h4 {\n+        font-size: 18px;\n+        margin-bottom: 10px;\n+        color: #333;\n+    }\n+    \n+    .feature-card p {\n+        color: #666;\n+        font-size: 14px;\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01SJCNqzEKHCxQvSB3zLhrtE"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω t·∫°o template cho trang danh s√°ch h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01Lk9XBuEg3b28fKbTFKpvcN","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/hoa_don.html","path":"nhakhoaso/templates/hoa_don.html","displayPath":"nhakhoaso/templates/hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/hoa_don.html\n+++ nhakhoaso/templates/hoa_don.html\n@@ -0,0 +1,133 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Danh s√°ch h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"page-header\">\n+    <h2>Danh s√°ch h√≥a ƒë∆°n</h2>\n+    <div class=\"breadcrumb\">\n+        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n+        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n+        <span>Danh s√°ch h√≥a ƒë∆°n</span>\n+    </div>\n+</div>\n+\n+<div class=\"dashboard-container\">\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-header\">\n+            <h3>Ch·ª©c nƒÉng</h3>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\" class=\"active\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"main-content\">\n+        <div class=\"action-bar\">\n+            <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"btn btn-primary\">\n+                <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n m·ªõi\n+            </a>\n+            <a href=\"{{ url_for('tim_kiem_hoa_don') }}\" class=\"btn btn-secondary\">\n+                <i class=\"fas fa-search\"></i> T√¨m ki·∫øm\n+            </a>\n+        </div>\n+\n+        {% with messages = get_flashed_messages(with_categories=true) %}\n+            {% if messages %}\n+                {% for category, message in messages %}\n+                    <div class=\"alert alert-{{ category }}\">\n+                        {{ message }}\n+                    </div>\n+                {% endfor %}\n+            {% endif %}\n+        {% endwith %}\n+\n+        <div class=\"data-table-container\">\n+            <table class=\"data-table\">\n+                <thead>\n+                    <tr>\n+                        <th>M√£ h√≥a ƒë∆°n</th>\n+                        <th>M√£ phi·∫øu kh√°m</th>\n+                        <th>B·ªánh nh√¢n</th>\n+                        <th>Ng√†y l·∫≠p</th>\n+                        <th>T·ªïng ti·ªÅn</th>\n+                        <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>\n+                        <th>Tr·∫°ng th√°i</th>\n+                        <th>Thao t√°c</th>\n+                    </tr>\n+                </thead>\n+                <tbody>\n+                    {% if hoa_don_list %}\n+                        {% for hd in hoa_don_list %}\n+                            <tr>\n+                                <td>{{ hd.MaHD }}</td>\n+                                <td>{{ hd.MaPK }}</td>\n+                                <td>{{ hd.TenBenhNhan }}</td>\n+                                <td>{{ hd.NgayLap }}</td>\n+                                <td>{{ \"{:,.0f}\".format(hd.TongTien) }} VNƒê</td>\n+                                <td>{{ hd.PhuongThucThanhToan }}</td>\n+                                <td>{{ hd.TrangThai }}</td>\n+                                <td class=\"actions\">\n+                                    <a href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" class=\"btn-icon\" title=\"Xem chi ti·∫øt\">\n+                                        <i class=\"fas fa-eye\"></i>\n+                                    </a>\n+                                    <button class=\"btn-icon delete-btn\" data-id=\"{{ hd.MaHD }}\" title=\"X√≥a\">\n+                                        <i class=\"fas fa-trash\"></i>\n+                                    </button>\n+                                </td>\n+                            </tr>\n+                        {% endfor %}\n+                    {% else %}\n+                        <tr>\n+                            <td colspan=\"8\" class=\"no-data\">Kh√¥ng c√≥ d·ªØ li·ªáu h√≥a ƒë∆°n</td>\n+                        </tr>\n+                    {% endif %}\n+                </tbody>\n+            </table>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // X·ª≠ l√Ω s·ª± ki·ªán x√≥a h√≥a ƒë∆°n\n+        const deleteButtons = document.querySelectorAll('.delete-btn');\n+        deleteButtons.forEach(button => {\n+            button.addEventListener('click', function() {\n+                const maHD = this.getAttribute('data-id');\n+                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h√≥a ƒë∆°n n√†y kh√¥ng?')) {\n+                    // G·ª≠i request x√≥a\n+                    fetch(`/api/hoa-don/${maHD}`, {\n+                        method: 'DELETE',\n+                    })\n+                    .then(response => response.json())\n+                    .then(data => {\n+                        if (data.success) {\n+                            alert(data.message);\n+                            // Reload trang sau khi x√≥a th√†nh c√¥ng\n+                            window.location.reload();\n+                        } else {\n+                            alert(data.message);\n+                        }\n+                    })\n+                    .catch(error => {\n+                        console.error('Error:', error);\n+                        alert('C√≥ l·ªói x·∫£y ra khi x√≥a h√≥a ƒë∆°n');\n+                    });\n+                }\n+            });\n+        });\n+    });\n+</script>\n+{% endblock %}","refToolCallId":"toolu_01Lk9XBuEg3b28fKbTFKpvcN"},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω t·∫°o template cho trang t·∫°o m·ªõi h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01MzgktFRyhDhvqBWZ2eLTTh","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/them_moi_hoa_don.html","path":"nhakhoaso/templates/them_moi_hoa_don.html","displayPath":"nhakhoaso/templates/them_moi_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/them_moi_hoa_don.html\n+++ nhakhoaso/templates/them_moi_hoa_don.html\n@@ -0,0 +1,279 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}T·∫°o h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"page-header\">\n+    <h2>T·∫°o h√≥a ƒë∆°n</h2>\n+    <div class=\"breadcrumb\">\n+        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n+        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n+        <span>T·∫°o h√≥a ƒë∆°n</span>\n+    </div>\n+</div>\n+\n+<div class=\"dashboard-container\">\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-header\">\n+            <h3>Ch·ª©c nƒÉng</h3>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"active\">\n+                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"main-content\">\n+        <div class=\"form-container\">\n+            <h3>Th√¥ng tin h√≥a ƒë∆°n</h3>\n+\n+            {% with messages = get_flashed_messages(with_categories=true) %}\n+                {% if messages %}\n+                    {% for category, message in messages %}\n+                        <div class=\"alert alert-{{ category }}\">\n+                            {{ message }}\n+                        </div>\n+                    {% endfor %}\n+                {% endif %}\n+            {% endwith %}\n+\n+            <form method=\"POST\" action=\"{{ url_for('them_moi_hoa_don') }}\" id=\"hoadonForm\">\n+                <div class=\"form-group\">\n+                    <label for=\"ma_hoa_don\">M√£ h√≥a ƒë∆°n <span class=\"required\">*</span></label>\n+                    <input type=\"text\" id=\"ma_hoa_don\" name=\"ma_hoa_don\" value=\"{{ ma_hoa_don }}\" readonly>\n+                    <small>M√£ h√≥a ƒë∆°n ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông</small>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"ma_phieu_kham\">M√£ phi·∫øu kh√°m <span class=\"required\">*</span></label>\n+                    <select id=\"ma_phieu_kham\" name=\"ma_phieu_kham\" required>\n+                        <option value=\"\">-- Ch·ªçn phi·∫øu kh√°m --</option>\n+                        {% for pk in phieu_kham_list %}\n+                            <option value=\"{{ pk.MaPK }}\" data-benh-nhan=\"{{ pk.TenBenhNhan }}\" data-bac-si=\"{{ pk.TenBacSi }}\" data-dich-vu=\"{{ pk.TenDV }}\" data-gia=\"{{ pk.Gia }}\">\n+                                {{ pk.MaPK }} - {{ pk.TenBenhNhan }} - {{ pk.NgayKham }}\n+                            </option>\n+                        {% endfor %}\n+                    </select>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"ngay_lap\">Ng√†y l·∫≠p <span class=\"required\">*</span></label>\n+                    <input type=\"datetime-local\" id=\"ngay_lap\" name=\"ngay_lap\" required>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"benh_nhan\">B·ªánh nh√¢n</label>\n+                    <input type=\"text\" id=\"benh_nhan\" readonly>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"bac_si\">B√°c sƒ© kh√°m</label>\n+                    <input type=\"text\" id=\"bac_si\" readonly>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"dich_vu\">D·ªãch v·ª•</label>\n+                    <input type=\"text\" id=\"dich_vu\" readonly>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"gia_dich_vu\">Gi√° d·ªãch v·ª•</label>\n+                    <input type=\"text\" id=\"gia_dich_vu\" readonly>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"phuong_thuc_thanh_toan\">Ph∆∞∆°ng th·ª©c thanh to√°n <span class=\"required\">*</span></label>\n+                    <select id=\"phuong_thuc_thanh_toan\" name=\"phuong_thuc_thanh_toan\" required>\n+                        <option value=\"\">-- Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n --</option>\n+                        <option value=\"Ti·ªÅn m·∫∑t\">Ti·ªÅn m·∫∑t</option>\n+                        <option value=\"Chuy·ªÉn kho·∫£n\">Chuy·ªÉn kho·∫£n</option>\n+                        <option value=\"Th·∫ª t√≠n d·ª•ng\">Th·∫ª t√≠n d·ª•ng</option>\n+                        <option value=\"V√≠ ƒëi·ªán t·ª≠\">V√≠ ƒëi·ªán t·ª≠</option>\n+                    </select>\n+                </div>\n+\n+                <div class=\"form-group\">\n+                    <label for=\"tong_tien\">T·ªïng ti·ªÅn</label>\n+                    <input type=\"text\" id=\"tong_tien\" readonly>\n+                </div>\n+\n+                <div class=\"form-actions\">\n+                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"window.location.href='{{ url_for('hoa_don_list') }}'\">\n+                        <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n+                    </button>\n+                    <button type=\"button\" class=\"btn btn-light\" id=\"printBtn\" disabled>\n+                        <i class=\"fas fa-print\"></i> In\n+                    </button>\n+                    <button type=\"submit\" class=\"btn btn-primary\">\n+                        <i class=\"fas fa-save\"></i> L∆∞u th√¥ng tin\n+                    </button>\n+                </div>\n+            </form>\n+        </div>\n+    </div>\n+</div>\n+\n+<div class=\"floating-buttons\">\n+    <a href=\"{{ url_for('hoa_don_list') }}\" class=\"floating-btn\" title=\"Quay l·∫°i\">\n+        <i class=\"fas fa-arrow-left\"></i>\n+    </a>\n+    <a href=\"{{ url_for('index') }}\" class=\"floating-btn\" title=\"V·ªÅ trang ch·ªß\">\n+        <i class=\"fas fa-home\"></i>\n+    </a>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // Thi·∫øt l·∫≠p ng√†y hi·ªán t·∫°i cho tr∆∞·ªùng ng√†y l·∫≠p\n+        const now = new Date();\n+        const year = now.getFullYear();\n+        const month = String(now.getMonth() + 1).padStart(2, '0');\n+        const day = String(now.getDate()).padStart(2, '0');\n+        const hours = String(now.getHours()).padStart(2, '0');\n+        const minutes = String(now.getMinutes()).padStart(2, '0');\n+        \n+        document.getElementById('ngay_lap').value = `${year}-${month}-${day}T${hours}:${minutes}`;\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán khi ch·ªçn phi·∫øu kh√°m\n+        const phieuKhamSelect = document.getElementById('ma_phieu_kham');\n+        phieuKhamSelect.addEventListener('change', function() {\n+            const selectedOption = this.options[this.selectedIndex];\n+            \n+            if (selectedOption.value) {\n+                // L·∫•y th√¥ng tin t·ª´ data attributes\n+                const benhNhan = selectedOption.getAttribute('data-benh-nhan');\n+                const bacSi = selectedOption.getAttribute('data-bac-si');\n+                const dichVu = selectedOption.getAttribute('data-dich-vu');\n+                const gia = selectedOption.getAttribute('data-gia');\n+                \n+                // C·∫≠p nh·∫≠t c√°c tr∆∞·ªùng th√¥ng tin\n+                document.getElementById('benh_nhan').value = benhNhan;\n+                document.getElementById('bac_si').value = bacSi;\n+                document.getElementById('dich_vu').value = dichVu;\n+                document.getElementById('gia_dich_vu').value = formatCurrency(gia);\n+                document.getElementById('tong_tien').value = formatCurrency(gia);\n+                \n+                // K√≠ch ho·∫°t n√∫t in\n+                document.getElementById('printBtn').disabled = false;\n+            } else {\n+                // X√≥a c√°c tr∆∞·ªùng th√¥ng tin n·∫øu kh√¥ng ch·ªçn phi·∫øu kh√°m\n+                document.getElementById('benh_nhan').value = '';\n+                document.getElementById('bac_si').value = '';\n+                document.getElementById('dich_vu').value = '';\n+                document.getElementById('gia_dich_vu').value = '';\n+                document.getElementById('tong_tien').value = '';\n+                \n+                // V√¥ hi·ªáu h√≥a n√∫t in\n+                document.getElementById('printBtn').disabled = true;\n+            }\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n+        document.getElementById('printBtn').addEventListener('click', function() {\n+            // M·ªü c·ª≠a s·ªï in\n+            window.print();\n+        });\n+        \n+        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá\n+        function formatCurrency(amount) {\n+            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);\n+        }\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .floating-buttons {\n+        position: fixed;\n+        bottom: 20px;\n+        right: 20px;\n+        display: flex;\n+        flex-direction: column;\n+        gap: 10px;\n+    }\n+    \n+    .floating-btn {\n+        width: 50px;\n+        height: 50px;\n+        border-radius: 50%;\n+        background-color: #4a90e2;\n+        color: white;\n+        display: flex;\n+        align-items: center;\n+        justify-content: center;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n+        transition: all 0.3s ease;\n+    }\n+    \n+    .floating-btn:hover {\n+        transform: scale(1.1);\n+        background-color: #3a7bc8;\n+    }\n+    \n+    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n+    @media print {\n+        .sidebar, .page-header, .form-actions, .floating-buttons {\n+            display: none;\n+        }\n+        \n+        .dashboard-container {\n+            display: block;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+        \n+        .form-container {\n+            border: none;\n+            box-shadow: none;\n+        }\n+        \n+        .form-group {\n+            margin-bottom: 10px;\n+        }\n+        \n+        input, select {\n+            border: none;\n+            background: transparent;\n+        }\n+        \n+        h3 {\n+            text-align: center;\n+            font-size: 24px;\n+            margin-bottom: 20px;\n+        }\n+        \n+        /* Th√™m th√¥ng tin ph√≤ng kh√°m khi in */\n+        .form-container::before {\n+            content: \"PH√íNG KH√ÅM NHA KHOA NHAKHOASO\";\n+            display: block;\n+            text-align: center;\n+            font-size: 18px;\n+            font-weight: bold;\n+            margin-bottom: 5px;\n+        }\n+        \n+        .form-container::after {\n+            content: \"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!\";\n+            display: block;\n+            text-align: center;\n+            margin-top: 30px;\n+            font-style: italic;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01MzgktFRyhDhvqBWZ2eLTTh"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i s·∫Ω t·∫°o template cho trang chi ti·∫øt h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01QtUzFuz82u435hGC6ArBmR","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/chi_tiet_hoa_don.html","path":"nhakhoaso/templates/chi_tiet_hoa_don.html","displayPath":"nhakhoaso/templates/chi_tiet_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/chi_tiet_hoa_don.html\n+++ nhakhoaso/templates/chi_tiet_hoa_don.html\n@@ -0,0 +1,377 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Chi ti·∫øt h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"page-header\">\n+    <h2>Chi ti·∫øt h√≥a ƒë∆°n</h2>\n+    <div class=\"breadcrumb\">\n+        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n+        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n+        <a href=\"{{ url_for('hoa_don_list') }}\">Danh s√°ch h√≥a ƒë∆°n</a> / \n+        <span>Chi ti·∫øt h√≥a ƒë∆°n</span>\n+    </div>\n+</div>\n+\n+<div class=\"dashboard-container\">\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-header\">\n+            <h3>Ch·ª©c nƒÉng</h3>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"main-content\">\n+        <div class=\"detail-container\">\n+            <div class=\"detail-header\">\n+                <h3>Th√¥ng tin h√≥a ƒë∆°n</h3>\n+                <div class=\"detail-actions\">\n+                    <button class=\"btn btn-light\" id=\"printBtn\">\n+                        <i class=\"fas fa-print\"></i> In h√≥a ƒë∆°n\n+                    </button>\n+                </div>\n+            </div>\n+\n+            {% with messages = get_flashed_messages(with_categories=true) %}\n+                {% if messages %}\n+                    {% for category, message in messages %}\n+                        <div class=\"alert alert-{{ category }}\">\n+                            {{ message }}\n+                        </div>\n+                    {% endfor %}\n+                {% endif %}\n+            {% endwith %}\n+\n+            <div class=\"invoice-container\" id=\"invoiceContent\">\n+                <div class=\"invoice-header\">\n+                    <div class=\"invoice-logo\">\n+                        <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n+                        <h2>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h2>\n+                    </div>\n+                    <div class=\"invoice-title\">\n+                        <h1>H√ìA ƒê∆†N THANH TO√ÅN</h1>\n+                        <p>M√£ h√≥a ƒë∆°n: <strong>{{ hoa_don.MaHD }}</strong></p>\n+                        <p>Ng√†y l·∫≠p: <strong>{{ hoa_don.NgayLap }}</strong></p>\n+                    </div>\n+                </div>\n+\n+                <div class=\"invoice-info\">\n+                    <div class=\"info-group\">\n+                        <h4>Th√¥ng tin b·ªánh nh√¢n</h4>\n+                        <p><strong>H·ªç t√™n:</strong> {{ hoa_don.TenBenhNhan }}</p>\n+                        <p><strong>M√£ b·ªánh nh√¢n:</strong> {{ hoa_don.MaBN }}</p>\n+                    </div>\n+\n+                    <div class=\"info-group\">\n+                        <h4>Th√¥ng tin kh√°m</h4>\n+                        <p><strong>M√£ phi·∫øu kh√°m:</strong> {{ hoa_don.MaPK }}</p>\n+                        <p><strong>Ng√†y kh√°m:</strong> {{ hoa_don.NgayKham }}</p>\n+                        <p><strong>B√°c sƒ© kh√°m:</strong> {{ hoa_don.TenBacSi }}</p>\n+                    </div>\n+                </div>\n+\n+                <div class=\"invoice-details\">\n+                    <h4>Chi ti·∫øt d·ªãch v·ª•</h4>\n+                    <table class=\"invoice-table\">\n+                        <thead>\n+                            <tr>\n+                                <th>STT</th>\n+                                <th>D·ªãch v·ª•</th>\n+                                <th>ƒê∆°n gi√°</th>\n+                                <th>S·ªë l∆∞·ª£ng</th>\n+                                <th>Th√†nh ti·ªÅn</th>\n+                            </tr>\n+                        </thead>\n+                        <tbody>\n+                            <tr>\n+                                <td>1</td>\n+                                <td>{{ hoa_don.TenDV }}</td>\n+                                <td>{{ \"{:,.0f}\".format(hoa_don.Gia) }} VNƒê</td>\n+                                <td>1</td>\n+                                <td>{{ \"{:,.0f}\".format(hoa_don.Gia) }} VNƒê</td>\n+                            </tr>\n+                        </tbody>\n+                        <tfoot>\n+                            <tr>\n+                                <td colspan=\"4\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                                <td><strong>{{ \"{:,.0f}\".format(hoa_don.TongTien) }} VNƒê</strong></td>\n+                            </tr>\n+                        </tfoot>\n+                    </table>\n+                </div>\n+\n+                <div class=\"invoice-payment\">\n+                    <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> {{ hoa_don.PhuongThucThanhToan }}</p>\n+                    <p><strong>Tr·∫°ng th√°i:</strong> {{ hoa_don.TrangThai }}</p>\n+                </div>\n+\n+                <div class=\"invoice-footer\">\n+                    <div class=\"signature\">\n+                        <p>Ng∆∞·ªùi l·∫≠p h√≥a ƒë∆°n</p>\n+                        <div class=\"signature-line\"></div>\n+                    </div>\n+                    <div class=\"signature\">\n+                        <p>Ng∆∞·ªùi thanh to√°n</p>\n+                        <div class=\"signature-line\"></div>\n+                    </div>\n+                </div>\n+\n+                <div class=\"invoice-note\">\n+                    <p>C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i!</p>\n+                </div>\n+            </div>\n+\n+            <div class=\"detail-actions bottom\">\n+                <a href=\"{{ url_for('hoa_don_list') }}\" class=\"btn btn-secondary\">\n+                    <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i danh s√°ch\n+                </a>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+\n+<div class=\"floating-buttons\">\n+    <a href=\"{{ url_for('hoa_don_list') }}\" class=\"floating-btn\" title=\"Quay l·∫°i\">\n+        <i class=\"fas fa-arrow-left\"></i>\n+    </a>\n+    <a href=\"{{ url_for('index') }}\" class=\"floating-btn\" title=\"V·ªÅ trang ch·ªß\">\n+        <i class=\"fas fa-home\"></i>\n+    </a>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n+        document.getElementById('printBtn').addEventListener('click', function() {\n+            window.print();\n+        });\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .detail-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+    }\n+    \n+    .detail-header {\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+        margin-bottom: 20px;\n+        padding-bottom: 15px;\n+        border-bottom: 1px solid #eee;\n+    }\n+    \n+    .invoice-container {\n+        padding: 20px;\n+        background-color: #fff;\n+        border: 1px solid #ddd;\n+        border-radius: 5px;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .invoice-header {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-bottom: 30px;\n+        padding-bottom: 20px;\n+        border-bottom: 2px solid #4a90e2;\n+    }\n+    \n+    .invoice-logo {\n+        display: flex;\n+        align-items: center;\n+    }\n+    \n+    .invoice-logo img {\n+        width: 50px;\n+        height: 50px;\n+        margin-right: 15px;\n+    }\n+    \n+    .invoice-logo h2 {\n+        font-size: 18px;\n+        margin: 0;\n+        color: #333;\n+    }\n+    \n+    .invoice-title h1 {\n+        font-size: 24px;\n+        color: #4a90e2;\n+        margin: 0 0 10px 0;\n+    }\n+    \n+    .invoice-title p {\n+        margin: 5px 0;\n+        font-size: 14px;\n+    }\n+    \n+    .invoice-info {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .info-group {\n+        flex: 1;\n+    }\n+    \n+    .info-group h4 {\n+        color: #4a90e2;\n+        margin-bottom: 10px;\n+        font-size: 16px;\n+    }\n+    \n+    .info-group p {\n+        margin: 5px 0;\n+        font-size: 14px;\n+    }\n+    \n+    .invoice-details {\n+        margin-bottom: 30px;\n+    }\n+    \n+    .invoice-details h4 {\n+        color: #4a90e2;\n+        margin-bottom: 15px;\n+        font-size: 16px;\n+    }\n+    \n+    .invoice-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .invoice-table th, .invoice-table td {\n+        padding: 10px;\n+        text-align: left;\n+        border-bottom: 1px solid #ddd;\n+    }\n+    \n+    .invoice-table th {\n+        background-color: #f5f5f5;\n+        font-weight: 600;\n+    }\n+    \n+    .invoice-table tfoot td {\n+        font-weight: bold;\n+        border-top: 2px solid #ddd;\n+    }\n+    \n+    .text-right {\n+        text-align: right;\n+    }\n+    \n+    .invoice-payment {\n+        margin-bottom: 30px;\n+    }\n+    \n+    .invoice-footer {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-top: 50px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .signature {\n+        text-align: center;\n+        width: 200px;\n+    }\n+    \n+    .signature p {\n+        margin-bottom: 50px;\n+    }\n+    \n+    .signature-line {\n+        border-top: 1px solid #000;\n+    }\n+    \n+    .invoice-note {\n+        text-align: center;\n+        font-style: italic;\n+        margin-top: 30px;\n+        color: #666;\n+    }\n+    \n+    .detail-actions.bottom {\n+        margin-top: 20px;\n+        text-align: right;\n+    }\n+    \n+    .floating-buttons {\n+        position: fixed;\n+        bottom: 20px;\n+        right: 20px;\n+        display: flex;\n+        flex-direction: column;\n+        gap: 10px;\n+    }\n+    \n+    .floating-btn {\n+        width: 50px;\n+        height: 50px;\n+        border-radius: 50%;\n+        background-color: #4a90e2;\n+        color: white;\n+        display: flex;\n+        align-items: center;\n+        justify-content: center;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n+        transition: all 0.3s ease;\n+    }\n+    \n+    .floating-btn:hover {\n+        transform: scale(1.1);\n+        background-color: #3a7bc8;\n+    }\n+    \n+    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n+    @media print {\n+        .sidebar, .page-header, .detail-actions, .floating-buttons {\n+            display: none;\n+        }\n+        \n+        .dashboard-container {\n+            display: block;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+        \n+        .detail-container {\n+            border: none;\n+            box-shadow: none;\n+            padding: 0;\n+        }\n+        \n+        .detail-header {\n+            display: none;\n+        }\n+        \n+        .invoice-container {\n+            border: none;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01QtUzFuz82u435hGC6ArBmR"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i s·∫Ω t·∫°o template cho trang t√¨m ki·∫øm h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01NYpRYx1ME6T8UsmQq2unQg","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/tim_kiem_hoa_don.html","path":"nhakhoaso/templates/tim_kiem_hoa_don.html","displayPath":"nhakhoaso/templates/tim_kiem_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/tim_kiem_hoa_don.html\n+++ nhakhoaso/templates/tim_kiem_hoa_don.html\n@@ -0,0 +1,139 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}T√¨m ki·∫øm h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"page-header\">\n+    <h2>T√¨m ki·∫øm h√≥a ƒë∆°n</h2>\n+    <div class=\"breadcrumb\">\n+        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n+        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n+        <a href=\"{{ url_for('hoa_don_list') }}\">Danh s√°ch h√≥a ƒë∆°n</a> / \n+        <span>T√¨m ki·∫øm</span>\n+    </div>\n+</div>\n+\n+<div class=\"dashboard-container\">\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-header\">\n+            <h3>Ch·ª©c nƒÉng</h3>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <div class=\"main-content\">\n+        <div class=\"search-container\">\n+            <h3>T√¨m ki·∫øm h√≥a ƒë∆°n</h3>\n+            \n+            <form method=\"POST\" action=\"{{ url_for('tim_kiem_hoa_don') }}\" class=\"search-form\">\n+                <div class=\"form-group\">\n+                    <label for=\"tu_khoa\">T·ª´ kh√≥a t√¨m ki·∫øm</label>\n+                    <input type=\"text\" id=\"tu_khoa\" name=\"tu_khoa\" placeholder=\"Nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm...\" required>\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"loai_tim_kiem\">Lo·∫°i t√¨m ki·∫øm</label>\n+                    <select id=\"loai_tim_kiem\" name=\"loai_tim_kiem\">\n+                        <option value=\"ma_hoa_don\">M√£ h√≥a ƒë∆°n</option>\n+                        <option value=\"ma_phieu_kham\">M√£ phi·∫øu kh√°m</option>\n+                        <option value=\"ma_benh_nhan\">M√£ b·ªánh nh√¢n</option>\n+                    </select>\n+                </div>\n+                \n+                <div class=\"form-actions\">\n+                    <button type=\"submit\" class=\"btn btn-primary\">\n+                        <i class=\"fas fa-search\"></i> T√¨m ki·∫øm\n+                    </button>\n+                    <button type=\"reset\" class=\"btn btn-secondary\">\n+                        <i class=\"fas fa-redo\"></i> L√†m m·ªõi\n+                    </button>\n+                </div>\n+            </form>\n+            \n+            <div class=\"search-results\">\n+                <h4>K·∫øt qu·∫£ t√¨m ki·∫øm</h4>\n+                \n+                {% if ket_qua %}\n+                    <table class=\"data-table\">\n+                        <thead>\n+                            <tr>\n+                                <th>M√£ h√≥a ƒë∆°n</th>\n+                                <th>M√£ phi·∫øu kh√°m</th>\n+                                <th>B·ªánh nh√¢n</th>\n+                                <th>Ng√†y l·∫≠p</th>\n+                                <th>T·ªïng ti·ªÅn</th>\n+                                <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>\n+                                <th>Tr·∫°ng th√°i</th>\n+                                <th>Thao t√°c</th>\n+                            </tr>\n+                        </thead>\n+                        <tbody>\n+                            {% for hd in ket_qua %}\n+                                <tr>\n+                                    <td>{{ hd.MaHD }}</td>\n+                                    <td>{{ hd.MaPK }}</td>\n+                                    <td>{{ hd.TenBenhNhan }}</td>\n+                                    <td>{{ hd.NgayLap }}</td>\n+                                    <td>{{ \"{:,.0f}\".format(hd.TongTien) }} VNƒê</td>\n+                                    <td>{{ hd.PhuongThucThanhToan }}</td>\n+                                    <td>{{ hd.TrangThai }}</td>\n+                                    <td class=\"actions\">\n+                                        <a href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" class=\"btn-icon\" title=\"Xem chi ti·∫øt\">\n+                                            <i class=\"fas fa-eye\"></i>\n+                                        </a>\n+                                    </td>\n+                                </tr>\n+                            {% endfor %}\n+                        </tbody>\n+                    </table>\n+                {% elif request.method == 'POST' %}\n+                    <div class=\"no-results\">\n+                        <p>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.</p>\n+                    </div>\n+                {% endif %}\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .search-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+    }\n+    \n+    .search-form {\n+        margin-bottom: 30px;\n+        padding-bottom: 20px;\n+        border-bottom: 1px solid #eee;\n+    }\n+    \n+    .search-results h4 {\n+        margin-bottom: 15px;\n+        color: #333;\n+    }\n+    \n+    .no-results {\n+        padding: 20px;\n+        text-align: center;\n+        background-color: #f9f9f9;\n+        border-radius: 5px;\n+        color: #666;\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01NYpRYx1ME6T8UsmQq2unQg"},{"type":"text","text":"B√¢y gi·ªù t√¥i c·∫ßn c·∫≠p nh·∫≠t c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ th√™m b·∫£ng HOADON. T√¥i s·∫Ω ch·∫°y l·ªánh ƒë·ªÉ kh·ªüi t·∫°o l·∫°i c∆° s·ªü d·ªØ li·ªáu:"},{"type":"toolCall","toolCallId":"toolu_01CLfxLHaNsA4SBSBG3AFcXF","isHidden":true,"title":"","statusText":"","status":"IN_PROGRESS","localResult":"{\"status\":\"UNRECOGNIZED\",\"output\":\"Command 'python' not found, did you mean:\\n  command 'python3' from deb python3\\n  command 'python' from deb python-is-python3\\n\"}"},{"type":"codePatch","diffs":[{"path":"nhakhoaso/database/utils.py","patch":"@@ -2362,12 +2362,186 @@\n K', 'PK', 5)\n+%0A%0Adef get_next_hoa_don_id():%0A    %22%22%22%0A    T%E1%BA%A1o m%C3%A3 h%C3%B3a %C4%91%C6%A1n ti%E1%BA%BFp theo%0A    %0A    Returns:%0A        str: M%C3%A3 h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A    %22%22%22%0A    return generate_next_id('HOADON', 'MaHD', 'HD', 5)\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/database/hoa_don.py","patch":"@@ -0,0 +1,6908 @@\n+from .db import execute_query%0Aimport datetime%0Afrom .utils import get_next_hoa_don_id%0A%0Adef get_all_hoa_don():%0A    %22%22%22%0A    L%E1%BA%A5y danh s%C3%A1ch t%E1%BA%A5t c%E1%BA%A3 h%C3%B3a %C4%91%C6%A1n%0A    %0A    Returns:%0A        list: Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A    %22%22%22%0A    query = %22%22%22%0A    SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, %0A           bn.HoTen as TenBenhNhan, %0A           bs.HoTen as TenBacSi,%0A           dv.TenDV, dv.Gia%0A    FROM HOADON h%0A    JOIN PHIEUKHAM p ON h.MaPK = p.MaPK%0A    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A    JOIN BACSI bs ON p.MaBS = bs.MaBS%0A    JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A    ORDER BY h.NgayLap DESC%0A    %22%22%22%0A    return execute_query(query, fetch=True)%0A%0Adef get_hoa_don_by_id(ma_hd):%0A    %22%22%22%0A    L%E1%BA%A5y th%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n theo m%C3%A3%0A    %0A    Args:%0A        ma_hd (str): M%C3%A3 h%C3%B3a %C4%91%C6%A1n%0A        %0A    Returns:%0A        dict: Th%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%0A    %22%22%22%0A    query = %22%22%22%0A    SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, %0A           bn.HoTen as TenBenhNhan, %0A           bs.HoTen as TenBacSi,%0A           dv.TenDV, dv.Gia%0A    FROM HOADON h%0A    JOIN PHIEUKHAM p ON h.MaPK = p.MaPK%0A    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A    JOIN BACSI bs ON p.MaBS = bs.MaBS%0A    JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A    WHERE h.MaHD = %25s%0A    %22%22%22%0A    result = execute_query(query, (ma_hd,), fetch=True)%0A    return result%5B0%5D if result else None%0A%0Adef search_hoa_don(tu_khoa, loai_tim_kiem='ma_hoa_don'):%0A    %22%22%22%0A    T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n theo t%E1%BB%AB kh%C3%B3a v%C3%A0 lo%E1%BA%A1i t%C3%ACm ki%E1%BA%BFm%0A    %0A    Args:%0A        tu_khoa (str): T%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm%0A        loai_tim_kiem (str): Lo%E1%BA%A1i t%C3%ACm ki%E1%BA%BFm (ma_hoa_don, ma_phieu_kham, ma_benh_nhan)%0A        %0A    Returns:%0A        list: Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n t%C3%ACm th%E1%BA%A5y%0A    %22%22%22%0A    if loai_tim_kiem == 'ma_hoa_don':%0A        query = %22%22%22%0A        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, %0A               bn.HoTen as TenBenhNhan, %0A               bs.HoTen as TenBacSi,%0A               dv.TenDV, dv.Gia%0A        FROM HOADON h%0A        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK%0A        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A        JOIN BACSI bs ON p.MaBS = bs.MaBS%0A        JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A        WHERE h.MaHD LIKE %25s%0A        %22%22%22%0A    elif loai_tim_kiem == 'ma_phieu_kham':%0A        query = %22%22%22%0A        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, %0A               bn.HoTen as TenBenhNhan, %0A               bs.HoTen as TenBacSi,%0A               dv.TenDV, dv.Gia%0A        FROM HOADON h%0A        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK%0A        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A        JOIN BACSI bs ON p.MaBS = bs.MaBS%0A        JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A        WHERE h.MaPK LIKE %25s%0A        %22%22%22%0A    elif loai_tim_kiem == 'ma_benh_nhan':%0A        query = %22%22%22%0A        SELECT h.*, p.MaBN, p.MaBS, p.MaDV, p.NgayKham, %0A               bn.HoTen as TenBenhNhan, %0A               bs.HoTen as TenBacSi,%0A               dv.TenDV, dv.Gia%0A        FROM HOADON h%0A        JOIN PHIEUKHAM p ON h.MaPK = p.MaPK%0A        JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A        JOIN BACSI bs ON p.MaBS = bs.MaBS%0A        JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A        WHERE p.MaBN LIKE %25s%0A        %22%22%22%0A    else:%0A        return %5B%5D%0A        %0A    return execute_query(query, (f'%25%7Btu_khoa%7D%25',), fetch=True)%0A%0Adef create_hoa_don(ma_pk, phuong_thuc_thanh_toan, ma_hd=None, ngay_lap=None):%0A    %22%22%22%0A    T%E1%BA%A1o m%E1%BB%9Bi h%C3%B3a %C4%91%C6%A1n%0A    %0A    Args:%0A        ma_pk (str): M%C3%A3 phi%E1%BA%BFu kh%C3%A1m%0A        phuong_thuc_thanh_toan (str): Ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%0A        ma_hd (str, optional): M%C3%A3 h%C3%B3a %C4%91%C6%A1n (n%E1%BA%BFu kh%C3%B4ng cung c%E1%BA%A5p s%E1%BA%BD t%E1%BB%B1 %C4%91%E1%BB%99ng t%E1%BA%A1o)%0A        ngay_lap (str, optional): Ng%C3%A0y l%E1%BA%ADp h%C3%B3a %C4%91%C6%A1n (%C4%91%E1%BB%8Bnh d%E1%BA%A1ng YYYY-MM-DD HH:MM:SS)%0A        %0A    Returns:%0A        tuple: (ma_hd, success) - M%C3%A3 h%C3%B3a %C4%91%C6%A1n v%C3%A0 k%E1%BA%BFt qu%E1%BA%A3 th%C3%A0nh c%C3%B4ng hay kh%C3%B4ng%0A    %22%22%22%0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 m%C3%A3 h%C3%B3a %C4%91%C6%A1n, t%E1%BA%A1o m%C3%A3 m%E1%BB%9Bi%0A    if not ma_hd:%0A        ma_hd = get_next_hoa_don_id()%0A        %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y l%E1%BA%ADp, s%E1%BB%AD d%E1%BB%A5ng ng%C3%A0y hi%E1%BB%87n t%E1%BA%A1i%0A    if not ngay_lap:%0A        ngay_lap = datetime.datetime.now().strftime(%22%25Y-%25m-%25d %25H:%25M:%25S%22)%0A    %0A    # L%E1%BA%A5y th%C3%B4ng tin gi%C3%A1 d%E1%BB%8Bch v%E1%BB%A5 t%E1%BB%AB phi%E1%BA%BFu kh%C3%A1m%0A    query_gia = %22%22%22%0A    SELECT dv.Gia%0A    FROM PHIEUKHAM pk%0A    JOIN DICHVU dv ON pk.MaDV = dv.MaDV%0A    WHERE pk.MaPK = %25s%0A    %22%22%22%0A    result = execute_query(query_gia, (ma_pk,), fetch=True)%0A    %0A    if not result:%0A        return None, False%0A    %0A    tong_tien = result%5B0%5D%5B'Gia'%5D%0A    %0A    # T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A    query = %22%22%22%0A    INSERT INTO HOADON (MaHD, MaPK, NgayLap, TongTien, PhuongThucThanhToan)%0A    VALUES (%25s, %25s, %25s, %25s, %25s)%0A    %22%22%22%0A    %0A    try:%0A        execute_query(query, (ma_hd, ma_pk, ngay_lap, tong_tien, phuong_thuc_thanh_toan))%0A        return ma_hd, True%0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi t%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n: %7Be%7D%22)%0A        return None, False%0A%0Adef update_hoa_don(ma_hd, ma_pk, phuong_thuc_thanh_toan, trang_thai=None):%0A    %22%22%22%0A    C%E1%BA%ADp nh%E1%BA%ADt th%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%0A    %0A    Args:%0A        ma_hd (str): M%C3%A3 h%C3%B3a %C4%91%C6%A1n%0A        ma_pk (str): M%C3%A3 phi%E1%BA%BFu kh%C3%A1m%0A        phuong_thuc_thanh_toan (str): Ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%0A        trang_thai (str, optional): Tr%E1%BA%A1ng th%C3%A1i h%C3%B3a %C4%91%C6%A1n%0A        %0A    Returns:%0A        bool: K%E1%BA%BFt qu%E1%BA%A3 c%E1%BA%ADp nh%E1%BA%ADt%0A    %22%22%22%0A    # L%E1%BA%A5y th%C3%B4ng tin gi%C3%A1 d%E1%BB%8Bch v%E1%BB%A5 t%E1%BB%AB phi%E1%BA%BFu kh%C3%A1m%0A    query_gia = %22%22%22%0A    SELECT dv.Gia%0A    FROM PHIEUKHAM pk%0A    JOIN DICHVU dv ON pk.MaDV = dv.MaDV%0A    WHERE pk.MaPK = %25s%0A    %22%22%22%0A    result = execute_query(query_gia, (ma_pk,), fetch=True)%0A    %0A    if not result:%0A        return False%0A    %0A    tong_tien = result%5B0%5D%5B'Gia'%5D%0A    %0A    # C%E1%BA%ADp nh%E1%BA%ADt h%C3%B3a %C4%91%C6%A1n%0A    if trang_thai:%0A        query = %22%22%22%0A        UPDATE HOADON%0A        SET MaPK = %25s, TongTien = %25s, PhuongThucThanhToan = %25s, TrangThai = %25s%0A        WHERE MaHD = %25s%0A        %22%22%22%0A        params = (ma_pk, tong_tien, phuong_thuc_thanh_toan, trang_thai, ma_hd)%0A    else:%0A        query = %22%22%22%0A        UPDATE HOADON%0A        SET MaPK = %25s, TongTien = %25s, PhuongThucThanhToan = %25s%0A        WHERE MaHD = %25s%0A        %22%22%22%0A        params = (ma_pk, tong_tien, phuong_thuc_thanh_toan, ma_hd)%0A    %0A    try:%0A        execute_query(query, params)%0A        return True%0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi c%E1%BA%ADp nh%E1%BA%ADt h%C3%B3a %C4%91%C6%A1n: %7Be%7D%22)%0A        return False%0A%0Adef delete_hoa_don(ma_hd):%0A    %22%22%22%0A    X%C3%B3a h%C3%B3a %C4%91%C6%A1n theo m%C3%A3%0A    %0A    Args:%0A        ma_hd (str): M%C3%A3 h%C3%B3a %C4%91%C6%A1n%0A        %0A    Returns:%0A        tuple: (success, message) - K%E1%BA%BFt qu%E1%BA%A3 x%C3%B3a v%C3%A0 th%C3%B4ng b%C3%A1o%0A    %22%22%22%0A    query = %22DELETE FROM HOADON WHERE MaHD = %25s%22%0A    try:%0A        execute_query(query, (ma_hd,))%0A        return True, %22X%C3%B3a h%C3%B3a %C4%91%C6%A1n th%C3%A0nh c%C3%B4ng%22%0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi x%C3%B3a h%C3%B3a %C4%91%C6%A1n: %7Be%7D%22)%0A        return False, f%22L%E1%BB%97i: %7Bstr(e)%7D%22%0A%0Adef get_phieu_kham_chua_thanh_toan():%0A    %22%22%22%0A    L%E1%BA%A5y danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m ch%C6%B0a c%C3%B3 h%C3%B3a %C4%91%C6%A1n%0A    %0A    Returns:%0A        list: Danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m ch%C6%B0a thanh to%C3%A1n%0A    %22%22%22%0A    query = %22%22%22%0A    SELECT p.*, bn.HoTen as TenBenhNhan, bs.HoTen as TenBacSi, dv.TenDV, dv.Gia%0A    FROM PHIEUKHAM p%0A    JOIN BENHNHAN bn ON p.MaBN = bn.MaBN%0A    JOIN BACSI bs ON p.MaBS = bs.MaBS%0A    JOIN DICHVU dv ON p.MaDV = dv.MaDV%0A    WHERE p.MaPK NOT IN (SELECT MaPK FROM HOADON)%0A    ORDER BY p.NgayKham DESC%0A    %22%22%22%0A    return execute_query(query, fetch=True)\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/thanh_toan.html","patch":"@@ -0,0 +1,2813 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22page-header%22%3E%0A    %3Ch2%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %3Cspan%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22welcome-section%22%3E%0A            %3Ch3%3ECh%C3%A0o m%E1%BB%ABng %C4%91%E1%BA%BFn v%E1%BB%9Bi Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/h3%3E%0A            %3Cp%3EVui l%C3%B2ng ch%E1%BB%8Dn ch%E1%BB%A9c n%C4%83ng t%E1%BB%AB menu b%C3%AAn tr%C3%A1i %C4%91%E1%BB%83 b%E1%BA%AFt %C4%91%E1%BA%A7u.%3C/p%3E%0A            %0A            %3Cdiv class=%22feature-cards%22%3E%0A                %3Cdiv class=%22feature-card%22 onclick=%22window.location.href='%7B%7B url_for('them_moi_hoa_don') %7D%7D'%22%3E%0A                    %3Cdiv class=%22feature-icon%22%3E%0A                        %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E%0A                    %3C/div%3E%0A                    %3Ch4%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/h4%3E%0A                    %3Cp%3ET%E1%BA%A1o m%E1%BB%9Bi h%C3%B3a %C4%91%C6%A1n thanh to%C3%A1n cho phi%E1%BA%BFu kh%C3%A1m%3C/p%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22feature-card%22 onclick=%22window.location.href='%7B%7B url_for('hoa_don_list') %7D%7D'%22%3E%0A                    %3Cdiv class=%22feature-icon%22%3E%0A                        %3Ci class=%22fas fa-list-alt%22%3E%3C/i%3E%0A                    %3C/div%3E%0A                    %3Ch4%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/h4%3E%0A                    %3Cp%3EXem danh s%C3%A1ch t%E1%BA%A5t c%E1%BA%A3 h%C3%B3a %C4%91%C6%A1n %C4%91%C3%A3 t%E1%BA%A1o%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .feature-cards %7B%0A        display: flex;%0A        gap: 20px;%0A        margin-top: 30px;%0A    %7D%0A    %0A    .feature-card %7B%0A        flex: 1;%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 25px;%0A        text-align: center;%0A        transition: all 0.3s ease;%0A        cursor: pointer;%0A    %7D%0A    %0A    .feature-card:hover %7B%0A        transform: translateY(-5px);%0A        box-shadow: 0 5px 15px rgba(0,0,0,0.15);%0A    %7D%0A    %0A    .feature-icon %7B%0A        font-size: 40px;%0A        color: #4a90e2;%0A        margin-bottom: 15px;%0A    %7D%0A    %0A    .feature-card h4 %7B%0A        font-size: 18px;%0A        margin-bottom: 10px;%0A        color: #333;%0A    %7D%0A    %0A    .feature-card p %7B%0A        color: #666;%0A        font-size: 14px;%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/chi_tiet_hoa_don.html","patch":"@@ -0,0 +1,10544 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22page-header%22%3E%0A    %3Ch2%3EChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/a%3E / %0A        %3Cspan%3EChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22detail-container%22%3E%0A            %3Cdiv class=%22detail-header%22%3E%0A                %3Ch3%3ETh%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A                %3Cdiv class=%22detail-actions%22%3E%0A                    %3Cbutton class=%22btn btn-light%22 id=%22printBtn%22%3E%0A                        %3Ci class=%22fas fa-print%22%3E%3C/i%3E In h%C3%B3a %C4%91%C6%A1n%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A%0A            %7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A                %7B%25 if messages %25%7D%0A                    %7B%25 for category, message in messages %25%7D%0A                        %3Cdiv class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                            %7B%7B message %7D%7D%0A                        %3C/div%3E%0A                    %7B%25 endfor %25%7D%0A                %7B%25 endif %25%7D%0A            %7B%25 endwith %25%7D%0A%0A            %3Cdiv class=%22invoice-container%22 id=%22invoiceContent%22%3E%0A                %3Cdiv class=%22invoice-header%22%3E%0A                    %3Cdiv class=%22invoice-logo%22%3E%0A                        %3Cimg src=%22%7B%7B url_for('static', filename='images/tooth-logo.png') %7D%7D%22 alt=%22Logo NHAKHOASO%22 onerror=%22this.src='https://via.placeholder.com/50x50?text=%F0%9F%A6%B7'%22%3E%0A                        %3Ch2%3EPH%C3%92NG KH%C3%81M NHA KHOA NHAKHOASO%3C/h2%3E%0A                    %3C/div%3E%0A                    %3Cdiv class=%22invoice-title%22%3E%0A                        %3Ch1%3EH%C3%93A %C4%90%C6%A0N THANH TO%C3%81N%3C/h1%3E%0A                        %3Cp%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n: %3Cstrong%3E%7B%7B hoa_don.MaHD %7D%7D%3C/strong%3E%3C/p%3E%0A                        %3Cp%3ENg%C3%A0y l%E1%BA%ADp: %3Cstrong%3E%7B%7B hoa_don.NgayLap %7D%7D%3C/strong%3E%3C/p%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22invoice-info%22%3E%0A                    %3Cdiv class=%22info-group%22%3E%0A                        %3Ch4%3ETh%C3%B4ng tin b%E1%BB%87nh nh%C3%A2n%3C/h4%3E%0A                        %3Cp%3E%3Cstrong%3EH%E1%BB%8D t%C3%AAn:%3C/strong%3E %7B%7B hoa_don.TenBenhNhan %7D%7D%3C/p%3E%0A                        %3Cp%3E%3Cstrong%3EM%C3%A3 b%E1%BB%87nh nh%C3%A2n:%3C/strong%3E %7B%7B hoa_don.MaBN %7D%7D%3C/p%3E%0A                    %3C/div%3E%0A%0A                    %3Cdiv class=%22info-group%22%3E%0A                        %3Ch4%3ETh%C3%B4ng tin kh%C3%A1m%3C/h4%3E%0A                        %3Cp%3E%3Cstrong%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m:%3C/strong%3E %7B%7B hoa_don.MaPK %7D%7D%3C/p%3E%0A                        %3Cp%3E%3Cstrong%3ENg%C3%A0y kh%C3%A1m:%3C/strong%3E %7B%7B hoa_don.NgayKham %7D%7D%3C/p%3E%0A                        %3Cp%3E%3Cstrong%3EB%C3%A1c s%C4%A9 kh%C3%A1m:%3C/strong%3E %7B%7B hoa_don.TenBacSi %7D%7D%3C/p%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22invoice-details%22%3E%0A                    %3Ch4%3EChi ti%E1%BA%BFt d%E1%BB%8Bch v%E1%BB%A5%3C/h4%3E%0A                    %3Ctable class=%22invoice-table%22%3E%0A                        %3Cthead%3E%0A                            %3Ctr%3E%0A                                %3Cth%3ESTT%3C/th%3E%0A                                %3Cth%3ED%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                                %3Cth%3E%C4%90%C6%A1n gi%C3%A1%3C/th%3E%0A                                %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng%3C/th%3E%0A                                %3Cth%3ETh%C3%A0nh ti%E1%BB%81n%3C/th%3E%0A                            %3C/tr%3E%0A                        %3C/thead%3E%0A                        %3Ctbody%3E%0A                            %3Ctr%3E%0A                                %3Ctd%3E1%3C/td%3E%0A                                %3Ctd%3E%7B%7B hoa_don.TenDV %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hoa_don.Gia) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E1%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hoa_don.Gia) %7D%7D VN%C4%90%3C/td%3E%0A                            %3C/tr%3E%0A                        %3C/tbody%3E%0A                        %3Ctfoot%3E%0A                            %3Ctr%3E%0A                                %3Ctd colspan=%224%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                                %3Ctd%3E%3Cstrong%3E%7B%7B %22%7B:,.0f%7D%22.format(hoa_don.TongTien) %7D%7D VN%C4%90%3C/strong%3E%3C/td%3E%0A                            %3C/tr%3E%0A                        %3C/tfoot%3E%0A                    %3C/table%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22invoice-payment%22%3E%0A                    %3Cp%3E%3Cstrong%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n:%3C/strong%3E %7B%7B hoa_don.PhuongThucThanhToan %7D%7D%3C/p%3E%0A                    %3Cp%3E%3Cstrong%3ETr%E1%BA%A1ng th%C3%A1i:%3C/strong%3E %7B%7B hoa_don.TrangThai %7D%7D%3C/p%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22invoice-footer%22%3E%0A                    %3Cdiv class=%22signature%22%3E%0A                        %3Cp%3ENg%C6%B0%E1%BB%9Di l%E1%BA%ADp h%C3%B3a %C4%91%C6%A1n%3C/p%3E%0A                        %3Cdiv class=%22signature-line%22%3E%3C/div%3E%0A                    %3C/div%3E%0A                    %3Cdiv class=%22signature%22%3E%0A                        %3Cp%3ENg%C6%B0%E1%BB%9Di thanh to%C3%A1n%3C/p%3E%0A                        %3Cdiv class=%22signature-line%22%3E%3C/div%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22invoice-note%22%3E%0A                    %3Cp%3EC%E1%BA%A3m %C6%A1n qu%C3%BD kh%C3%A1ch %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng d%E1%BB%8Bch v%E1%BB%A5 c%E1%BB%A7a ch%C3%BAng t%C3%B4i!%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A%0A            %3Cdiv class=%22detail-actions bottom%22%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22btn btn-secondary%22%3E%0A                    %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E Quay l%E1%BA%A1i danh s%C3%A1ch%0A                %3C/a%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22floating-buttons%22%3E%0A    %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22floating-btn%22 title=%22Quay l%E1%BA%A1i%22%3E%0A        %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E%0A    %3C/a%3E%0A    %3Ca href=%22%7B%7B url_for('index') %7D%7D%22 class=%22floating-btn%22 title=%22V%E1%BB%81 trang ch%E1%BB%A7%22%3E%0A        %3Ci class=%22fas fa-home%22%3E%3C/i%3E%0A    %3C/a%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .detail-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .detail-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A        padding-bottom: 15px;%0A        border-bottom: 1px solid #eee;%0A    %7D%0A    %0A    .invoice-container %7B%0A        padding: 20px;%0A        background-color: #fff;%0A        border: 1px solid #ddd;%0A        border-radius: 5px;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .invoice-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-bottom: 30px;%0A        padding-bottom: 20px;%0A        border-bottom: 2px solid #4a90e2;%0A    %7D%0A    %0A    .invoice-logo %7B%0A        display: flex;%0A        align-items: center;%0A    %7D%0A    %0A    .invoice-logo img %7B%0A        width: 50px;%0A        height: 50px;%0A        margin-right: 15px;%0A    %7D%0A    %0A    .invoice-logo h2 %7B%0A        font-size: 18px;%0A        margin: 0;%0A        color: #333;%0A    %7D%0A    %0A    .invoice-title h1 %7B%0A        font-size: 24px;%0A        color: #4a90e2;%0A        margin: 0 0 10px 0;%0A    %7D%0A    %0A    .invoice-title p %7B%0A        margin: 5px 0;%0A        font-size: 14px;%0A    %7D%0A    %0A    .invoice-info %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .info-group %7B%0A        flex: 1;%0A    %7D%0A    %0A    .info-group h4 %7B%0A        color: #4a90e2;%0A        margin-bottom: 10px;%0A        font-size: 16px;%0A    %7D%0A    %0A    .info-group p %7B%0A        margin: 5px 0;%0A        font-size: 14px;%0A    %7D%0A    %0A    .invoice-details %7B%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .invoice-details h4 %7B%0A        color: #4a90e2;%0A        margin-bottom: 15px;%0A        font-size: 16px;%0A    %7D%0A    %0A    .invoice-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .invoice-table th, .invoice-table td %7B%0A        padding: 10px;%0A        text-align: left;%0A        border-bottom: 1px solid #ddd;%0A    %7D%0A    %0A    .invoice-table th %7B%0A        background-color: #f5f5f5;%0A        font-weight: 600;%0A    %7D%0A    %0A    .invoice-table tfoot td %7B%0A        font-weight: bold;%0A        border-top: 2px solid #ddd;%0A    %7D%0A    %0A    .text-right %7B%0A        text-align: right;%0A    %7D%0A    %0A    .invoice-payment %7B%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .invoice-footer %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-top: 50px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .signature %7B%0A        text-align: center;%0A        width: 200px;%0A    %7D%0A    %0A    .signature p %7B%0A        margin-bottom: 50px;%0A    %7D%0A    %0A    .signature-line %7B%0A        border-top: 1px solid #000;%0A    %7D%0A    %0A    .invoice-note %7B%0A        text-align: center;%0A        font-style: italic;%0A        margin-top: 30px;%0A        color: #666;%0A    %7D%0A    %0A    .detail-actions.bottom %7B%0A        margin-top: 20px;%0A        text-align: right;%0A    %7D%0A    %0A    .floating-buttons %7B%0A        position: fixed;%0A        bottom: 20px;%0A        right: 20px;%0A        display: flex;%0A        flex-direction: column;%0A        gap: 10px;%0A    %7D%0A    %0A    .floating-btn %7B%0A        width: 50px;%0A        height: 50px;%0A        border-radius: 50%25;%0A        background-color: #4a90e2;%0A        color: white;%0A        display: flex;%0A        align-items: center;%0A        justify-content: center;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.2);%0A        transition: all 0.3s ease;%0A    %7D%0A    %0A    .floating-btn:hover %7B%0A        transform: scale(1.1);%0A        background-color: #3a7bc8;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .page-header, .detail-actions, .floating-buttons %7B%0A            display: none;%0A        %7D%0A        %0A        .dashboard-container %7B%0A            display: block;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A        %0A        .detail-container %7B%0A            border: none;%0A            box-shadow: none;%0A            padding: 0;%0A        %7D%0A        %0A        .detail-header %7B%0A            display: none;%0A        %7D%0A        %0A        .invoice-container %7B%0A            border: none;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/app.py","patch":"@@ -787,16 +787,197 @@\n _kham_id\n+, get_next_hoa_don_id%0Afrom database.hoa_don import get_all_hoa_don, get_hoa_don_by_id, search_hoa_don, create_hoa_don, update_hoa_don, delete_hoa_don, get_phieu_kham_chua_thanh_toan\n %0Aimport \n@@ -11923,16 +11923,2774 @@\n html')%0A%0A\n+# Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A@app.route('/hoa-don')%0Adef hoa_don_list():%0A    hoa_don_list = get_all_hoa_don()%0A    return render_template('hoa_don.html', hoa_don_list=hoa_don_list)%0A%0A# T%E1%BA%A1o m%E1%BB%9Bi h%C3%B3a %C4%91%C6%A1n%0A@app.route('/hoa-don/them-moi', methods=%5B'GET', 'POST'%5D)%0Adef them_moi_hoa_don():%0A    if request.method == 'POST':%0A        # X%E1%BB%AD l%C3%BD d%E1%BB%AF li%E1%BB%87u form khi submit%0A        ma_hoa_don = request.form.get('ma_hoa_don')%0A        ma_phieu_kham = request.form.get('ma_phieu_kham')%0A        phuong_thuc_thanh_toan = request.form.get('phuong_thuc_thanh_toan')%0A        ngay_lap = request.form.get('ngay_lap')%0A        %0A        # Ki%E1%BB%83m tra d%E1%BB%AF li%E1%BB%87u %C4%91%E1%BA%A7u v%C3%A0o%0A        if not ma_phieu_kham or not phuong_thuc_thanh_toan:%0A            flash('Vui l%C3%B2ng %C4%91i%E1%BB%81n %C4%91%E1%BA%A7y %C4%91%E1%BB%A7 th%C3%B4ng tin b%E1%BA%AFt bu%E1%BB%99c', 'error')%0A        else:%0A            # L%C6%B0u v%C3%A0o database%0A            ma_hd, result = create_hoa_don(%0A                ma_phieu_kham,%0A                phuong_thuc_thanh_toan,%0A                ma_hoa_don,%0A                ngay_lap%0A            )%0A            %0A            if result:%0A                flash(f'T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n th%C3%A0nh c%C3%B4ng v%E1%BB%9Bi m%C3%A3 %7Bma_hd%7D!', 'success')%0A                return redirect(url_for('hoa_don_list'))%0A            else:%0A                flash('C%C3%B3 l%E1%BB%97i x%E1%BA%A3y ra khi t%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n', 'error')%0A                    %0A    # GET request - hi%E1%BB%83n th%E1%BB%8B form v%E1%BB%9Bi m%C3%A3 h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A    ma_hoa_don = get_next_hoa_don_id()%0A    phieu_kham_list = get_phieu_kham_chua_thanh_toan()%0A    %0A    return render_template('them_moi_hoa_don.html', %0A                          ma_hoa_don=ma_hoa_don,%0A                          phieu_kham_list=phieu_kham_list)%0A%0A# T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A@app.route('/hoa-don/tim-kiem', methods=%5B'GET', 'POST'%5D)%0Adef tim_kiem_hoa_don():%0A    # D%E1%BB%AF li%E1%BB%87u m%E1%BA%ABu cho k%E1%BA%BFt qu%E1%BA%A3 t%C3%ACm ki%E1%BA%BFm%0A    ket_qua = %5B%5D%0A%0A    if request.method == 'POST':%0A        tu_khoa = request.form.get('tu_khoa')%0A        loai_tim_kiem = request.form.get('loai_tim_kiem', 'ma_hoa_don')%0A        %0A        if tu_khoa:%0A            ket_qua = search_hoa_don(tu_khoa, loai_tim_kiem)%0A            %0A    return render_template('tim_kiem_hoa_don.html', ket_qua=ket_qua)%0A%0A# Chi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%0A@app.route('/hoa-don/chi-tiet/%3Cma_hd%3E')%0Adef chi_tiet_hoa_don(ma_hd):%0A    hd = get_hoa_don_by_id(ma_hd)%0A    if not hd:%0A        flash('Kh%C3%B4ng t%C3%ACm th%E1%BA%A5y h%C3%B3a %C4%91%C6%A1n', 'error')%0A        return redirect(url_for('hoa_don_list'))%0A    return render_template('chi_tiet_hoa_don.html', hoa_don=hd)%0A%0A# API x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A@app.route('/api/hoa-don/%3Cma_hd%3E', methods=%5B'DELETE'%5D)%0Adef api_delete_hoa_don(ma_hd):%0A    try:%0A        result, message = delete_hoa_don(ma_hd)%0A        if not result:%0A            return jsonify(%7B%22success%22: False, %22message%22: message%7D), 404%0A        return jsonify(%7B%22success%22: True, %22message%22: message%7D)%0A    except Exception as e:%0A        return jsonify(%7B%22success%22: False, %22message%22: str(e)%7D), 500%0A%0A\n # B%C3%A1o c%C3%A1\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/hoa_don.html","patch":"@@ -0,0 +1,5083 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22page-header%22%3E%0A    %3Ch2%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Cspan%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22action-bar%22%3E%0A            %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22btn btn-primary%22%3E%0A                %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A            %3C/a%3E%0A            %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22btn btn-secondary%22%3E%0A                %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm%0A            %3C/a%3E%0A        %3C/div%3E%0A%0A        %7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A            %7B%25 if messages %25%7D%0A                %7B%25 for category, message in messages %25%7D%0A                    %3Cdiv class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                        %7B%7B message %7D%7D%0A                    %3C/div%3E%0A                %7B%25 endfor %25%7D%0A            %7B%25 endif %25%7D%0A        %7B%25 endwith %25%7D%0A%0A        %3Cdiv class=%22data-table-container%22%3E%0A            %3Ctable class=%22data-table%22%3E%0A                %3Cthead%3E%0A                    %3Ctr%3E%0A                        %3Cth%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                        %3Cth%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/th%3E%0A                        %3Cth%3EB%E1%BB%87nh nh%C3%A2n%3C/th%3E%0A                        %3Cth%3ENg%C3%A0y l%E1%BA%ADp%3C/th%3E%0A                        %3Cth%3ET%E1%BB%95ng ti%E1%BB%81n%3C/th%3E%0A                        %3Cth%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/th%3E%0A                        %3Cth%3ETr%E1%BA%A1ng th%C3%A1i%3C/th%3E%0A                        %3Cth%3EThao t%C3%A1c%3C/th%3E%0A                    %3C/tr%3E%0A                %3C/thead%3E%0A                %3Ctbody%3E%0A                    %7B%25 if hoa_don_list %25%7D%0A                        %7B%25 for hd in hoa_don_list %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B hd.MaHD %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B hd.MaPK %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B hd.TenBenhNhan %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B hd.NgayLap %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hd.TongTien) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B hd.PhuongThucThanhToan %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B hd.TrangThai %7D%7D%3C/td%3E%0A                                %3Ctd class=%22actions%22%3E%0A                                    %3Ca href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 class=%22btn-icon%22 title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                        %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                    %3C/a%3E%0A                                    %3Cbutton class=%22btn-icon delete-btn%22 data-id=%22%7B%7B hd.MaHD %7D%7D%22 title=%22X%C3%B3a%22%3E%0A                                        %3Ci class=%22fas fa-trash%22%3E%3C/i%3E%0A                                    %3C/button%3E%0A                                %3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %7B%25 else %25%7D%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%228%22 class=%22no-data%22%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u h%C3%B3a %C4%91%C6%A1n%3C/td%3E%0A                        %3C/tr%3E%0A                    %7B%25 endif %25%7D%0A                %3C/tbody%3E%0A            %3C/table%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A        const deleteButtons = document.querySelectorAll('.delete-btn');%0A        deleteButtons.forEach(button =%3E %7B%0A            button.addEventListener('click', function() %7B%0A                const maHD = this.getAttribute('data-id');%0A                if (confirm('B%E1%BA%A1n c%C3%B3 ch%E1%BA%AFc ch%E1%BA%AFn mu%E1%BB%91n x%C3%B3a h%C3%B3a %C4%91%C6%A1n n%C3%A0y kh%C3%B4ng?')) %7B%0A                    // G%E1%BB%ADi request x%C3%B3a%0A                    fetch(%60/api/hoa-don/$%7BmaHD%7D%60, %7B%0A                        method: 'DELETE',%0A                    %7D)%0A                    .then(response =%3E response.json())%0A                    .then(data =%3E %7B%0A                        if (data.success) %7B%0A                            alert(data.message);%0A                            // Reload trang sau khi x%C3%B3a th%C3%A0nh c%C3%B4ng%0A                            window.location.reload();%0A                        %7D else %7B%0A                            alert(data.message);%0A                        %7D%0A                    %7D)%0A                    .catch(error =%3E %7B%0A                        console.error('Error:', error);%0A                        alert('C%C3%B3 l%E1%BB%97i x%E1%BA%A3y ra khi x%C3%B3a h%C3%B3a %C4%91%C6%A1n');%0A                    %7D);%0A                %7D%0A            %7D);%0A        %7D);%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/database/init_db.sql","patch":"@@ -1479,24 +1479,474 @@\n U(MaDV)%0A);%0A%0A\n+-- B%E1%BA%A3ng HOADON%0ACREATE TABLE IF NOT EXISTS HOADON (%0A    MaHD CHAR(10) NOT NULL PRIMARY KEY, -- M%C3%A3 h%C3%B3a %C4%91%C6%A1n%0A    MaPK CHAR(10) NOT NULL, -- M%C3%A3 phi%E1%BA%BFu kh%C3%A1m%0A    NgayLap DATETIME NOT NULL, -- Ng%C3%A0y l%E1%BA%ADp h%C3%B3a %C4%91%C6%A1n%0A    TongTien DECIMAL(18,2) NOT NULL, -- T%E1%BB%95ng ti%E1%BB%81n%0A    PhuongThucThanhToan VARCHAR(50) NOT NULL, -- Ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%0A    TrangThai VARCHAR(50) DEFAULT '%C4%90%C3%A3 thanh to%C3%A1n', -- Tr%E1%BA%A1ng th%C3%A1i h%C3%B3a %C4%91%C6%A1n%0A    FOREIGN KEY (MaPK) REFERENCES PHIEUKHAM(MaPK)%0A);%0A%0A\n -- Th%C3%AAm d%E1%BB%AF l\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/tim_kiem_hoa_don.html","patch":"@@ -0,0 +1,5078 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DT%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22page-header%22%3E%0A    %3Ch2%3ET%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/a%3E / %0A        %3Cspan%3ET%C3%ACm ki%E1%BA%BFm%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22search-container%22%3E%0A            %3Ch3%3ET%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A            %0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22search-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_khoa%22%3ET%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22tu_khoa%22 name=%22tu_khoa%22 placeholder=%22Nh%E1%BA%ADp t%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm...%22 required%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22loai_tim_kiem%22%3ELo%E1%BA%A1i t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cselect id=%22loai_tim_kiem%22 name=%22loai_tim_kiem%22%3E%0A                        %3Coption value=%22ma_hoa_don%22%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/option%3E%0A                        %3Coption value=%22ma_phieu_kham%22%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/option%3E%0A                        %3Coption value=%22ma_benh_nhan%22%3EM%C3%A3 b%E1%BB%87nh nh%C3%A2n%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E L%C3%A0m m%E1%BB%9Bi%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A            %0A            %3Cdiv class=%22search-results%22%3E%0A                %3Ch4%3EK%E1%BA%BFt qu%E1%BA%A3 t%C3%ACm ki%E1%BA%BFm%3C/h4%3E%0A                %0A                %7B%25 if ket_qua %25%7D%0A                    %3Ctable class=%22data-table%22%3E%0A                        %3Cthead%3E%0A                            %3Ctr%3E%0A                                %3Cth%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                                %3Cth%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/th%3E%0A                                %3Cth%3EB%E1%BB%87nh nh%C3%A2n%3C/th%3E%0A                                %3Cth%3ENg%C3%A0y l%E1%BA%ADp%3C/th%3E%0A                                %3Cth%3ET%E1%BB%95ng ti%E1%BB%81n%3C/th%3E%0A                                %3Cth%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/th%3E%0A                                %3Cth%3ETr%E1%BA%A1ng th%C3%A1i%3C/th%3E%0A                                %3Cth%3EThao t%C3%A1c%3C/th%3E%0A                            %3C/tr%3E%0A                        %3C/thead%3E%0A                        %3Ctbody%3E%0A                            %7B%25 for hd in ket_qua %25%7D%0A                                %3Ctr%3E%0A                                    %3Ctd%3E%7B%7B hd.MaHD %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.MaPK %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.TenBenhNhan %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.NgayLap %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hd.TongTien) %7D%7D VN%C4%90%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.PhuongThucThanhToan %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.TrangThai %7D%7D%3C/td%3E%0A                                    %3Ctd class=%22actions%22%3E%0A                                        %3Ca href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 class=%22btn-icon%22 title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                            %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                        %3C/a%3E%0A                                    %3C/td%3E%0A                                %3C/tr%3E%0A                            %7B%25 endfor %25%7D%0A                        %3C/tbody%3E%0A                    %3C/table%3E%0A                %7B%25 elif request.method == 'POST' %25%7D%0A                    %3Cdiv class=%22no-results%22%3E%0A                        %3Cp%3EKh%C3%B4ng t%C3%ACm th%E1%BA%A5y k%E1%BA%BFt qu%E1%BA%A3 ph%C3%B9 h%E1%BB%A3p.%3C/p%3E%0A                    %3C/div%3E%0A                %7B%25 endif %25%7D%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .search-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .search-form %7B%0A        margin-bottom: 30px;%0A        padding-bottom: 20px;%0A        border-bottom: 1px solid #eee;%0A    %7D%0A    %0A    .search-results h4 %7B%0A        margin-bottom: 15px;%0A        color: #333;%0A    %7D%0A    %0A    .no-results %7B%0A        padding: 20px;%0A        text-align: center;%0A        background-color: #f9f9f9;%0A        border-radius: 5px;%0A        color: #666;%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/them_moi_hoa_don.html","patch":"@@ -0,0 +1,10258 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DT%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22page-header%22%3E%0A    %3Ch2%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Cspan%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22form-container%22%3E%0A            %3Ch3%3ETh%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A%0A            %7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A                %7B%25 if messages %25%7D%0A                    %7B%25 for category, message in messages %25%7D%0A                        %3Cdiv class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                            %7B%7B message %7D%7D%0A                        %3C/div%3E%0A                    %7B%25 endfor %25%7D%0A                %7B%25 endif %25%7D%0A            %7B%25 endwith %25%7D%0A%0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 id=%22hoadonForm%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22ma_hoa_don%22%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n %3Cspan class=%22required%22%3E*%3C/span%3E%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22ma_hoa_don%22 name=%22ma_hoa_don%22 value=%22%7B%7B ma_hoa_don %7D%7D%22 readonly%3E%0A                    %3Csmall%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n %C4%91%C6%B0%E1%BB%A3c t%E1%BA%A1o t%E1%BB%B1 %C4%91%E1%BB%99ng%3C/small%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22ma_phieu_kham%22%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m %3Cspan class=%22required%22%3E*%3C/span%3E%3C/label%3E%0A                    %3Cselect id=%22ma_phieu_kham%22 name=%22ma_phieu_kham%22 required%3E%0A                        %3Coption value=%22%22%3E-- Ch%E1%BB%8Dn phi%E1%BA%BFu kh%C3%A1m --%3C/option%3E%0A                        %7B%25 for pk in phieu_kham_list %25%7D%0A                            %3Coption value=%22%7B%7B pk.MaPK %7D%7D%22 data-benh-nhan=%22%7B%7B pk.TenBenhNhan %7D%7D%22 data-bac-si=%22%7B%7B pk.TenBacSi %7D%7D%22 data-dich-vu=%22%7B%7B pk.TenDV %7D%7D%22 data-gia=%22%7B%7B pk.Gia %7D%7D%22%3E%0A                                %7B%7B pk.MaPK %7D%7D - %7B%7B pk.TenBenhNhan %7D%7D - %7B%7B pk.NgayKham %7D%7D%0A                            %3C/option%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/select%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22ngay_lap%22%3ENg%C3%A0y l%E1%BA%ADp %3Cspan class=%22required%22%3E*%3C/span%3E%3C/label%3E%0A                    %3Cinput type=%22datetime-local%22 id=%22ngay_lap%22 name=%22ngay_lap%22 required%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22benh_nhan%22%3EB%E1%BB%87nh nh%C3%A2n%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22benh_nhan%22 readonly%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22bac_si%22%3EB%C3%A1c s%C4%A9 kh%C3%A1m%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22bac_si%22 readonly%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22dich_vu%22%3ED%E1%BB%8Bch v%E1%BB%A5%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22dich_vu%22 readonly%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22gia_dich_vu%22%3EGi%C3%A1 d%E1%BB%8Bch v%E1%BB%A5%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22gia_dich_vu%22 readonly%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22phuong_thuc_thanh_toan%22%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n %3Cspan class=%22required%22%3E*%3C/span%3E%3C/label%3E%0A                    %3Cselect id=%22phuong_thuc_thanh_toan%22 name=%22phuong_thuc_thanh_toan%22 required%3E%0A                        %3Coption value=%22%22%3E-- Ch%E1%BB%8Dn ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n --%3C/option%3E%0A                        %3Coption value=%22Ti%E1%BB%81n m%E1%BA%B7t%22%3ETi%E1%BB%81n m%E1%BA%B7t%3C/option%3E%0A                        %3Coption value=%22Chuy%E1%BB%83n kho%E1%BA%A3n%22%3EChuy%E1%BB%83n kho%E1%BA%A3n%3C/option%3E%0A                        %3Coption value=%22Th%E1%BA%BB t%C3%ADn d%E1%BB%A5ng%22%3ETh%E1%BA%BB t%C3%ADn d%E1%BB%A5ng%3C/option%3E%0A                        %3Coption value=%22V%C3%AD %C4%91i%E1%BB%87n t%E1%BB%AD%22%3EV%C3%AD %C4%91i%E1%BB%87n t%E1%BB%AD%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tong_tien%22%3ET%E1%BB%95ng ti%E1%BB%81n%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22tong_tien%22 readonly%3E%0A                %3C/div%3E%0A%0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22button%22 class=%22btn btn-secondary%22 onclick=%22window.location.href='%7B%7B url_for('hoa_don_list') %7D%7D'%22%3E%0A                        %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E Quay l%E1%BA%A1i%0A                    %3C/button%3E%0A                    %3Cbutton type=%22button%22 class=%22btn btn-light%22 id=%22printBtn%22 disabled%3E%0A                        %3Ci class=%22fas fa-print%22%3E%3C/i%3E In%0A                    %3C/button%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-save%22%3E%3C/i%3E L%C6%B0u th%C3%B4ng tin%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22floating-buttons%22%3E%0A    %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22floating-btn%22 title=%22Quay l%E1%BA%A1i%22%3E%0A        %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E%0A    %3C/a%3E%0A    %3Ca href=%22%7B%7B url_for('index') %7D%7D%22 class=%22floating-btn%22 title=%22V%E1%BB%81 trang ch%E1%BB%A7%22%3E%0A        %3Ci class=%22fas fa-home%22%3E%3C/i%3E%0A    %3C/a%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // Thi%E1%BA%BFt l%E1%BA%ADp ng%C3%A0y hi%E1%BB%87n t%E1%BA%A1i cho tr%C6%B0%E1%BB%9Dng ng%C3%A0y l%E1%BA%ADp%0A        const now = new Date();%0A        const year = now.getFullYear();%0A        const month = String(now.getMonth() + 1).padStart(2, '0');%0A        const day = String(now.getDate()).padStart(2, '0');%0A        const hours = String(now.getHours()).padStart(2, '0');%0A        const minutes = String(now.getMinutes()).padStart(2, '0');%0A        %0A        document.getElementById('ngay_lap').value = %60$%7Byear%7D-$%7Bmonth%7D-$%7Bday%7DT$%7Bhours%7D:$%7Bminutes%7D%60;%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n khi ch%E1%BB%8Dn phi%E1%BA%BFu kh%C3%A1m%0A        const phieuKhamSelect = document.getElementById('ma_phieu_kham');%0A        phieuKhamSelect.addEventListener('change', function() %7B%0A            const selectedOption = this.options%5Bthis.selectedIndex%5D;%0A            %0A            if (selectedOption.value) %7B%0A                // L%E1%BA%A5y th%C3%B4ng tin t%E1%BB%AB data attributes%0A                const benhNhan = selectedOption.getAttribute('data-benh-nhan');%0A                const bacSi = selectedOption.getAttribute('data-bac-si');%0A                const dichVu = selectedOption.getAttribute('data-dich-vu');%0A                const gia = selectedOption.getAttribute('data-gia');%0A                %0A                // C%E1%BA%ADp nh%E1%BA%ADt c%C3%A1c tr%C6%B0%E1%BB%9Dng th%C3%B4ng tin%0A                document.getElementById('benh_nhan').value = benhNhan;%0A                document.getElementById('bac_si').value = bacSi;%0A                document.getElementById('dich_vu').value = dichVu;%0A                document.getElementById('gia_dich_vu').value = formatCurrency(gia);%0A                document.getElementById('tong_tien').value = formatCurrency(gia);%0A                %0A                // K%C3%ADch ho%E1%BA%A1t n%C3%BAt in%0A                document.getElementById('printBtn').disabled = false;%0A            %7D else %7B%0A                // X%C3%B3a c%C3%A1c tr%C6%B0%E1%BB%9Dng th%C3%B4ng tin n%E1%BA%BFu kh%C3%B4ng ch%E1%BB%8Dn phi%E1%BA%BFu kh%C3%A1m%0A                document.getElementById('benh_nhan').value = '';%0A                document.getElementById('bac_si').value = '';%0A                document.getElementById('dich_vu').value = '';%0A                document.getElementById('gia_dich_vu').value = '';%0A                document.getElementById('tong_tien').value = '';%0A                %0A                // V%C3%B4 hi%E1%BB%87u h%C3%B3a n%C3%BAt in%0A                document.getElementById('printBtn').disabled = true;%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            // M%E1%BB%9F c%E1%BB%ADa s%E1%BB%95 in%0A            window.print();%0A        %7D);%0A        %0A        // H%C3%A0m %C4%91%E1%BB%8Bnh d%E1%BA%A1ng ti%E1%BB%81n t%E1%BB%87%0A        function formatCurrency(amount) %7B%0A            return new Intl.NumberFormat('vi-VN', %7B style: 'currency', currency: 'VND' %7D).format(amount);%0A        %7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .floating-buttons %7B%0A        position: fixed;%0A        bottom: 20px;%0A        right: 20px;%0A        display: flex;%0A        flex-direction: column;%0A        gap: 10px;%0A    %7D%0A    %0A    .floating-btn %7B%0A        width: 50px;%0A        height: 50px;%0A        border-radius: 50%25;%0A        background-color: #4a90e2;%0A        color: white;%0A        display: flex;%0A        align-items: center;%0A        justify-content: center;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.2);%0A        transition: all 0.3s ease;%0A    %7D%0A    %0A    .floating-btn:hover %7B%0A        transform: scale(1.1);%0A        background-color: #3a7bc8;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .page-header, .form-actions, .floating-buttons %7B%0A            display: none;%0A        %7D%0A        %0A        .dashboard-container %7B%0A            display: block;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A        %0A        .form-container %7B%0A            border: none;%0A            box-shadow: none;%0A        %7D%0A        %0A        .form-group %7B%0A            margin-bottom: 10px;%0A        %7D%0A        %0A        input, select %7B%0A            border: none;%0A            background: transparent;%0A        %7D%0A        %0A        h3 %7B%0A            text-align: center;%0A            font-size: 24px;%0A            margin-bottom: 20px;%0A        %7D%0A        %0A        /* Th%C3%AAm th%C3%B4ng tin ph%C3%B2ng kh%C3%A1m khi in */%0A        .form-container::before %7B%0A            content: %22PH%C3%92NG KH%C3%81M NHA KHOA NHAKHOASO%22;%0A            display: block;%0A            text-align: center;%0A            font-size: 18px;%0A            font-weight: bold;%0A            margin-bottom: 5px;%0A        %7D%0A        %0A        .form-container::after %7B%0A            content: %22C%E1%BA%A3m %C6%A1n qu%C3%BD kh%C3%A1ch %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng d%E1%BB%8Bch v%E1%BB%A5!%22;%0A            display: block;%0A            text-align: center;%0A            margin-top: 30px;%0A            font-style: italic;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false}]},{"id":"65283026-e209-4afb-accd-f82d9f21656c","type":"shellCommand","status":"UNRECOGNIZED","shell":"bash","command":"cd /home/huong/nhakhoaso && python init_database.py","toolCallId":"toolu_01CLfxLHaNsA4SBSBG3AFcXF","requiresConfirmation":true,"commandsRequiringConfirmation":[{"name":"python","arguments":["init_database.py"]}],"output":"Command 'python' not found, did you mean:\n  command 'python3' from deb python3\n  command 'python' from deb python-is-python3\n","outputPath":"/tmp/6dd4dce0-bb54-41de-ae93-37ba65828737.log"}],"context":{"author":"Coding Agent","operationId":"f4c78e24-9c4d-466d-b130-204296628db5"},"isInternal":false},{"id":"246726af-444e-4ecd-8678-1234a1ba7414","role":"assistant","createdAt":1745254524803,"content":[{"type":"text","text":"T√¥i s·∫Ω th·ª≠ l·∫°i v·ªõi python3:"},{"type":"toolCall","toolCallId":"toolu_0187Dd2UeUapuKyYan31y1UZ","isHidden":true,"title":"","statusText":"","status":"IN_PROGRESS","localResult":"{\"status\":\"UNRECOGNIZED\",\"output\":\"L·ªói khi kh·ªüi t·∫°o c∆° s·ªü d·ªØ li·ªáu: UNIQUE constraint failed: BENHNHAN.MaBN\\n\"}"},{"id":"f038db8d-50a1-4044-8a86-a6eb29e57be8","type":"shellCommand","status":"UNRECOGNIZED","shell":"bash","command":"cd /home/huong/nhakhoaso && python3 init_database.py","toolCallId":"toolu_0187Dd2UeUapuKyYan31y1UZ","requiresConfirmation":true,"commandsRequiringConfirmation":[{"name":"python3","arguments":["init_database.py"]}],"output":"L·ªói khi kh·ªüi t·∫°o c∆° s·ªü d·ªØ li·ªáu: UNIQUE constraint failed: BENHNHAN.MaBN\n","outputPath":"/tmp/dd79cc8e-c000-41c5-b093-ff3b5dc84e0a.log"}],"context":{"author":"Coding Agent","operationId":"7b4c8005-6825-4c1b-930e-09511128bcff"},"isInternal":false},{"id":"77973e95-2399-4438-a890-1db20c2f71da","role":"assistant","createdAt":1745254755018,"content":[{"type":"text","text":"C√≥ v·∫ª nh∆∞ ƒë√£ c√≥ d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu. T√¥i s·∫Ω ki·ªÉm tra xem b·∫£ng HOADON ƒë√£ ƒë∆∞·ª£c t·∫°o ch∆∞a:"},{"type":"toolCall","toolCallId":"toolu_016cqH3iGyrhSz7J4EPCG56G","isHidden":true,"title":"","statusText":"","status":"IN_PROGRESS","localResult":"{\"status\":\"UNRECOGNIZED\",\"output\":\"[{'name': 'HOADON'}]\\n\"}"},{"id":"535aa79d-1901-46fa-8204-079d60e91d93","type":"shellCommand","status":"UNRECOGNIZED","shell":"bash","command":"cd /home/huong/nhakhoaso && python3 -c \"from database.db import execute_query; print(execute_query('SELECT name FROM sqlite_master WHERE type=\\\"table\\\" AND name=\\\"HOADON\\\"', fetch=True))\"","toolCallId":"toolu_016cqH3iGyrhSz7J4EPCG56G","requiresConfirmation":true,"commandsRequiringConfirmation":[{"name":"python3","arguments":["-c"]}],"output":"[{'name': 'HOADON'}]\n","outputPath":"/tmp/7286d818-9d3a-48d3-ade8-395522550386.log"}],"context":{"author":"Coding Agent","operationId":"f5771166-cd96-407b-90a4-6f6ad20814c3"},"isInternal":false},{"id":"1ddf8d7f-1572-499a-928b-58a41e0cf9cf","role":"assistant","createdAt":1745254793408,"content":[{"type":"text","text":"B·∫£ng HOADON ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng. B√¢y gi·ªù t√¥i s·∫Ω ki·ªÉm tra xem ·ª©ng d·ª•ng c√≥ ch·∫°y ƒë∆∞·ª£c kh√¥ng:"},{"type":"toolCall","toolCallId":"toolu_011iDmaswJWH4a4SbA1BNCd5","isHidden":true,"title":"","statusText":"","status":"IN_PROGRESS","localResult":"{\"status\":\"UNRECOGNIZED\",\"output\":\"\"}"},{"id":"59ba99fb-e0bb-4353-a119-9562d05a5d06","type":"shellCommand","status":"UNRECOGNIZED","shell":"bash","command":"cd /home/huong/nhakhoaso && python3 app.py &","toolCallId":"toolu_011iDmaswJWH4a4SbA1BNCd5","requiresConfirmation":true,"commandsRequiringConfirmation":[{"name":"python3","arguments":["app.py"]}],"output":"","outputPath":"/tmp/9153fab8-1433-4566-9186-e93595d9cf1f.log"}],"context":{"author":"Coding Agent","operationId":"7201a4c6-16d9-4d38-a4d8-95ae2820a3e6"},"isInternal":false},{"id":"c38b4009-78e0-40b1-a730-ae4ad1be2f11","role":"assistant","createdAt":1745254927861,"content":[{"type":"text","text":"·ª®ng d·ª•ng ƒë√£ ƒë∆∞·ª£c kh·ªüi ƒë·ªông. B√¢y gi·ªù t√¥i s·∫Ω t√≥m t·∫Øt nh·ªØng g√¨ ƒë√£ l√†m v√† h∆∞·ªõng d·∫´n c√°ch s·ª≠ d·ª•ng ch·ª©c nƒÉng m·ªõi.\n\n## T√≥m t·∫Øt\n\nT√¥i ƒë√£ ho√†n th√†nh vi·ªác tri·ªÉn khai ch·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n v·ªõi 2 ch·ª©c nƒÉng con: t·∫°o h√≥a ƒë∆°n thanh to√°n v√† danh s√°ch h√≥a ƒë∆°n. D∆∞·ªõi ƒë√¢y l√† nh·ªØng g√¨ ƒë√£ ƒë∆∞·ª£c th·ª±c hi·ªán:\n\n1. **C∆° s·ªü d·ªØ li·ªáu**:\n   - T·∫°o b·∫£ng HOADON ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin h√≥a ƒë∆°n\n   - Li√™n k·∫øt b·∫£ng HOADON v·ªõi b·∫£ng PHIEUKHAM\n\n2. **Module x·ª≠ l√Ω d·ªØ li·ªáu**:\n   - T·∫°o module database/hoa_don.py v·ªõi c√°c h√†m CRUD cho h√≥a ƒë∆°n\n   - C·∫≠p nh·∫≠t utils.py ƒë·ªÉ th√™m h√†m t·∫°o m√£ h√≥a ƒë∆°n t·ª± ƒë·ªông\n\n3. **Route v√† Controller**:\n   - C·∫≠p nh·∫≠t app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng h√≥a ƒë∆°n\n   - Th√™m c√°c API endpoint ƒë·ªÉ x·ª≠ l√Ω c√°c thao t√°c v·ªõi h√≥a ƒë∆°n\n\n4. **Giao di·ªán ng∆∞·ªùi d√πng**:\n   - T·∫°o template thanh_toan.html l√†m trang ch√≠nh cho ch·ª©c nƒÉng thanh to√°n\n   - T·∫°o template them_moi_hoa_don.html cho ch·ª©c nƒÉng t·∫°o h√≥a ƒë∆°n\n   - T·∫°o template hoa_don.html cho ch·ª©c nƒÉng danh s√°ch h√≥a ƒë∆°n\n   - T·∫°o template chi_tiet_hoa_don.html ƒë·ªÉ xem chi ti·∫øt h√≥a ƒë∆°n\n   - T·∫°o template tim_kiem_hoa_don.html ƒë·ªÉ t√¨m ki·∫øm h√≥a ƒë∆°n\n\n## H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\n\n1. **Truy c·∫≠p ch·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n**:\n   - T·ª´ trang ch·ªß, nh·∫•p v√†o \"Qu·∫£n l√Ω thanh to√°n\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/thanh-toan`\n\n2. **T·∫°o h√≥a ƒë∆°n m·ªõi**:\n   - T·ª´ trang Qu·∫£n l√Ω thanh to√°n, nh·∫•p v√†o \"T·∫°o h√≥a ƒë∆°n\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/them-moi`\n   - Ch·ªçn phi·∫øu kh√°m t·ª´ danh s√°ch phi·∫øu kh√°m ch∆∞a thanh to√°n\n   - Th√¥ng tin b·ªánh nh√¢n, b√°c sƒ©, d·ªãch v·ª• v√† gi√° s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn\n   - Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n\n   - Nh·∫•p v√†o \"L∆∞u th√¥ng tin\" ƒë·ªÉ l∆∞u h√≥a ƒë∆°n\n   - C√≥ th·ªÉ nh·∫•p v√†o \"In\" ƒë·ªÉ in h√≥a ƒë∆°n\n\n3. **Xem danh s√°ch h√≥a ƒë∆°n**:\n   - T·ª´ trang Qu·∫£n l√Ω thanh to√°n, nh·∫•p v√†o \"Danh s√°ch h√≥a ƒë∆°n\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don`\n   - Danh s√°ch hi·ªÉn th·ªã t·∫•t c·∫£ h√≥a ƒë∆°n ƒë√£ t·∫°o\n   - C√≥ th·ªÉ xem chi ti·∫øt ho·∫∑c x√≥a h√≥a ƒë∆°n\n\n4. **Xem chi ti·∫øt h√≥a ƒë∆°n**:\n   - T·ª´ danh s√°ch h√≥a ƒë∆°n, nh·∫•p v√†o bi·ªÉu t∆∞·ª£ng \"Xem chi ti·∫øt\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/chi-tiet/<ma_hd>`\n   - Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß th√¥ng tin h√≥a ƒë∆°n\n   - C√≥ th·ªÉ in h√≥a ƒë∆°n t·ª´ trang chi ti·∫øt\n\n5. **T√¨m ki·∫øm h√≥a ƒë∆°n**:\n   - T·ª´ danh s√°ch h√≥a ƒë∆°n, nh·∫•p v√†o \"T√¨m ki·∫øm\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/tim-kiem`\n   - Nh·∫≠p t·ª´ kh√≥a v√† ch·ªçn lo·∫°i t√¨m ki·∫øm (m√£ h√≥a ƒë∆°n, m√£ phi·∫øu kh√°m, m√£ b·ªánh nh√¢n)\n   - Nh·∫•p v√†o \"T√¨m ki·∫øm\" ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£\n\nCh·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ƒë·∫ßy ƒë·ªß theo y√™u c·∫ßu, bao g·ªìm t·∫°o h√≥a ƒë∆°n thanh to√°n v√† danh s√°ch h√≥a ƒë∆°n. Giao di·ªán ƒë∆∞·ª£c thi·∫øt k·∫ø th√¢n thi·ªán v·ªõi ng∆∞·ªùi d√πng v√† c√≥ t√≠nh nƒÉng in h√≥a ƒë∆°n."}],"context":{"author":"Coding Agent","operationId":"8fcaa7ff-664f-46b5-8c03-bab9daf4329a","usedFilePaths":[{"fsPath":"/home/huong/nhakhoaso/database/dich_vu.py","path":"nhakhoaso/database/dich_vu.py","displayPath":"nhakhoaso/database/dich_vu.py"}]},"isInternal":false},{"id":"69a639ab-e2e7-41f0-8011-f9ebda5837f4","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"ch√∫ √Ω t√¥i t√¥i mu·ªën ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n c≈©ng ph·∫£i t∆∞∆°ng t·ª± c√°c ch·ª©c nƒÉng kh√°c ch·ª©, c≈©ng ph·∫£i c√≥ thanh ch·ª©c nƒÉng b√™n tr√°i, giao di·ªán gi·ªëng c√°c ch·ª©c nƒÉng kh√°c m√†"}]}]},"content":[{"type":"text","text":"ch√∫ √Ω t√¥i t√¥i mu·ªën ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n c≈©ng ph·∫£i t∆∞∆°ng t·ª± c√°c ch·ª©c nƒÉng kh√°c ch·ª©, c≈©ng ph·∫£i c√≥ thanh ch·ª©c nƒÉng b√™n tr√°i, giao di·ªán gi·ªëng c√°c ch·ª©c nƒÉng kh√°c m√†"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/templates/them_moi_hoa_don.html","path":"nhakhoaso/templates/them_moi_hoa_don.html","displayPath":"nhakhoaso/templates/them_moi_hoa_don.html","content":"{% extends 'layout.html' %}\n\n{% block title %}T·∫°o h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n\n{% block content %}\n<div class=\"page-header\">\n    <h2>T·∫°o h√≥a ƒë∆°n</h2>\n    <div class=\"breadcrumb\">\n        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n        <span>T·∫°o h√≥a ƒë∆°n</span>\n    </div>\n</div>\n\n<div class=\"dashboard-container\">\n    <div class=\"sidebar\">\n        <div class=\"sidebar-header\">\n            <h3>Ch·ª©c nƒÉng</h3>\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"active\">\n                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('hoa_don_list') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n                </a>\n            </li>\n        </ul>\n    </div>\n\n    <div class=\"main-content\">\n        <div class=\"form-container\">\n            <h3>Th√¥ng tin h√≥a ƒë∆°n</h3>\n\n            {% with messages = get_flashed_messages(with_categories=true) %}\n                {% if messages %}\n                    {% for category, message in messages %}\n                        <div class=\"alert alert-{{ category }}\">\n                            {{ message }}\n                        </div>\n                    {% endfor %}\n                {% endif %}\n            {% endwith %}\n\n            <form method=\"POST\" action=\"{{ url_for('them_moi_hoa_don') }}\" id=\"hoadonForm\">\n                <div class=\"form-group\">\n                    <label for=\"ma_hoa_don\">M√£ h√≥a ƒë∆°n <span class=\"required\">*</span></label>\n                    <input type=\"text\" id=\"ma_hoa_don\" name=\"ma_hoa_don\" value=\"{{ ma_hoa_don }}\" readonly>\n                    <small>M√£ h√≥a ƒë∆°n ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông</small>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"ma_phieu_kham\">M√£ phi·∫øu kh√°m <span class=\"required\">*</span></label>\n                    <select id=\"ma_phieu_kham\" name=\"ma_phieu_kham\" required>\n                        <option value=\"\">-- Ch·ªçn phi·∫øu kh√°m --</option>\n                        {% for pk in phieu_kham_list %}\n                            <option value=\"{{ pk.MaPK }}\" data-benh-nhan=\"{{ pk.TenBenhNhan }}\" data-bac-si=\"{{ pk.TenBacSi }}\" data-dich-vu=\"{{ pk.TenDV }}\" data-gia=\"{{ pk.Gia }}\">\n                                {{ pk.MaPK }} - {{ pk.TenBenhNhan }} - {{ pk.NgayKham }}\n                            </option>\n                        {% endfor %}\n                    </select>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"ngay_lap\">Ng√†y l·∫≠p <span class=\"required\">*</span></label>\n                    <input type=\"datetime-local\" id=\"ngay_lap\" name=\"ngay_lap\" required>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"benh_nhan\">B·ªánh nh√¢n</label>\n                    <input type=\"text\" id=\"benh_nhan\" readonly>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"bac_si\">B√°c sƒ© kh√°m</label>\n                    <input type=\"text\" id=\"bac_si\" readonly>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"dich_vu\">D·ªãch v·ª•</label>\n                    <input type=\"text\" id=\"dich_vu\" readonly>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"gia_dich_vu\">Gi√° d·ªãch v·ª•</label>\n                    <input type=\"text\" id=\"gia_dich_vu\" readonly>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"phuong_thuc_thanh_toan\">Ph∆∞∆°ng th·ª©c thanh to√°n <span class=\"required\">*</span></label>\n                    <select id=\"phuong_thuc_thanh_toan\" name=\"phuong_thuc_thanh_toan\" required>\n                        <option value=\"\">-- Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n --</option>\n                        <option value=\"Ti·ªÅn m·∫∑t\">Ti·ªÅn m·∫∑t</option>\n                        <option value=\"Chuy·ªÉn kho·∫£n\">Chuy·ªÉn kho·∫£n</option>\n                        <option value=\"Th·∫ª t√≠n d·ª•ng\">Th·∫ª t√≠n d·ª•ng</option>\n                        <option value=\"V√≠ ƒëi·ªán t·ª≠\">V√≠ ƒëi·ªán t·ª≠</option>\n                    </select>\n                </div>\n\n                <div class=\"form-group\">\n                    <label for=\"tong_tien\">T·ªïng ti·ªÅn</label>\n                    <input type=\"text\" id=\"tong_tien\" readonly>\n                </div>\n\n                <div class=\"form-actions\">\n                    <button type=\"button\" class=\"btn btn-secondary\" onclick=\"window.location.href='{{ url_for('hoa_don_list') }}'\">\n                        <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n                    </button>\n                    <button type=\"button\" class=\"btn btn-light\" id=\"printBtn\" disabled>\n                        <i class=\"fas fa-print\"></i> In\n                    </button>\n                    <button type=\"submit\" class=\"btn btn-primary\">\n                        <i class=\"fas fa-save\"></i> L∆∞u th√¥ng tin\n                    </button>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>\n\n<div class=\"floating-buttons\">\n    <a href=\"{{ url_for('hoa_don_list') }}\" class=\"floating-btn\" title=\"Quay l·∫°i\">\n        <i class=\"fas fa-arrow-left\"></i>\n    </a>\n    <a href=\"{{ url_for('index') }}\" class=\"floating-btn\" title=\"V·ªÅ trang ch·ªß\">\n        <i class=\"fas fa-home\"></i>\n    </a>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        // Thi·∫øt l·∫≠p ng√†y hi·ªán t·∫°i cho tr∆∞·ªùng ng√†y l·∫≠p\n        const now = new Date();\n        const year = now.getFullYear();\n        const month = String(now.getMonth() + 1).padStart(2, '0');\n        const day = String(now.getDate()).padStart(2, '0');\n        const hours = String(now.getHours()).padStart(2, '0');\n        const minutes = String(now.getMinutes()).padStart(2, '0');\n        \n        document.getElementById('ngay_lap').value = `${year}-${month}-${day}T${hours}:${minutes}`;\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán khi ch·ªçn phi·∫øu kh√°m\n        const phieuKhamSelect = document.getElementById('ma_phieu_kham');\n        phieuKhamSelect.addEventListener('change', function() {\n            const selectedOption = this.options[this.selectedIndex];\n            \n            if (selectedOption.value) {\n                // L·∫•y th√¥ng tin t·ª´ data attributes\n                const benhNhan = selectedOption.getAttribute('data-benh-nhan');\n                const bacSi = selectedOption.getAttribute('data-bac-si');\n                const dichVu = selectedOption.getAttribute('data-dich-vu');\n                const gia = selectedOption.getAttribute('data-gia');\n                \n                // C·∫≠p nh·∫≠t c√°c tr∆∞·ªùng th√¥ng tin\n                document.getElementById('benh_nhan').value = benhNhan;\n                document.getElementById('bac_si').value = bacSi;\n                document.getElementById('dich_vu').value = dichVu;\n                document.getElementById('gia_dich_vu').value = formatCurrency(gia);\n                document.getElementById('tong_tien').value = formatCurrency(gia);\n                \n                // K√≠ch ho·∫°t n√∫t in\n                document.getElementById('printBtn').disabled = false;\n            } else {\n                // X√≥a c√°c tr∆∞·ªùng th√¥ng tin n·∫øu kh√¥ng ch·ªçn phi·∫øu kh√°m\n                document.getElementById('benh_nhan').value = '';\n                document.getElementById('bac_si').value = '';\n                document.getElementById('dich_vu').value = '';\n                document.getElementById('gia_dich_vu').value = '';\n                document.getElementById('tong_tien').value = '';\n                \n                // V√¥ hi·ªáu h√≥a n√∫t in\n                document.getElementById('printBtn').disabled = true;\n            }\n        });\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n        document.getElementById('printBtn').addEventListener('click', function() {\n            // M·ªü c·ª≠a s·ªï in\n            window.print();\n        });\n        \n        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá\n        function formatCurrency(amount) {\n            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);\n        }\n    });\n</script>\n{% endblock %}\n\n{% block extra_css %}\n<style>\n    .floating-buttons {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n    }\n    \n    .floating-btn {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: #4a90e2;\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n        transition: all 0.3s ease;\n    }\n    \n    .floating-btn:hover {\n        transform: scale(1.1);\n        background-color: #3a7bc8;\n    }\n    \n    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n    @media print {\n        .sidebar, .page-header, .form-actions, .floating-buttons {\n            display: none;\n        }\n        \n        .dashboard-container {\n            display: block;\n        }\n        \n        .main-content {\n            width: 100%;\n            margin: 0;\n            padding: 0;\n        }\n        \n        .form-container {\n            border: none;\n            box-shadow: none;\n        }\n        \n        .form-group {\n            margin-bottom: 10px;\n        }\n        \n        input, select {\n            border: none;\n            background: transparent;\n        }\n        \n        h3 {\n            text-align: center;\n            font-size: 24px;\n            margin-bottom: 20px;\n        }\n        \n        /* Th√™m th√¥ng tin ph√≤ng kh√°m khi in */\n        .form-container::before {\n            content: \"PH√íNG KH√ÅM NHA KHOA NHAKHOASO\";\n            display: block;\n            text-align: center;\n            font-size: 18px;\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        \n        .form-container::after {\n            content: \"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•!\";\n            display: block;\n            text-align: center;\n            margin-top: 30px;\n            font-style: italic;\n        }\n    }\n</style>\n{% endblock %}","language":"html"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745255150715,"isInternal":false},{"id":"11abb0d2-6c8a-4a2e-a81b-8224a0546db9","role":"assistant","createdAt":1745255163914,"content":[{"type":"text","text":"T√¥i hi·ªÉu r·ªìi, b·∫°n mu·ªën ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n c√≥ giao di·ªán v√† c·∫•u tr√∫c t∆∞∆°ng t·ª± nh∆∞ c√°c ch·ª©c nƒÉng kh√°c trong h·ªá th·ªëng, bao g·ªìm thanh ch·ª©c nƒÉng b√™n tr√°i. T√¥i s·∫Ω ki·ªÉm tra v√† ƒëi·ªÅu ch·ªânh l·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n v·ªõi c√°c ch·ª©c nƒÉng kh√°c.\n\nƒê·∫ßu ti√™n, t√¥i s·∫Ω xem m·ªôt trang ch·ª©c nƒÉng kh√°c ƒë·ªÉ hi·ªÉu c·∫•u tr√∫c chung:"},{"type":"toolCall","toolCallId":"toolu_015kqkazGYEj95Rw9zEjxig9","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/benh_nhan.html","path":"nhakhoaso/templates/benh_nhan.html","displayPath":"nhakhoaso/templates/benh_nhan.html"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω c·∫≠p nh·∫≠t l·∫°i c√°c template cho ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n ƒë·ªÉ ph√π h·ª£p v·ªõi c·∫•u tr√∫c chung c·ªßa h·ªá th·ªëng. ƒê·∫ßu ti√™n, t√¥i s·∫Ω c·∫≠p nh·∫≠t trang thanh_toan.html:"},{"type":"toolCall","toolCallId":"toolu_01RHxbxrTcupooHQBw1hXaGG","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/thanh_toan.html","path":"nhakhoaso/templates/thanh_toan.html","displayPath":"nhakhoaso/templates/thanh_toan.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/thanh_toan.html\n+++ nhakhoaso/templates/thanh_toan.html\n@@ -3,22 +3,36 @@\n {% block title %}Qu·∫£n l√Ω thanh to√°n - NHAKHOASO{% endblock %}\n \n {% block content %}\n-<div class=\"page-header\">\n-    <h2>Qu·∫£n l√Ω thanh to√°n</h2>\n-    <div class=\"breadcrumb\">\n-        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / <span>Qu·∫£n l√Ω thanh to√°n</span>\n-    </div>\n+<div class=\"section-title\">\n+    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>\n </div>\n \n-<div class=\"dashboard-container\">\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n     <div class=\"sidebar\">\n-        <div class=\"sidebar-header\">\n-            <h3>Ch·ª©c nƒÉng</h3>\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n         </div>\n         <ul class=\"sidebar-menu\">\n             <li>\n-                <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"active\">\n-                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n                 </a>\n             </li>\n             <li>\n@@ -27,9 +41,58 @@\n                 </a>\n             </li>\n         </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n+                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n+            </a>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('phieu_kham_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n+                </a>\n+            </li>\n+        </ul>\n     </div>\n \n+    <!-- Main content -->\n     <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>Qu·∫£n l√Ω thanh to√°n</h2>\n+        </div>\n+        \n         <div class=\"welcome-section\">\n             <h3>Ch√†o m·ª´ng ƒë·∫øn v·ªõi Qu·∫£n l√Ω thanh to√°n</h3>\n             <p>Vui l√≤ng ch·ªçn ch·ª©c nƒÉng t·ª´ menu b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>\n@@ -96,5 +159,13 @@\n         color: #666;\n         font-size: 14px;\n     }\n+    \n+    .welcome-section {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        margin-top: 20px;\n+    }\n </style>\n {% endblock %}","refToolCallId":"toolu_01RHxbxrTcupooHQBw1hXaGG"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω c·∫≠p nh·∫≠t trang danh s√°ch h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01FfdjAm4Rfe9JbMNturcz9g","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/hoa_don.html","path":"nhakhoaso/templates/hoa_don.html","displayPath":"nhakhoaso/templates/hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/hoa_don.html\n+++ nhakhoaso/templates/hoa_don.html\n@@ -3,24 +3,36 @@\n {% block title %}Danh s√°ch h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n \n {% block content %}\n-<div class=\"page-header\">\n-    <h2>Danh s√°ch h√≥a ƒë∆°n</h2>\n-    <div class=\"breadcrumb\">\n-        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n-        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n-        <span>Danh s√°ch h√≥a ƒë∆°n</span>\n-    </div>\n+<div class=\"section-title\">\n+    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>\n </div>\n \n-<div class=\"dashboard-container\">\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n     <div class=\"sidebar\">\n-        <div class=\"sidebar-header\">\n-            <h3>Ch·ª©c nƒÉng</h3>\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n         </div>\n         <ul class=\"sidebar-menu\">\n             <li>\n                 <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n-                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n                 </a>\n             </li>\n             <li>\n@@ -29,29 +41,67 @@\n                 </a>\n             </li>\n         </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n+                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n+            </a>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('phieu_kham_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n+                </a>\n+            </li>\n+        </ul>\n     </div>\n \n+    <!-- Main content -->\n     <div class=\"main-content\">\n-        <div class=\"action-bar\">\n-            <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"btn btn-primary\">\n-                <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n m·ªõi\n-            </a>\n-            <a href=\"{{ url_for('tim_kiem_hoa_don') }}\" class=\"btn btn-secondary\">\n-                <i class=\"fas fa-search\"></i> T√¨m ki·∫øm\n-            </a>\n-        </div>\n-\n-        {% with messages = get_flashed_messages(with_categories=true) %}\n-            {% if messages %}\n-                {% for category, message in messages %}\n-                    <div class=\"alert alert-{{ category }}\">\n-                        {{ message }}\n-                    </div>\n-                {% endfor %}\n-            {% endif %}\n-        {% endwith %}\n-\n-        <div class=\"data-table-container\">\n+        <div class=\"content-header\">\n+            <h2>Danh s√°ch h√≥a ƒë∆°n</h2>\n+        </div>\n+        \n+        <div class=\"module-actions\">\n+            <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"btn\"><i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n m·ªõi</a>\n+            <div class=\"search-box\">\n+                <input type=\"text\" placeholder=\"T√¨m ki·∫øm h√≥a ƒë∆°n...\">\n+                <button class=\"btn\" onclick=\"window.location.href='{{ url_for('tim_kiem_hoa_don') }}'\"><i class=\"fas fa-search\"></i></button>\n+            </div>\n+        </div>\n+\n+        <div class=\"module-content\">\n             <table class=\"data-table\">\n                 <thead>\n                     <tr>\n@@ -68,7 +118,7 @@\n                 <tbody>\n                     {% if hoa_don_list %}\n                         {% for hd in hoa_don_list %}\n-                            <tr>\n+                            <tr id=\"hoa-don-{{ hd.MaHD }}\">\n                                 <td>{{ hd.MaHD }}</td>\n                                 <td>{{ hd.MaPK }}</td>\n                                 <td>{{ hd.TenBenhNhan }}</td>\n@@ -76,58 +126,93 @@\n                                 <td>{{ \"{:,.0f}\".format(hd.TongTien) }} VNƒê</td>\n                                 <td>{{ hd.PhuongThucThanhToan }}</td>\n                                 <td>{{ hd.TrangThai }}</td>\n-                                <td class=\"actions\">\n-                                    <a href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" class=\"btn-icon\" title=\"Xem chi ti·∫øt\">\n+                                <td>\n+                                    <a \n+                                        href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" \n+                                        class=\"action-btn view-btn\" \n+                                        title=\"Xem chi ti·∫øt\">\n                                         <i class=\"fas fa-eye\"></i>\n                                     </a>\n-                                    <button class=\"btn-icon delete-btn\" data-id=\"{{ hd.MaHD }}\" title=\"X√≥a\">\n+                                    <a \n+                                        href=\"#\" \n+                                        class=\"action-btn delete-btn\" \n+                                        title=\"X√≥a\" \n+                                        onclick=\"deleteInvoice('{{ hd.MaHD }}')\">\n                                         <i class=\"fas fa-trash\"></i>\n-                                    </button>\n+                                    </a>\n                                 </td>\n                             </tr>\n                         {% endfor %}\n                     {% else %}\n                         <tr>\n-                            <td colspan=\"8\" class=\"no-data\">Kh√¥ng c√≥ d·ªØ li·ªáu h√≥a ƒë∆°n</td>\n+                            <td colspan=\"8\" class=\"text-center\">\n+                                <div class=\"no-data\">\n+                                    <i class=\"fas fa-database\"></i>\n+                                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu h√≥a ƒë∆°n</p>\n+                                    <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"btn\">\n+                                        <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n m·ªõi\n+                                    </a>\n+                                </div>\n+                            </td>\n                         </tr>\n                     {% endif %}\n                 </tbody>\n             </table>\n         </div>\n+\n+        <div class=\"pagination\">\n+            <a href=\"#\" class=\"page-link\">&laquo;</a>\n+            <a href=\"#\" class=\"page-link active\">1</a>\n+            <a href=\"#\" class=\"page-link\">2</a>\n+            <a href=\"#\" class=\"page-link\">3</a>\n+            <a href=\"#\" class=\"page-link\">&raquo;</a>\n+        </div>\n     </div>\n </div>\n {% endblock %}\n \n {% block extra_js %}\n <script>\n-    document.addEventListener('DOMContentLoaded', function() {\n-        // X·ª≠ l√Ω s·ª± ki·ªán x√≥a h√≥a ƒë∆°n\n-        const deleteButtons = document.querySelectorAll('.delete-btn');\n-        deleteButtons.forEach(button => {\n-            button.addEventListener('click', function() {\n-                const maHD = this.getAttribute('data-id');\n-                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h√≥a ƒë∆°n n√†y kh√¥ng?')) {\n-                    // G·ª≠i request x√≥a\n-                    fetch(`/api/hoa-don/${maHD}`, {\n-                        method: 'DELETE',\n-                    })\n-                    .then(response => response.json())\n-                    .then(data => {\n-                        if (data.success) {\n-                            alert(data.message);\n-                            // Reload trang sau khi x√≥a th√†nh c√¥ng\n-                            window.location.reload();\n-                        } else {\n-                            alert(data.message);\n-                        }\n-                    })\n-                    .catch(error => {\n-                        console.error('Error:', error);\n-                        alert('C√≥ l·ªói x·∫£y ra khi x√≥a h√≥a ƒë∆°n');\n-                    });\n+    // H√†m x√≥a h√≥a ƒë∆°n\n+    function deleteInvoice(maHD) {\n+        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h√≥a ƒë∆°n n√†y?')) {\n+            // G·ªçi API x√≥a h√≥a ƒë∆°n\n+            fetch(`/api/hoa-don/${maHD}`, {\n+                method: 'DELETE'\n+            })\n+            .then(response => response.json())\n+            .then(data => {\n+                if (data.success) {\n+                    // X√≥a d√≤ng kh·ªèi b·∫£ng\n+                    document.getElementById(`hoa-don-${maHD}`).remove();\n+                    alert('X√≥a h√≥a ƒë∆°n th√†nh c√¥ng!');\n+                    \n+                    // Ki·ªÉm tra n·∫øu kh√¥ng c√≤n h√≥a ƒë∆°n n√†o, hi·ªÉn th·ªã th√¥ng b√°o\n+                    const tbody = document.querySelector('.data-table tbody');\n+                    if (tbody.children.length === 0) {\n+                        tbody.innerHTML = `\n+                        <tr>\n+                            <td colspan=\"8\" class=\"text-center\">\n+                                <div class=\"no-data\">\n+                                    <i class=\"fas fa-database\"></i>\n+                                    <p>Ch∆∞a c√≥ d·ªØ li·ªáu h√≥a ƒë∆°n</p>\n+                                    <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"btn\">\n+                                        <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n m·ªõi\n+                                    </a>\n+                                </div>\n+                            </td>\n+                        </tr>\n+                        `;\n+                    }\n+                } else {\n+                    alert('L·ªói: ' + data.message);\n                 }\n+            })\n+            .catch(error => {\n+                console.error('Error:', error);\n+                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a h√≥a ƒë∆°n');\n             });\n-        });\n-    });\n+        }\n+    }\n </script>\n {% endblock %}","refToolCallId":"toolu_01FfdjAm4Rfe9JbMNturcz9g"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω c·∫≠p nh·∫≠t trang t·∫°o m·ªõi h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01VdDybJUyAgJmtuSTKnSvFs","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/them_moi_hoa_don.html","path":"nhakhoaso/templates/them_moi_hoa_don.html","displayPath":"nhakhoaso/templates/them_moi_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/them_moi_hoa_don.html\n+++ nhakhoaso/templates/them_moi_hoa_don.html\n@@ -3,24 +3,36 @@\n {% block title %}T·∫°o h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n \n {% block content %}\n-<div class=\"page-header\">\n-    <h2>T·∫°o h√≥a ƒë∆°n</h2>\n-    <div class=\"breadcrumb\">\n-        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n-        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n-        <span>T·∫°o h√≥a ƒë∆°n</span>\n-    </div>\n+<div class=\"section-title\">\n+    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>\n </div>\n \n-<div class=\"dashboard-container\">\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n     <div class=\"sidebar\">\n-        <div class=\"sidebar-header\">\n-            <h3>Ch·ª©c nƒÉng</h3>\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n         </div>\n         <ul class=\"sidebar-menu\">\n             <li>\n                 <a href=\"{{ url_for('them_moi_hoa_don') }}\" class=\"active\">\n-                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n                 </a>\n             </li>\n             <li>\n@@ -29,23 +41,62 @@\n                 </a>\n             </li>\n         </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n+                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n+            </a>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('phieu_kham_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n+                </a>\n+            </li>\n+        </ul>\n     </div>\n \n+    <!-- Main content -->\n     <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>T·∫°o h√≥a ƒë∆°n</h2>\n+        </div>\n+        \n         <div class=\"form-container\">\n             <h3>Th√¥ng tin h√≥a ƒë∆°n</h3>\n \n-            {% with messages = get_flashed_messages(with_categories=true) %}\n-                {% if messages %}\n-                    {% for category, message in messages %}\n-                        <div class=\"alert alert-{{ category }}\">\n-                            {{ message }}\n-                        </div>\n-                    {% endfor %}\n-                {% endif %}\n-            {% endwith %}\n-\n-            <form method=\"POST\" action=\"{{ url_for('them_moi_hoa_don') }}\" id=\"hoadonForm\">\n+            <form method=\"POST\" action=\"{{ url_for('them_moi_hoa_don') }}\" id=\"hoadonForm\" class=\"standard-form\">\n                 <div class=\"form-group\">\n                     <label for=\"ma_hoa_don\">M√£ h√≥a ƒë∆°n <span class=\"required\">*</span></label>\n                     <input type=\"text\" id=\"ma_hoa_don\" name=\"ma_hoa_don\" value=\"{{ ma_hoa_don }}\" readonly>\n@@ -119,15 +170,6 @@\n             </form>\n         </div>\n     </div>\n-</div>\n-\n-<div class=\"floating-buttons\">\n-    <a href=\"{{ url_for('hoa_don_list') }}\" class=\"floating-btn\" title=\"Quay l·∫°i\">\n-        <i class=\"fas fa-arrow-left\"></i>\n-    </a>\n-    <a href=\"{{ url_for('index') }}\" class=\"floating-btn\" title=\"V·ªÅ trang ch·ªß\">\n-        <i class=\"fas fa-home\"></i>\n-    </a>\n </div>\n {% endblock %}\n \n@@ -194,40 +236,62 @@\n \n {% block extra_css %}\n <style>\n-    .floating-buttons {\n-        position: fixed;\n-        bottom: 20px;\n-        right: 20px;\n+    .form-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        margin-top: 20px;\n+    }\n+    \n+    .standard-form .form-group {\n+        margin-bottom: 20px;\n+    }\n+    \n+    .standard-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .standard-form input,\n+    .standard-form select {\n+        width: 100%;\n+        padding: 8px 12px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+        font-size: 14px;\n+    }\n+    \n+    .standard-form input[readonly] {\n+        background-color: #f9f9f9;\n+    }\n+    \n+    .form-actions {\n         display: flex;\n-        flex-direction: column;\n+        justify-content: flex-end;\n         gap: 10px;\n-    }\n-    \n-    .floating-btn {\n-        width: 50px;\n-        height: 50px;\n-        border-radius: 50%;\n-        background-color: #4a90e2;\n-        color: white;\n-        display: flex;\n-        align-items: center;\n-        justify-content: center;\n-        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n-        transition: all 0.3s ease;\n-    }\n-    \n-    .floating-btn:hover {\n-        transform: scale(1.1);\n-        background-color: #3a7bc8;\n+        margin-top: 30px;\n+    }\n+    \n+    .required {\n+        color: #e74c3c;\n+    }\n+    \n+    small {\n+        display: block;\n+        margin-top: 5px;\n+        color: #777;\n+        font-size: 12px;\n     }\n     \n     /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n     @media print {\n-        .sidebar, .page-header, .form-actions, .floating-buttons {\n+        .sidebar, .section-title, .content-header, .form-actions {\n             display: none;\n         }\n         \n-        .dashboard-container {\n+        .page-container {\n             display: block;\n         }\n         \n@@ -247,8 +311,8 @@\n         }\n         \n         input, select {\n-            border: none;\n-            background: transparent;\n+            border: none !important;\n+            background: transparent !important;\n         }\n         \n         h3 {","refToolCallId":"toolu_01VdDybJUyAgJmtuSTKnSvFs"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i s·∫Ω c·∫≠p nh·∫≠t trang t√¨m ki·∫øm h√≥a ƒë∆°n:"},{"type":"toolCall","toolCallId":"toolu_01CZedTYepkuHbS7cDgjnZpE","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/tim_kiem_hoa_don.html","path":"nhakhoaso/templates/tim_kiem_hoa_don.html","displayPath":"nhakhoaso/templates/tim_kiem_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/tim_kiem_hoa_don.html\n+++ nhakhoaso/templates/tim_kiem_hoa_don.html\n@@ -3,25 +3,36 @@\n {% block title %}T√¨m ki·∫øm h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n \n {% block content %}\n-<div class=\"page-header\">\n-    <h2>T√¨m ki·∫øm h√≥a ƒë∆°n</h2>\n-    <div class=\"breadcrumb\">\n-        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n-        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n-        <a href=\"{{ url_for('hoa_don_list') }}\">Danh s√°ch h√≥a ƒë∆°n</a> / \n-        <span>T√¨m ki·∫øm</span>\n-    </div>\n+<div class=\"section-title\">\n+    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>\n </div>\n \n-<div class=\"dashboard-container\">\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n     <div class=\"sidebar\">\n-        <div class=\"sidebar-header\">\n-            <h3>Ch·ª©c nƒÉng</h3>\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n         </div>\n         <ul class=\"sidebar-menu\">\n             <li>\n                 <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n-                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\" class=\"active\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n                 </a>\n             </li>\n             <li>\n@@ -30,12 +41,59 @@\n                 </a>\n             </li>\n         </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n+                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n+            </a>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('phieu_kham_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n+                </a>\n+            </li>\n+        </ul>\n     </div>\n \n+    <!-- Main content -->\n     <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>T√¨m ki·∫øm h√≥a ƒë∆°n</h2>\n+        </div>\n+        \n         <div class=\"search-container\">\n-            <h3>T√¨m ki·∫øm h√≥a ƒë∆°n</h3>\n-            \n             <form method=\"POST\" action=\"{{ url_for('tim_kiem_hoa_don') }}\" class=\"search-form\">\n                 <div class=\"form-group\">\n                     <label for=\"tu_khoa\">T·ª´ kh√≥a t√¨m ki·∫øm</label>\n@@ -65,38 +123,50 @@\n                 <h4>K·∫øt qu·∫£ t√¨m ki·∫øm</h4>\n                 \n                 {% if ket_qua %}\n-                    <table class=\"data-table\">\n-                        <thead>\n-                            <tr>\n-                                <th>M√£ h√≥a ƒë∆°n</th>\n-                                <th>M√£ phi·∫øu kh√°m</th>\n-                                <th>B·ªánh nh√¢n</th>\n-                                <th>Ng√†y l·∫≠p</th>\n-                                <th>T·ªïng ti·ªÅn</th>\n-                                <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>\n-                                <th>Tr·∫°ng th√°i</th>\n-                                <th>Thao t√°c</th>\n-                            </tr>\n-                        </thead>\n-                        <tbody>\n-                            {% for hd in ket_qua %}\n+                    <div class=\"module-content\">\n+                        <table class=\"data-table\">\n+                            <thead>\n                                 <tr>\n-                                    <td>{{ hd.MaHD }}</td>\n-                                    <td>{{ hd.MaPK }}</td>\n-                                    <td>{{ hd.TenBenhNhan }}</td>\n-                                    <td>{{ hd.NgayLap }}</td>\n-                                    <td>{{ \"{:,.0f}\".format(hd.TongTien) }} VNƒê</td>\n-                                    <td>{{ hd.PhuongThucThanhToan }}</td>\n-                                    <td>{{ hd.TrangThai }}</td>\n-                                    <td class=\"actions\">\n-                                        <a href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" class=\"btn-icon\" title=\"Xem chi ti·∫øt\">\n-                                            <i class=\"fas fa-eye\"></i>\n-                                        </a>\n-                                    </td>\n+                                    <th>M√£ h√≥a ƒë∆°n</th>\n+                                    <th>M√£ phi·∫øu kh√°m</th>\n+                                    <th>B·ªánh nh√¢n</th>\n+                                    <th>Ng√†y l·∫≠p</th>\n+                                    <th>T·ªïng ti·ªÅn</th>\n+                                    <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>\n+                                    <th>Tr·∫°ng th√°i</th>\n+                                    <th>Thao t√°c</th>\n                                 </tr>\n-                            {% endfor %}\n-                        </tbody>\n-                    </table>\n+                            </thead>\n+                            <tbody>\n+                                {% for hd in ket_qua %}\n+                                    <tr id=\"hoa-don-{{ hd.MaHD }}\">\n+                                        <td>{{ hd.MaHD }}</td>\n+                                        <td>{{ hd.MaPK }}</td>\n+                                        <td>{{ hd.TenBenhNhan }}</td>\n+                                        <td>{{ hd.NgayLap }}</td>\n+                                        <td>{{ \"{:,.0f}\".format(hd.TongTien) }} VNƒê</td>\n+                                        <td>{{ hd.PhuongThucThanhToan }}</td>\n+                                        <td>{{ hd.TrangThai }}</td>\n+                                        <td>\n+                                            <a \n+                                                href=\"{{ url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) }}\" \n+                                                class=\"action-btn view-btn\" \n+                                                title=\"Xem chi ti·∫øt\">\n+                                                <i class=\"fas fa-eye\"></i>\n+                                            </a>\n+                                            <a \n+                                                href=\"#\" \n+                                                class=\"action-btn delete-btn\" \n+                                                title=\"X√≥a\" \n+                                                onclick=\"deleteInvoice('{{ hd.MaHD }}')\">\n+                                                <i class=\"fas fa-trash\"></i>\n+                                            </a>\n+                                        </td>\n+                                    </tr>\n+                                {% endfor %}\n+                            </tbody>\n+                        </table>\n+                    </div>\n                 {% elif request.method == 'POST' %}\n                     <div class=\"no-results\">\n                         <p>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.</p>\n@@ -106,6 +176,34 @@\n         </div>\n     </div>\n </div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script>\n+    // H√†m x√≥a h√≥a ƒë∆°n\n+    function deleteInvoice(maHD) {\n+        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h√≥a ƒë∆°n n√†y?')) {\n+            // G·ªçi API x√≥a h√≥a ƒë∆°n\n+            fetch(`/api/hoa-don/${maHD}`, {\n+                method: 'DELETE'\n+            })\n+            .then(response => response.json())\n+            .then(data => {\n+                if (data.success) {\n+                    // X√≥a d√≤ng kh·ªèi b·∫£ng\n+                    document.getElementById(`hoa-don-${maHD}`).remove();\n+                    alert('X√≥a h√≥a ƒë∆°n th√†nh c√¥ng!');\n+                } else {\n+                    alert('L·ªói: ' + data.message);\n+                }\n+            })\n+            .catch(error => {\n+                console.error('Error:', error);\n+                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a h√≥a ƒë∆°n');\n+            });\n+        }\n+    }\n+</script>\n {% endblock %}\n \n {% block extra_css %}\n@@ -115,6 +213,7 @@\n         border-radius: 8px;\n         box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n         padding: 20px;\n+        margin-top: 20px;\n     }\n     \n     .search-form {\n@@ -123,9 +222,37 @@\n         border-bottom: 1px solid #eee;\n     }\n     \n+    .search-form .form-group {\n+        margin-bottom: 15px;\n+    }\n+    \n+    .search-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .search-form input,\n+    .search-form select {\n+        width: 100%;\n+        padding: 8px 12px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+        font-size: 14px;\n+    }\n+    \n+    .form-actions {\n+        display: flex;\n+        gap: 10px;\n+        margin-top: 20px;\n+    }\n+    \n     .search-results h4 {\n         margin-bottom: 15px;\n         color: #333;\n+        font-size: 18px;\n+        padding-bottom: 10px;\n+        border-bottom: 1px solid #eee;\n     }\n     \n     .no-results {","refToolCallId":"toolu_01CZedTYepkuHbS7cDgjnZpE"},{"type":"text","text":"T√¥i c≈©ng c·∫ßn c·∫≠p nh·∫≠t trang chi ti·∫øt h√≥a ƒë∆°n ƒë·ªÉ ph√π h·ª£p v·ªõi giao di·ªán chung:"},{"type":"toolCall","toolCallId":"toolu_01U82MhXMeZ4Y1HzeqBD65iX","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/chi_tiet_hoa_don.html","path":"nhakhoaso/templates/chi_tiet_hoa_don.html","displayPath":"nhakhoaso/templates/chi_tiet_hoa_don.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/chi_tiet_hoa_don.html\n+++ nhakhoaso/templates/chi_tiet_hoa_don.html\n@@ -3,25 +3,36 @@\n {% block title %}Chi ti·∫øt h√≥a ƒë∆°n - NHAKHOASO{% endblock %}\n \n {% block content %}\n-<div class=\"page-header\">\n-    <h2>Chi ti·∫øt h√≥a ƒë∆°n</h2>\n-    <div class=\"breadcrumb\">\n-        <a href=\"{{ url_for('index') }}\">Trang ch·ªß</a> / \n-        <a href=\"{{ url_for('thanh_toan') }}\">Qu·∫£n l√Ω thanh to√°n</a> / \n-        <a href=\"{{ url_for('hoa_don_list') }}\">Danh s√°ch h√≥a ƒë∆°n</a> / \n-        <span>Chi ti·∫øt h√≥a ƒë∆°n</span>\n-    </div>\n+<div class=\"section-title\">\n+    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>\n </div>\n \n-<div class=\"dashboard-container\">\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n     <div class=\"sidebar\">\n-        <div class=\"sidebar-header\">\n-            <h3>Ch·ª©c nƒÉng</h3>\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n         </div>\n         <ul class=\"sidebar-menu\">\n             <li>\n                 <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n-                    <i class=\"fas fa-plus-circle\"></i> T·∫°o h√≥a ƒë∆°n\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n                 </a>\n             </li>\n             <li>\n@@ -30,29 +41,67 @@\n                 </a>\n             </li>\n         </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n+                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n+            </a>\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('phieu_kham_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n+                </a>\n+            </li>\n+        </ul>\n     </div>\n \n+    <!-- Main content -->\n     <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>Chi ti·∫øt h√≥a ƒë∆°n</h2>\n+            <div class=\"header-actions\">\n+                <button class=\"btn btn-light\" id=\"printBtn\">\n+                    <i class=\"fas fa-print\"></i> In h√≥a ƒë∆°n\n+                </button>\n+                <a href=\"{{ url_for('hoa_don_list') }}\" class=\"btn btn-secondary\">\n+                    <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n+                </a>\n+            </div>\n+        </div>\n+        \n         <div class=\"detail-container\">\n-            <div class=\"detail-header\">\n-                <h3>Th√¥ng tin h√≥a ƒë∆°n</h3>\n-                <div class=\"detail-actions\">\n-                    <button class=\"btn btn-light\" id=\"printBtn\">\n-                        <i class=\"fas fa-print\"></i> In h√≥a ƒë∆°n\n-                    </button>\n-                </div>\n-            </div>\n-\n-            {% with messages = get_flashed_messages(with_categories=true) %}\n-                {% if messages %}\n-                    {% for category, message in messages %}\n-                        <div class=\"alert alert-{{ category }}\">\n-                            {{ message }}\n-                        </div>\n-                    {% endfor %}\n-                {% endif %}\n-            {% endwith %}\n-\n             <div class=\"invoice-container\" id=\"invoiceContent\">\n                 <div class=\"invoice-header\">\n                     <div class=\"invoice-logo\">\n@@ -131,23 +180,8 @@\n                     <p>C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i!</p>\n                 </div>\n             </div>\n-\n-            <div class=\"detail-actions bottom\">\n-                <a href=\"{{ url_for('hoa_don_list') }}\" class=\"btn btn-secondary\">\n-                    <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i danh s√°ch\n-                </a>\n-            </div>\n         </div>\n     </div>\n-</div>\n-\n-<div class=\"floating-buttons\">\n-    <a href=\"{{ url_for('hoa_don_list') }}\" class=\"floating-btn\" title=\"Quay l·∫°i\">\n-        <i class=\"fas fa-arrow-left\"></i>\n-    </a>\n-    <a href=\"{{ url_for('index') }}\" class=\"floating-btn\" title=\"V·ªÅ trang ch·ªß\">\n-        <i class=\"fas fa-home\"></i>\n-    </a>\n </div>\n {% endblock %}\n \n@@ -164,20 +198,24 @@\n \n {% block extra_css %}\n <style>\n+    .content-header {\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .header-actions {\n+        display: flex;\n+        gap: 10px;\n+    }\n+    \n     .detail-container {\n         background-color: #fff;\n         border-radius: 8px;\n         box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n         padding: 20px;\n-    }\n-    \n-    .detail-header {\n-        display: flex;\n-        justify-content: space-between;\n-        align-items: center;\n-        margin-bottom: 20px;\n-        padding-bottom: 15px;\n-        border-bottom: 1px solid #eee;\n+        margin-top: 20px;\n     }\n     \n     .invoice-container {\n@@ -185,7 +223,6 @@\n         background-color: #fff;\n         border: 1px solid #ddd;\n         border-radius: 5px;\n-        margin-bottom: 20px;\n     }\n     \n     .invoice-header {\n@@ -311,45 +348,13 @@\n         color: #666;\n     }\n     \n-    .detail-actions.bottom {\n-        margin-top: 20px;\n-        text-align: right;\n-    }\n-    \n-    .floating-buttons {\n-        position: fixed;\n-        bottom: 20px;\n-        right: 20px;\n-        display: flex;\n-        flex-direction: column;\n-        gap: 10px;\n-    }\n-    \n-    .floating-btn {\n-        width: 50px;\n-        height: 50px;\n-        border-radius: 50%;\n-        background-color: #4a90e2;\n-        color: white;\n-        display: flex;\n-        align-items: center;\n-        justify-content: center;\n-        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\n-        transition: all 0.3s ease;\n-    }\n-    \n-    .floating-btn:hover {\n-        transform: scale(1.1);\n-        background-color: #3a7bc8;\n-    }\n-    \n     /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n     @media print {\n-        .sidebar, .page-header, .detail-actions, .floating-buttons {\n+        .sidebar, .section-title, .content-header {\n             display: none;\n         }\n         \n-        .dashboard-container {\n+        .page-container {\n             display: block;\n         }\n         \n@@ -365,10 +370,6 @@\n             padding: 0;\n         }\n         \n-        .detail-header {\n-            display: none;\n-        }\n-        \n         .invoice-container {\n             border: none;\n         }","refToolCallId":"toolu_01U82MhXMeZ4Y1HzeqBD65iX"},{"type":"text","text":"T√¥i ƒë√£ ho√†n th√†nh vi·ªác c·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c template cho ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n ƒë·ªÉ ph√π h·ª£p v·ªõi giao di·ªán chung c·ªßa h·ªá th·ªëng. B√¢y gi·ªù t√¥i s·∫Ω t√≥m t·∫Øt nh·ªØng thay ƒë·ªïi ƒë√£ th·ª±c hi·ªán:\n\n## T√≥m t·∫Øt c√°c thay ƒë·ªïi\n\n1. **C·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu**:\n   - ƒê√£ t·∫°o b·∫£ng HOADON trong c∆° s·ªü d·ªØ li·ªáu ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin h√≥a ƒë∆°n\n   - ƒê√£ li√™n k·∫øt b·∫£ng HOADON v·ªõi b·∫£ng PHIEUKHAM\n\n2. **Module x·ª≠ l√Ω d·ªØ li·ªáu**:\n   - ƒê√£ t·∫°o module database/hoa_don.py v·ªõi c√°c h√†m CRUD cho h√≥a ƒë∆°n\n   - ƒê√£ c·∫≠p nh·∫≠t utils.py ƒë·ªÉ th√™m h√†m t·∫°o m√£ h√≥a ƒë∆°n t·ª± ƒë·ªông\n\n3. **Route v√† Controller**:\n   - ƒê√£ c·∫≠p nh·∫≠t app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng h√≥a ƒë∆°n\n   - ƒê√£ th√™m c√°c API endpoint ƒë·ªÉ x·ª≠ l√Ω c√°c thao t√°c v·ªõi h√≥a ƒë∆°n\n\n4. **Giao di·ªán ng∆∞·ªùi d√πng**:\n   - ƒê√£ t·∫°o v√† c·∫≠p nh·∫≠t c√°c template cho ch·ª©c nƒÉng qu·∫£n l√Ω thanh to√°n:\n     * thanh_toan.html: Trang ch√≠nh cho ch·ª©c nƒÉng thanh to√°n\n     * them_moi_hoa_don.html: Trang t·∫°o h√≥a ƒë∆°n\n     * hoa_don.html: Trang danh s√°ch h√≥a ƒë∆°n\n     * chi_tiet_hoa_don.html: Trang chi ti·∫øt h√≥a ƒë∆°n\n     * tim_kiem_hoa_don.html: Trang t√¨m ki·∫øm h√≥a ƒë∆°n\n   - ƒê√£ c·∫≠p nh·∫≠t giao di·ªán ƒë·ªÉ ph√π h·ª£p v·ªõi c·∫•u tr√∫c chung c·ªßa h·ªá th·ªëng, bao g·ªìm:\n     * Thanh sidebar b√™n tr√°i v·ªõi c√°c ch·ª©c nƒÉng\n     * C·∫•u tr√∫c trang gi·ªëng v·ªõi c√°c ch·ª©c nƒÉng kh√°c\n     * C√°c n√∫t ch·ª©c nƒÉng v√† b·ªë c·ª•c t∆∞∆°ng t·ª±\n\n5. **Ch·ª©c nƒÉng**:\n   - T·∫°o h√≥a ƒë∆°n: Cho ph√©p ng∆∞·ªùi d√πng t·∫°o h√≥a ƒë∆°n t·ª´ phi·∫øu kh√°m, t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin b·ªánh nh√¢n, b√°c sƒ©, d·ªãch v·ª• v√† gi√°\n   - Danh s√°ch h√≥a ƒë∆°n: Hi·ªÉn th·ªã danh s√°ch t·∫•t c·∫£ h√≥a ƒë∆°n ƒë√£ t·∫°o\n   - Chi ti·∫øt h√≥a ƒë∆°n: Xem th√¥ng tin chi ti·∫øt c·ªßa h√≥a ƒë∆°n v√† in h√≥a ƒë∆°n\n   - T√¨m ki·∫øm h√≥a ƒë∆°n: T√¨m ki·∫øm h√≥a ƒë∆°n theo m√£ h√≥a ƒë∆°n, m√£ phi·∫øu kh√°m ho·∫∑c m√£ b·ªánh nh√¢n\n\n## H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\n\n1. **Truy c·∫≠p ch·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n**:\n   - T·ª´ trang ch·ªß, nh·∫•p v√†o \"Qu·∫£n l√Ω thanh to√°n\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/thanh-toan`\n\n2. **T·∫°o h√≥a ƒë∆°n m·ªõi**:\n   - T·ª´ trang Qu·∫£n l√Ω thanh to√°n, nh·∫•p v√†o \"T·∫°o h√≥a ƒë∆°n\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/them-moi`\n   - Ch·ªçn phi·∫øu kh√°m t·ª´ danh s√°ch phi·∫øu kh√°m ch∆∞a thanh to√°n\n   - Th√¥ng tin b·ªánh nh√¢n, b√°c sƒ©, d·ªãch v·ª• v√† gi√° s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn\n   - Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n\n   - Nh·∫•p v√†o \"L∆∞u th√¥ng tin\" ƒë·ªÉ l∆∞u h√≥a ƒë∆°n\n   - C√≥ th·ªÉ nh·∫•p v√†o \"In\" ƒë·ªÉ in h√≥a ƒë∆°n\n\n3. **Xem danh s√°ch h√≥a ƒë∆°n**:\n   - T·ª´ trang Qu·∫£n l√Ω thanh to√°n, nh·∫•p v√†o \"Danh s√°ch h√≥a ƒë∆°n\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don`\n   - Danh s√°ch hi·ªÉn th·ªã t·∫•t c·∫£ h√≥a ƒë∆°n ƒë√£ t·∫°o\n   - C√≥ th·ªÉ xem chi ti·∫øt ho·∫∑c x√≥a h√≥a ƒë∆°n\n\n4. **Xem chi ti·∫øt h√≥a ƒë∆°n**:\n   - T·ª´ danh s√°ch h√≥a ƒë∆°n, nh·∫•p v√†o bi·ªÉu t∆∞·ª£ng \"Xem chi ti·∫øt\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/chi-tiet/<ma_hd>`\n   - Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß th√¥ng tin h√≥a ƒë∆°n\n   - C√≥ th·ªÉ in h√≥a ƒë∆°n t·ª´ trang chi ti·∫øt\n\n5. **T√¨m ki·∫øm h√≥a ƒë∆°n**:\n   - T·ª´ trang Qu·∫£n l√Ω thanh to√°n, nh·∫•p v√†o \"T√¨m ki·∫øm h√≥a ƒë∆°n\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/hoa-don/tim-kiem`\n   - Nh·∫≠p t·ª´ kh√≥a v√† ch·ªçn lo·∫°i t√¨m ki·∫øm (m√£ h√≥a ƒë∆°n, m√£ phi·∫øu kh√°m, m√£ b·ªánh nh√¢n)\n   - Nh·∫•p v√†o \"T√¨m ki·∫øm\" ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£\n\nCh·ª©c nƒÉng Qu·∫£n l√Ω thanh to√°n ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ƒë·∫ßy ƒë·ªß theo y√™u c·∫ßu, v·ªõi giao di·ªán ph√π h·ª£p v·ªõi c·∫•u tr√∫c chung c·ªßa h·ªá th·ªëng. Ng∆∞·ªùi d√πng c√≥ th·ªÉ d·ªÖ d√†ng t·∫°o, xem, t√¨m ki·∫øm v√† in h√≥a ƒë∆°n thanh to√°n."},{"type":"codePatch","diffs":[{"path":"nhakhoaso/templates/thanh_toan.html","patch":"@@ -121,30 +121,580 @@\n ss=%22\n-page-header%22%3E%0A    %3Ch2%3E\n+section-title%22%3E%0A    %3Ch2%3EQU%E1%BA%A2N L%C3%9D THANH TO%C3%81N%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E \n Qu%E1%BA%A3n\n@@ -711,418 +711,1887 @@\n to%C3%A1n\n-%3C/h2%3E%0A\n+%0A    \n     %3C\n+/\n div\n- class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %3Cspan%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22active\n+%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22 style=%22text-decoration: none; color: inherit;%22%3E%0A                %3Ci class=%22fas fa-chart-line%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD phi%E1%BA%BFu kh%C3%A1m%0A            %3C/a%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_phieu_kham') %7D%7D\n %22%3E%0A \n@@ -2630,37 +2630,40 @@\n  fa-\n-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n\n+search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm phi%E1%BA%BFu kh%C3%A1m\n %0A   \n@@ -2744,39 +2744,42 @@\n ef=%22%7B%7B url_for('\n-hoa_don\n+phieu_kham\n _list') %7D%7D%22%3E%0A   \n@@ -2825,39 +2825,42 @@\n %3E%3C/i%3E Danh s%C3%A1ch \n-h%C3%B3a %C4%91%C6%A1n\n+phi%E1%BA%BFu kh%C3%A1m\n %0A               \n@@ -2918,33 +2918,160 @@\n    %3C\n-div class=%22main-content%22%3E\n+!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/h2%3E%0A        %3C/div%3E%0A        \n %0A   \n@@ -4938,16 +4938,207 @@\n ;%0A    %7D%0A\n+    %0A    .welcome-section %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-top: 20px;%0A    %7D%0A\n %3C/style%3E\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/chi_tiet_hoa_don.html","patch":"@@ -119,147 +119,855 @@\n ss=%22\n-page-header%22%3E%0A    %3Ch2%3EChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A\n+section-title%22%3E%0A    %3Ch2%3EQU%E1%BA%A2N L%C3%9D THANH TO%C3%81N%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A     \n         \n %3Ca h\n@@ -954,32 +954,35 @@\n i%3E%0A             \n+   \n %3Ca href=%22%7B%7B url_\n@@ -991,98 +991,259 @@\n r('t\n-hanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E\n+im_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E \n Danh\n@@ -1259,15 +1259,8 @@\n  %C4%91%C6%A1n\n-%3C/a%3E / \n %0A   \n@@ -1268,107 +1268,120 @@\n     \n-%3Cspan%3EChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A\n+        %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A        \n     %3C\n-div\n+i\n  class=%22\n side\n@@ -1372,33 +1372,67 @@\n   %3Ci class=%22\n-sidebar%22%3E\n+fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n\n %0A        %3Cdi\n@@ -1421,35 +1421,49 @@\n h nh%C3%A2n%0A        %3C\n+/\n div\n+%3E%0A        %3Cul\n  class=%22sidebar-\n@@ -1462,22 +1462,20 @@\n sidebar-\n-header\n+menu\n %22%3E%0A     \n@@ -1486,24 +1486,73 @@\n    %3C\n-h3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3\n+li%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22\n %3E%0A  \n@@ -1549,39 +1549,36 @@\n ') %7D%7D%22%3E%0A        \n-%3C/div%3E%0A\n+    \n         %3Cul clas\n@@ -1566,34 +1566,33 @@\n            %3C\n-ul\n+i\n  class=%22\n sidebar-menu\n@@ -1575,37 +1575,98 @@\n   %3Ci class=%22\n-sidebar-menu%22\n+fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li\n %3E%0A          \n@@ -1706,38 +1706,40 @@\n %7B url_for('t\n-hem_moi_hoa_do\n+im_kiem_benh_nha\n n') %7D%7D%22%3E%0A   \n@@ -1776,36 +1776,38 @@\n  fa-\n-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1\n+search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2\n n%0A  \n@@ -1889,38 +1889,40 @@\n ef=%22%7B%7B url_for('\n-hoa_do\n+benh_nha\n n_list') %7D%7D%22%3E%0A  \n@@ -1969,38 +1969,40 @@\n %3E%3C/i%3E Danh s%C3%A1ch \n-h%C3%B3a %C4%91%C6%A1\n+b%E1%BB%87nh nh%C3%A2\n n%0A              \n@@ -2048,55 +2048,165 @@\n     \n-%3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A\n+    %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22 style=%22text-decoration: none; color: inherit;%22%3E%0A     \n         \n %3Cdiv\n@@ -2197,36 +2197,37 @@\n             \n-%3Cdiv\n+   %3Ci\n  class=%22\n detail-conta\n@@ -2218,110 +2218,202 @@\n ss=%22\n-detail-conta\n+fas fa-chart-l\n ine\n-r\n %22%3E\n-%0A            %3Cdiv class=%22detail-header%22%3E%0A                %3Ch3%3ETh%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A\n+%3C/i%3E Qu%E1%BA%A3n l%C3%BD phi%E1%BA%BFu kh%C3%A1m%0A            %3C/a%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_phieu_kham') %7D%7D%22%3E%0A    \n     \n@@ -2421,35 +2421,33 @@\n            %3C\n-div\n+i\n  class=%22\n detail-actio\n@@ -2438,94 +2438,161 @@\n ss=%22\n-detail-actions%22%3E%0A                    %3Cbutton class=%22btn btn-light%22 id=%22printBtn%22%3E%0A    \n+fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_phieu_kham') %7D%7D%22%3E%0A\n     \n@@ -2628,35 +2628,41 @@\n  fa-\n-print\n+search\n %22%3E%3C/i%3E \n-In h%C3%B3a %C4%91%C6%A1n%0A    \n+T%C3%ACm ki%E1%BA%BFm phi%E1%BA%BFu kh%C3%A1m%0A\n     \n@@ -2675,22 +2675,17 @@\n       %3C/\n-button\n+a\n %3E%0A      \n@@ -2686,33 +2686,28 @@\n             \n-    %3C/div\n+%3C/li\n %3E%0A          \n@@ -2701,38 +2701,35 @@\n i%3E%0A            %3C\n-/div%3E%0A\n+li%3E\n %0A            %7B%25 \n@@ -2729,392 +2729,758 @@\n     \n-%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A                %7B%25 if messages %25%7D%0A                    %7B%25 for category, message in messages %25%7D%0A                        %3Cdiv class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                            %7B%7B message %7D%7D%0A                        %3C/div%3E%0A                    %7B%25 endfor %25%7D%0A                %7B%25 endif %25%7D%0A            %7B%25 endwith %25%7D%0A\n+    %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EChi ti%E1%BA%BFt h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A            %3Cdiv class=%22header-actions%22%3E%0A                %3Cbutton class=%22btn btn-light%22 id=%22printBtn%22%3E%0A                    %3Ci class=%22fas fa-print%22%3E%3C/i%3E In h%C3%B3a %C4%91%C6%A1n%0A                %3C/button%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22btn btn-secondary%22%3E%0A                    %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E Quay l%E1%BA%A1i%0A                %3C/a%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22detail-container%22%3E\n %0A   \n@@ -7126,1287 +7126,777 @@\n iv%3E%0A\n-%0A            %3Cdiv class=%22detail-actions bottom%22%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22btn btn-secondary%22%3E%0A                    %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E Quay l%E1%BA%A1i danh s%C3%A1ch%0A                %3C/a%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22floating-buttons%22%3E%0A    %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22floating-btn%22 title=%22Quay l%E1%BA%A1i%22%3E%0A        %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E%0A    %3C/a%3E%0A    %3Ca href=%22%7B%7B url_for('index') %7D%7D%22 class=%22floating-btn%22 title=%22V%E1%BB%81 trang ch%E1%BB%A7%22%3E%0A        %3Ci class=%22fas fa-home%22%3E%3C/i%3E%0A    %3C/a%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .detail-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .detail-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A        padding-bottom: 15px;%0A        border-bottom: 1px solid #eee\n+        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .content-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .header-actions %7B%0A        display: flex;%0A        gap: 10px;%0A    %7D%0A    %0A    .detail-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-top: 20px\n ;%0A  \n@@ -8048,37 +8048,8 @@\n px;%0A\n-        margin-bottom: 20px;%0A\n     \n@@ -10318,823 +10318,106 @@\n     \n-.detail-actions.bottom %7B%0A        margin-top: 20px;%0A        text-align: right;%0A    %7D%0A    %0A    .floating-buttons %7B%0A        position: fixed;%0A        bottom: 20px;%0A        right: 20px;%0A        display: flex;%0A        flex-direction: column;%0A        gap: 10px;%0A    %7D%0A    %0A    .floating-btn %7B%0A        width: 50px;%0A        height: 50px;%0A        border-radius: 50%25;%0A        background-color: #4a90e2;%0A        color: white;%0A        display: flex;%0A        align-items: center;%0A        justify-content: center;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.2);%0A        transition: all 0.3s ease;%0A    %7D%0A    %0A    .floating-btn:hover %7B%0A        transform: scale(1.1);%0A        background-color: #3a7bc8;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .page-header, .detail-actions, .floating-buttons\n+/* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .section-title, .content-header\n  %7B%0A \n@@ -10474,17 +10474,12 @@\n    .\n-dashboard\n+page\n -con\n@@ -10780,79 +10780,8 @@\n    %0A\n-        .detail-header %7B%0A            display: none;%0A        %7D%0A        %0A\n     \n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/them_moi_hoa_don.html","patch":"@@ -114,256 +114,411 @@\n ss=%22\n-page-header%22%3E%0A    %3Ch2%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Cspan%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E\n+section-title%22%3E%0A    %3Ch2%3EQU%E1%BA%A2N L%C3%9D THANH TO%C3%81N%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D\n %0A%0A%3Cd\n@@ -527,25 +527,20 @@\n  class=%22\n-dashboard\n+page\n -contain\n@@ -540,24 +540,45 @@\n container%22%3E%0A\n+    %3C!-- Sidebar --%3E%0A\n     %3Cdiv cla\n@@ -619,22 +619,21 @@\n sidebar-\n-header\n+title\n %22%3E%0A     \n@@ -644,25 +644,68 @@\n    %3C\n-h3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E\n+i class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n\n %0A   \n@@ -888,23 +888,195 @@\n plus\n--circle\n+%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search\n %22%3E%3C/i%3E T\n %E1%BA%A1o h\n@@ -1063,34 +1063,39 @@\n a-search%22%3E%3C/i%3E T\n-%E1%BA%A1o\n+%C3%ACm ki%E1%BA%BFm\n  h%C3%B3a %C4%91%C6%A1n%0A       \n@@ -1327,46 +1327,114 @@\n     \n-%3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E\n+    %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n\n %0A   \n@@ -1443,251 +1443,836 @@\n    %3C\n+/\n div\n- class=%22form-container%22%3E%0A            %3Ch3%3ETh%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A%0A            %7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A                %7B%25 if messages %25%7D%0A                    %7B%25 for category, message in messages %25%7D%0A    \n+%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22 style=%22text-decoration: none; color: inherit;%22%3E%0A                %3Ci class=%22fas fa-chart-line%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD phi%E1%BA%BFu kh%C3%A1m%0A\n     \n@@ -2271,32 +2271,37 @@\n h%C3%A1m%0A            \n+%3C/a%3E%0A\n         %3Cdiv cla\n@@ -2297,89 +2297,381 @@\n    %3C\n+/\n div\n- class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                            %7B%7B message %7D%7D\n+%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm phi%E1%BA%BFu kh%C3%A1m\n %0A   \n@@ -2672,32 +2672,40 @@\n %C3%A1m%0A             \n+   %3C/a%3E%0A\n            %3C/div\n@@ -2691,37 +2691,37 @@\n %3C/a%3E%0A           \n+ \n %3C/\n-div\n+li\n %3E%0A              \n@@ -2714,32 +2714,37 @@\n             \n+%3Cli%3E%0A\n         \n %7B%25 endfor %25%7D\n@@ -2735,74 +2735,420 @@\n     \n-%7B%25 endfor %25%7D%0A                %7B%25 endif %25%7D%0A            %7B%25 endwith %25%7D\n+        %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3ET%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22form-container%22%3E%0A            %3Ch3%3ETh%C3%B4ng tin h%C3%B3a %C4%91%C6%A1n%3C/h3%3E\n %0A%0A  \n@@ -3235,16 +3235,38 @@\n donForm%22\n+ class=%22standard-form%22\n %3E%0A      \n@@ -6900,306 +6900,8 @@\n div%3E\n-%0A%0A%3Cdiv class=%22floating-buttons%22%3E%0A    %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22 class=%22floating-btn%22 title=%22Quay l%E1%BA%A1i%22%3E%0A        %3Ci class=%22fas fa-arrow-left%22%3E%3C/i%3E%0A    %3C/a%3E%0A    %3Ca href=%22%7B%7B url_for('index') %7D%7D%22 class=%22floating-btn%22 title=%22V%E1%BB%81 trang ch%E1%BB%A7%22%3E%0A        %3Ci class=%22fas fa-home%22%3E%3C/i%3E%0A    %3C/a%3E%0A%3C/div%3E\n %0A%7B%25 \n@@ -9750,65 +9750,173 @@\n   .f\n-loating-buttons %7B%0A        position: fixed;%0A        bottom\n+orm-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-top\n : 20\n@@ -9927,24 +9927,114 @@\n     \n+%7D%0A\n     \n-right: 20px;\n+%0A    .standard-form .form-group %7B%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .standard-form label %7B\n %0A   \n@@ -10039,36 +10039,37 @@\n        display: \n-flex\n+block\n ;%0A        flex-d\n@@ -10066,123 +10066,197 @@\n     \n-flex-direction: column;%0A        gap: 10px;%0A    %7D%0A    %0A    .floating-btn %7B%0A        width: 50px;%0A        height: 50px\n+margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .standard-form input,%0A    .standard-form select %7B%0A        width: 100%25;%0A        padding: 8px 12px;%0A        border: 1px solid #ddd\n ;%0A  \n@@ -10280,13 +10280,86 @@\n us: \n-50%25\n+4px\n ;%0A\n+        font-size: 14px;%0A    %7D%0A    %0A    .standard-form input%5Breadonly%5D %7B%0A\n     \n@@ -10385,37 +10385,46 @@\n r: #\n-4a90e2\n+f9f9f9\n ;%0A    \n+%7D%0A\n     \n-color: white;\n+%0A    .form-actions %7B\n %0A   \n@@ -10447,37 +10447,8 @@\n ex;%0A\n-        align-items: center;%0A\n     \n@@ -10468,22 +10468,24 @@\n ontent: \n-center\n+flex-end\n ;%0A      \n@@ -10490,117 +10490,69 @@\n     \n-box-shadow: 0 2px 10px rgba(0,0,0,0.2);%0A        transition: all 0.3s ease;%0A    %7D%0A    %0A    .floating-btn:hover\n+gap: 10px;%0A        margin-top: 30px;%0A    %7D%0A    %0A    .required\n  %7B%0A \n@@ -10562,64 +10562,140 @@\n     \n-transf\n+col\n or\n-m\n : \n-scale(1.1);%0A        background-color: #3a7bc8\n+#e74c3c;%0A    %7D%0A    %0A    small %7B%0A        display: block;%0A        margin-top: 5px;%0A        color: #777;%0A        font-size: 12px\n ;%0A  \n@@ -10779,50 +10779,50 @@\n r, .\n-page-header, .form-actions, .floating-butt\n+section-title, .content-header, .form-acti\n ons \n@@ -10882,17 +10882,12 @@\n    .\n-dashboard\n+page\n -con\n@@ -11272,32 +11272,43 @@\n     border: none\n+ !important\n ;%0A            ba\n@@ -11328,16 +11328,27 @@\n nsparent\n+ !important\n ;%0A      \n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/tim_kiem_hoa_don.html","patch":"@@ -119,4354 +119,8040 @@\n ss=%22\n-page-header%22%3E%0A    %3Ch2%3ET%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/a%3E / %0A        %3Cspan%3ET%C3%ACm ki%E1%BA%BFm%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22dashboard-container%22%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-header%22%3E%0A            %3Ch3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus-circle%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22search-container%22%3E%0A            %3Ch3%3ET%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%3C/h3%3E%0A            %0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22search-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_khoa%22%3ET%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22tu_khoa%22 name=%22tu_khoa%22 placeholder=%22Nh%E1%BA%ADp t%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm...%22 required%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22loai_tim_kiem%22%3ELo%E1%BA%A1i t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cselect id=%22loai_tim_kiem%22 name=%22loai_tim_kiem%22%3E%0A                        %3Coption value=%22ma_hoa_don%22%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/option%3E%0A                        %3Coption value=%22ma_phieu_kham%22%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/option%3E%0A                        %3Coption value=%22ma_benh_nhan%22%3EM%C3%A3 b%E1%BB%87nh nh%C3%A2n%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E L%C3%A0m m%E1%BB%9Bi%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A            %0A            %3Cdiv class=%22search-results%22%3E%0A                %3Ch4%3EK%E1%BA%BFt qu%E1%BA%A3 t%C3%ACm ki%E1%BA%BFm%3C/h4%3E%0A                %0A                %7B%25 if ket_qua %25%7D%0A                    %3Ctable class=%22data-table%22%3E%0A                        %3Cthead%3E%0A                            %3Ctr%3E%0A                                %3Cth%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                                %3Cth%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/th%3E%0A                                %3Cth%3EB%E1%BB%87nh nh%C3%A2n%3C/th%3E%0A                                %3Cth%3ENg%C3%A0y l%E1%BA%ADp%3C/th%3E%0A                                %3Cth%3ET%E1%BB%95ng ti%E1%BB%81n%3C/th%3E%0A                                %3Cth%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/th%3E%0A                                %3Cth%3ETr%E1%BA%A1ng th%C3%A1i%3C/th%3E%0A                                %3Cth%3EThao t%C3%A1c%3C/th%3E%0A                            %3C/tr%3E%0A                        %3C/thead%3E%0A                        %3Ctbody%3E%0A                            %7B%25 for hd in ket_qua %25%7D%0A                                %3Ctr%3E%0A                                    %3Ctd%3E%7B%7B hd.MaHD %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.MaPK %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.TenBenhNhan %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.NgayLap %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hd.TongTien) %7D%7D VN%C4%90%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.PhuongThucThanhToan %7D%7D%3C/td%3E%0A                                    %3Ctd%3E%7B%7B hd.TrangThai %7D%7D%3C/td%3E%0A                                    %3Ctd class=%22actions%22%3E%0A                                        %3Ca href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 class=%22btn-icon%22 title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                            %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                        %3C/a%3E%0A                                    %3C/td%3E%0A                                %3C/tr%3E%0A                            %7B%25 endfor %25%7D%0A                        %3C/tbody%3E%0A                    %3C/table%3E%0A                %7B%25 elif request.method == 'POST' %25%7D%0A                    %3Cdiv class=%22no-results%22%3E%0A                        %3Cp%3EKh%C3%B4ng t%C3%ACm th%E1%BA%A5y k%E1%BA%BFt qu%E1%BA%A3 ph%C3%B9 h%E1%BB%A3p.%3C/p%3E%0A                    %3C/div%3E%0A                %7B%25 endif %25%7D%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div\n+section-title%22%3E%0A    %3Ch2%3EQU%E1%BA%A2N L%C3%9D THANH TO%C3%81N%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22 style=%22text-decoration: none; color: inherit;%22%3E%0A                %3Ci class=%22fas fa-chart-line%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD phi%E1%BA%BFu kh%C3%A1m%0A            %3C/a%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3ET%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22search-container%22%3E%0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22search-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_khoa%22%3ET%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cinput type=%22text%22 id=%22tu_khoa%22 name=%22tu_khoa%22 placeholder=%22Nh%E1%BA%ADp t%E1%BB%AB kh%C3%B3a t%C3%ACm ki%E1%BA%BFm...%22 required%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22loai_tim_kiem%22%3ELo%E1%BA%A1i t%C3%ACm ki%E1%BA%BFm%3C/label%3E%0A                    %3Cselect id=%22loai_tim_kiem%22 name=%22loai_tim_kiem%22%3E%0A                        %3Coption value=%22ma_hoa_don%22%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/option%3E%0A                        %3Coption value=%22ma_phieu_kham%22%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/option%3E%0A                        %3Coption value=%22ma_benh_nhan%22%3EM%C3%A3 b%E1%BB%87nh nh%C3%A2n%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E L%C3%A0m m%E1%BB%9Bi%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A            %0A            %3Cdiv class=%22search-results%22%3E%0A                %3Ch4%3EK%E1%BA%BFt qu%E1%BA%A3 t%C3%ACm ki%E1%BA%BFm%3C/h4%3E%0A                %0A                %7B%25 if ket_qua %25%7D%0A                    %3Cdiv class=%22module-content%22%3E%0A                        %3Ctable class=%22data-table%22%3E%0A                            %3Cthead%3E%0A                                %3Ctr%3E%0A                                    %3Cth%3EM%C3%A3 h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                                    %3Cth%3EM%C3%A3 phi%E1%BA%BFu kh%C3%A1m%3C/th%3E%0A                                    %3Cth%3EB%E1%BB%87nh nh%C3%A2n%3C/th%3E%0A                                    %3Cth%3ENg%C3%A0y l%E1%BA%ADp%3C/th%3E%0A                                    %3Cth%3ET%E1%BB%95ng ti%E1%BB%81n%3C/th%3E%0A                                    %3Cth%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/th%3E%0A                                    %3Cth%3ETr%E1%BA%A1ng th%C3%A1i%3C/th%3E%0A                                    %3Cth%3EThao t%C3%A1c%3C/th%3E%0A                                %3C/tr%3E%0A                            %3C/thead%3E%0A                            %3Ctbody%3E%0A                                %7B%25 for hd in ket_qua %25%7D%0A                                    %3Ctr id=%22hoa-don-%7B%7B hd.MaHD %7D%7D%22%3E%0A                                        %3Ctd%3E%7B%7B hd.MaHD %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%7B%7B hd.MaPK %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%7B%7B hd.TenBenhNhan %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%7B%7B hd.NgayLap %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(hd.TongTien) %7D%7D VN%C4%90%3C/td%3E%0A                                        %3Ctd%3E%7B%7B hd.PhuongThucThanhToan %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%7B%7B hd.TrangThai %7D%7D%3C/td%3E%0A                                        %3Ctd%3E%0A                                            %3Ca %0A                                                href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 %0A                                                class=%22action-btn view-btn%22 %0A                                                title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                                %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                            %3C/a%3E%0A                                            %3Ca %0A                                                href=%22#%22 %0A                                                class=%22action-btn delete-btn%22 %0A                                                title=%22X%C3%B3a%22 %0A                                                onclick=%22deleteInvoice('%7B%7B hd.MaHD %7D%7D')%22%3E%0A                                                %3Ci class=%22fas fa-trash%22%3E%3C/i%3E%0A                                            %3C/a%3E%0A                                        %3C/td%3E%0A                                    %3C/tr%3E%0A                                %7B%25 endfor %25%7D%0A                            %3C/tbody%3E%0A                        %3C/table%3E%0A                    %3C/div%3E%0A                %7B%25 elif request.method == 'POST' %25%7D%0A                    %3Cdiv class=%22no-results%22%3E%0A                        %3Cp%3EKh%C3%B4ng t%C3%ACm th%E1%BA%A5y k%E1%BA%BFt qu%E1%BA%A3 ph%C3%B9 h%E1%BB%A3p.%3C/p%3E%0A                    %3C/div%3E%0A                %7B%25 endif %25%7D%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    // H%C3%A0m x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A    function deleteInvoice(maHD) %7B%0A        if (confirm('B%E1%BA%A1n c%C3%B3 ch%E1%BA%AFc ch%E1%BA%AFn mu%E1%BB%91n x%C3%B3a h%C3%B3a %C4%91%C6%A1n n%C3%A0y?')) %7B%0A            // G%E1%BB%8Di API x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A            fetch(%60/api/hoa-don/$%7BmaHD%7D%60, %7B%0A                method: 'DELETE'%0A            %7D)%0A            .then(response =%3E response.json())%0A            .then(data =%3E %7B%0A                if (data.success) %7B%0A                    // X%C3%B3a d%C3%B2ng kh%E1%BB%8Fi b%E1%BA%A3ng%0A                    document.getElementById(%60hoa-don-$%7BmaHD%7D%60).remove();%0A                    alert('X%C3%B3a h%C3%B3a %C4%91%C6%A1n th%C3%A0nh c%C3%B4ng!');%0A                %7D else %7B%0A                    alert('L%E1%BB%97i: ' + data.message);%0A                %7D%0A            %7D)%0A            .catch(error =%3E %7B%0A                console.error('Error:', error);%0A                alert('%C4%90%C3%A3 x%E1%BA%A3y ra l%E1%BB%97i khi x%C3%B3a h%C3%B3a %C4%91%C6%A1n');%0A            %7D);%0A        %7D%0A    %7D%0A%3C/script\n %3E%0A%7B%25\n@@ -8346,24 +8346,50 @@\n ding: 20px;%0A\n+        margin-top: 20px;%0A\n     %7D%0A    %0A \n@@ -8531,69 +8531,641 @@\n rch-\n-results h4 %7B%0A        margin-bottom: 15px;%0A        color: #333\n+form .form-group %7B%0A        margin-bottom: 15px;%0A    %7D%0A    %0A    .search-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .search-form input,%0A    .search-form select %7B%0A        width: 100%25;%0A        padding: 8px 12px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A        font-size: 14px;%0A    %7D%0A    %0A    .form-actions %7B%0A        display: flex;%0A        gap: 10px;%0A        margin-top: 20px;%0A    %7D%0A    %0A    .search-results h4 %7B%0A        margin-bottom: 15px;%0A        color: #333;%0A        font-size: 18px;%0A        padding-bottom: 10px;%0A        border-bottom: 1px solid #eee\n ;%0A  \n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/hoa_don.html","patch":"@@ -120,268 +120,411 @@\n ss=%22\n-page-header%22%3E%0A    %3Ch2%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A    %3Cdiv class=%22breadcrumb%22%3E%0A        %3Ca href=%22%7B%7B url_for('index') %7D%7D%22%3ETrang ch%E1%BB%A7%3C/a%3E / %0A        %3Ca href=%22%7B%7B url_for('thanh_toan') %7D%7D%22%3EQu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%3C/a%3E / %0A        %3Cspan%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/span%3E%0A    %3C/div%3E%0A%3C/div%3E\n+section-title%22%3E%0A    %3Ch2%3EQU%E1%BA%A2N L%C3%9D THANH TO%C3%81N%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D\n %0A%0A%3Cd\n@@ -537,17 +537,12 @@\n ss=%22\n-dashboard\n+page\n -con\n@@ -546,24 +546,45 @@\n container%22%3E%0A\n+    %3C!-- Sidebar --%3E%0A\n     %3Cdiv cla\n@@ -629,14 +629,13 @@\n bar-\n-header\n+title\n %22%3E%0A \n@@ -650,25 +650,68 @@\n    %3C\n-h3%3ECh%E1%BB%A9c n%C4%83ng%3C/h3%3E\n+i class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n\n %0A   \n@@ -879,23 +879,195 @@\n plus\n--circle\n+%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search\n %22%3E%3C/i%3E T\n %E1%BA%A1o h\n@@ -1054,34 +1054,39 @@\n a-search%22%3E%3C/i%3E T\n-%E1%BA%A1o\n+%C3%ACm ki%E1%BA%BFm\n  h%C3%B3a %C4%91%C6%A1n%0A       \n@@ -1333,32 +1333,71 @@\n     \n-%3C/div%3E%0A%0A\n+    %0A        %3Cdiv class=%22sidebar-title%22%3E%0A        \n     %3C\n-div\n+i\n  class=%22\n main\n@@ -1396,22 +1396,51 @@\n ss=%22\n-main-content%22%3E\n+fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n\n %0A   \n@@ -1449,32 +1449,69 @@\n    %3C\n+/\n div\n- class=%22action-bar%22%3E%0A\n+%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A    \n     \n@@ -1552,47 +1552,29 @@\n moi_\n-hoa_don') %7D%7D%22 class=%22btn btn-primary%22%3E%0A\n+benh_nhan') %7D%7D%22%3E%0A    \n     \n@@ -1618,23 +1618,30 @@\n i%3E T\n-%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A\n+h%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A    \n     \n@@ -1670,78 +1670,281 @@\n    %3C\n-a href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22 class=%22btn btn-secondary%22%3E%0A\n+/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A    \n     \n@@ -1976,30 +1976,43 @@\n  fa-\n-search\n+list\n %22%3E%3C/i%3E \n-T%C3%ACm ki%E1%BA%BFm%0A\n+Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A    \n     \n@@ -2036,417 +2036,1527 @@\n     \n-%3C/div%3E%0A%0A        %7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A            %7B%25 if messages %25%7D%0A                %7B%25 for category, message in messages %25%7D%0A                    %3Cdiv class=%22alert alert-%7B%7B category %7D%7D%22%3E%0A                        %7B%7B message %7D%7D%0A                    %3C/div%3E%0A                %7B%25 endfor %25%7D%0A            %7B%25 endif %25%7D%0A        %7B%25 endwith %25%7D%0A%0A        %3Cdiv class=%22data-table-container\n+    %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22 style=%22text-decoration: none; color: inherit;%22%3E%0A                %3Ci class=%22fas fa-chart-line%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD phi%E1%BA%BFu kh%C3%A1m%0A            %3C/a%3E%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_phieu_kham') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('phieu_kham_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch phi%E1%BA%BFu kh%C3%A1m%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EDanh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%3C/h2%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22module-actions%22%3E%0A            %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22btn%22%3E%3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%3C/a%3E%0A            %3Cdiv class=%22search-box%22%3E%0A                %3Cinput type=%22text%22 placeholder=%22T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n...%22%3E%0A                %3Cbutton class=%22btn%22 onclick=%22window.location.href='%7B%7B url_for('tim_kiem_hoa_don') %7D%7D'%22%3E%3Ci class=%22fas fa-search%22%3E%3C/i%3E%3C/button%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A%0A        %3Cdiv class=%22module-content\n %22%3E%0A \n@@ -4196,32 +4196,59 @@\n              %3Ctr\n+ id=%22hoa-don-%7B%7B hd.MaHD %7D%7D%22\n %3E%0A              \n@@ -4713,374 +4713,679 @@\n  %3Ctd\n- class=%22actions%22%3E%0A                                    %3Ca href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 class=%22btn-icon%22 title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                        %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                    %3C/a%3E%0A                                    %3Cbutton class=%22btn-icon delete-btn%22 data-id=%22%7B%7B hd.MaHD %7D%7D%22 title=%22X%C3%B3a\n+%3E%0A                                    %3Ca %0A                                        href=%22%7B%7B url_for('chi_tiet_hoa_don', ma_hd=hd.MaHD) %7D%7D%22 %0A                                        class=%22action-btn view-btn%22 %0A                                        title=%22Xem chi ti%E1%BA%BFt%22%3E%0A                                        %3Ci class=%22fas fa-eye%22%3E%3C/i%3E%0A                                    %3C/a%3E%0A                                    %3Ca %0A                                        href=%22#%22 %0A                                        class=%22action-btn delete-btn%22 %0A                                        title=%22X%C3%B3a%22 %0A                                        onclick=%22deleteInvoice('%7B%7B hd.MaHD %7D%7D')\n %22%3E%0A \n@@ -5490,22 +5490,17 @@\n       %3C/\n-button\n+a\n %3E%0A      \n@@ -5717,1471 +5717,2731 @@\n ss=%22\n-no-data%22%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u h%C3%B3a %C4%91%C6%A1n%3C/td%3E%0A                        %3C/tr%3E%0A                    %7B%25 endif %25%7D%0A                %3C/tbody%3E%0A            %3C/table%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A        const deleteButtons = document.querySelectorAll('.delete-btn');%0A        deleteButtons.forEach(button =%3E %7B%0A            button.addEventListener('click', function() %7B%0A                const maHD = this.getAttribute('data-id');%0A                if (confirm('B%E1%BA%A1n c%C3%B3 ch%E1%BA%AFc ch%E1%BA%AFn mu%E1%BB%91n x%C3%B3a h%C3%B3a %C4%91%C6%A1n n%C3%A0y kh%C3%B4ng?')) %7B%0A                    // G%E1%BB%ADi request x%C3%B3a%0A                    fetch(%60/api/hoa-don/$%7BmaHD%7D%60, %7B%0A                        method: 'DELETE',%0A                    %7D)%0A                    .then(response =%3E response.json())%0A                    .then(data =%3E %7B%0A                        if (data.success) %7B%0A                            alert(data.message);%0A                            // Reload trang sau khi x%C3%B3a th%C3%A0nh c%C3%B4ng%0A                            window.location.reload();%0A                        %7D else %7B%0A                            alert(data.message);%0A                        %7D%0A                    %7D)%0A                    .catch(error =%3E %7B%0A                        console.error('Error:', error);%0A                        alert('C%C3%B3 l%E1%BB%97i x%E1%BA%A3y ra khi x%C3%B3a h%C3%B3a %C4%91%C6%A1n');%0A                    %7D);%0A                %7D%0A            %7D);%0A        %7D);%0A    %7D);\n+text-center%22%3E%0A                                %3Cdiv class=%22no-data%22%3E%0A                                    %3Ci class=%22fas fa-database%22%3E%3C/i%3E%0A                                    %3Cp%3ECh%C6%B0a c%C3%B3 d%E1%BB%AF li%E1%BB%87u h%C3%B3a %C4%91%C6%A1n%3C/p%3E%0A                                    %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22btn%22%3E%0A                                        %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A                                    %3C/a%3E%0A                                %3C/div%3E%0A                            %3C/td%3E%0A                        %3C/tr%3E%0A                    %7B%25 endif %25%7D%0A                %3C/tbody%3E%0A            %3C/table%3E%0A        %3C/div%3E%0A%0A        %3Cdiv class=%22pagination%22%3E%0A            %3Ca href=%22#%22 class=%22page-link%22%3E&laquo;%3C/a%3E%0A            %3Ca href=%22#%22 class=%22page-link active%22%3E1%3C/a%3E%0A            %3Ca href=%22#%22 class=%22page-link%22%3E2%3C/a%3E%0A            %3Ca href=%22#%22 class=%22page-link%22%3E3%3C/a%3E%0A            %3Ca href=%22#%22 class=%22page-link%22%3E&raquo;%3C/a%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript%3E%0A    // H%C3%A0m x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A    function deleteInvoice(maHD) %7B%0A        if (confirm('B%E1%BA%A1n c%C3%B3 ch%E1%BA%AFc ch%E1%BA%AFn mu%E1%BB%91n x%C3%B3a h%C3%B3a %C4%91%C6%A1n n%C3%A0y?')) %7B%0A            // G%E1%BB%8Di API x%C3%B3a h%C3%B3a %C4%91%C6%A1n%0A            fetch(%60/api/hoa-don/$%7BmaHD%7D%60, %7B%0A                method: 'DELETE'%0A            %7D)%0A            .then(response =%3E response.json())%0A            .then(data =%3E %7B%0A                if (data.success) %7B%0A                    // X%C3%B3a d%C3%B2ng kh%E1%BB%8Fi b%E1%BA%A3ng%0A                    document.getElementById(%60hoa-don-$%7BmaHD%7D%60).remove();%0A                    alert('X%C3%B3a h%C3%B3a %C4%91%C6%A1n th%C3%A0nh c%C3%B4ng!');%0A                    %0A                    // Ki%E1%BB%83m tra n%E1%BA%BFu kh%C3%B4ng c%C3%B2n h%C3%B3a %C4%91%C6%A1n n%C3%A0o, hi%E1%BB%83n th%E1%BB%8B th%C3%B4ng b%C3%A1o%0A                    const tbody = document.querySelector('.data-table tbody');%0A                    if (tbody.children.length === 0) %7B%0A                        tbody.innerHTML = %60%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%228%22 class=%22text-center%22%3E%0A                                %3Cdiv class=%22no-data%22%3E%0A                                    %3Ci class=%22fas fa-database%22%3E%3C/i%3E%0A                                    %3Cp%3ECh%C6%B0a c%C3%B3 d%E1%BB%AF li%E1%BB%87u h%C3%B3a %C4%91%C6%A1n%3C/p%3E%0A                                    %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22 class=%22btn%22%3E%0A                                        %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n m%E1%BB%9Bi%0A                                    %3C/a%3E%0A                                %3C/div%3E%0A                            %3C/td%3E%0A                        %3C/tr%3E%0A                        %60;%0A                    %7D%0A                %7D else %7B%0A                    alert('L%E1%BB%97i: ' + data.message);%0A                %7D%0A            %7D)%0A            .catch(error =%3E %7B%0A                console.error('Error:', error);%0A                alert('%C4%90%C3%A3 x%E1%BA%A3y ra l%E1%BB%97i khi x%C3%B3a h%C3%B3a %C4%91%C6%A1n');%0A            %7D);%0A        %7D%0A    %7D\n %0A%3C/s\n","isNew":false,"isApplied":true,"isUnread":false}]}],"context":{"author":"Coding Agent","operationId":"94d502ae-bd02-4d2e-8f36-9382a6771f72"},"isInternal":false},{"id":"c9e75f4b-4f72-46b1-9f98-d4b2a700192f","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"t∆∞∆°ng t·ª± h√£y t·∫°o cho t√¥i ch·ª© nƒÉng b√°o c√°o v√† th·ªëng k√™: g·ªìm 3 ch·ª©c nƒÉng nh·ªè:"}]},{"type":"paragraph","content":[{"type":"text","text":"+ B√°o x√°o s·ªë l∆∞·ª£ng d·ªãch v·ª•"}]},{"type":"paragraph","content":[{"type":"text","text":"+b√°o c√°o s·ªë l∆∞·ª£ng b·ªánh nh√¢n "}]},{"type":"paragraph","content":[{"type":"text","text":"+ b√°o c√°o donh theo l·ªãch h·∫πn"}]},{"type":"paragraph","content":[{"type":"text","text":"t√¥i s·∫Ω m√¥ t·∫£ c√°c ch·ª©c nƒÉng sau ƒë√≥"}]}]},"content":[{"type":"text","text":"t∆∞∆°ng t·ª± h√£y t·∫°o cho t√¥i ch·ª© nƒÉng b√°o c√°o v√† th·ªëng k√™: g·ªìm 3 ch·ª©c nƒÉng nh·ªè:"},{"type":"text","text":"+ B√°o x√°o s·ªë l∆∞·ª£ng d·ªãch v·ª•"},{"type":"text","text":"+b√°o c√°o s·ªë l∆∞·ª£ng b·ªánh nh√¢n "},{"type":"text","text":"+ b√°o c√°o donh theo l·ªãch h·∫πn"},{"type":"text","text":"t√¥i s·∫Ω m√¥ t·∫£ c√°c ch·ª©c nƒÉng sau ƒë√≥"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/templates/chi_tiet_dich_vu.html","path":"nhakhoaso/templates/chi_tiet_dich_vu.html","displayPath":"nhakhoaso/templates/chi_tiet_dich_vu.html","content":"{% extends 'layout.html' %}\n\n{% block title %}Chi ti·∫øt d·ªãch v·ª• - NHAKHOASO{% endblock %}\n\n{% block content %}\n<div class=\"section-title\">\n    <h2>QU·∫¢N L√ù D·ªäCH V·ª§</h2>\n</div>\n\n<!-- Flash messages -->\n{% with messages = get_flashed_messages(with_categories=true) %}\n    {% if messages %}\n        <div class=\"flash-messages\">\n            {% for category, message in messages %}\n                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n            {% endfor %}\n        </div>\n    {% endif %}\n{% endwith %}\n\n<div class=\"page-container\">\n    <!-- Sidebar -->\n    <div class=\"sidebar\">\n        <div class=\"sidebar-title\">\n            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('benh_nhan_list') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n                </a>\n            </li>\n        </ul>\n        \n        <div class=\"sidebar-title\">\n            <i class=\"fas fa-clipboard-list\"></i> Qu·∫£n l√Ω b√°c sƒ©\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_bac_si') }}\">\n                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b√°c sƒ©\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('tim_kiem_bac_si') }}\">\n                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b√°c sƒ©\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('bac_si_page') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch b√°c sƒ©\n                </a>\n            </li>\n        </ul>\n        \n        <div class=\"sidebar-title\">\n            <a href=\"{{ url_for('phieu_kham_list') }}\" style=\"text-decoration: none; color: inherit;\">\n                <i class=\"fas fa-chart-line\"></i> Qu·∫£n l√Ω phi·∫øu kh√°m\n            </a>\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_phieu_kham') }}\">\n                    <i class=\"fas fa-plus\"></i> T·∫°o phi·∫øu kh√°m\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('tim_kiem_phieu_kham') }}\">\n                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm phi·∫øu kh√°m\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('phieu_kham_list') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch phi·∫øu kh√°m\n                </a>\n            </li>\n        </ul>\n        \n        <div class=\"sidebar-title\">\n            <i class=\"fas fa-calendar-check\"></i> Qu·∫£n l√Ω l·ªãch h·∫πn\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_lich_hen') }}\">\n                    <i class=\"fas fa-plus\"></i> ƒê·∫∑t l·ªãch h·∫πn\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('tim_kiem_lich_hen') }}\">\n                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm l·ªãch h·∫πn\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('lich_hen_list') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch l·ªãch h·∫πn\n                </a>\n            </li>\n        </ul>\n        \n        <div class=\"sidebar-title\">\n            <i class=\"fas fa-hand-holding-heart\"></i> Qu·∫£n l√Ω d·ªãch v·ª•\n        </div>\n        <ul class=\"sidebar-menu\">\n            <li>\n                <a href=\"{{ url_for('them_moi_dich_vu') }}\">\n                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi d·ªãch v·ª•\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('tim_kiem_dich_vu') }}\">\n                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm d·ªãch v·ª•\n                </a>\n            </li>\n            <li>\n                <a href=\"{{ url_for('dich_vu_list') }}\">\n                    <i class=\"fas fa-list\"></i> Danh s√°ch d·ªãch v·ª•\n                </a>\n            </li>\n        </ul>\n    </div>\n\n    <!-- Main content -->\n    <div class=\"main-content\">\n        <div class=\"content-header\">\n            <h2>Chi ti·∫øt d·ªãch v·ª•</h2>\n            <div class=\"header-actions\">\n                <a href=\"{{ url_for('chinh_sua_dich_vu', ma_dv=dich_vu.MaDV) }}\" class=\"btn btn-primary\">\n                    <i class=\"fas fa-edit\"></i> Ch·ªânh s·ª≠a\n                </a>\n                <a href=\"{{ url_for('dich_vu_list') }}\" class=\"btn btn-secondary\">\n                    <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n                </a>\n            </div>\n        </div>\n        \n        <div class=\"detail-container\">\n            <div class=\"detail-card\">\n                <div class=\"detail-header\">\n                    <h3>Th√¥ng tin d·ªãch v·ª•</h3>\n                    <div class=\"price-tag\">{{ \"{:,.0f}\".format(dich_vu.Gia|float) }} VNƒê</div>\n                </div>\n                \n                <div class=\"detail-content\">\n                    <div class=\"detail-row\">\n                        <div class=\"detail-label\">M√£ d·ªãch v·ª•:</div>\n                        <div class=\"detail-value\">{{ dich_vu.MaDV }}</div>\n                    </div>\n                    \n                    <div class=\"detail-row\">\n                        <div class=\"detail-label\">T√™n d·ªãch v·ª•:</div>\n                        <div class=\"detail-value\">{{ dich_vu.TenDV }}</div>\n                    </div>\n                    \n                    <div class=\"detail-row\">\n                        <div class=\"detail-label\">Gi√° d·ªãch v·ª•:</div>\n                        <div class=\"detail-value\">{{ \"{:,.0f}\".format(dich_vu.Gia|float) }} VNƒê</div>\n                    </div>\n                </div>\n                \n                <div class=\"detail-actions\">\n                    <a href=\"{{ url_for('chinh_sua_dich_vu', ma_dv=dich_vu.MaDV) }}\" class=\"btn btn-primary\">\n                        <i class=\"fas fa-edit\"></i> Ch·ªânh s·ª≠a\n                    </a>\n                    <button class=\"btn btn-danger\" onclick=\"deleteDichVu('{{ dich_vu.MaDV }}')\">\n                        <i class=\"fas fa-trash\"></i> X√≥a\n                    </button>\n                    <a href=\"{{ url_for('dich_vu_list') }}\" class=\"btn btn-secondary\">\n                        <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<style>\n    .content-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n    }\n    \n    .header-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    .detail-container {\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        overflow: hidden;\n    }\n    \n    .detail-card {\n        padding: 0;\n    }\n    \n    .detail-header {\n        background-color: var(--secondary-color);\n        padding: 15px 20px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n    \n    .detail-header h3 {\n        margin: 0;\n        font-size: 18px;\n        color: var(--primary-color);\n    }\n    \n    .price-tag {\n        background-color: var(--primary-color);\n        color: white;\n        padding: 5px 10px;\n        border-radius: 4px;\n        font-weight: bold;\n    }\n    \n    .detail-content {\n        padding: 20px;\n    }\n    \n    .detail-row {\n        display: flex;\n        margin-bottom: 15px;\n        border-bottom: 1px solid #eee;\n        padding-bottom: 15px;\n    }\n    \n    .detail-row:last-child {\n        margin-bottom: 0;\n        border-bottom: none;\n        padding-bottom: 0;\n    }\n    \n    .detail-label {\n        width: 150px;\n        font-weight: 500;\n        color: #555;\n    }\n    \n    .detail-value {\n        flex: 1;\n    }\n    \n    .detail-actions {\n        padding: 15px 20px;\n        background-color: #f8f9fa;\n        display: flex;\n        gap: 10px;\n        justify-content: flex-end;\n    }\n    \n    .btn {\n        padding: 8px 15px;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 14px;\n        display: inline-flex;\n        align-items: center;\n        gap: 5px;\n    }\n    \n    .btn-primary {\n        background-color: var(--primary-color);\n        color: white;\n    }\n    \n    .btn-secondary {\n        background-color: #6c757d;\n        color: white;\n    }\n    \n    .btn-danger {\n        background-color: #dc3545;\n        color: white;\n    }\n</style>\n\n{% block extra_js %}\n<script>\n    // H√†m x√≥a d·ªãch v·ª•\n    function deleteDichVu(maDV) {\n        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªãch v·ª• n√†y?')) {\n            // G·ªçi API x√≥a d·ªãch v·ª•\n            fetch(`/api/dich-vu/${maDV}`, {\n                method: 'DELETE'\n            })\n            .then(response => response.json())\n            .then(data => {\n                if (data.success) {\n                    alert(data.message);\n                    window.location.href = \"{{ url_for('dich_vu_list') }}\";\n                } else {\n                    alert('L·ªói: ' + data.message);\n                }\n            })\n            .catch(error => {\n                console.error('Error:', error);\n                alert('ƒê√£ x·∫£y ra l·ªói khi x√≥a d·ªãch v·ª•');\n            });\n        }\n    }\n</script>\n{% endblock %}\n{% endblock %}","language":"html"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745256505090,"isInternal":false},{"id":"c29a81b5-c187-435d-b6dd-ead7d5d45c34","role":"assistant","createdAt":1745256517824,"content":[{"type":"text","text":"T√¥i s·∫Ω t·∫°o ch·ª©c nƒÉng b√°o c√°o v√† th·ªëng k√™ v·ªõi 3 ch·ª©c nƒÉng nh·ªè nh∆∞ b·∫°n y√™u c·∫ßu. Tr∆∞·ªõc ti√™n, t√¥i c·∫ßn t·∫°o c√°c file template v√† c·∫≠p nh·∫≠t c√°c route c·∫ßn thi·∫øt.\n\nƒê·∫ßu ti√™n, t√¥i s·∫Ω t·∫°o trang ch√≠nh cho ch·ª©c nƒÉng b√°o c√°o v√† th·ªëng k√™:"},{"type":"toolCall","toolCallId":"toolu_01Y1bKQqyaqf4Cenf2koVmPr","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao.html","path":"nhakhoaso/templates/bao_cao.html","displayPath":"nhakhoaso/templates/bao_cao.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao.html\n+++ nhakhoaso/templates/bao_cao.html\n@@ -0,0 +1,373 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}B√°o c√°o v√† Th·ªëng k√™ - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n+</div>\n+\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-chart-bar\"></i> B√°o c√°o v√† Th·ªëng k√™\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_dich_vu') }}\">\n+                    <i class=\"fas fa-hand-holding-heart\"></i> B√°o c√°o d·ªãch v·ª•\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_benh_nhan') }}\">\n+                    <i class=\"fas fa-user-injured\"></i> B√°o c√°o b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_doanh_thu') }}\">\n+                    <i class=\"fas fa-money-bill-wave\"></i> B√°o c√°o doanh thu\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <!-- Main content -->\n+    <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>T·ªïng quan b√°o c√°o</h2>\n+        </div>\n+        \n+        <div class=\"dashboard-stats\">\n+            <div class=\"stat-card\">\n+                <div class=\"stat-icon\">\n+                    <i class=\"fas fa-user-injured\"></i>\n+                </div>\n+                <div class=\"stat-info\">\n+                    <h3>{{ tong_benh_nhan }}</h3>\n+                    <p>T·ªïng s·ªë b·ªánh nh√¢n</p>\n+                </div>\n+            </div>\n+            \n+            <div class=\"stat-card\">\n+                <div class=\"stat-icon\">\n+                    <i class=\"fas fa-hand-holding-heart\"></i>\n+                </div>\n+                <div class=\"stat-info\">\n+                    <h3>{{ tong_dich_vu }}</h3>\n+                    <p>T·ªïng s·ªë d·ªãch v·ª•</p>\n+                </div>\n+            </div>\n+            \n+            <div class=\"stat-card\">\n+                <div class=\"stat-icon\">\n+                    <i class=\"fas fa-calendar-check\"></i>\n+                </div>\n+                <div class=\"stat-info\">\n+                    <h3>{{ tong_lich_hen }}</h3>\n+                    <p>T·ªïng s·ªë l·ªãch h·∫πn</p>\n+                </div>\n+            </div>\n+            \n+            <div class=\"stat-card\">\n+                <div class=\"stat-icon\">\n+                    <i class=\"fas fa-money-bill-wave\"></i>\n+                </div>\n+                <div class=\"stat-info\">\n+                    <h3>{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</h3>\n+                    <p>T·ªïng doanh thu</p>\n+                </div>\n+            </div>\n+        </div>\n+        \n+        <div class=\"report-cards\">\n+            <div class=\"report-card\">\n+                <div class=\"report-header\">\n+                    <h3>B√°o c√°o d·ªãch v·ª•</h3>\n+                    <a href=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"btn btn-sm\">Xem chi ti·∫øt</a>\n+                </div>\n+                <div class=\"report-content\">\n+                    <div class=\"chart-container\">\n+                        <canvas id=\"serviceChart\"></canvas>\n+                    </div>\n+                </div>\n+            </div>\n+            \n+            <div class=\"report-card\">\n+                <div class=\"report-header\">\n+                    <h3>B√°o c√°o b·ªánh nh√¢n</h3>\n+                    <a href=\"{{ url_for('bao_cao_benh_nhan') }}\" class=\"btn btn-sm\">Xem chi ti·∫øt</a>\n+                </div>\n+                <div class=\"report-content\">\n+                    <div class=\"chart-container\">\n+                        <canvas id=\"patientChart\"></canvas>\n+                    </div>\n+                </div>\n+            </div>\n+            \n+            <div class=\"report-card\">\n+                <div class=\"report-header\">\n+                    <h3>B√°o c√°o doanh thu</h3>\n+                    <a href=\"{{ url_for('bao_cao_doanh_thu') }}\" class=\"btn btn-sm\">Xem chi ti·∫øt</a>\n+                </div>\n+                <div class=\"report-content\">\n+                    <div class=\"chart-container\">\n+                        <canvas id=\"revenueChart\"></canvas>\n+                    </div>\n+                </div>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì d·ªãch v·ª•\n+        const serviceCtx = document.getElementById('serviceChart').getContext('2d');\n+        const serviceChart = new Chart(serviceCtx, {\n+            type: 'pie',\n+            data: {\n+                labels: {{ dich_vu_labels|safe }},\n+                datasets: [{\n+                    data: {{ dich_vu_data|safe }},\n+                    backgroundColor: [\n+                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',\n+                        '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6'\n+                    ],\n+                    hoverOffset: 4\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                plugins: {\n+                    legend: {\n+                        position: 'right',\n+                    },\n+                    title: {\n+                        display: true,\n+                        text: 'T·ª∑ l·ªá s·ª≠ d·ª•ng d·ªãch v·ª•'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì b·ªánh nh√¢n\n+        const patientCtx = document.getElementById('patientChart').getContext('2d');\n+        const patientChart = new Chart(patientCtx, {\n+            type: 'bar',\n+            data: {\n+                labels: {{ benh_nhan_labels|safe }},\n+                datasets: [{\n+                    label: 'S·ªë l∆∞·ª£ng b·ªánh nh√¢n',\n+                    data: {{ benh_nhan_data|safe }},\n+                    backgroundColor: '#4e73df',\n+                    borderColor: '#4e73df',\n+                    borderWidth: 1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        ticks: {\n+                            precision: 0\n+                        }\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì doanh thu\n+        const revenueCtx = document.getElementById('revenueChart').getContext('2d');\n+        const revenueChart = new Chart(revenueCtx, {\n+            type: 'line',\n+            data: {\n+                labels: {{ doanh_thu_labels|safe }},\n+                datasets: [{\n+                    label: 'Doanh thu (VNƒê)',\n+                    data: {{ doanh_thu_data|safe }},\n+                    fill: false,\n+                    borderColor: '#1cc88a',\n+                    tension: 0.1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true\n+                    }\n+                }\n+            }\n+        });\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .dashboard-stats {\n+        display: grid;\n+        grid-template-columns: repeat(4, 1fr);\n+        gap: 20px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .stat-card {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        display: flex;\n+        align-items: center;\n+    }\n+    \n+    .stat-icon {\n+        width: 60px;\n+        height: 60px;\n+        border-radius: 50%;\n+        background-color: rgba(78, 115, 223, 0.1);\n+        display: flex;\n+        align-items: center;\n+        justify-content: center;\n+        margin-right: 15px;\n+    }\n+    \n+    .stat-icon i {\n+        font-size: 24px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .stat-info h3 {\n+        margin: 0;\n+        font-size: 24px;\n+        font-weight: 700;\n+        color: #333;\n+    }\n+    \n+    .stat-info p {\n+        margin: 5px 0 0;\n+        font-size: 14px;\n+        color: #666;\n+    }\n+    \n+    .report-cards {\n+        display: grid;\n+        grid-template-columns: repeat(2, 1fr);\n+        gap: 20px;\n+    }\n+    \n+    .report-card {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        overflow: hidden;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .report-header {\n+        background-color: var(--secondary-color);\n+        padding: 15px 20px;\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+    }\n+    \n+    .report-header h3 {\n+        margin: 0;\n+        font-size: 18px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .report-content {\n+        padding: 20px;\n+    }\n+    \n+    .chart-container {\n+        height: 300px;\n+        position: relative;\n+    }\n+    \n+    .btn-sm {\n+        padding: 5px 10px;\n+        font-size: 12px;\n+        background-color: var(--primary-color);\n+        color: white;\n+        border-radius: 4px;\n+        text-decoration: none;\n+    }\n+    \n+    @media (max-width: 1200px) {\n+        .dashboard-stats {\n+            grid-template-columns: repeat(2, 1fr);\n+        }\n+        \n+        .report-cards {\n+            grid-template-columns: 1fr;\n+        }\n+    }\n+    \n+    @media (max-width: 768px) {\n+        .dashboard-stats {\n+            grid-template-columns: 1fr;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01Y1bKQqyaqf4Cenf2koVmPr"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω t·∫°o trang b√°o c√°o d·ªãch v·ª•:"},{"type":"toolCall","toolCallId":"toolu_01TWWfKs78jG6VC6MqjFKivs","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu.html\n+++ nhakhoaso/templates/bao_cao_dich_vu.html\n@@ -0,0 +1,495 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}B√°o c√°o d·ªãch v·ª• - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n+</div>\n+\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-chart-bar\"></i> B√°o c√°o v√† Th·ªëng k√™\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"active\">\n+                    <i class=\"fas fa-hand-holding-heart\"></i> B√°o c√°o d·ªãch v·ª•\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_benh_nhan') }}\">\n+                    <i class=\"fas fa-user-injured\"></i> B√°o c√°o b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_doanh_thu') }}\">\n+                    <i class=\"fas fa-money-bill-wave\"></i> B√°o c√°o doanh thu\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <!-- Main content -->\n+    <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>B√°o c√°o d·ªãch v·ª•</h2>\n+            <div class=\"header-actions\">\n+                <button class=\"btn btn-primary\" id=\"printBtn\">\n+                    <i class=\"fas fa-print\"></i> In b√°o c√°o\n+                </button>\n+                <button class=\"btn btn-secondary\" id=\"exportBtn\">\n+                    <i class=\"fas fa-file-export\"></i> Xu·∫•t Excel\n+                </button>\n+            </div>\n+        </div>\n+        \n+        <div class=\"filter-container\">\n+            <form method=\"POST\" action=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"filter-form\">\n+                <div class=\"form-group\">\n+                    <label for=\"tu_ngay\">T·ª´ ng√†y</label>\n+                    <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"den_ngay\">ƒê·∫øn ng√†y</label>\n+                    <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-actions\">\n+                    <button type=\"submit\" class=\"btn btn-primary\">\n+                        <i class=\"fas fa-filter\"></i> L·ªçc\n+                    </button>\n+                    <button type=\"reset\" class=\"btn btn-secondary\">\n+                        <i class=\"fas fa-redo\"></i> ƒê·∫∑t l·∫°i\n+                    </button>\n+                </div>\n+            </form>\n+        </div>\n+        \n+        <div class=\"report-container\" id=\"reportContent\">\n+            <div class=\"report-header\">\n+                <div class=\"report-title\">\n+                    <h3>B√ÅO C√ÅO S·ªê L∆Ø·ª¢NG D·ªäCH V·ª§</h3>\n+                    <p>T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}</p>\n+                </div>\n+                <div class=\"report-logo\">\n+                    <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n+                    <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>\n+                </div>\n+            </div>\n+            \n+            <div class=\"report-summary\">\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">T·ªïng s·ªë d·ªãch v·ª•:</div>\n+                    <div class=\"summary-value\">{{ tong_dich_vu }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t:</div>\n+                    <div class=\"summary-value\">{{ dich_vu_pho_bien }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">T·ªïng doanh thu t·ª´ d·ªãch v·ª•:</div>\n+                    <div class=\"summary-value\">{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</div>\n+                </div>\n+            </div>\n+            \n+            <div class=\"chart-section\">\n+                <div class=\"chart-container\">\n+                    <canvas id=\"serviceChart\"></canvas>\n+                </div>\n+                <div class=\"chart-container\">\n+                    <canvas id=\"serviceRevenueChart\"></canvas>\n+                </div>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Chi ti·∫øt d·ªãch v·ª•</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>M√£ d·ªãch v·ª•</th>\n+                            <th>T√™n d·ªãch v·ª•</th>\n+                            <th>S·ªë l∆∞·ª£ng</th>\n+                            <th>Gi√° d·ªãch v·ª•</th>\n+                            <th>Doanh thu</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for dv in dich_vu_list %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ dv.MaDV }}</td>\n+                                <td>{{ dv.TenDV }}</td>\n+                                <td>{{ dv.SoLuong }}</td>\n+                                <td>{{ \"{:,.0f}\".format(dv.Gia) }} VNƒê</td>\n+                                <td>{{ \"{:,.0f}\".format(dv.DoanhThu) }} VNƒê</td>\n+                                <td>{{ \"%.2f\"|format(dv.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"3\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_so_luong }}</strong></td>\n+                            <td></td>\n+                            <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª•\n+        const serviceCtx = document.getElementById('serviceChart').getContext('2d');\n+        const serviceChart = new Chart(serviceCtx, {\n+            type: 'pie',\n+            data: {\n+                labels: {{ dich_vu_labels|safe }},\n+                datasets: [{\n+                    label: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•',\n+                    data: {{ dich_vu_data|safe }},\n+                    backgroundColor: [\n+                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',\n+                        '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6'\n+                    ],\n+                    hoverOffset: 4\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                plugins: {\n+                    legend: {\n+                        position: 'right',\n+                    },\n+                    title: {\n+                        display: true,\n+                        text: 'T·ª∑ l·ªá s·ª≠ d·ª•ng d·ªãch v·ª•'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì doanh thu d·ªãch v·ª•\n+        const revenueCtx = document.getElementById('serviceRevenueChart').getContext('2d');\n+        const revenueChart = new Chart(revenueCtx, {\n+            type: 'bar',\n+            data: {\n+                labels: {{ dich_vu_labels|safe }},\n+                datasets: [{\n+                    label: 'Doanh thu (VNƒê)',\n+                    data: {{ doanh_thu_data|safe }},\n+                    backgroundColor: '#1cc88a',\n+                    borderColor: '#1cc88a',\n+                    borderWidth: 1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Doanh thu theo d·ªãch v·ª•'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n+        document.getElementById('printBtn').addEventListener('click', function() {\n+            window.print();\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán xu·∫•t Excel\n+        document.getElementById('exportBtn').addEventListener('click', function() {\n+            exportToExcel();\n+        });\n+        \n+        // H√†m xu·∫•t Excel\n+        function exportToExcel() {\n+            // L·∫•y d·ªØ li·ªáu t·ª´ b·∫£ng\n+            const table = document.querySelector('.data-table');\n+            const rows = table.querySelectorAll('tr');\n+            \n+            // T·∫°o workbook v√† worksheet\n+            const wb = XLSX.utils.book_new();\n+            const wsData = [];\n+            \n+            // Th√™m ti√™u ƒë·ªÅ b√°o c√°o\n+            wsData.push(['B√ÅO C√ÅO S·ªê L∆Ø·ª¢NG D·ªäCH V·ª§']);\n+            wsData.push([`T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}`]);\n+            wsData.push([]);\n+            \n+            // Th√™m d·ªØ li·ªáu t·ª´ b·∫£ng\n+            rows.forEach(row => {\n+                const rowData = [];\n+                row.querySelectorAll('th, td').forEach(cell => {\n+                    rowData.push(cell.textContent.trim());\n+                });\n+                wsData.push(rowData);\n+            });\n+            \n+            // T·∫°o worksheet v√† th√™m v√†o workbook\n+            const ws = XLSX.utils.aoa_to_sheet(wsData);\n+            XLSX.utils.book_append_sheet(wb, ws, 'B√°o c√°o d·ªãch v·ª•');\n+            \n+            // Xu·∫•t file Excel\n+            XLSX.writeFile(wb, `Bao_cao_dich_vu_${new Date().toISOString().slice(0, 10)}.xlsx`);\n+        }\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .filter-form {\n+        display: flex;\n+        align-items: flex-end;\n+        gap: 20px;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form input {\n+        width: 100%;\n+        padding: 8px 12px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .form-actions {\n+        display: flex;\n+        gap: 10px;\n+    }\n+    \n+    .report-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+    }\n+    \n+    .report-header {\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+        margin-bottom: 20px;\n+        padding-bottom: 20px;\n+        border-bottom: 1px solid #eee;\n+    }\n+    \n+    .report-logo {\n+        display: flex;\n+        align-items: center;\n+    }\n+    \n+    .report-logo img {\n+        width: 40px;\n+        height: 40px;\n+        margin-right: 10px;\n+    }\n+    \n+    .report-logo h4 {\n+        margin: 0;\n+        font-size: 16px;\n+    }\n+    \n+    .report-title h3 {\n+        margin: 0 0 5px;\n+        font-size: 20px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .report-title p {\n+        margin: 0;\n+        font-size: 14px;\n+        color: #666;\n+    }\n+    \n+    .report-summary {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-bottom: 20px;\n+        padding: 15px;\n+        background-color: #f8f9fc;\n+        border-radius: 5px;\n+    }\n+    \n+    .summary-item {\n+        text-align: center;\n+    }\n+    \n+    .summary-label {\n+        font-size: 14px;\n+        color: #666;\n+        margin-bottom: 5px;\n+    }\n+    \n+    .summary-value {\n+        font-size: 18px;\n+        font-weight: 700;\n+        color: var(--primary-color);\n+    }\n+    \n+    .chart-section {\n+        display: flex;\n+        gap: 20px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .chart-container {\n+        flex: 1;\n+        height: 300px;\n+        position: relative;\n+    }\n+    \n+    .table-section h4 {\n+        margin-top: 0;\n+        margin-bottom: 15px;\n+        font-size: 18px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .data-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .data-table th, .data-table td {\n+        padding: 10px;\n+        text-align: left;\n+        border-bottom: 1px solid #ddd;\n+    }\n+    \n+    .data-table th {\n+        background-color: #f5f5f5;\n+        font-weight: 600;\n+    }\n+    \n+    .data-table tfoot td {\n+        font-weight: bold;\n+        border-top: 2px solid #ddd;\n+    }\n+    \n+    .text-right {\n+        text-align: right;\n+    }\n+    \n+    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n+    @media print {\n+        .sidebar, .section-title, .content-header, .filter-container, .header-actions {\n+            display: none;\n+        }\n+        \n+        .page-container {\n+            display: block;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+        \n+        .report-container {\n+            box-shadow: none;\n+            padding: 0;\n+        }\n+        \n+        .chart-section {\n+            page-break-inside: avoid;\n+        }\n+        \n+        .table-section {\n+            page-break-inside: avoid;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01TWWfKs78jG6VC6MqjFKivs"},{"type":"text","text":"Ti·∫øp theo, t√¥i s·∫Ω t·∫°o trang b√°o c√°o b·ªánh nh√¢n:"},{"type":"toolCall","toolCallId":"toolu_01P1MZCRJ77GenASJHWune6q","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_benh_nhan.html","path":"nhakhoaso/templates/bao_cao_benh_nhan.html","displayPath":"nhakhoaso/templates/bao_cao_benh_nhan.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_benh_nhan.html\n+++ nhakhoaso/templates/bao_cao_benh_nhan.html\n@@ -0,0 +1,673 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}B√°o c√°o b·ªánh nh√¢n - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n+</div>\n+\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-chart-bar\"></i> B√°o c√°o v√† Th·ªëng k√™\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_dich_vu') }}\">\n+                    <i class=\"fas fa-hand-holding-heart\"></i> B√°o c√°o d·ªãch v·ª•\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_benh_nhan') }}\" class=\"active\">\n+                    <i class=\"fas fa-user-injured\"></i> B√°o c√°o b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_doanh_thu') }}\">\n+                    <i class=\"fas fa-money-bill-wave\"></i> B√°o c√°o doanh thu\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <!-- Main content -->\n+    <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>B√°o c√°o b·ªánh nh√¢n</h2>\n+            <div class=\"header-actions\">\n+                <button class=\"btn btn-primary\" id=\"printBtn\">\n+                    <i class=\"fas fa-print\"></i> In b√°o c√°o\n+                </button>\n+                <button class=\"btn btn-secondary\" id=\"exportBtn\">\n+                    <i class=\"fas fa-file-export\"></i> Xu·∫•t Excel\n+                </button>\n+            </div>\n+        </div>\n+        \n+        <div class=\"filter-container\">\n+            <form method=\"POST\" action=\"{{ url_for('bao_cao_benh_nhan') }}\" class=\"filter-form\">\n+                <div class=\"form-group\">\n+                    <label for=\"tu_ngay\">T·ª´ ng√†y</label>\n+                    <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"den_ngay\">ƒê·∫øn ng√†y</label>\n+                    <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"loai_bao_cao\">Lo·∫°i b√°o c√°o</label>\n+                    <select id=\"loai_bao_cao\" name=\"loai_bao_cao\">\n+                        <option value=\"all\" {% if loai_bao_cao == 'all' %}selected{% endif %}>T·∫•t c·∫£ b·ªánh nh√¢n</option>\n+                        <option value=\"new\" {% if loai_bao_cao == 'new' %}selected{% endif %}>B·ªánh nh√¢n m·ªõi</option>\n+                        <option value=\"returning\" {% if loai_bao_cao == 'returning' %}selected{% endif %}>B·ªánh nh√¢n quay l·∫°i</option>\n+                    </select>\n+                </div>\n+                \n+                <div class=\"form-actions\">\n+                    <button type=\"submit\" class=\"btn btn-primary\">\n+                        <i class=\"fas fa-filter\"></i> L·ªçc\n+                    </button>\n+                    <button type=\"reset\" class=\"btn btn-secondary\">\n+                        <i class=\"fas fa-redo\"></i> ƒê·∫∑t l·∫°i\n+                    </button>\n+                </div>\n+            </form>\n+        </div>\n+        \n+        <div class=\"report-container\" id=\"reportContent\">\n+            <div class=\"report-header\">\n+                <div class=\"report-title\">\n+                    <h3>B√ÅO C√ÅO S·ªê L∆Ø·ª¢NG B·ªÜNH NH√ÇN</h3>\n+                    <p>T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}</p>\n+                </div>\n+                <div class=\"report-logo\">\n+                    <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n+                    <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>\n+                </div>\n+            </div>\n+            \n+            <div class=\"report-summary\">\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">T·ªïng s·ªë b·ªánh nh√¢n:</div>\n+                    <div class=\"summary-value\">{{ tong_benh_nhan }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">B·ªánh nh√¢n m·ªõi:</div>\n+                    <div class=\"summary-value\">{{ benh_nhan_moi }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">B·ªánh nh√¢n quay l·∫°i:</div>\n+                    <div class=\"summary-value\">{{ benh_nhan_quay_lai }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">T·ª∑ l·ªá quay l·∫°i:</div>\n+                    <div class=\"summary-value\">{{ \"%.2f\"|format(ty_le_quay_lai) }}%</div>\n+                </div>\n+            </div>\n+            \n+            <div class=\"chart-section\">\n+                <div class=\"chart-container\">\n+                    <canvas id=\"patientTypeChart\"></canvas>\n+                </div>\n+                <div class=\"chart-container\">\n+                    <canvas id=\"patientTrendChart\"></canvas>\n+                </div>\n+            </div>\n+            \n+            <div class=\"chart-section\">\n+                <div class=\"chart-container\">\n+                    <canvas id=\"ageGroupChart\"></canvas>\n+                </div>\n+                <div class=\"chart-container\">\n+                    <canvas id=\"genderChart\"></canvas>\n+                </div>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Chi ti·∫øt b·ªánh nh√¢n theo th·ªùi gian</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>Th·ªùi gian</th>\n+                            <th>T·ªïng s·ªë b·ªánh nh√¢n</th>\n+                            <th>B·ªánh nh√¢n m·ªõi</th>\n+                            <th>B·ªánh nh√¢n quay l·∫°i</th>\n+                            <th>T·ª∑ l·ªá quay l·∫°i</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in benh_nhan_theo_thoi_gian %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.ThoiGian }}</td>\n+                                <td>{{ item.TongSo }}</td>\n+                                <td>{{ item.BenhNhanMoi }}</td>\n+                                <td>{{ item.BenhNhanQuayLai }}</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLeQuayLai) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"2\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_benh_nhan }}</strong></td>\n+                            <td><strong>{{ benh_nhan_moi }}</strong></td>\n+                            <td><strong>{{ benh_nhan_quay_lai }}</strong></td>\n+                            <td><strong>{{ \"%.2f\"|format(ty_le_quay_lai) }}%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Ph√¢n b·ªë b·ªánh nh√¢n theo ƒë·ªô tu·ªïi</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>Nh√≥m tu·ªïi</th>\n+                            <th>S·ªë l∆∞·ª£ng</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in benh_nhan_theo_tuoi %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.NhomTuoi }}</td>\n+                                <td>{{ item.SoLuong }}</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"2\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_benh_nhan }}</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Ph√¢n b·ªë b·ªánh nh√¢n theo gi·ªõi t√≠nh</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>Gi·ªõi t√≠nh</th>\n+                            <th>S·ªë l∆∞·ª£ng</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in benh_nhan_theo_gioi_tinh %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.GioiTinh }}</td>\n+                                <td>{{ item.SoLuong }}</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"2\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_benh_nhan }}</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // Bi·ªÉu ƒë·ªì ph√¢n lo·∫°i b·ªánh nh√¢n\n+        const patientTypeCtx = document.getElementById('patientTypeChart').getContext('2d');\n+        const patientTypeChart = new Chart(patientTypeCtx, {\n+            type: 'pie',\n+            data: {\n+                labels: ['B·ªánh nh√¢n m·ªõi', 'B·ªánh nh√¢n quay l·∫°i'],\n+                datasets: [{\n+                    data: [{{ benh_nhan_moi }}, {{ benh_nhan_quay_lai }}],\n+                    backgroundColor: ['#4e73df', '#1cc88a'],\n+                    hoverOffset: 4\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                plugins: {\n+                    legend: {\n+                        position: 'right',\n+                    },\n+                    title: {\n+                        display: true,\n+                        text: 'Ph√¢n lo·∫°i b·ªánh nh√¢n'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Bi·ªÉu ƒë·ªì xu h∆∞·ªõng b·ªánh nh√¢n theo th·ªùi gian\n+        const patientTrendCtx = document.getElementById('patientTrendChart').getContext('2d');\n+        const patientTrendChart = new Chart(patientTrendCtx, {\n+            type: 'line',\n+            data: {\n+                labels: {{ thoi_gian_labels|safe }},\n+                datasets: [{\n+                    label: 'T·ªïng s·ªë b·ªánh nh√¢n',\n+                    data: {{ tong_so_data|safe }},\n+                    fill: false,\n+                    borderColor: '#4e73df',\n+                    tension: 0.1\n+                }, {\n+                    label: 'B·ªánh nh√¢n m·ªõi',\n+                    data: {{ benh_nhan_moi_data|safe }},\n+                    fill: false,\n+                    borderColor: '#1cc88a',\n+                    tension: 0.1\n+                }, {\n+                    label: 'B·ªánh nh√¢n quay l·∫°i',\n+                    data: {{ benh_nhan_quay_lai_data|safe }},\n+                    fill: false,\n+                    borderColor: '#f6c23e',\n+                    tension: 0.1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        ticks: {\n+                            precision: 0\n+                        }\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Xu h∆∞·ªõng b·ªánh nh√¢n theo th·ªùi gian'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Bi·ªÉu ƒë·ªì ph√¢n b·ªë b·ªánh nh√¢n theo ƒë·ªô tu·ªïi\n+        const ageGroupCtx = document.getElementById('ageGroupChart').getContext('2d');\n+        const ageGroupChart = new Chart(ageGroupCtx, {\n+            type: 'bar',\n+            data: {\n+                labels: {{ nhom_tuoi_labels|safe }},\n+                datasets: [{\n+                    label: 'S·ªë l∆∞·ª£ng b·ªánh nh√¢n',\n+                    data: {{ nhom_tuoi_data|safe }},\n+                    backgroundColor: '#36b9cc',\n+                    borderColor: '#36b9cc',\n+                    borderWidth: 1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        ticks: {\n+                            precision: 0\n+                        }\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Ph√¢n b·ªë b·ªánh nh√¢n theo ƒë·ªô tu·ªïi'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Bi·ªÉu ƒë·ªì ph√¢n b·ªë b·ªánh nh√¢n theo gi·ªõi t√≠nh\n+        const genderCtx = document.getElementById('genderChart').getContext('2d');\n+        const genderChart = new Chart(genderCtx, {\n+            type: 'doughnut',\n+            data: {\n+                labels: {{ gioi_tinh_labels|safe }},\n+                datasets: [{\n+                    data: {{ gioi_tinh_data|safe }},\n+                    backgroundColor: ['#4e73df', '#e74a3b', '#f6c23e'],\n+                    hoverOffset: 4\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                plugins: {\n+                    legend: {\n+                        position: 'right',\n+                    },\n+                    title: {\n+                        display: true,\n+                        text: 'Ph√¢n b·ªë b·ªánh nh√¢n theo gi·ªõi t√≠nh'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n+        document.getElementById('printBtn').addEventListener('click', function() {\n+            window.print();\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán xu·∫•t Excel\n+        document.getElementById('exportBtn').addEventListener('click', function() {\n+            exportToExcel();\n+        });\n+        \n+        // H√†m xu·∫•t Excel\n+        function exportToExcel() {\n+            // L·∫•y d·ªØ li·ªáu t·ª´ c√°c b·∫£ng\n+            const tables = document.querySelectorAll('.data-table');\n+            \n+            // T·∫°o workbook\n+            const wb = XLSX.utils.book_new();\n+            \n+            // Th√™m ti√™u ƒë·ªÅ b√°o c√°o\n+            const headerData = [\n+                ['B√ÅO C√ÅO S·ªê L∆Ø·ª¢NG B·ªÜNH NH√ÇN'],\n+                [`T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}`],\n+                []\n+            ];\n+            \n+            // Th√™m d·ªØ li·ªáu t·ªïng quan\n+            const summaryData = [\n+                ['T·ªïng s·ªë b·ªánh nh√¢n', 'B·ªánh nh√¢n m·ªõi', 'B·ªánh nh√¢n quay l·∫°i', 'T·ª∑ l·ªá quay l·∫°i'],\n+                [{{ tong_benh_nhan }}, {{ benh_nhan_moi }}, {{ benh_nhan_quay_lai }}, '{{ \"%.2f\"|format(ty_le_quay_lai) }}%']\n+            ];\n+            \n+            // Th√™m worksheet t·ªïng quan\n+            const summarySheet = XLSX.utils.aoa_to_sheet([...headerData, ...summaryData]);\n+            XLSX.utils.book_append_sheet(wb, summarySheet, 'T·ªïng quan');\n+            \n+            // Th√™m worksheet cho t·ª´ng b·∫£ng\n+            tables.forEach((table, index) => {\n+                const rows = table.querySelectorAll('tr');\n+                const wsData = [];\n+                \n+                // Th√™m ti√™u ƒë·ªÅ b·∫£ng\n+                const tableTitle = table.previousElementSibling.textContent;\n+                wsData.push([tableTitle]);\n+                wsData.push([]);\n+                \n+                // Th√™m d·ªØ li·ªáu t·ª´ b·∫£ng\n+                rows.forEach(row => {\n+                    const rowData = [];\n+                    row.querySelectorAll('th, td').forEach(cell => {\n+                        rowData.push(cell.textContent.trim());\n+                    });\n+                    wsData.push(rowData);\n+                });\n+                \n+                // T·∫°o worksheet v√† th√™m v√†o workbook\n+                const ws = XLSX.utils.aoa_to_sheet(wsData);\n+                XLSX.utils.book_append_sheet(wb, ws, `B·∫£ng ${index + 1}`);\n+            });\n+            \n+            // Xu·∫•t file Excel\n+            XLSX.writeFile(wb, `Bao_cao_benh_nhan_${new Date().toISOString().slice(0, 10)}.xlsx`);\n+        }\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .filter-form {\n+        display: flex;\n+        align-items: flex-end;\n+        gap: 20px;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form input,\n+    .filter-form select {\n+        width: 100%;\n+        padding: 8px 12px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .form-actions {\n+        display: flex;\n+        gap: 10px;\n+    }\n+    \n+    .report-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+    }\n+    \n+    .report-header {\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+        margin-bottom: 20px;\n+        padding-bottom: 20px;\n+        border-bottom: 1px solid #eee;\n+    }\n+    \n+    .report-logo {\n+        display: flex;\n+        align-items: center;\n+    }\n+    \n+    .report-logo img {\n+        width: 40px;\n+        height: 40px;\n+        margin-right: 10px;\n+    }\n+    \n+    .report-logo h4 {\n+        margin: 0;\n+        font-size: 16px;\n+    }\n+    \n+    .report-title h3 {\n+        margin: 0 0 5px;\n+        font-size: 20px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .report-title p {\n+        margin: 0;\n+        font-size: 14px;\n+        color: #666;\n+    }\n+    \n+    .report-summary {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-bottom: 20px;\n+        padding: 15px;\n+        background-color: #f8f9fc;\n+        border-radius: 5px;\n+    }\n+    \n+    .summary-item {\n+        text-align: center;\n+    }\n+    \n+    .summary-label {\n+        font-size: 14px;\n+        color: #666;\n+        margin-bottom: 5px;\n+    }\n+    \n+    .summary-value {\n+        font-size: 18px;\n+        font-weight: 700;\n+        color: var(--primary-color);\n+    }\n+    \n+    .chart-section {\n+        display: flex;\n+        gap: 20px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .chart-container {\n+        flex: 1;\n+        height: 300px;\n+        position: relative;\n+    }\n+    \n+    .table-section {\n+        margin-bottom: 30px;\n+    }\n+    \n+    .table-section h4 {\n+        margin-top: 0;\n+        margin-bottom: 15px;\n+        font-size: 18px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .data-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .data-table th, .data-table td {\n+        padding: 10px;\n+        text-align: left;\n+        border-bottom: 1px solid #ddd;\n+    }\n+    \n+    .data-table th {\n+        background-color: #f5f5f5;\n+        font-weight: 600;\n+    }\n+    \n+    .data-table tfoot td {\n+        font-weight: bold;\n+        border-top: 2px solid #ddd;\n+    }\n+    \n+    .text-right {\n+        text-align: right;\n+    }\n+    \n+    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n+    @media print {\n+        .sidebar, .section-title, .content-header, .filter-container, .header-actions {\n+            display: none;\n+        }\n+        \n+        .page-container {\n+            display: block;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+        \n+        .report-container {\n+            box-shadow: none;\n+            padding: 0;\n+        }\n+        \n+        .chart-section {\n+            page-break-inside: avoid;\n+        }\n+        \n+        .table-section {\n+            page-break-inside: avoid;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01P1MZCRJ77GenASJHWune6q"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i s·∫Ω t·∫°o trang b√°o c√°o doanh thu:"},{"type":"toolCall","toolCallId":"toolu_01KowtqWcPugcjqdEAVxkTWf","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_doanh_thu.html","path":"nhakhoaso/templates/bao_cao_doanh_thu.html","displayPath":"nhakhoaso/templates/bao_cao_doanh_thu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_doanh_thu.html\n+++ nhakhoaso/templates/bao_cao_doanh_thu.html\n@@ -0,0 +1,627 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}B√°o c√°o doanh thu - NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n+</div>\n+\n+<!-- Flash messages -->\n+{% with messages = get_flashed_messages(with_categories=true) %}\n+    {% if messages %}\n+        <div class=\"flash-messages\">\n+            {% for category, message in messages %}\n+                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n+            {% endfor %}\n+        </div>\n+    {% endif %}\n+{% endwith %}\n+\n+<div class=\"page-container\">\n+    <!-- Sidebar -->\n+    <div class=\"sidebar\">\n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-chart-bar\"></i> B√°o c√°o v√† Th·ªëng k√™\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_dich_vu') }}\">\n+                    <i class=\"fas fa-hand-holding-heart\"></i> B√°o c√°o d·ªãch v·ª•\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_benh_nhan') }}\">\n+                    <i class=\"fas fa-user-injured\"></i> B√°o c√°o b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('bao_cao_doanh_thu') }}\" class=\"active\">\n+                    <i class=\"fas fa-money-bill-wave\"></i> B√°o c√°o doanh thu\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-user-injured\"></i> Qu·∫£n l√Ω b·ªánh nh√¢n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_benh_nhan') }}\">\n+                    <i class=\"fas fa-plus\"></i> Th√™m m·ªõi b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_benh_nhan') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm b·ªánh nh√¢n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('benh_nhan_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch b·ªánh nh√¢n\n+                </a>\n+            </li>\n+        </ul>\n+        \n+        <div class=\"sidebar-title\">\n+            <i class=\"fas fa-file-invoice-dollar\"></i> Qu·∫£n l√Ω thanh to√°n\n+        </div>\n+        <ul class=\"sidebar-menu\">\n+            <li>\n+                <a href=\"{{ url_for('them_moi_hoa_don') }}\">\n+                    <i class=\"fas fa-plus\"></i> T·∫°o h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('tim_kiem_hoa_don') }}\">\n+                    <i class=\"fas fa-search\"></i> T√¨m ki·∫øm h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+            <li>\n+                <a href=\"{{ url_for('hoa_don_list') }}\">\n+                    <i class=\"fas fa-list\"></i> Danh s√°ch h√≥a ƒë∆°n\n+                </a>\n+            </li>\n+        </ul>\n+    </div>\n+\n+    <!-- Main content -->\n+    <div class=\"main-content\">\n+        <div class=\"content-header\">\n+            <h2>B√°o c√°o doanh thu</h2>\n+            <div class=\"header-actions\">\n+                <button class=\"btn btn-primary\" id=\"printBtn\">\n+                    <i class=\"fas fa-print\"></i> In b√°o c√°o\n+                </button>\n+                <button class=\"btn btn-secondary\" id=\"exportBtn\">\n+                    <i class=\"fas fa-file-export\"></i> Xu·∫•t Excel\n+                </button>\n+            </div>\n+        </div>\n+        \n+        <div class=\"filter-container\">\n+            <form method=\"POST\" action=\"{{ url_for('bao_cao_doanh_thu') }}\" class=\"filter-form\">\n+                <div class=\"form-group\">\n+                    <label for=\"tu_ngay\">T·ª´ ng√†y</label>\n+                    <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"den_ngay\">ƒê·∫øn ng√†y</label>\n+                    <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n+                </div>\n+                \n+                <div class=\"form-group\">\n+                    <label for=\"loai_bao_cao\">Lo·∫°i b√°o c√°o</label>\n+                    <select id=\"loai_bao_cao\" name=\"loai_bao_cao\">\n+                        <option value=\"day\" {% if loai_bao_cao == 'day' %}selected{% endif %}>Theo ng√†y</option>\n+                        <option value=\"month\" {% if loai_bao_cao == 'month' %}selected{% endif %}>Theo th√°ng</option>\n+                        <option value=\"quarter\" {% if loai_bao_cao == 'quarter' %}selected{% endif %}>Theo qu√Ω</option>\n+                        <option value=\"year\" {% if loai_bao_cao == 'year' %}selected{% endif %}>Theo nƒÉm</option>\n+                    </select>\n+                </div>\n+                \n+                <div class=\"form-actions\">\n+                    <button type=\"submit\" class=\"btn btn-primary\">\n+                        <i class=\"fas fa-filter\"></i> L·ªçc\n+                    </button>\n+                    <button type=\"reset\" class=\"btn btn-secondary\">\n+                        <i class=\"fas fa-redo\"></i> ƒê·∫∑t l·∫°i\n+                    </button>\n+                </div>\n+            </form>\n+        </div>\n+        \n+        <div class=\"report-container\" id=\"reportContent\">\n+            <div class=\"report-header\">\n+                <div class=\"report-title\">\n+                    <h3>B√ÅO C√ÅO DOANH THU</h3>\n+                    <p>T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}</p>\n+                </div>\n+                <div class=\"report-logo\">\n+                    <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n+                    <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>\n+                </div>\n+            </div>\n+            \n+            <div class=\"report-summary\">\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">T·ªïng doanh thu:</div>\n+                    <div class=\"summary-value\">{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">S·ªë l∆∞·ª£ng h√≥a ƒë∆°n:</div>\n+                    <div class=\"summary-value\">{{ tong_hoa_don }}</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">Doanh thu trung b√¨nh:</div>\n+                    <div class=\"summary-value\">{{ \"{:,.0f}\".format(doanh_thu_trung_binh) }} VNƒê</div>\n+                </div>\n+                <div class=\"summary-item\">\n+                    <div class=\"summary-label\">Doanh thu cao nh·∫•t:</div>\n+                    <div class=\"summary-value\">{{ \"{:,.0f}\".format(doanh_thu_cao_nhat) }} VNƒê</div>\n+                </div>\n+            </div>\n+            \n+            <div class=\"chart-section\">\n+                <div class=\"chart-container\">\n+                    <canvas id=\"revenueChart\"></canvas>\n+                </div>\n+                <div class=\"chart-container\">\n+                    <canvas id=\"paymentMethodChart\"></canvas>\n+                </div>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Chi ti·∫øt doanh thu theo th·ªùi gian</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>Th·ªùi gian</th>\n+                            <th>S·ªë l∆∞·ª£ng h√≥a ƒë∆°n</th>\n+                            <th>Doanh thu</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in doanh_thu_theo_thoi_gian %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.ThoiGian }}</td>\n+                                <td>{{ item.SoLuongHoaDon }}</td>\n+                                <td>{{ \"{:,.0f}\".format(item.DoanhThu) }} VNƒê</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"2\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_hoa_don }}</strong></td>\n+                            <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>Ph∆∞∆°ng th·ª©c thanh to√°n</th>\n+                            <th>S·ªë l∆∞·ª£ng h√≥a ƒë∆°n</th>\n+                            <th>Doanh thu</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in doanh_thu_theo_pttt %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.PhuongThucThanhToan }}</td>\n+                                <td>{{ item.SoLuongHoaDon }}</td>\n+                                <td>{{ \"{:,.0f}\".format(item.DoanhThu) }} VNƒê</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"2\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_hoa_don }}</strong></td>\n+                            <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+            \n+            <div class=\"table-section\">\n+                <h4>Doanh thu theo d·ªãch v·ª•</h4>\n+                <table class=\"data-table\">\n+                    <thead>\n+                        <tr>\n+                            <th>STT</th>\n+                            <th>M√£ d·ªãch v·ª•</th>\n+                            <th>T√™n d·ªãch v·ª•</th>\n+                            <th>S·ªë l∆∞·ª£ng</th>\n+                            <th>Doanh thu</th>\n+                            <th>T·ª∑ l·ªá</th>\n+                        </tr>\n+                    </thead>\n+                    <tbody>\n+                        {% for item in doanh_thu_theo_dich_vu %}\n+                            <tr>\n+                                <td>{{ loop.index }}</td>\n+                                <td>{{ item.MaDV }}</td>\n+                                <td>{{ item.TenDV }}</td>\n+                                <td>{{ item.SoLuong }}</td>\n+                                <td>{{ \"{:,.0f}\".format(item.DoanhThu) }} VNƒê</td>\n+                                <td>{{ \"%.2f\"|format(item.TyLe) }}%</td>\n+                            </tr>\n+                        {% endfor %}\n+                    </tbody>\n+                    <tfoot>\n+                        <tr>\n+                            <td colspan=\"3\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n+                            <td><strong>{{ tong_so_luong_dich_vu }}</strong></td>\n+                            <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê</strong></td>\n+                            <td><strong>100%</strong></td>\n+                        </tr>\n+                    </tfoot>\n+                </table>\n+            </div>\n+        </div>\n+    </div>\n+</div>\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        // Bi·ªÉu ƒë·ªì doanh thu theo th·ªùi gian\n+        const revenueCtx = document.getElementById('revenueChart').getContext('2d');\n+        const revenueChart = new Chart(revenueCtx, {\n+            type: 'bar',\n+            data: {\n+                labels: {{ thoi_gian_labels|safe }},\n+                datasets: [{\n+                    label: 'Doanh thu (VNƒê)',\n+                    data: {{ doanh_thu_data|safe }},\n+                    backgroundColor: '#1cc88a',\n+                    borderColor: '#1cc88a',\n+                    borderWidth: 1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Doanh thu theo th·ªùi gian'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Bi·ªÉu ƒë·ªì doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n\n+        const paymentMethodCtx = document.getElementById('paymentMethodChart').getContext('2d');\n+        const paymentMethodChart = new Chart(paymentMethodCtx, {\n+            type: 'pie',\n+            data: {\n+                labels: {{ pttt_labels|safe }},\n+                datasets: [{\n+                    data: {{ pttt_data|safe }},\n+                    backgroundColor: [\n+                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'\n+                    ],\n+                    hoverOffset: 4\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                plugins: {\n+                    legend: {\n+                        position: 'right',\n+                    },\n+                    title: {\n+                        display: true,\n+                        text: 'Doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n'\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n+        document.getElementById('printBtn').addEventListener('click', function() {\n+            window.print();\n+        });\n+        \n+        // X·ª≠ l√Ω s·ª± ki·ªán xu·∫•t Excel\n+        document.getElementById('exportBtn').addEventListener('click', function() {\n+            exportToExcel();\n+        });\n+        \n+        // H√†m xu·∫•t Excel\n+        function exportToExcel() {\n+            // L·∫•y d·ªØ li·ªáu t·ª´ c√°c b·∫£ng\n+            const tables = document.querySelectorAll('.data-table');\n+            \n+            // T·∫°o workbook\n+            const wb = XLSX.utils.book_new();\n+            \n+            // Th√™m ti√™u ƒë·ªÅ b√°o c√°o\n+            const headerData = [\n+                ['B√ÅO C√ÅO DOANH THU'],\n+                [`T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}`],\n+                []\n+            ];\n+            \n+            // Th√™m d·ªØ li·ªáu t·ªïng quan\n+            const summaryData = [\n+                ['T·ªïng doanh thu', 'S·ªë l∆∞·ª£ng h√≥a ƒë∆°n', 'Doanh thu trung b√¨nh', 'Doanh thu cao nh·∫•t'],\n+                [\n+                    '{{ \"{:,.0f}\".format(tong_doanh_thu) }} VNƒê', \n+                    {{ tong_hoa_don }}, \n+                    '{{ \"{:,.0f}\".format(doanh_thu_trung_binh) }} VNƒê', \n+                    '{{ \"{:,.0f}\".format(doanh_thu_cao_nhat) }} VNƒê'\n+                ]\n+            ];\n+            \n+            // Th√™m worksheet t·ªïng quan\n+            const summarySheet = XLSX.utils.aoa_to_sheet([...headerData, ...summaryData]);\n+            XLSX.utils.book_append_sheet(wb, summarySheet, 'T·ªïng quan');\n+            \n+            // Th√™m worksheet cho t·ª´ng b·∫£ng\n+            tables.forEach((table, index) => {\n+                const rows = table.querySelectorAll('tr');\n+                const wsData = [];\n+                \n+                // Th√™m ti√™u ƒë·ªÅ b·∫£ng\n+                const tableTitle = table.previousElementSibling.textContent;\n+                wsData.push([tableTitle]);\n+                wsData.push([]);\n+                \n+                // Th√™m d·ªØ li·ªáu t·ª´ b·∫£ng\n+                rows.forEach(row => {\n+                    const rowData = [];\n+                    row.querySelectorAll('th, td').forEach(cell => {\n+                        rowData.push(cell.textContent.trim());\n+                    });\n+                    wsData.push(rowData);\n+                });\n+                \n+                // T·∫°o worksheet v√† th√™m v√†o workbook\n+                const ws = XLSX.utils.aoa_to_sheet(wsData);\n+                XLSX.utils.book_append_sheet(wb, ws, `B·∫£ng ${index + 1}`);\n+            });\n+            \n+            // Xu·∫•t file Excel\n+            XLSX.writeFile(wb, `Bao_cao_doanh_thu_${new Date().toISOString().slice(0, 10)}.xlsx`);\n+        }\n+    });\n+</script>\n+{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+        margin-bottom: 20px;\n+    }\n+    \n+    .filter-form {\n+        display: flex;\n+        align-items: flex-end;\n+        gap: 20px;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form input,\n+    .filter-form select {\n+        width: 100%;\n+        padding: 8px 12px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .form-actions {\n+        display: flex;\n+        gap: 10px;\n+    }\n+    \n+    .report-container {\n+        background-color: #fff;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n+        padding: 20px;\n+    }\n+    \n+    .report-header {\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+        margin-bottom: 20px;\n+        padding-bottom: 20px;\n+        border-bottom: 1px solid #eee;\n+    }\n+    \n+    .report-logo {\n+        display: flex;\n+        align-items: center;\n+    }\n+    \n+    .report-logo img {\n+        width: 40px;\n+        height: 40px;\n+        margin-right: 10px;\n+    }\n+    \n+    .report-logo h4 {\n+        margin: 0;\n+        font-size: 16px;\n+    }\n+    \n+    .report-title h3 {\n+        margin: 0 0 5px;\n+        font-size: 20px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .report-title p {\n+        margin: 0;\n+        font-size: 14px;\n+        color: #666;\n+    }\n+    \n+    .report-summary {\n+        display: flex;\n+        justify-content: space-between;\n+        margin-bottom: 20px;\n+        padding: 15px;\n+        background-color: #f8f9fc;\n+        border-radius: 5px;\n+    }\n+    \n+    .summary-item {\n+        text-align: center;\n+    }\n+    \n+    .summary-label {\n+        font-size: 14px;\n+        color: #666;\n+        margin-bottom: 5px;\n+    }\n+    \n+    .summary-value {\n+        font-size: 18px;\n+        font-weight: 700;\n+        color: var(--primary-color);\n+    }\n+    \n+    .chart-section {\n+        display: flex;\n+        gap: 20px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .chart-container {\n+        flex: 1;\n+        height: 300px;\n+        position: relative;\n+    }\n+    \n+    .table-section {\n+        margin-bottom: 30px;\n+    }\n+    \n+    .table-section h4 {\n+        margin-top: 0;\n+        margin-bottom: 15px;\n+        font-size: 18px;\n+        color: var(--primary-color);\n+    }\n+    \n+    .data-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .data-table th, .data-table td {\n+        padding: 10px;\n+        text-align: left;\n+        border-bottom: 1px solid #ddd;\n+    }\n+    \n+    .data-table th {\n+        background-color: #f5f5f5;\n+        font-weight: 600;\n+    }\n+    \n+    .data-table tfoot td {\n+        font-weight: bold;\n+        border-top: 2px solid #ddd;\n+    }\n+    \n+    .text-right {\n+        text-align: right;\n+    }\n+    \n+    /* ƒê·ªãnh d·∫°ng cho ch·∫ø ƒë·ªô in */\n+    @media print {\n+        .sidebar, .section-title, .content-header, .filter-container, .header-actions {\n+            display: none;\n+        }\n+        \n+        .page-container {\n+            display: block;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+        \n+        .report-container {\n+            box-shadow: none;\n+            padding: 0;\n+        }\n+        \n+        .chart-section {\n+            page-break-inside: avoid;\n+        }\n+        \n+        .table-section {\n+            page-break-inside: avoid;\n+        }\n+    }\n+    \n+    @media (max-width: 992px) {\n+        .filter-form {\n+            flex-direction: column;\n+            align-items: stretch;\n+        }\n+        \n+        .chart-section {\n+            flex-direction: column;\n+        }\n+        \n+        .chart-container {\n+            height: 250px;\n+        }\n+        \n+        .report-summary {\n+            flex-wrap: wrap;\n+        }\n+        \n+        .summary-item {\n+            width: 50%;\n+            margin-bottom: 15px;\n+        }\n+    }\n+</style>\n+{% endblock %}","refToolCallId":"toolu_01KowtqWcPugcjqdEAVxkTWf"},{"type":"text","text":"B√¢y gi·ªù, t√¥i s·∫Ω t·∫°o module x·ª≠ l√Ω d·ªØ li·ªáu cho ch·ª©c nƒÉng b√°o c√°o:"},{"type":"toolCall","toolCallId":"toolu_01S1YDr22asN2Pus6sfZwZzw","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/bao_cao.py\n+++ nhakhoaso/database/bao_cao.py\n@@ -0,0 +1,753 @@\n+import sqlite3\n+import json\n+from datetime import datetime, timedelta\n+import calendar\n+\n+def get_connection():\n+    conn = sqlite3.connect('nhakhoaso.db')\n+    conn.row_factory = sqlite3.Row\n+    return conn\n+\n+def get_tong_quan_bao_cao():\n+    \"\"\"L·∫•y th√¥ng tin t·ªïng quan cho trang b√°o c√°o ch√≠nh\"\"\"\n+    conn = get_connection()\n+    cursor = conn.cursor()\n+    \n+    # L·∫•y t·ªïng s·ªë b·ªánh nh√¢n\n+    cursor.execute(\"SELECT COUNT(*) as tong_benh_nhan FROM BENHNHAN\")\n+    tong_benh_nhan = cursor.fetchone()['tong_benh_nhan']\n+    \n+    # L·∫•y t·ªïng s·ªë d·ªãch v·ª•\n+    cursor.execute(\"SELECT COUNT(*) as tong_dich_vu FROM DICHVU\")\n+    tong_dich_vu = cursor.fetchone()['tong_dich_vu']\n+    \n+    # L·∫•y t·ªïng s·ªë l·ªãch h·∫πn\n+    cursor.execute(\"SELECT COUNT(*) as tong_lich_hen FROM LICHHEN\")\n+    tong_lich_hen = cursor.fetchone()['tong_lich_hen']\n+    \n+    # L·∫•y t·ªïng doanh thu\n+    cursor.execute(\"SELECT SUM(TongTien) as tong_doanh_thu FROM HOADON\")\n+    result = cursor.fetchone()\n+    tong_doanh_thu = result['tong_doanh_thu'] if result['tong_doanh_thu'] else 0\n+    \n+    # L·∫•y d·ªØ li·ªáu cho bi·ªÉu ƒë·ªì d·ªãch v·ª•\n+    cursor.execute(\"\"\"\n+        SELECT dv.TenDV, COUNT(pk.MaDV) as so_luong\n+        FROM DICHVU dv\n+        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        GROUP BY dv.MaDV\n+        ORDER BY so_luong DESC\n+        LIMIT 5\n+    \"\"\")\n+    dich_vu_data = cursor.fetchall()\n+    \n+    dich_vu_labels = [row['TenDV'] for row in dich_vu_data]\n+    dich_vu_values = [row['so_luong'] for row in dich_vu_data]\n+    \n+    # L·∫•y d·ªØ li·ªáu cho bi·ªÉu ƒë·ªì b·ªánh nh√¢n theo th√°ng\n+    current_year = datetime.now().year\n+    months = []\n+    benh_nhan_counts = []\n+    \n+    for month in range(1, 13):\n+        cursor.execute(\"\"\"\n+            SELECT COUNT(*) as count\n+            FROM BENHNHAN\n+            WHERE strftime('%Y', NgayTao) = ? AND strftime('%m', NgayTao) = ?\n+        \"\"\", (str(current_year), f\"{month:02d}\"))\n+        count = cursor.fetchone()['count']\n+        \n+        months.append(f\"Th√°ng {month}\")\n+        benh_nhan_counts.append(count)\n+    \n+    # L·∫•y d·ªØ li·ªáu cho bi·ªÉu ƒë·ªì doanh thu theo th√°ng\n+    doanh_thu_months = []\n+    doanh_thu_values = []\n+    \n+    for month in range(1, 13):\n+        cursor.execute(\"\"\"\n+            SELECT SUM(TongTien) as doanh_thu\n+            FROM HOADON\n+            WHERE strftime('%Y', NgayLap) = ? AND strftime('%m', NgayLap) = ?\n+        \"\"\", (str(current_year), f\"{month:02d}\"))\n+        result = cursor.fetchone()\n+        doanh_thu = result['doanh_thu'] if result['doanh_thu'] else 0\n+        \n+        doanh_thu_months.append(f\"Th√°ng {month}\")\n+        doanh_thu_values.append(doanh_thu)\n+    \n+    conn.close()\n+    \n+    return {\n+        'tong_benh_nhan': tong_benh_nhan,\n+        'tong_dich_vu': tong_dich_vu,\n+        'tong_lich_hen': tong_lich_hen,\n+        'tong_doanh_thu': tong_doanh_thu,\n+        'dich_vu_labels': json.dumps(dich_vu_labels),\n+        'dich_vu_data': json.dumps(dich_vu_values),\n+        'benh_nhan_labels': json.dumps(months),\n+        'benh_nhan_data': json.dumps(benh_nhan_counts),\n+        'doanh_thu_labels': json.dumps(doanh_thu_months),\n+        'doanh_thu_data': json.dumps(doanh_thu_values)\n+    }\n+\n+def get_bao_cao_dich_vu(tu_ngay=None, den_ngay=None):\n+    \"\"\"L·∫•y d·ªØ li·ªáu b√°o c√°o d·ªãch v·ª•\"\"\"\n+    conn = get_connection()\n+    cursor = conn.cursor()\n+    \n+    # N·∫øu kh√¥ng c√≥ ng√†y, l·∫•y d·ªØ li·ªáu c·ªßa th√°ng hi·ªán t·∫°i\n+    if not tu_ngay or not den_ngay:\n+        today = datetime.now()\n+        first_day = datetime(today.year, today.month, 1).strftime('%Y-%m-%d')\n+        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)[1]).strftime('%Y-%m-%d')\n+        tu_ngay = first_day\n+        den_ngay = last_day\n+    \n+    # L·∫•y danh s√°ch d·ªãch v·ª• v√† s·ªë l∆∞·ª£ng s·ª≠ d·ª•ng\n+    cursor.execute(\"\"\"\n+        SELECT dv.MaDV, dv.TenDV, dv.Gia, COUNT(pk.MaDV) as SoLuong, \n+               SUM(dv.Gia) as DoanhThu\n+        FROM DICHVU dv\n+        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        LEFT JOIN HOADON hd ON pk.MaPK = hd.MaPK\n+        WHERE hd.NgayLap BETWEEN ? AND ?\n+        GROUP BY dv.MaDV\n+        ORDER BY SoLuong DESC\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    dich_vu_list = []\n+    tong_so_luong = 0\n+    tong_doanh_thu = 0\n+    \n+    for row in cursor.fetchall():\n+        so_luong = row['SoLuong'] if row['SoLuong'] else 0\n+        doanh_thu = row['DoanhThu'] if row['DoanhThu'] else 0\n+        \n+        tong_so_luong += so_luong\n+        tong_doanh_thu += doanh_thu\n+        \n+        dich_vu_list.append({\n+            'MaDV': row['MaDV'],\n+            'TenDV': row['TenDV'],\n+            'Gia': row['Gia'],\n+            'SoLuong': so_luong,\n+            'DoanhThu': doanh_thu,\n+            'TyLe': 0  # S·∫Ω t√≠nh sau khi c√≥ t·ªïng\n+        })\n+    \n+    # T√≠nh t·ª∑ l·ªá cho t·ª´ng d·ªãch v·ª•\n+    for dv in dich_vu_list:\n+        if tong_doanh_thu > 0:\n+            dv['TyLe'] = (dv['DoanhThu'] / tong_doanh_thu) * 100\n+        else:\n+            dv['TyLe'] = 0\n+    \n+    # L·∫•y d·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t\n+    dich_vu_pho_bien = dich_vu_list[0]['TenDV'] if dich_vu_list else \"Kh√¥ng c√≥ d·ªØ li·ªáu\"\n+    \n+    # Chu·∫©n b·ªã d·ªØ li·ªáu cho bi·ªÉu ƒë·ªì\n+    dich_vu_labels = [dv['TenDV'] for dv in dich_vu_list]\n+    dich_vu_data = [dv['SoLuong'] for dv in dich_vu_list]\n+    doanh_thu_data = [dv['DoanhThu'] for dv in dich_vu_list]\n+    \n+    conn.close()\n+    \n+    return {\n+        'tu_ngay': tu_ngay,\n+        'den_ngay': den_ngay,\n+        'dich_vu_list': dich_vu_list,\n+        'tong_dich_vu': len(dich_vu_list),\n+        'tong_so_luong': tong_so_luong,\n+        'tong_doanh_thu': tong_doanh_thu,\n+        'dich_vu_pho_bien': dich_vu_pho_bien,\n+        'dich_vu_labels': json.dumps(dich_vu_labels),\n+        'dich_vu_data': json.dumps(dich_vu_data),\n+        'doanh_thu_data': json.dumps(doanh_thu_data)\n+    }\n+\n+def get_bao_cao_benh_nhan(tu_ngay=None, den_ngay=None, loai_bao_cao='all'):\n+    \"\"\"L·∫•y d·ªØ li·ªáu b√°o c√°o b·ªánh nh√¢n\"\"\"\n+    conn = get_connection()\n+    cursor = conn.cursor()\n+    \n+    # N·∫øu kh√¥ng c√≥ ng√†y, l·∫•y d·ªØ li·ªáu c·ªßa th√°ng hi·ªán t·∫°i\n+    if not tu_ngay or not den_ngay:\n+        today = datetime.now()\n+        first_day = datetime(today.year, today.month, 1).strftime('%Y-%m-%d')\n+        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)[1]).strftime('%Y-%m-%d')\n+        tu_ngay = first_day\n+        den_ngay = last_day\n+    \n+    # L·∫•y t·ªïng s·ªë b·ªánh nh√¢n\n+    if loai_bao_cao == 'new':\n+        cursor.execute(\"\"\"\n+            SELECT COUNT(*) as tong_benh_nhan\n+            FROM BENHNHAN\n+            WHERE NgayTao BETWEEN ? AND ?\n+        \"\"\", (tu_ngay, den_ngay))\n+    else:\n+        cursor.execute(\"\"\"\n+            SELECT COUNT(DISTINCT bn.MaBN) as tong_benh_nhan\n+            FROM BENHNHAN bn\n+            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+            WHERE pk.NgayKham BETWEEN ? AND ?\n+        \"\"\", (tu_ngay, den_ngay))\n+    \n+    tong_benh_nhan = cursor.fetchone()['tong_benh_nhan']\n+    \n+    # L·∫•y s·ªë b·ªánh nh√¢n m·ªõi (ƒëƒÉng k√Ω trong kho·∫£ng th·ªùi gian)\n+    cursor.execute(\"\"\"\n+        SELECT COUNT(*) as benh_nhan_moi\n+        FROM BENHNHAN\n+        WHERE NgayTao BETWEEN ? AND ?\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    benh_nhan_moi = cursor.fetchone()['benh_nhan_moi']\n+    \n+    # L·∫•y s·ªë b·ªánh nh√¢n quay l·∫°i (ƒë√£ ƒëƒÉng k√Ω tr∆∞·ªõc kho·∫£ng th·ªùi gian nh∆∞ng c√≥ kh√°m trong kho·∫£ng th·ªùi gian)\n+    cursor.execute(\"\"\"\n+        SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai\n+        FROM BENHNHAN bn\n+        JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+        WHERE pk.NgayKham BETWEEN ? AND ?\n+        AND bn.NgayTao < ?\n+    \"\"\", (tu_ngay, den_ngay, tu_ngay))\n+    \n+    benh_nhan_quay_lai = cursor.fetchone()['benh_nhan_quay_lai']\n+    \n+    # T√≠nh t·ª∑ l·ªá quay l·∫°i\n+    ty_le_quay_lai = 0\n+    if tong_benh_nhan > 0:\n+        ty_le_quay_lai = (benh_nhan_quay_lai / tong_benh_nhan) * 100\n+    \n+    # L·∫•y d·ªØ li·ªáu b·ªánh nh√¢n theo th·ªùi gian (theo tu·∫ßn)\n+    start_date = datetime.strptime(tu_ngay, '%Y-%m-%d')\n+    end_date = datetime.strptime(den_ngay, '%Y-%m-%d')\n+    \n+    benh_nhan_theo_thoi_gian = []\n+    thoi_gian_labels = []\n+    tong_so_data = []\n+    benh_nhan_moi_data = []\n+    benh_nhan_quay_lai_data = []\n+    \n+    # Chia th√†nh c√°c kho·∫£ng th·ªùi gian (tu·∫ßn ho·∫∑c th√°ng t√πy thu·ªôc v√†o kho·∫£ng th·ªùi gian)\n+    delta = (end_date - start_date).days\n+    \n+    if delta <= 31:  # N·∫øu kho·∫£ng th·ªùi gian <= 1 th√°ng, chia theo ng√†y\n+        current_date = start_date\n+        while current_date <= end_date:\n+            date_str = current_date.strftime('%Y-%m-%d')\n+            next_date = current_date + timedelta(days=1)\n+            \n+            # L·∫•y t·ªïng s·ªë b·ªánh nh√¢n trong ng√†y\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(DISTINCT bn.MaBN) as tong_so\n+                FROM BENHNHAN bn\n+                LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+                WHERE pk.NgayKham = ?\n+            \"\"\", (date_str,))\n+            tong_so = cursor.fetchone()['tong_so']\n+            \n+            # L·∫•y s·ªë b·ªánh nh√¢n m·ªõi trong ng√†y\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as benh_nhan_moi\n+                FROM BENHNHAN\n+                WHERE NgayTao = ?\n+            \"\"\", (date_str,))\n+            bn_moi = cursor.fetchone()['benh_nhan_moi']\n+            \n+            # L·∫•y s·ªë b·ªánh nh√¢n quay l·∫°i trong ng√†y\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai\n+                FROM BENHNHAN bn\n+                JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+                WHERE pk.NgayKham = ?\n+                AND bn.NgayTao < ?\n+            \"\"\", (date_str, date_str))\n+            bn_quay_lai = cursor.fetchone()['benh_nhan_quay_lai']\n+            \n+            # T√≠nh t·ª∑ l·ªá quay l·∫°i\n+            ty_le = 0\n+            if tong_so > 0:\n+                ty_le = (bn_quay_lai / tong_so) * 100\n+            \n+            benh_nhan_theo_thoi_gian.append({\n+                'ThoiGian': current_date.strftime('%d/%m/%Y'),\n+                'TongSo': tong_so,\n+                'BenhNhanMoi': bn_moi,\n+                'BenhNhanQuayLai': bn_quay_lai,\n+                'TyLeQuayLai': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(current_date.strftime('%d/%m'))\n+            tong_so_data.append(tong_so)\n+            benh_nhan_moi_data.append(bn_moi)\n+            benh_nhan_quay_lai_data.append(bn_quay_lai)\n+            \n+            current_date = next_date\n+    else:  # N·∫øu kho·∫£ng th·ªùi gian > 1 th√°ng, chia theo tu·∫ßn\n+        current_date = start_date\n+        week_num = 1\n+        \n+        while current_date <= end_date:\n+            week_end = min(current_date + timedelta(days=6), end_date)\n+            week_start_str = current_date.strftime('%Y-%m-%d')\n+            week_end_str = week_end.strftime('%Y-%m-%d')\n+            \n+            # L·∫•y t·ªïng s·ªë b·ªánh nh√¢n trong tu·∫ßn\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(DISTINCT bn.MaBN) as tong_so\n+                FROM BENHNHAN bn\n+                LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+                WHERE pk.NgayKham BETWEEN ? AND ?\n+            \"\"\", (week_start_str, week_end_str))\n+            tong_so = cursor.fetchone()['tong_so']\n+            \n+            # L·∫•y s·ªë b·ªánh nh√¢n m·ªõi trong tu·∫ßn\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as benh_nhan_moi\n+                FROM BENHNHAN\n+                WHERE NgayTao BETWEEN ? AND ?\n+            \"\"\", (week_start_str, week_end_str))\n+            bn_moi = cursor.fetchone()['benh_nhan_moi']\n+            \n+            # L·∫•y s·ªë b·ªánh nh√¢n quay l·∫°i trong tu·∫ßn\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai\n+                FROM BENHNHAN bn\n+                JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+                WHERE pk.NgayKham BETWEEN ? AND ?\n+                AND bn.NgayTao < ?\n+            \"\"\", (week_start_str, week_end_str, week_start_str))\n+            bn_quay_lai = cursor.fetchone()['benh_nhan_quay_lai']\n+            \n+            # T√≠nh t·ª∑ l·ªá quay l·∫°i\n+            ty_le = 0\n+            if tong_so > 0:\n+                ty_le = (bn_quay_lai / tong_so) * 100\n+            \n+            benh_nhan_theo_thoi_gian.append({\n+                'ThoiGian': f\"Tu·∫ßn {week_num} ({current_date.strftime('%d/%m')} - {week_end.strftime('%d/%m')})\",\n+                'TongSo': tong_so,\n+                'BenhNhanMoi': bn_moi,\n+                'BenhNhanQuayLai': bn_quay_lai,\n+                'TyLeQuayLai': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(f\"Tu·∫ßn {week_num}\")\n+            tong_so_data.append(tong_so)\n+            benh_nhan_moi_data.append(bn_moi)\n+            benh_nhan_quay_lai_data.append(bn_quay_lai)\n+            \n+            current_date = week_end + timedelta(days=1)\n+            week_num += 1\n+    \n+    # L·∫•y ph√¢n b·ªë b·ªánh nh√¢n theo ƒë·ªô tu·ªïi\n+    cursor.execute(\"\"\"\n+        SELECT \n+            CASE \n+                WHEN (strftime('%Y', 'now') - strftime('%Y', NgaySinh)) < 18 THEN 'D∆∞·ªõi 18 tu·ªïi'\n+                WHEN (strftime('%Y', 'now') - strftime('%Y', NgaySinh)) BETWEEN 18 AND 30 THEN '18-30 tu·ªïi'\n+                WHEN (strftime('%Y', 'now') - strftime('%Y', NgaySinh)) BETWEEN 31 AND 45 THEN '31-45 tu·ªïi'\n+                WHEN (strftime('%Y', 'now') - strftime('%Y', NgaySinh)) BETWEEN 46 AND 60 THEN '46-60 tu·ªïi'\n+                ELSE 'Tr√™n 60 tu·ªïi'\n+            END as NhomTuoi,\n+            COUNT(*) as SoLuong\n+        FROM BENHNHAN\n+        WHERE MaBN IN (\n+            SELECT DISTINCT bn.MaBN\n+            FROM BENHNHAN bn\n+            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+            WHERE pk.NgayKham BETWEEN ? AND ?\n+        )\n+        GROUP BY NhomTuoi\n+        ORDER BY \n+            CASE NhomTuoi\n+                WHEN 'D∆∞·ªõi 18 tu·ªïi' THEN 1\n+                WHEN '18-30 tu·ªïi' THEN 2\n+                WHEN '31-45 tu·ªïi' THEN 3\n+                WHEN '46-60 tu·ªïi' THEN 4\n+                WHEN 'Tr√™n 60 tu·ªïi' THEN 5\n+            END\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    benh_nhan_theo_tuoi = []\n+    nhom_tuoi_labels = []\n+    nhom_tuoi_data = []\n+    \n+    for row in cursor.fetchall():\n+        ty_le = 0\n+        if tong_benh_nhan > 0:\n+            ty_le = (row['SoLuong'] / tong_benh_nhan) * 100\n+        \n+        benh_nhan_theo_tuoi.append({\n+            'NhomTuoi': row['NhomTuoi'],\n+            'SoLuong': row['SoLuong'],\n+            'TyLe': ty_le\n+        })\n+        \n+        nhom_tuoi_labels.append(row['NhomTuoi'])\n+        nhom_tuoi_data.append(row['SoLuong'])\n+    \n+    # L·∫•y ph√¢n b·ªë b·ªánh nh√¢n theo gi·ªõi t√≠nh\n+    cursor.execute(\"\"\"\n+        SELECT \n+            CASE \n+                WHEN GioiTinh = 1 THEN 'Nam'\n+                WHEN GioiTinh = 0 THEN 'N·ªØ'\n+                ELSE 'Kh√°c'\n+            END as GioiTinh,\n+            COUNT(*) as SoLuong\n+        FROM BENHNHAN\n+        WHERE MaBN IN (\n+            SELECT DISTINCT bn.MaBN\n+            FROM BENHNHAN bn\n+            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN\n+            WHERE pk.NgayKham BETWEEN ? AND ?\n+        )\n+        GROUP BY GioiTinh\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    benh_nhan_theo_gioi_tinh = []\n+    gioi_tinh_labels = []\n+    gioi_tinh_data = []\n+    \n+    for row in cursor.fetchall():\n+        ty_le = 0\n+        if tong_benh_nhan > 0:\n+            ty_le = (row['SoLuong'] / tong_benh_nhan) * 100\n+        \n+        benh_nhan_theo_gioi_tinh.append({\n+            'GioiTinh': row['GioiTinh'],\n+            'SoLuong': row['SoLuong'],\n+            'TyLe': ty_le\n+        })\n+        \n+        gioi_tinh_labels.append(row['GioiTinh'])\n+        gioi_tinh_data.append(row['SoLuong'])\n+    \n+    conn.close()\n+    \n+    return {\n+        'tu_ngay': tu_ngay,\n+        'den_ngay': den_ngay,\n+        'loai_bao_cao': loai_bao_cao,\n+        'tong_benh_nhan': tong_benh_nhan,\n+        'benh_nhan_moi': benh_nhan_moi,\n+        'benh_nhan_quay_lai': benh_nhan_quay_lai,\n+        'ty_le_quay_lai': ty_le_quay_lai,\n+        'benh_nhan_theo_thoi_gian': benh_nhan_theo_thoi_gian,\n+        'benh_nhan_theo_tuoi': benh_nhan_theo_tuoi,\n+        'benh_nhan_theo_gioi_tinh': benh_nhan_theo_gioi_tinh,\n+        'thoi_gian_labels': json.dumps(thoi_gian_labels),\n+        'tong_so_data': json.dumps(tong_so_data),\n+        'benh_nhan_moi_data': json.dumps(benh_nhan_moi_data),\n+        'benh_nhan_quay_lai_data': json.dumps(benh_nhan_quay_lai_data),\n+        'nhom_tuoi_labels': json.dumps(nhom_tuoi_labels),\n+        'nhom_tuoi_data': json.dumps(nhom_tuoi_data),\n+        'gioi_tinh_labels': json.dumps(gioi_tinh_labels),\n+        'gioi_tinh_data': json.dumps(gioi_tinh_data)\n+    }\n+\n+def get_bao_cao_doanh_thu(tu_ngay=None, den_ngay=None, loai_bao_cao='day'):\n+    \"\"\"L·∫•y d·ªØ li·ªáu b√°o c√°o doanh thu\"\"\"\n+    conn = get_connection()\n+    cursor = conn.cursor()\n+    \n+    # N·∫øu kh√¥ng c√≥ ng√†y, l·∫•y d·ªØ li·ªáu c·ªßa th√°ng hi·ªán t·∫°i\n+    if not tu_ngay or not den_ngay:\n+        today = datetime.now()\n+        first_day = datetime(today.year, today.month, 1).strftime('%Y-%m-%d')\n+        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)[1]).strftime('%Y-%m-%d')\n+        tu_ngay = first_day\n+        den_ngay = last_day\n+    \n+    # L·∫•y t·ªïng doanh thu\n+    cursor.execute(\"\"\"\n+        SELECT SUM(TongTien) as tong_doanh_thu\n+        FROM HOADON\n+        WHERE NgayLap BETWEEN ? AND ?\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    result = cursor.fetchone()\n+    tong_doanh_thu = result['tong_doanh_thu'] if result['tong_doanh_thu'] else 0\n+    \n+    # L·∫•y t·ªïng s·ªë h√≥a ƒë∆°n\n+    cursor.execute(\"\"\"\n+        SELECT COUNT(*) as tong_hoa_don\n+        FROM HOADON\n+        WHERE NgayLap BETWEEN ? AND ?\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    tong_hoa_don = cursor.fetchone()['tong_hoa_don']\n+    \n+    # T√≠nh doanh thu trung b√¨nh\n+    doanh_thu_trung_binh = 0\n+    if tong_hoa_don > 0:\n+        doanh_thu_trung_binh = tong_doanh_thu / tong_hoa_don\n+    \n+    # L·∫•y doanh thu cao nh·∫•t\n+    cursor.execute(\"\"\"\n+        SELECT MAX(TongTien) as doanh_thu_cao_nhat\n+        FROM HOADON\n+        WHERE NgayLap BETWEEN ? AND ?\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    result = cursor.fetchone()\n+    doanh_thu_cao_nhat = result['doanh_thu_cao_nhat'] if result['doanh_thu_cao_nhat'] else 0\n+    \n+    # L·∫•y doanh thu theo th·ªùi gian\n+    doanh_thu_theo_thoi_gian = []\n+    thoi_gian_labels = []\n+    doanh_thu_data = []\n+    \n+    # Format th·ªùi gian theo lo·∫°i b√°o c√°o\n+    if loai_bao_cao == 'day':\n+        # B√°o c√°o theo ng√†y\n+        start_date = datetime.strptime(tu_ngay, '%Y-%m-%d')\n+        end_date = datetime.strptime(den_ngay, '%Y-%m-%d')\n+        \n+        current_date = start_date\n+        while current_date <= end_date:\n+            date_str = current_date.strftime('%Y-%m-%d')\n+            \n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu\n+                FROM HOADON\n+                WHERE date(NgayLap) = ?\n+            \"\"\", (date_str,))\n+            \n+            row = cursor.fetchone()\n+            so_luong = row['so_luong'] if row['so_luong'] else 0\n+            doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+            \n+            ty_le = 0\n+            if tong_doanh_thu > 0:\n+                ty_le = (doanh_thu / tong_doanh_thu) * 100\n+            \n+            doanh_thu_theo_thoi_gian.append({\n+                'ThoiGian': current_date.strftime('%d/%m/%Y'),\n+                'SoLuongHoaDon': so_luong,\n+                'DoanhThu': doanh_thu,\n+                'TyLe': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(current_date.strftime('%d/%m'))\n+            doanh_thu_data.append(doanh_thu)\n+            \n+            current_date += timedelta(days=1)\n+    \n+    elif loai_bao_cao == 'month':\n+        # B√°o c√°o theo th√°ng\n+        start_date = datetime.strptime(tu_ngay, '%Y-%m-%d')\n+        end_date = datetime.strptime(den_ngay, '%Y-%m-%d')\n+        \n+        # L·∫•y th√°ng ƒë·∫ßu ti√™n v√† cu·ªëi c√πng\n+        start_month = start_date.replace(day=1)\n+        end_month = end_date.replace(day=1)\n+        \n+        current_month = start_month\n+        while current_month <= end_month:\n+            month_start = current_month.strftime('%Y-%m-%d')\n+            last_day = calendar.monthrange(current_month.year, current_month.month)[1]\n+            month_end = current_month.replace(day=last_day).strftime('%Y-%m-%d')\n+            \n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu\n+                FROM HOADON\n+                WHERE date(NgayLap) BETWEEN ? AND ?\n+            \"\"\", (month_start, month_end))\n+            \n+            row = cursor.fetchone()\n+            so_luong = row['so_luong'] if row['so_luong'] else 0\n+            doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+            \n+            ty_le = 0\n+            if tong_doanh_thu > 0:\n+                ty_le = (doanh_thu / tong_doanh_thu) * 100\n+            \n+            doanh_thu_theo_thoi_gian.append({\n+                'ThoiGian': f\"Th√°ng {current_month.month}/{current_month.year}\",\n+                'SoLuongHoaDon': so_luong,\n+                'DoanhThu': doanh_thu,\n+                'TyLe': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(f\"T{current_month.month}/{current_month.year}\")\n+            doanh_thu_data.append(doanh_thu)\n+            \n+            # Chuy·ªÉn sang th√°ng ti·∫øp theo\n+            if current_month.month == 12:\n+                current_month = current_month.replace(year=current_month.year + 1, month=1)\n+            else:\n+                current_month = current_month.replace(month=current_month.month + 1)\n+    \n+    elif loai_bao_cao == 'quarter':\n+        # B√°o c√°o theo qu√Ω\n+        start_date = datetime.strptime(tu_ngay, '%Y-%m-%d')\n+        end_date = datetime.strptime(den_ngay, '%Y-%m-%d')\n+        \n+        # L·∫•y qu√Ω ƒë·∫ßu ti√™n v√† cu·ªëi c√πng\n+        start_quarter = (start_date.month - 1) // 3 + 1\n+        start_year = start_date.year\n+        \n+        end_quarter = (end_date.month - 1) // 3 + 1\n+        end_year = end_date.year\n+        \n+        current_year = start_year\n+        current_quarter = start_quarter\n+        \n+        while current_year < end_year or (current_year == end_year and current_quarter <= end_quarter):\n+            quarter_start_month = (current_quarter - 1) * 3 + 1\n+            quarter_end_month = quarter_start_month + 2\n+            \n+            quarter_start = datetime(current_year, quarter_start_month, 1).strftime('%Y-%m-%d')\n+            quarter_end = datetime(current_year, quarter_end_month, calendar.monthrange(current_year, quarter_end_month)[1]).strftime('%Y-%m-%d')\n+            \n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu\n+                FROM HOADON\n+                WHERE date(NgayLap) BETWEEN ? AND ?\n+            \"\"\", (quarter_start, quarter_end))\n+            \n+            row = cursor.fetchone()\n+            so_luong = row['so_luong'] if row['so_luong'] else 0\n+            doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+            \n+            ty_le = 0\n+            if tong_doanh_thu > 0:\n+                ty_le = (doanh_thu / tong_doanh_thu) * 100\n+            \n+            doanh_thu_theo_thoi_gian.append({\n+                'ThoiGian': f\"Qu√Ω {current_quarter}/{current_year}\",\n+                'SoLuongHoaDon': so_luong,\n+                'DoanhThu': doanh_thu,\n+                'TyLe': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(f\"Q{current_quarter}/{current_year}\")\n+            doanh_thu_data.append(doanh_thu)\n+            \n+            # Chuy·ªÉn sang qu√Ω ti·∫øp theo\n+            current_quarter += 1\n+            if current_quarter > 4:\n+                current_quarter = 1\n+                current_year += 1\n+    \n+    elif loai_bao_cao == 'year':\n+        # B√°o c√°o theo nƒÉm\n+        start_date = datetime.strptime(tu_ngay, '%Y-%m-%d')\n+        end_date = datetime.strptime(den_ngay, '%Y-%m-%d')\n+        \n+        start_year = start_date.year\n+        end_year = end_date.year\n+        \n+        for year in range(start_year, end_year + 1):\n+            year_start = datetime(year, 1, 1).strftime('%Y-%m-%d')\n+            year_end = datetime(year, 12, 31).strftime('%Y-%m-%d')\n+            \n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu\n+                FROM HOADON\n+                WHERE date(NgayLap) BETWEEN ? AND ?\n+            \"\"\", (year_start, year_end))\n+            \n+            row = cursor.fetchone()\n+            so_luong = row['so_luong'] if row['so_luong'] else 0\n+            doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+            \n+            ty_le = 0\n+            if tong_doanh_thu > 0:\n+                ty_le = (doanh_thu / tong_doanh_thu) * 100\n+            \n+            doanh_thu_theo_thoi_gian.append({\n+                'ThoiGian': f\"NƒÉm {year}\",\n+                'SoLuongHoaDon': so_luong,\n+                'DoanhThu': doanh_thu,\n+                'TyLe': ty_le\n+            })\n+            \n+            thoi_gian_labels.append(str(year))\n+            doanh_thu_data.append(doanh_thu)\n+    \n+    # L·∫•y doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n\n+    cursor.execute(\"\"\"\n+        SELECT PhuongThucThanhToan, COUNT(*) as so_luong, SUM(TongTien) as doanh_thu\n+        FROM HOADON\n+        WHERE NgayLap BETWEEN ? AND ?\n+        GROUP BY PhuongThucThanhToan\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    doanh_thu_theo_pttt = []\n+    pttt_labels = []\n+    pttt_data = []\n+    \n+    for row in cursor.fetchall():\n+        doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+        \n+        ty_le = 0\n+        if tong_doanh_thu > 0:\n+            ty_le = (doanh_thu / tong_doanh_thu) * 100\n+        \n+        doanh_thu_theo_pttt.append({\n+            'PhuongThucThanhToan': row['PhuongThucThanhToan'],\n+            'SoLuongHoaDon': row['so_luong'],\n+            'DoanhThu': doanh_thu,\n+            'TyLe': ty_le\n+        })\n+        \n+        pttt_labels.append(row['PhuongThucThanhToan'])\n+        pttt_data.append(doanh_thu)\n+    \n+    # L·∫•y doanh thu theo d·ªãch v·ª•\n+    cursor.execute(\"\"\"\n+        SELECT dv.MaDV, dv.TenDV, COUNT(pk.MaDV) as so_luong, SUM(hd.TongTien) as doanh_thu\n+        FROM DICHVU dv\n+        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        JOIN HOADON hd ON pk.MaPK = hd.MaPK\n+        WHERE hd.NgayLap BETWEEN ? AND ?\n+        GROUP BY dv.MaDV\n+        ORDER BY doanh_thu DESC\n+    \"\"\", (tu_ngay, den_ngay))\n+    \n+    doanh_thu_theo_dich_vu = []\n+    tong_so_luong_dich_vu = 0\n+    \n+    for row in cursor.fetchall():\n+        so_luong = row['so_luong'] if row['so_luong'] else 0\n+        doanh_thu = row['doanh_thu'] if row['doanh_thu'] else 0\n+        \n+        tong_so_luong_dich_vu += so_luong\n+        \n+        ty_le = 0\n+        if tong_doanh_thu > 0:\n+            ty_le = (doanh_thu / tong_doanh_thu) * 100\n+        \n+        doanh_thu_theo_dich_vu.append({\n+            'MaDV': row['MaDV'],\n+            'TenDV': row['TenDV'],\n+            'SoLuong': so_luong,\n+            'DoanhThu': doanh_thu,\n+            'TyLe': ty_le\n+        })\n+    \n+    conn.close()\n+    \n+    return {\n+        'tu_ngay': tu_ngay,\n+        'den_ngay': den_ngay,\n+        'loai_bao_cao': loai_bao_cao,\n+        'tong_doanh_thu': tong_doanh_thu,\n+        'tong_hoa_don': tong_hoa_don,\n+        'doanh_thu_trung_binh': doanh_thu_trung_binh,\n+        'doanh_thu_cao_nhat': doanh_thu_cao_nhat,\n+        'doanh_thu_theo_thoi_gian': doanh_thu_theo_thoi_gian,\n+        'doanh_thu_theo_pttt': doanh_thu_theo_pttt,\n+        'doanh_thu_theo_dich_vu': doanh_thu_theo_dich_vu,\n+        'tong_so_luong_dich_vu': tong_so_luong_dich_vu,\n+        'thoi_gian_labels': json.dumps(thoi_gian_labels),\n+        'doanh_thu_data': json.dumps(doanh_thu_data),\n+        'pttt_labels': json.dumps(pttt_labels),\n+        'pttt_data': json.dumps(pttt_data)\n+    }","refToolCallId":"toolu_01S1YDr22asN2Pus6sfZwZzw"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i s·∫Ω c·∫≠p nh·∫≠t file app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng b√°o c√°o:"},{"type":"toolCall","toolCallId":"toolu_01Fv62V5bZvHxib1cpEQbhXa","isHidden":false,"title":"","statusText":"Retrieved context","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/test/app.py","path":"test/app.py","displayPath":"test/app.py"},{"fsPath":"/home/huong/insert/app.py","path":"insert/app.py","displayPath":"insert/app.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/2d4a354c/HTbT.py","path":".vscode-server/data/User/History/2d4a354c/HTbT.py","displayPath":".vscode-server/data/User/History/2d4a354c/HTbT.py"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω c·∫≠p nh·∫≠t file app.py ƒë·ªÉ th√™m c√°c route cho ch·ª©c nƒÉng b√°o c√°o:"},{"type":"toolCall","toolCallId":"toolu_0169nJsyzwVH8xEJG7HhHk8X","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -405,7 +405,44 @@\n # B√°o c√°o v√† th·ªëng k√™\n @app.route('/bao-cao')\n def bao_cao():\n-    return render_template('bao_cao.html')\n+    from database.bao_cao import get_tong_quan_bao_cao\n+    data = get_tong_quan_bao_cao()\n+    return render_template('bao_cao.html', **data)\n+\n+# B√°o c√°o d·ªãch v·ª•\n+@app.route('/bao-cao/dich-vu', methods=['GET', 'POST'])\n+def bao_cao_dich_vu():\n+    from database.bao_cao import get_bao_cao_dich_vu\n+    \n+    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n+    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n+    \n+    data = get_bao_cao_dich_vu(tu_ngay, den_ngay)\n+    return render_template('bao_cao_dich_vu.html', **data)\n+\n+# B√°o c√°o b·ªánh nh√¢n\n+@app.route('/bao-cao/benh-nhan', methods=['GET', 'POST'])\n+def bao_cao_benh_nhan():\n+    from database.bao_cao import get_bao_cao_benh_nhan\n+    \n+    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n+    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n+    loai_bao_cao = request.form.get('loai_bao_cao', 'all') if request.method == 'POST' else 'all'\n+    \n+    data = get_bao_cao_benh_nhan(tu_ngay, den_ngay, loai_bao_cao)\n+    return render_template('bao_cao_benh_nhan.html', **data)\n+\n+# B√°o c√°o doanh thu\n+@app.route('/bao-cao/doanh-thu', methods=['GET', 'POST'])\n+def bao_cao_doanh_thu():\n+    from database.bao_cao import get_bao_cao_doanh_thu\n+    \n+    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n+    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n+    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'\n+    \n+    data = get_bao_cao_doanh_thu(tu_ngay, den_ngay, loai_bao_cao)\n+    return render_template('bao_cao_doanh_thu.html', **data)\n \n # API endpoints\n @app.route('/api/benh-nhan/<ma_bn>', methods=['GET'])","refToolCallId":"toolu_0169nJsyzwVH8xEJG7HhHk8X"},{"type":"text","text":"T√¥i ƒë√£ ho√†n th√†nh vi·ªác t·∫°o ch·ª©c nƒÉng b√°o c√°o v√† th·ªëng k√™ v·ªõi 3 ch·ª©c nƒÉng nh·ªè nh∆∞ b·∫°n y√™u c·∫ßu. D∆∞·ªõi ƒë√¢y l√† t·ªïng quan v·ªÅ nh·ªØng g√¨ ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai:\n\n## Ch·ª©c nƒÉng B√°o c√°o v√† Th·ªëng k√™\n\n### 1. T·ªïng quan\n\nT√¥i ƒë√£ t·∫°o m·ªôt trang t·ªïng quan b√°o c√°o hi·ªÉn th·ªã c√°c th√¥ng tin ch√≠nh v·ªÅ ho·∫°t ƒë·ªông c·ªßa ph√≤ng kh√°m, bao g·ªìm:\n- T·ªïng s·ªë b·ªánh nh√¢n\n- T·ªïng s·ªë d·ªãch v·ª•\n- T·ªïng s·ªë l·ªãch h·∫πn\n- T·ªïng doanh thu\n- Bi·ªÉu ƒë·ªì t√≥m t·∫Øt cho t·ª´ng lo·∫°i b√°o c√°o\n\n### 2. B√°o c√°o s·ªë l∆∞·ª£ng d·ªãch v·ª•\n\nCh·ª©c nƒÉng n√†y cho ph√©p xem th·ªëng k√™ v·ªÅ c√°c d·ªãch v·ª• ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong m·ªôt kho·∫£ng th·ªùi gian, bao g·ªìm:\n- T·ªïng s·ªë d·ªãch v·ª•\n- D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t\n- T·ªïng doanh thu t·ª´ d·ªãch v·ª•\n- Bi·ªÉu ƒë·ªì t·ª∑ l·ªá s·ª≠ d·ª•ng d·ªãch v·ª•\n- Bi·ªÉu ƒë·ªì doanh thu theo d·ªãch v·ª•\n- B·∫£ng chi ti·∫øt v·ªõi th√¥ng tin v·ªÅ s·ªë l∆∞·ª£ng, doanh thu v√† t·ª∑ l·ªá c·ªßa t·ª´ng d·ªãch v·ª•\n\n### 3. B√°o c√°o s·ªë l∆∞·ª£ng b·ªánh nh√¢n\n\nCh·ª©c nƒÉng n√†y cho ph√©p xem th·ªëng k√™ v·ªÅ b·ªánh nh√¢n trong m·ªôt kho·∫£ng th·ªùi gian, bao g·ªìm:\n- T·ªïng s·ªë b·ªánh nh√¢n\n- S·ªë l∆∞·ª£ng b·ªánh nh√¢n m·ªõi v√† b·ªánh nh√¢n quay l·∫°i\n- T·ª∑ l·ªá quay l·∫°i c·ªßa b·ªánh nh√¢n\n- Bi·ªÉu ƒë·ªì ph√¢n lo·∫°i b·ªánh nh√¢n (m·ªõi/quay l·∫°i)\n- Bi·ªÉu ƒë·ªì xu h∆∞·ªõng b·ªánh nh√¢n theo th·ªùi gian\n- Bi·ªÉu ƒë·ªì ph√¢n b·ªë b·ªánh nh√¢n theo ƒë·ªô tu·ªïi\n- Bi·ªÉu ƒë·ªì ph√¢n b·ªë b·ªánh nh√¢n theo gi·ªõi t√≠nh\n- B·∫£ng chi ti·∫øt v·ªõi th√¥ng tin v·ªÅ s·ªë l∆∞·ª£ng b·ªánh nh√¢n theo th·ªùi gian, ƒë·ªô tu·ªïi v√† gi·ªõi t√≠nh\n\n### 4. B√°o c√°o doanh thu\n\nCh·ª©c nƒÉng n√†y cho ph√©p xem th·ªëng k√™ v·ªÅ doanh thu trong m·ªôt kho·∫£ng th·ªùi gian, bao g·ªìm:\n- T·ªïng doanh thu\n- S·ªë l∆∞·ª£ng h√≥a ƒë∆°n\n- Doanh thu trung b√¨nh\n- Doanh thu cao nh·∫•t\n- Bi·ªÉu ƒë·ªì doanh thu theo th·ªùi gian (ng√†y/th√°ng/qu√Ω/nƒÉm)\n- Bi·ªÉu ƒë·ªì doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n\n- B·∫£ng chi ti·∫øt doanh thu theo th·ªùi gian\n- B·∫£ng chi ti·∫øt doanh thu theo ph∆∞∆°ng th·ª©c thanh to√°n\n- B·∫£ng chi ti·∫øt doanh thu theo d·ªãch v·ª•\n\n## T√≠nh nƒÉng chung\n\nT·∫•t c·∫£ c√°c b√°o c√°o ƒë·ªÅu c√≥ c√°c t√≠nh nƒÉng sau:\n1. **L·ªçc theo th·ªùi gian**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªçn kho·∫£ng th·ªùi gian ƒë·ªÉ xem b√°o c√°o\n2. **In b√°o c√°o**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ in b√°o c√°o tr·ª±c ti·∫øp t·ª´ tr√¨nh duy·ªát\n3. **Xu·∫•t Excel**: Ng∆∞·ªùi d√πng c√≥ th·ªÉ xu·∫•t b√°o c√°o ra file Excel ƒë·ªÉ l∆∞u tr·ªØ ho·∫∑c x·ª≠ l√Ω th√™m\n4. **Bi·ªÉu ƒë·ªì tr·ª±c quan**: S·ª≠ d·ª•ng th∆∞ vi·ªán Chart.js ƒë·ªÉ hi·ªÉn th·ªã d·ªØ li·ªáu d∆∞·ªõi d·∫°ng bi·ªÉu ƒë·ªì\n5. **B·∫£ng chi ti·∫øt**: Hi·ªÉn th·ªã d·ªØ li·ªáu chi ti·∫øt d∆∞·ªõi d·∫°ng b·∫£ng\n\n## C·∫•u tr√∫c file\n\n1. **Templates**:\n   - `bao_cao.html`: Trang t·ªïng quan b√°o c√°o\n   - `bao_cao_dich_vu.html`: Trang b√°o c√°o d·ªãch v·ª•\n   - `bao_cao_benh_nhan.html`: Trang b√°o c√°o b·ªánh nh√¢n\n   - `bao_cao_doanh_thu.html`: Trang b√°o c√°o doanh thu\n\n2. **Module x·ª≠ l√Ω d·ªØ li·ªáu**:\n   - `database/bao_cao.py`: Ch·ª©a c√°c h√†m x·ª≠ l√Ω d·ªØ li·ªáu cho c√°c b√°o c√°o\n\n3. **Routes**:\n   - ƒê√£ th√™m c√°c route v√†o `app.py` ƒë·ªÉ x·ª≠ l√Ω c√°c y√™u c·∫ßu b√°o c√°o\n\n## H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng\n\n1. **Truy c·∫≠p ch·ª©c nƒÉng B√°o c√°o v√† Th·ªëng k√™**:\n   - T·ª´ trang ch·ªß, nh·∫•p v√†o \"B√°o c√°o v√† Th·ªëng k√™\"\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/bao-cao`\n\n2. **Xem b√°o c√°o d·ªãch v·ª•**:\n   - T·ª´ trang B√°o c√°o v√† Th·ªëng k√™, nh·∫•p v√†o \"B√°o c√°o d·ªãch v·ª•\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/bao-cao/dich-vu`\n   - Ch·ªçn kho·∫£ng th·ªùi gian v√† nh·∫•p v√†o \"L·ªçc\" ƒë·ªÉ xem b√°o c√°o\n   - C√≥ th·ªÉ in b√°o c√°o ho·∫∑c xu·∫•t ra Excel\n\n3. **Xem b√°o c√°o b·ªánh nh√¢n**:\n   - T·ª´ trang B√°o c√°o v√† Th·ªëng k√™, nh·∫•p v√†o \"B√°o c√°o b·ªánh nh√¢n\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/bao-cao/benh-nhan`\n   - Ch·ªçn kho·∫£ng th·ªùi gian, lo·∫°i b√°o c√°o v√† nh·∫•p v√†o \"L·ªçc\" ƒë·ªÉ xem b√°o c√°o\n   - C√≥ th·ªÉ in b√°o c√°o ho·∫∑c xu·∫•t ra Excel\n\n4. **Xem b√°o c√°o doanh thu**:\n   - T·ª´ trang B√°o c√°o v√† Th·ªëng k√™, nh·∫•p v√†o \"B√°o c√°o doanh thu\" ·ªü thanh sidebar b√™n tr√°i\n   - Ho·∫∑c truy c·∫≠p tr·ª±c ti·∫øp qua URL: `/bao-cao/doanh-thu`\n   - Ch·ªçn kho·∫£ng th·ªùi gian, lo·∫°i b√°o c√°o (ng√†y/th√°ng/qu√Ω/nƒÉm) v√† nh·∫•p v√†o \"L·ªçc\" ƒë·ªÉ xem b√°o c√°o\n   - C√≥ th·ªÉ in b√°o c√°o ho·∫∑c xu·∫•t ra Excel\n\n## L∆∞u √Ω\n\n- C√°c b√°o c√°o s·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ c∆° s·ªü d·ªØ li·ªáu hi·ªán c√≥, bao g·ªìm th√¥ng tin v·ªÅ b·ªánh nh√¢n, d·ªãch v·ª•, phi·∫øu kh√°m v√† h√≥a ƒë∆°n.\n- Bi·ªÉu ƒë·ªì ƒë∆∞·ª£c t·∫°o b·∫±ng th∆∞ vi·ªán Chart.js, m·ªôt th∆∞ vi·ªán JavaScript ph·ªï bi·∫øn ƒë·ªÉ t·∫°o bi·ªÉu ƒë·ªì t∆∞∆°ng t√°c.\n- Ch·ª©c nƒÉng xu·∫•t Excel s·ª≠ d·ª•ng th∆∞ vi·ªán SheetJS (xlsx) ƒë·ªÉ t·∫°o v√† t·∫£i xu·ªëng file Excel.\n- Giao di·ªán ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ ph√π h·ª£p v·ªõi giao di·ªán chung c·ªßa h·ªá th·ªëng, s·ª≠ d·ª•ng c√πng m·ªôt b·ªë c·ª•c v√† phong c√°ch.\n\nCh·ª©c nƒÉng B√°o c√°o v√† Th·ªëng k√™ ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai ƒë·∫ßy ƒë·ªß theo y√™u c·∫ßu, v·ªõi giao di·ªán th√¢n thi·ªán v√† d·ªÖ s·ª≠ d·ª•ng. Ng∆∞·ªùi d√πng c√≥ th·ªÉ d·ªÖ d√†ng xem, in v√† xu·∫•t c√°c b√°o c√°o ƒë·ªÉ ph·ª•c v·ª• cho vi·ªác qu·∫£n l√Ω ph√≤ng kh√°m."},{"type":"codePatch","diffs":[{"path":"nhakhoaso/templates/bao_cao_doanh_thu.html","patch":"@@ -0,0 +1,20882 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o doanh thu - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O V%C3%80 TH%E1%BB%90NG K%C3%8A%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E B%C3%A1o c%C3%A1o v%C3%A0 Th%E1%BB%91ng k%C3%AA%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-hand-holding-heart%22%3E%3C/i%3E B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E B%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-money-bill-wave%22%3E%3C/i%3E B%C3%A1o c%C3%A1o doanh thu%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EB%C3%A1o c%C3%A1o doanh thu%3C/h2%3E%0A            %3Cdiv class=%22header-actions%22%3E%0A                %3Cbutton class=%22btn btn-primary%22 id=%22printBtn%22%3E%0A                    %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A                %3C/button%3E%0A                %3Cbutton class=%22btn btn-secondary%22 id=%22exportBtn%22%3E%0A                    %3Ci class=%22fas fa-file-export%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A                %3C/button%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22filter-container%22%3E%0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22 class=%22filter-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_ngay%22%3ET%E1%BB%AB ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22tu_ngay%22 name=%22tu_ngay%22 value=%22%7B%7B tu_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22den_ngay%22%3E%C4%90%E1%BA%BFn ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22den_ngay%22 name=%22den_ngay%22 value=%22%7B%7B den_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22loai_bao_cao%22%3ELo%E1%BA%A1i b%C3%A1o c%C3%A1o%3C/label%3E%0A                    %3Cselect id=%22loai_bao_cao%22 name=%22loai_bao_cao%22%3E%0A                        %3Coption value=%22day%22 %7B%25 if loai_bao_cao == 'day' %25%7Dselected%7B%25 endif %25%7D%3ETheo ng%C3%A0y%3C/option%3E%0A                        %3Coption value=%22month%22 %7B%25 if loai_bao_cao == 'month' %25%7Dselected%7B%25 endif %25%7D%3ETheo th%C3%A1ng%3C/option%3E%0A                        %3Coption value=%22quarter%22 %7B%25 if loai_bao_cao == 'quarter' %25%7Dselected%7B%25 endif %25%7D%3ETheo qu%C3%BD%3C/option%3E%0A                        %3Coption value=%22year%22 %7B%25 if loai_bao_cao == 'year' %25%7Dselected%7B%25 endif %25%7D%3ETheo n%C4%83m%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E %C4%90%E1%BA%B7t l%E1%BA%A1i%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22report-container%22 id=%22reportContent%22%3E%0A            %3Cdiv class=%22report-header%22%3E%0A                %3Cdiv class=%22report-title%22%3E%0A                    %3Ch3%3EB%C3%81O C%C3%81O DOANH THU%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%3C/p%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-logo%22%3E%0A                    %3Cimg src=%22%7B%7B url_for('static', filename='images/tooth-logo.png') %7D%7D%22 alt=%22Logo NHAKHOASO%22 onerror=%22this.src='https://via.placeholder.com/50x50?text=%F0%9F%A6%B7'%22%3E%0A                    %3Ch4%3EPH%C3%92NG KH%C3%81M NHA KHOA NHAKHOASO%3C/h4%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22report-summary%22%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ET%E1%BB%95ng doanh thu:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng h%C3%B3a %C4%91%C6%A1n:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B tong_hoa_don %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3EDoanh thu trung b%C3%ACnh:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B %22%7B:,.0f%7D%22.format(doanh_thu_trung_binh) %7D%7D VN%C4%90%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3EDoanh thu cao nh%E1%BA%A5t:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B %22%7B:,.0f%7D%22.format(doanh_thu_cao_nhat) %7D%7D VN%C4%90%3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22chart-section%22%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22revenueChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22paymentMethodChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EChi ti%E1%BA%BFt doanh thu theo th%E1%BB%9Di gian%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3ETh%E1%BB%9Di gian%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                            %3Cth%3EDoanh thu%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in doanh_thu_theo_thoi_gian %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.ThoiGian %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.SoLuongHoaDon %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(item.DoanhThu) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%222%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_hoa_don %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EDoanh thu theo ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3EPh%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng h%C3%B3a %C4%91%C6%A1n%3C/th%3E%0A                            %3Cth%3EDoanh thu%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in doanh_thu_theo_pttt %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.PhuongThucThanhToan %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.SoLuongHoaDon %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(item.DoanhThu) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%222%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_hoa_don %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EDoanh thu theo d%E1%BB%8Bch v%E1%BB%A5%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3EM%C3%A3 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                            %3Cth%3ET%C3%AAn d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng%3C/th%3E%0A                            %3Cth%3EDoanh thu%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in doanh_thu_theo_dich_vu %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.MaDV %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.TenDV %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.SoLuong %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(item.DoanhThu) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%223%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_so_luong_dich_vu %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript src=%22https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 doanh thu theo th%E1%BB%9Di gian%0A        const revenueCtx = document.getElementById('revenueChart').getContext('2d');%0A        const revenueChart = new Chart(revenueCtx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: %7B%7B thoi_gian_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'Doanh thu (VN%C4%90)',%0A                    data: %7B%7B doanh_thu_data%7Csafe %7D%7D,%0A                    backgroundColor: '#1cc88a',%0A                    borderColor: '#1cc88a',%0A                    borderWidth: 1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Doanh thu theo th%E1%BB%9Di gian'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 doanh thu theo ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%0A        const paymentMethodCtx = document.getElementById('paymentMethodChart').getContext('2d');%0A        const paymentMethodChart = new Chart(paymentMethodCtx, %7B%0A            type: 'pie',%0A            data: %7B%0A                labels: %7B%7B pttt_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    data: %7B%7B pttt_data%7Csafe %7D%7D,%0A                    backgroundColor: %5B%0A                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b'%0A                    %5D,%0A                    hoverOffset: 4%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                plugins: %7B%0A                    legend: %7B%0A                        position: 'right',%0A                    %7D,%0A                    title: %7B%0A                        display: true,%0A                        text: 'Doanh thu theo ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n xu%E1%BA%A5t Excel%0A        document.getElementById('exportBtn').addEventListener('click', function() %7B%0A            exportToExcel();%0A        %7D);%0A        %0A        // H%C3%A0m xu%E1%BA%A5t Excel%0A        function exportToExcel() %7B%0A            // L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB c%C3%A1c b%E1%BA%A3ng%0A            const tables = document.querySelectorAll('.data-table');%0A            %0A            // T%E1%BA%A1o workbook%0A            const wb = XLSX.utils.book_new();%0A            %0A            // Th%C3%AAm ti%C3%AAu %C4%91%E1%BB%81 b%C3%A1o c%C3%A1o%0A            const headerData = %5B%0A                %5B'B%C3%81O C%C3%81O DOANH THU'%5D,%0A                %5B%60T%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%60%5D,%0A                %5B%5D%0A            %5D;%0A            %0A            // Th%C3%AAm d%E1%BB%AF li%E1%BB%87u t%E1%BB%95ng quan%0A            const summaryData = %5B%0A                %5B'T%E1%BB%95ng doanh thu', 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng h%C3%B3a %C4%91%C6%A1n', 'Doanh thu trung b%C3%ACnh', 'Doanh thu cao nh%E1%BA%A5t'%5D,%0A                %5B%0A                    '%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90', %0A                    %7B%7B tong_hoa_don %7D%7D, %0A                    '%7B%7B %22%7B:,.0f%7D%22.format(doanh_thu_trung_binh) %7D%7D VN%C4%90', %0A                    '%7B%7B %22%7B:,.0f%7D%22.format(doanh_thu_cao_nhat) %7D%7D VN%C4%90'%0A                %5D%0A            %5D;%0A            %0A            // Th%C3%AAm worksheet t%E1%BB%95ng quan%0A            const summarySheet = XLSX.utils.aoa_to_sheet(%5B...headerData, ...summaryData%5D);%0A            XLSX.utils.book_append_sheet(wb, summarySheet, 'T%E1%BB%95ng quan');%0A            %0A            // Th%C3%AAm worksheet cho t%E1%BB%ABng b%E1%BA%A3ng%0A            tables.forEach((table, index) =%3E %7B%0A                const rows = table.querySelectorAll('tr');%0A                const wsData = %5B%5D;%0A                %0A                // Th%C3%AAm ti%C3%AAu %C4%91%E1%BB%81 b%E1%BA%A3ng%0A                const tableTitle = table.previousElementSibling.textContent;%0A                wsData.push(%5BtableTitle%5D);%0A                wsData.push(%5B%5D);%0A                %0A                // Th%C3%AAm d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB b%E1%BA%A3ng%0A                rows.forEach(row =%3E %7B%0A                    const rowData = %5B%5D;%0A                    row.querySelectorAll('th, td').forEach(cell =%3E %7B%0A                        rowData.push(cell.textContent.trim());%0A                    %7D);%0A                    wsData.push(rowData);%0A                %7D);%0A                %0A                // T%E1%BA%A1o worksheet v%C3%A0 th%C3%AAm v%C3%A0o workbook%0A                const ws = XLSX.utils.aoa_to_sheet(wsData);%0A                XLSX.utils.book_append_sheet(wb, ws, %60B%E1%BA%A3ng $%7Bindex + 1%7D%60);%0A            %7D);%0A            %0A            // Xu%E1%BA%A5t file Excel%0A            XLSX.writeFile(wb, %60Bao_cao_doanh_thu_$%7Bnew Date().toISOString().slice(0, 10)%7D.xlsx%60);%0A        %7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .filter-form %7B%0A        display: flex;%0A        align-items: flex-end;%0A        gap: 20px;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form input,%0A    .filter-form select %7B%0A        width: 100%25;%0A        padding: 8px 12px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .form-actions %7B%0A        display: flex;%0A        gap: 10px;%0A    %7D%0A    %0A    .report-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .report-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A        padding-bottom: 20px;%0A        border-bottom: 1px solid #eee;%0A    %7D%0A    %0A    .report-logo %7B%0A        display: flex;%0A        align-items: center;%0A    %7D%0A    %0A    .report-logo img %7B%0A        width: 40px;%0A        height: 40px;%0A        margin-right: 10px;%0A    %7D%0A    %0A    .report-logo h4 %7B%0A        margin: 0;%0A        font-size: 16px;%0A    %7D%0A    %0A    .report-title h3 %7B%0A        margin: 0 0 5px;%0A        font-size: 20px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .report-title p %7B%0A        margin: 0;%0A        font-size: 14px;%0A        color: #666;%0A    %7D%0A    %0A    .report-summary %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-bottom: 20px;%0A        padding: 15px;%0A        background-color: #f8f9fc;%0A        border-radius: 5px;%0A    %7D%0A    %0A    .summary-item %7B%0A        text-align: center;%0A    %7D%0A    %0A    .summary-label %7B%0A        font-size: 14px;%0A        color: #666;%0A        margin-bottom: 5px;%0A    %7D%0A    %0A    .summary-value %7B%0A        font-size: 18px;%0A        font-weight: 700;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .chart-section %7B%0A        display: flex;%0A        gap: 20px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .chart-container %7B%0A        flex: 1;%0A        height: 300px;%0A        position: relative;%0A    %7D%0A    %0A    .table-section %7B%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .table-section h4 %7B%0A        margin-top: 0;%0A        margin-bottom: 15px;%0A        font-size: 18px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .data-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .data-table th, .data-table td %7B%0A        padding: 10px;%0A        text-align: left;%0A        border-bottom: 1px solid #ddd;%0A    %7D%0A    %0A    .data-table th %7B%0A        background-color: #f5f5f5;%0A        font-weight: 600;%0A    %7D%0A    %0A    .data-table tfoot td %7B%0A        font-weight: bold;%0A        border-top: 2px solid #ddd;%0A    %7D%0A    %0A    .text-right %7B%0A        text-align: right;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .section-title, .content-header, .filter-container, .header-actions %7B%0A            display: none;%0A        %7D%0A        %0A        .page-container %7B%0A            display: block;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A        %0A        .report-container %7B%0A            box-shadow: none;%0A            padding: 0;%0A        %7D%0A        %0A        .chart-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A        %0A        .table-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A    %7D%0A    %0A    @media (max-width: 992px) %7B%0A        .filter-form %7B%0A            flex-direction: column;%0A            align-items: stretch;%0A        %7D%0A        %0A        .chart-section %7B%0A            flex-direction: column;%0A        %7D%0A        %0A        .chart-container %7B%0A            height: 250px;%0A        %7D%0A        %0A        .report-summary %7B%0A            flex-wrap: wrap;%0A        %7D%0A        %0A        .summary-item %7B%0A            width: 50%25;%0A            margin-bottom: 15px;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/database/bao_cao.py","patch":"@@ -0,0 +1,27260 @@\n+import sqlite3%0Aimport json%0Afrom datetime import datetime, timedelta%0Aimport calendar%0A%0Adef get_connection():%0A    conn = sqlite3.connect('nhakhoaso.db')%0A    conn.row_factory = sqlite3.Row%0A    return conn%0A%0Adef get_tong_quan_bao_cao():%0A    %22%22%22L%E1%BA%A5y th%C3%B4ng tin t%E1%BB%95ng quan cho trang b%C3%A1o c%C3%A1o ch%C3%ADnh%22%22%22%0A    conn = get_connection()%0A    cursor = conn.cursor()%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n%0A    cursor.execute(%22SELECT COUNT(*) as tong_benh_nhan FROM BENHNHAN%22)%0A    tong_benh_nhan = cursor.fetchone()%5B'tong_benh_nhan'%5D%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 d%E1%BB%8Bch v%E1%BB%A5%0A    cursor.execute(%22SELECT COUNT(*) as tong_dich_vu FROM DICHVU%22)%0A    tong_dich_vu = cursor.fetchone()%5B'tong_dich_vu'%5D%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 l%E1%BB%8Bch h%E1%BA%B9n%0A    cursor.execute(%22SELECT COUNT(*) as tong_lich_hen FROM LICHHEN%22)%0A    tong_lich_hen = cursor.fetchone()%5B'tong_lich_hen'%5D%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng doanh thu%0A    cursor.execute(%22SELECT SUM(TongTien) as tong_doanh_thu FROM HOADON%22)%0A    result = cursor.fetchone()%0A    tong_doanh_thu = result%5B'tong_doanh_thu'%5D if result%5B'tong_doanh_thu'%5D else 0%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 d%E1%BB%8Bch v%E1%BB%A5%0A    cursor.execute(%22%22%22%0A        SELECT dv.TenDV, COUNT(pk.MaDV) as so_luong%0A        FROM DICHVU dv%0A        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        GROUP BY dv.MaDV%0A        ORDER BY so_luong DESC%0A        LIMIT 5%0A    %22%22%22)%0A    dich_vu_data = cursor.fetchall()%0A    %0A    dich_vu_labels = %5Brow%5B'TenDV'%5D for row in dich_vu_data%5D%0A    dich_vu_values = %5Brow%5B'so_luong'%5D for row in dich_vu_data%5D%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 b%E1%BB%87nh nh%C3%A2n theo th%C3%A1ng%0A    current_year = datetime.now().year%0A    months = %5B%5D%0A    benh_nhan_counts = %5B%5D%0A    %0A    for month in range(1, 13):%0A        cursor.execute(%22%22%22%0A            SELECT COUNT(*) as count%0A            FROM BENHNHAN%0A            WHERE strftime('%25Y', NgayTao) = ? AND strftime('%25m', NgayTao) = ?%0A        %22%22%22, (str(current_year), f%22%7Bmonth:02d%7D%22))%0A        count = cursor.fetchone()%5B'count'%5D%0A        %0A        months.append(f%22Th%C3%A1ng %7Bmonth%7D%22)%0A        benh_nhan_counts.append(count)%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 doanh thu theo th%C3%A1ng%0A    doanh_thu_months = %5B%5D%0A    doanh_thu_values = %5B%5D%0A    %0A    for month in range(1, 13):%0A        cursor.execute(%22%22%22%0A            SELECT SUM(TongTien) as doanh_thu%0A            FROM HOADON%0A            WHERE strftime('%25Y', NgayLap) = ? AND strftime('%25m', NgayLap) = ?%0A        %22%22%22, (str(current_year), f%22%7Bmonth:02d%7D%22))%0A        result = cursor.fetchone()%0A        doanh_thu = result%5B'doanh_thu'%5D if result%5B'doanh_thu'%5D else 0%0A        %0A        doanh_thu_months.append(f%22Th%C3%A1ng %7Bmonth%7D%22)%0A        doanh_thu_values.append(doanh_thu)%0A    %0A    conn.close()%0A    %0A    return %7B%0A        'tong_benh_nhan': tong_benh_nhan,%0A        'tong_dich_vu': tong_dich_vu,%0A        'tong_lich_hen': tong_lich_hen,%0A        'tong_doanh_thu': tong_doanh_thu,%0A        'dich_vu_labels': json.dumps(dich_vu_labels),%0A        'dich_vu_data': json.dumps(dich_vu_values),%0A        'benh_nhan_labels': json.dumps(months),%0A        'benh_nhan_data': json.dumps(benh_nhan_counts),%0A        'doanh_thu_labels': json.dumps(doanh_thu_months),%0A        'doanh_thu_data': json.dumps(doanh_thu_values)%0A    %7D%0A%0Adef get_bao_cao_dich_vu(tu_ngay=None, den_ngay=None):%0A    %22%22%22L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%22%22%22%0A    conn = get_connection()%0A    cursor = conn.cursor()%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y, l%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u c%E1%BB%A7a th%C3%A1ng hi%E1%BB%87n t%E1%BA%A1i%0A    if not tu_ngay or not den_ngay:%0A        today = datetime.now()%0A        first_day = datetime(today.year, today.month, 1).strftime('%25Y-%25m-%25d')%0A        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)%5B1%5D).strftime('%25Y-%25m-%25d')%0A        tu_ngay = first_day%0A        den_ngay = last_day%0A    %0A    # L%E1%BA%A5y danh s%C3%A1ch d%E1%BB%8Bch v%E1%BB%A5 v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3ng s%E1%BB%AD d%E1%BB%A5ng%0A    cursor.execute(%22%22%22%0A        SELECT dv.MaDV, dv.TenDV, dv.Gia, COUNT(pk.MaDV) as SoLuong, %0A               SUM(dv.Gia) as DoanhThu%0A        FROM DICHVU dv%0A        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        LEFT JOIN HOADON hd ON pk.MaPK = hd.MaPK%0A        WHERE hd.NgayLap BETWEEN ? AND ?%0A        GROUP BY dv.MaDV%0A        ORDER BY SoLuong DESC%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    dich_vu_list = %5B%5D%0A    tong_so_luong = 0%0A    tong_doanh_thu = 0%0A    %0A    for row in cursor.fetchall():%0A        so_luong = row%5B'SoLuong'%5D if row%5B'SoLuong'%5D else 0%0A        doanh_thu = row%5B'DoanhThu'%5D if row%5B'DoanhThu'%5D else 0%0A        %0A        tong_so_luong += so_luong%0A        tong_doanh_thu += doanh_thu%0A        %0A        dich_vu_list.append(%7B%0A            'MaDV': row%5B'MaDV'%5D,%0A            'TenDV': row%5B'TenDV'%5D,%0A            'Gia': row%5B'Gia'%5D,%0A            'SoLuong': so_luong,%0A            'DoanhThu': doanh_thu,%0A            'TyLe': 0  # S%E1%BA%BD t%C3%ADnh sau khi c%C3%B3 t%E1%BB%95ng%0A        %7D)%0A    %0A    # T%C3%ADnh t%E1%BB%B7 l%E1%BB%87 cho t%E1%BB%ABng d%E1%BB%8Bch v%E1%BB%A5%0A    for dv in dich_vu_list:%0A        if tong_doanh_thu %3E 0:%0A            dv%5B'TyLe'%5D = (dv%5B'DoanhThu'%5D / tong_doanh_thu) * 100%0A        else:%0A            dv%5B'TyLe'%5D = 0%0A    %0A    # L%E1%BA%A5y d%E1%BB%8Bch v%E1%BB%A5 ph%E1%BB%95 bi%E1%BA%BFn nh%E1%BA%A5t%0A    dich_vu_pho_bien = dich_vu_list%5B0%5D%5B'TenDV'%5D if dich_vu_list else %22Kh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u%22%0A    %0A    # Chu%E1%BA%A9n b%E1%BB%8B d%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93%0A    dich_vu_labels = %5Bdv%5B'TenDV'%5D for dv in dich_vu_list%5D%0A    dich_vu_data = %5Bdv%5B'SoLuong'%5D for dv in dich_vu_list%5D%0A    doanh_thu_data = %5Bdv%5B'DoanhThu'%5D for dv in dich_vu_list%5D%0A    %0A    conn.close()%0A    %0A    return %7B%0A        'tu_ngay': tu_ngay,%0A        'den_ngay': den_ngay,%0A        'dich_vu_list': dich_vu_list,%0A        'tong_dich_vu': len(dich_vu_list),%0A        'tong_so_luong': tong_so_luong,%0A        'tong_doanh_thu': tong_doanh_thu,%0A        'dich_vu_pho_bien': dich_vu_pho_bien,%0A        'dich_vu_labels': json.dumps(dich_vu_labels),%0A        'dich_vu_data': json.dumps(dich_vu_data),%0A        'doanh_thu_data': json.dumps(doanh_thu_data)%0A    %7D%0A%0Adef get_bao_cao_benh_nhan(tu_ngay=None, den_ngay=None, loai_bao_cao='all'):%0A    %22%22%22L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%22%22%22%0A    conn = get_connection()%0A    cursor = conn.cursor()%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y, l%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u c%E1%BB%A7a th%C3%A1ng hi%E1%BB%87n t%E1%BA%A1i%0A    if not tu_ngay or not den_ngay:%0A        today = datetime.now()%0A        first_day = datetime(today.year, today.month, 1).strftime('%25Y-%25m-%25d')%0A        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)%5B1%5D).strftime('%25Y-%25m-%25d')%0A        tu_ngay = first_day%0A        den_ngay = last_day%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n%0A    if loai_bao_cao == 'new':%0A        cursor.execute(%22%22%22%0A            SELECT COUNT(*) as tong_benh_nhan%0A            FROM BENHNHAN%0A            WHERE NgayTao BETWEEN ? AND ?%0A        %22%22%22, (tu_ngay, den_ngay))%0A    else:%0A        cursor.execute(%22%22%22%0A            SELECT COUNT(DISTINCT bn.MaBN) as tong_benh_nhan%0A            FROM BENHNHAN bn%0A            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A            WHERE pk.NgayKham BETWEEN ? AND ?%0A        %22%22%22, (tu_ngay, den_ngay))%0A    %0A    tong_benh_nhan = cursor.fetchone()%5B'tong_benh_nhan'%5D%0A    %0A    # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi (%C4%91%C4%83ng k%C3%BD trong kho%E1%BA%A3ng th%E1%BB%9Di gian)%0A    cursor.execute(%22%22%22%0A        SELECT COUNT(*) as benh_nhan_moi%0A        FROM BENHNHAN%0A        WHERE NgayTao BETWEEN ? AND ?%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    benh_nhan_moi = cursor.fetchone()%5B'benh_nhan_moi'%5D%0A    %0A    # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i (%C4%91%C3%A3 %C4%91%C4%83ng k%C3%BD tr%C6%B0%E1%BB%9Bc kho%E1%BA%A3ng th%E1%BB%9Di gian nh%C6%B0ng c%C3%B3 kh%C3%A1m trong kho%E1%BA%A3ng th%E1%BB%9Di gian)%0A    cursor.execute(%22%22%22%0A        SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai%0A        FROM BENHNHAN bn%0A        JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A        WHERE pk.NgayKham BETWEEN ? AND ?%0A        AND bn.NgayTao %3C ?%0A    %22%22%22, (tu_ngay, den_ngay, tu_ngay))%0A    %0A    benh_nhan_quay_lai = cursor.fetchone()%5B'benh_nhan_quay_lai'%5D%0A    %0A    # T%C3%ADnh t%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i%0A    ty_le_quay_lai = 0%0A    if tong_benh_nhan %3E 0:%0A        ty_le_quay_lai = (benh_nhan_quay_lai / tong_benh_nhan) * 100%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%E1%BB%87nh nh%C3%A2n theo th%E1%BB%9Di gian (theo tu%E1%BA%A7n)%0A    start_date = datetime.strptime(tu_ngay, '%25Y-%25m-%25d')%0A    end_date = datetime.strptime(den_ngay, '%25Y-%25m-%25d')%0A    %0A    benh_nhan_theo_thoi_gian = %5B%5D%0A    thoi_gian_labels = %5B%5D%0A    tong_so_data = %5B%5D%0A    benh_nhan_moi_data = %5B%5D%0A    benh_nhan_quay_lai_data = %5B%5D%0A    %0A    # Chia th%C3%A0nh c%C3%A1c kho%E1%BA%A3ng th%E1%BB%9Di gian (tu%E1%BA%A7n ho%E1%BA%B7c th%C3%A1ng t%C3%B9y thu%E1%BB%99c v%C3%A0o kho%E1%BA%A3ng th%E1%BB%9Di gian)%0A    delta = (end_date - start_date).days%0A    %0A    if delta %3C= 31:  # N%E1%BA%BFu kho%E1%BA%A3ng th%E1%BB%9Di gian %3C= 1 th%C3%A1ng, chia theo ng%C3%A0y%0A        current_date = start_date%0A        while current_date %3C= end_date:%0A            date_str = current_date.strftime('%25Y-%25m-%25d')%0A            next_date = current_date + timedelta(days=1)%0A            %0A            # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n trong ng%C3%A0y%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(DISTINCT bn.MaBN) as tong_so%0A                FROM BENHNHAN bn%0A                LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A                WHERE pk.NgayKham = ?%0A            %22%22%22, (date_str,))%0A            tong_so = cursor.fetchone()%5B'tong_so'%5D%0A            %0A            # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi trong ng%C3%A0y%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as benh_nhan_moi%0A                FROM BENHNHAN%0A                WHERE NgayTao = ?%0A            %22%22%22, (date_str,))%0A            bn_moi = cursor.fetchone()%5B'benh_nhan_moi'%5D%0A            %0A            # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i trong ng%C3%A0y%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai%0A                FROM BENHNHAN bn%0A                JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A                WHERE pk.NgayKham = ?%0A                AND bn.NgayTao %3C ?%0A            %22%22%22, (date_str, date_str))%0A            bn_quay_lai = cursor.fetchone()%5B'benh_nhan_quay_lai'%5D%0A            %0A            # T%C3%ADnh t%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i%0A            ty_le = 0%0A            if tong_so %3E 0:%0A                ty_le = (bn_quay_lai / tong_so) * 100%0A            %0A            benh_nhan_theo_thoi_gian.append(%7B%0A                'ThoiGian': current_date.strftime('%25d/%25m/%25Y'),%0A                'TongSo': tong_so,%0A                'BenhNhanMoi': bn_moi,%0A                'BenhNhanQuayLai': bn_quay_lai,%0A                'TyLeQuayLai': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(current_date.strftime('%25d/%25m'))%0A            tong_so_data.append(tong_so)%0A            benh_nhan_moi_data.append(bn_moi)%0A            benh_nhan_quay_lai_data.append(bn_quay_lai)%0A            %0A            current_date = next_date%0A    else:  # N%E1%BA%BFu kho%E1%BA%A3ng th%E1%BB%9Di gian %3E 1 th%C3%A1ng, chia theo tu%E1%BA%A7n%0A        current_date = start_date%0A        week_num = 1%0A        %0A        while current_date %3C= end_date:%0A            week_end = min(current_date + timedelta(days=6), end_date)%0A            week_start_str = current_date.strftime('%25Y-%25m-%25d')%0A            week_end_str = week_end.strftime('%25Y-%25m-%25d')%0A            %0A            # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n trong tu%E1%BA%A7n%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(DISTINCT bn.MaBN) as tong_so%0A                FROM BENHNHAN bn%0A                LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A                WHERE pk.NgayKham BETWEEN ? AND ?%0A            %22%22%22, (week_start_str, week_end_str))%0A            tong_so = cursor.fetchone()%5B'tong_so'%5D%0A            %0A            # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi trong tu%E1%BA%A7n%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as benh_nhan_moi%0A                FROM BENHNHAN%0A                WHERE NgayTao BETWEEN ? AND ?%0A            %22%22%22, (week_start_str, week_end_str))%0A            bn_moi = cursor.fetchone()%5B'benh_nhan_moi'%5D%0A            %0A            # L%E1%BA%A5y s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i trong tu%E1%BA%A7n%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(DISTINCT bn.MaBN) as benh_nhan_quay_lai%0A                FROM BENHNHAN bn%0A                JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A                WHERE pk.NgayKham BETWEEN ? AND ?%0A                AND bn.NgayTao %3C ?%0A            %22%22%22, (week_start_str, week_end_str, week_start_str))%0A            bn_quay_lai = cursor.fetchone()%5B'benh_nhan_quay_lai'%5D%0A            %0A            # T%C3%ADnh t%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i%0A            ty_le = 0%0A            if tong_so %3E 0:%0A                ty_le = (bn_quay_lai / tong_so) * 100%0A            %0A            benh_nhan_theo_thoi_gian.append(%7B%0A                'ThoiGian': f%22Tu%E1%BA%A7n %7Bweek_num%7D (%7Bcurrent_date.strftime('%25d/%25m')%7D - %7Bweek_end.strftime('%25d/%25m')%7D)%22,%0A                'TongSo': tong_so,%0A                'BenhNhanMoi': bn_moi,%0A                'BenhNhanQuayLai': bn_quay_lai,%0A                'TyLeQuayLai': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(f%22Tu%E1%BA%A7n %7Bweek_num%7D%22)%0A            tong_so_data.append(tong_so)%0A            benh_nhan_moi_data.append(bn_moi)%0A            benh_nhan_quay_lai_data.append(bn_quay_lai)%0A            %0A            current_date = week_end + timedelta(days=1)%0A            week_num += 1%0A    %0A    # L%E1%BA%A5y ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo %C4%91%E1%BB%99 tu%E1%BB%95i%0A    cursor.execute(%22%22%22%0A        SELECT %0A            CASE %0A                WHEN (strftime('%25Y', 'now') - strftime('%25Y', NgaySinh)) %3C 18 THEN 'D%C6%B0%E1%BB%9Bi 18 tu%E1%BB%95i'%0A                WHEN (strftime('%25Y', 'now') - strftime('%25Y', NgaySinh)) BETWEEN 18 AND 30 THEN '18-30 tu%E1%BB%95i'%0A                WHEN (strftime('%25Y', 'now') - strftime('%25Y', NgaySinh)) BETWEEN 31 AND 45 THEN '31-45 tu%E1%BB%95i'%0A                WHEN (strftime('%25Y', 'now') - strftime('%25Y', NgaySinh)) BETWEEN 46 AND 60 THEN '46-60 tu%E1%BB%95i'%0A                ELSE 'Tr%C3%AAn 60 tu%E1%BB%95i'%0A            END as NhomTuoi,%0A            COUNT(*) as SoLuong%0A        FROM BENHNHAN%0A        WHERE MaBN IN (%0A            SELECT DISTINCT bn.MaBN%0A            FROM BENHNHAN bn%0A            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A            WHERE pk.NgayKham BETWEEN ? AND ?%0A        )%0A        GROUP BY NhomTuoi%0A        ORDER BY %0A            CASE NhomTuoi%0A                WHEN 'D%C6%B0%E1%BB%9Bi 18 tu%E1%BB%95i' THEN 1%0A                WHEN '18-30 tu%E1%BB%95i' THEN 2%0A                WHEN '31-45 tu%E1%BB%95i' THEN 3%0A                WHEN '46-60 tu%E1%BB%95i' THEN 4%0A                WHEN 'Tr%C3%AAn 60 tu%E1%BB%95i' THEN 5%0A            END%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    benh_nhan_theo_tuoi = %5B%5D%0A    nhom_tuoi_labels = %5B%5D%0A    nhom_tuoi_data = %5B%5D%0A    %0A    for row in cursor.fetchall():%0A        ty_le = 0%0A        if tong_benh_nhan %3E 0:%0A            ty_le = (row%5B'SoLuong'%5D / tong_benh_nhan) * 100%0A        %0A        benh_nhan_theo_tuoi.append(%7B%0A            'NhomTuoi': row%5B'NhomTuoi'%5D,%0A            'SoLuong': row%5B'SoLuong'%5D,%0A            'TyLe': ty_le%0A        %7D)%0A        %0A        nhom_tuoi_labels.append(row%5B'NhomTuoi'%5D)%0A        nhom_tuoi_data.append(row%5B'SoLuong'%5D)%0A    %0A    # L%E1%BA%A5y ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo gi%E1%BB%9Bi t%C3%ADnh%0A    cursor.execute(%22%22%22%0A        SELECT %0A            CASE %0A                WHEN GioiTinh = 1 THEN 'Nam'%0A                WHEN GioiTinh = 0 THEN 'N%E1%BB%AF'%0A                ELSE 'Kh%C3%A1c'%0A            END as GioiTinh,%0A            COUNT(*) as SoLuong%0A        FROM BENHNHAN%0A        WHERE MaBN IN (%0A            SELECT DISTINCT bn.MaBN%0A            FROM BENHNHAN bn%0A            LEFT JOIN PHIEUKHAM pk ON bn.MaBN = pk.MaBN%0A            WHERE pk.NgayKham BETWEEN ? AND ?%0A        )%0A        GROUP BY GioiTinh%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    benh_nhan_theo_gioi_tinh = %5B%5D%0A    gioi_tinh_labels = %5B%5D%0A    gioi_tinh_data = %5B%5D%0A    %0A    for row in cursor.fetchall():%0A        ty_le = 0%0A        if tong_benh_nhan %3E 0:%0A            ty_le = (row%5B'SoLuong'%5D / tong_benh_nhan) * 100%0A        %0A        benh_nhan_theo_gioi_tinh.append(%7B%0A            'GioiTinh': row%5B'GioiTinh'%5D,%0A            'SoLuong': row%5B'SoLuong'%5D,%0A            'TyLe': ty_le%0A        %7D)%0A        %0A        gioi_tinh_labels.append(row%5B'GioiTinh'%5D)%0A        gioi_tinh_data.append(row%5B'SoLuong'%5D)%0A    %0A    conn.close()%0A    %0A    return %7B%0A        'tu_ngay': tu_ngay,%0A        'den_ngay': den_ngay,%0A        'loai_bao_cao': loai_bao_cao,%0A        'tong_benh_nhan': tong_benh_nhan,%0A        'benh_nhan_moi': benh_nhan_moi,%0A        'benh_nhan_quay_lai': benh_nhan_quay_lai,%0A        'ty_le_quay_lai': ty_le_quay_lai,%0A        'benh_nhan_theo_thoi_gian': benh_nhan_theo_thoi_gian,%0A        'benh_nhan_theo_tuoi': benh_nhan_theo_tuoi,%0A        'benh_nhan_theo_gioi_tinh': benh_nhan_theo_gioi_tinh,%0A        'thoi_gian_labels': json.dumps(thoi_gian_labels),%0A        'tong_so_data': json.dumps(tong_so_data),%0A        'benh_nhan_moi_data': json.dumps(benh_nhan_moi_data),%0A        'benh_nhan_quay_lai_data': json.dumps(benh_nhan_quay_lai_data),%0A        'nhom_tuoi_labels': json.dumps(nhom_tuoi_labels),%0A        'nhom_tuoi_data': json.dumps(nhom_tuoi_data),%0A        'gioi_tinh_labels': json.dumps(gioi_tinh_labels),%0A        'gioi_tinh_data': json.dumps(gioi_tinh_data)%0A    %7D%0A%0Adef get_bao_cao_doanh_thu(tu_ngay=None, den_ngay=None, loai_bao_cao='day'):%0A    %22%22%22L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o doanh thu%22%22%22%0A    conn = get_connection()%0A    cursor = conn.cursor()%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y, l%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u c%E1%BB%A7a th%C3%A1ng hi%E1%BB%87n t%E1%BA%A1i%0A    if not tu_ngay or not den_ngay:%0A        today = datetime.now()%0A        first_day = datetime(today.year, today.month, 1).strftime('%25Y-%25m-%25d')%0A        last_day = datetime(today.year, today.month, calendar.monthrange(today.year, today.month)%5B1%5D).strftime('%25Y-%25m-%25d')%0A        tu_ngay = first_day%0A        den_ngay = last_day%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng doanh thu%0A    cursor.execute(%22%22%22%0A        SELECT SUM(TongTien) as tong_doanh_thu%0A        FROM HOADON%0A        WHERE NgayLap BETWEEN ? AND ?%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    result = cursor.fetchone()%0A    tong_doanh_thu = result%5B'tong_doanh_thu'%5D if result%5B'tong_doanh_thu'%5D else 0%0A    %0A    # L%E1%BA%A5y t%E1%BB%95ng s%E1%BB%91 h%C3%B3a %C4%91%C6%A1n%0A    cursor.execute(%22%22%22%0A        SELECT COUNT(*) as tong_hoa_don%0A        FROM HOADON%0A        WHERE NgayLap BETWEEN ? AND ?%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    tong_hoa_don = cursor.fetchone()%5B'tong_hoa_don'%5D%0A    %0A    # T%C3%ADnh doanh thu trung b%C3%ACnh%0A    doanh_thu_trung_binh = 0%0A    if tong_hoa_don %3E 0:%0A        doanh_thu_trung_binh = tong_doanh_thu / tong_hoa_don%0A    %0A    # L%E1%BA%A5y doanh thu cao nh%E1%BA%A5t%0A    cursor.execute(%22%22%22%0A        SELECT MAX(TongTien) as doanh_thu_cao_nhat%0A        FROM HOADON%0A        WHERE NgayLap BETWEEN ? AND ?%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    result = cursor.fetchone()%0A    doanh_thu_cao_nhat = result%5B'doanh_thu_cao_nhat'%5D if result%5B'doanh_thu_cao_nhat'%5D else 0%0A    %0A    # L%E1%BA%A5y doanh thu theo th%E1%BB%9Di gian%0A    doanh_thu_theo_thoi_gian = %5B%5D%0A    thoi_gian_labels = %5B%5D%0A    doanh_thu_data = %5B%5D%0A    %0A    # Format th%E1%BB%9Di gian theo lo%E1%BA%A1i b%C3%A1o c%C3%A1o%0A    if loai_bao_cao == 'day':%0A        # B%C3%A1o c%C3%A1o theo ng%C3%A0y%0A        start_date = datetime.strptime(tu_ngay, '%25Y-%25m-%25d')%0A        end_date = datetime.strptime(den_ngay, '%25Y-%25m-%25d')%0A        %0A        current_date = start_date%0A        while current_date %3C= end_date:%0A            date_str = current_date.strftime('%25Y-%25m-%25d')%0A            %0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu%0A                FROM HOADON%0A                WHERE date(NgayLap) = ?%0A            %22%22%22, (date_str,))%0A            %0A            row = cursor.fetchone()%0A            so_luong = row%5B'so_luong'%5D if row%5B'so_luong'%5D else 0%0A            doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A            %0A            ty_le = 0%0A            if tong_doanh_thu %3E 0:%0A                ty_le = (doanh_thu / tong_doanh_thu) * 100%0A            %0A            doanh_thu_theo_thoi_gian.append(%7B%0A                'ThoiGian': current_date.strftime('%25d/%25m/%25Y'),%0A                'SoLuongHoaDon': so_luong,%0A                'DoanhThu': doanh_thu,%0A                'TyLe': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(current_date.strftime('%25d/%25m'))%0A            doanh_thu_data.append(doanh_thu)%0A            %0A            current_date += timedelta(days=1)%0A    %0A    elif loai_bao_cao == 'month':%0A        # B%C3%A1o c%C3%A1o theo th%C3%A1ng%0A        start_date = datetime.strptime(tu_ngay, '%25Y-%25m-%25d')%0A        end_date = datetime.strptime(den_ngay, '%25Y-%25m-%25d')%0A        %0A        # L%E1%BA%A5y th%C3%A1ng %C4%91%E1%BA%A7u ti%C3%AAn v%C3%A0 cu%E1%BB%91i c%C3%B9ng%0A        start_month = start_date.replace(day=1)%0A        end_month = end_date.replace(day=1)%0A        %0A        current_month = start_month%0A        while current_month %3C= end_month:%0A            month_start = current_month.strftime('%25Y-%25m-%25d')%0A            last_day = calendar.monthrange(current_month.year, current_month.month)%5B1%5D%0A            month_end = current_month.replace(day=last_day).strftime('%25Y-%25m-%25d')%0A            %0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu%0A                FROM HOADON%0A                WHERE date(NgayLap) BETWEEN ? AND ?%0A            %22%22%22, (month_start, month_end))%0A            %0A            row = cursor.fetchone()%0A            so_luong = row%5B'so_luong'%5D if row%5B'so_luong'%5D else 0%0A            doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A            %0A            ty_le = 0%0A            if tong_doanh_thu %3E 0:%0A                ty_le = (doanh_thu / tong_doanh_thu) * 100%0A            %0A            doanh_thu_theo_thoi_gian.append(%7B%0A                'ThoiGian': f%22Th%C3%A1ng %7Bcurrent_month.month%7D/%7Bcurrent_month.year%7D%22,%0A                'SoLuongHoaDon': so_luong,%0A                'DoanhThu': doanh_thu,%0A                'TyLe': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(f%22T%7Bcurrent_month.month%7D/%7Bcurrent_month.year%7D%22)%0A            doanh_thu_data.append(doanh_thu)%0A            %0A            # Chuy%E1%BB%83n sang th%C3%A1ng ti%E1%BA%BFp theo%0A            if current_month.month == 12:%0A                current_month = current_month.replace(year=current_month.year + 1, month=1)%0A            else:%0A                current_month = current_month.replace(month=current_month.month + 1)%0A    %0A    elif loai_bao_cao == 'quarter':%0A        # B%C3%A1o c%C3%A1o theo qu%C3%BD%0A        start_date = datetime.strptime(tu_ngay, '%25Y-%25m-%25d')%0A        end_date = datetime.strptime(den_ngay, '%25Y-%25m-%25d')%0A        %0A        # L%E1%BA%A5y qu%C3%BD %C4%91%E1%BA%A7u ti%C3%AAn v%C3%A0 cu%E1%BB%91i c%C3%B9ng%0A        start_quarter = (start_date.month - 1) // 3 + 1%0A        start_year = start_date.year%0A        %0A        end_quarter = (end_date.month - 1) // 3 + 1%0A        end_year = end_date.year%0A        %0A        current_year = start_year%0A        current_quarter = start_quarter%0A        %0A        while current_year %3C end_year or (current_year == end_year and current_quarter %3C= end_quarter):%0A            quarter_start_month = (current_quarter - 1) * 3 + 1%0A            quarter_end_month = quarter_start_month + 2%0A            %0A            quarter_start = datetime(current_year, quarter_start_month, 1).strftime('%25Y-%25m-%25d')%0A            quarter_end = datetime(current_year, quarter_end_month, calendar.monthrange(current_year, quarter_end_month)%5B1%5D).strftime('%25Y-%25m-%25d')%0A            %0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu%0A                FROM HOADON%0A                WHERE date(NgayLap) BETWEEN ? AND ?%0A            %22%22%22, (quarter_start, quarter_end))%0A            %0A            row = cursor.fetchone()%0A            so_luong = row%5B'so_luong'%5D if row%5B'so_luong'%5D else 0%0A            doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A            %0A            ty_le = 0%0A            if tong_doanh_thu %3E 0:%0A                ty_le = (doanh_thu / tong_doanh_thu) * 100%0A            %0A            doanh_thu_theo_thoi_gian.append(%7B%0A                'ThoiGian': f%22Qu%C3%BD %7Bcurrent_quarter%7D/%7Bcurrent_year%7D%22,%0A                'SoLuongHoaDon': so_luong,%0A                'DoanhThu': doanh_thu,%0A                'TyLe': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(f%22Q%7Bcurrent_quarter%7D/%7Bcurrent_year%7D%22)%0A            doanh_thu_data.append(doanh_thu)%0A            %0A            # Chuy%E1%BB%83n sang qu%C3%BD ti%E1%BA%BFp theo%0A            current_quarter += 1%0A            if current_quarter %3E 4:%0A                current_quarter = 1%0A                current_year += 1%0A    %0A    elif loai_bao_cao == 'year':%0A        # B%C3%A1o c%C3%A1o theo n%C4%83m%0A        start_date = datetime.strptime(tu_ngay, '%25Y-%25m-%25d')%0A        end_date = datetime.strptime(den_ngay, '%25Y-%25m-%25d')%0A        %0A        start_year = start_date.year%0A        end_year = end_date.year%0A        %0A        for year in range(start_year, end_year + 1):%0A            year_start = datetime(year, 1, 1).strftime('%25Y-%25m-%25d')%0A            year_end = datetime(year, 12, 31).strftime('%25Y-%25m-%25d')%0A            %0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as so_luong, SUM(TongTien) as doanh_thu%0A                FROM HOADON%0A                WHERE date(NgayLap) BETWEEN ? AND ?%0A            %22%22%22, (year_start, year_end))%0A            %0A            row = cursor.fetchone()%0A            so_luong = row%5B'so_luong'%5D if row%5B'so_luong'%5D else 0%0A            doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A            %0A            ty_le = 0%0A            if tong_doanh_thu %3E 0:%0A                ty_le = (doanh_thu / tong_doanh_thu) * 100%0A            %0A            doanh_thu_theo_thoi_gian.append(%7B%0A                'ThoiGian': f%22N%C4%83m %7Byear%7D%22,%0A                'SoLuongHoaDon': so_luong,%0A                'DoanhThu': doanh_thu,%0A                'TyLe': ty_le%0A            %7D)%0A            %0A            thoi_gian_labels.append(str(year))%0A            doanh_thu_data.append(doanh_thu)%0A    %0A    # L%E1%BA%A5y doanh thu theo ph%C6%B0%C6%A1ng th%E1%BB%A9c thanh to%C3%A1n%0A    cursor.execute(%22%22%22%0A        SELECT PhuongThucThanhToan, COUNT(*) as so_luong, SUM(TongTien) as doanh_thu%0A        FROM HOADON%0A        WHERE NgayLap BETWEEN ? AND ?%0A        GROUP BY PhuongThucThanhToan%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    doanh_thu_theo_pttt = %5B%5D%0A    pttt_labels = %5B%5D%0A    pttt_data = %5B%5D%0A    %0A    for row in cursor.fetchall():%0A        doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A        %0A        ty_le = 0%0A        if tong_doanh_thu %3E 0:%0A            ty_le = (doanh_thu / tong_doanh_thu) * 100%0A        %0A        doanh_thu_theo_pttt.append(%7B%0A            'PhuongThucThanhToan': row%5B'PhuongThucThanhToan'%5D,%0A            'SoLuongHoaDon': row%5B'so_luong'%5D,%0A            'DoanhThu': doanh_thu,%0A            'TyLe': ty_le%0A        %7D)%0A        %0A        pttt_labels.append(row%5B'PhuongThucThanhToan'%5D)%0A        pttt_data.append(doanh_thu)%0A    %0A    # L%E1%BA%A5y doanh thu theo d%E1%BB%8Bch v%E1%BB%A5%0A    cursor.execute(%22%22%22%0A        SELECT dv.MaDV, dv.TenDV, COUNT(pk.MaDV) as so_luong, SUM(hd.TongTien) as doanh_thu%0A        FROM DICHVU dv%0A        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        JOIN HOADON hd ON pk.MaPK = hd.MaPK%0A        WHERE hd.NgayLap BETWEEN ? AND ?%0A        GROUP BY dv.MaDV%0A        ORDER BY doanh_thu DESC%0A    %22%22%22, (tu_ngay, den_ngay))%0A    %0A    doanh_thu_theo_dich_vu = %5B%5D%0A    tong_so_luong_dich_vu = 0%0A    %0A    for row in cursor.fetchall():%0A        so_luong = row%5B'so_luong'%5D if row%5B'so_luong'%5D else 0%0A        doanh_thu = row%5B'doanh_thu'%5D if row%5B'doanh_thu'%5D else 0%0A        %0A        tong_so_luong_dich_vu += so_luong%0A        %0A        ty_le = 0%0A        if tong_doanh_thu %3E 0:%0A            ty_le = (doanh_thu / tong_doanh_thu) * 100%0A        %0A        doanh_thu_theo_dich_vu.append(%7B%0A            'MaDV': row%5B'MaDV'%5D,%0A            'TenDV': row%5B'TenDV'%5D,%0A            'SoLuong': so_luong,%0A            'DoanhThu': doanh_thu,%0A            'TyLe': ty_le%0A        %7D)%0A    %0A    conn.close()%0A    %0A    return %7B%0A        'tu_ngay': tu_ngay,%0A        'den_ngay': den_ngay,%0A        'loai_bao_cao': loai_bao_cao,%0A        'tong_doanh_thu': tong_doanh_thu,%0A        'tong_hoa_don': tong_hoa_don,%0A        'doanh_thu_trung_binh': doanh_thu_trung_binh,%0A        'doanh_thu_cao_nhat': doanh_thu_cao_nhat,%0A        'doanh_thu_theo_thoi_gian': doanh_thu_theo_thoi_gian,%0A        'doanh_thu_theo_pttt': doanh_thu_theo_pttt,%0A        'doanh_thu_theo_dich_vu': doanh_thu_theo_dich_vu,%0A        'tong_so_luong_dich_vu': tong_so_luong_dich_vu,%0A        'thoi_gian_labels': json.dumps(thoi_gian_labels),%0A        'doanh_thu_data': json.dumps(doanh_thu_data),%0A        'pttt_labels': json.dumps(pttt_labels),%0A        'pttt_data': json.dumps(pttt_data)%0A    %7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/app.py","patch":"@@ -14749,45 +14749,1687 @@\n     \n-return render_template('bao_cao.html'\n+from database.bao_cao import get_tong_quan_bao_cao%0A    data = get_tong_quan_bao_cao()%0A    return render_template('bao_cao.html', **data)%0A%0A# B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A@app.route('/bao-cao/dich-vu', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_dich_vu():%0A    from database.bao_cao import get_bao_cao_dich_vu%0A    %0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    %0A    data = get_bao_cao_dich_vu(tu_ngay, den_ngay)%0A    return render_template('bao_cao_dich_vu.html', **data)%0A%0A# B%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A@app.route('/bao-cao/benh-nhan', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_benh_nhan():%0A    from database.bao_cao import get_bao_cao_benh_nhan%0A    %0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    loai_bao_cao = request.form.get('loai_bao_cao', 'all') if request.method == 'POST' else 'all'%0A    %0A    data = get_bao_cao_benh_nhan(tu_ngay, den_ngay, loai_bao_cao)%0A    return render_template('bao_cao_benh_nhan.html', **data)%0A%0A# B%C3%A1o c%C3%A1o doanh thu%0A@app.route('/bao-cao/doanh-thu', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_doanh_thu():%0A    from database.bao_cao import get_bao_cao_doanh_thu%0A    %0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'%0A    %0A    data = get_bao_cao_doanh_thu(tu_ngay, den_ngay, loai_bao_cao)%0A    return render_template('bao_cao_doanh_thu.html', **data\n )%0A%0A#\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao.html","patch":"@@ -0,0 +1,11134 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o v%C3%A0 Th%E1%BB%91ng k%C3%AA - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O V%C3%80 TH%E1%BB%90NG K%C3%8A%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E B%C3%A1o c%C3%A1o v%C3%A0 Th%E1%BB%91ng k%C3%AA%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-hand-holding-heart%22%3E%3C/i%3E B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E B%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-money-bill-wave%22%3E%3C/i%3E B%C3%A1o c%C3%A1o doanh thu%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3ET%E1%BB%95ng quan b%C3%A1o c%C3%A1o%3C/h2%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22dashboard-stats%22%3E%0A            %3Cdiv class=%22stat-card%22%3E%0A                %3Cdiv class=%22stat-icon%22%3E%0A                    %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22stat-info%22%3E%0A                    %3Ch3%3E%7B%7B tong_benh_nhan %7D%7D%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22stat-card%22%3E%0A                %3Cdiv class=%22stat-icon%22%3E%0A                    %3Ci class=%22fas fa-hand-holding-heart%22%3E%3C/i%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22stat-info%22%3E%0A                    %3Ch3%3E%7B%7B tong_dich_vu %7D%7D%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%95ng s%E1%BB%91 d%E1%BB%8Bch v%E1%BB%A5%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22stat-card%22%3E%0A                %3Cdiv class=%22stat-icon%22%3E%0A                    %3Ci class=%22fas fa-calendar-check%22%3E%3C/i%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22stat-info%22%3E%0A                    %3Ch3%3E%7B%7B tong_lich_hen %7D%7D%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%95ng s%E1%BB%91 l%E1%BB%8Bch h%E1%BA%B9n%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22stat-card%22%3E%0A                %3Cdiv class=%22stat-icon%22%3E%0A                    %3Ci class=%22fas fa-money-bill-wave%22%3E%3C/i%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22stat-info%22%3E%0A                    %3Ch3%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%95ng doanh thu%3C/p%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22report-cards%22%3E%0A            %3Cdiv class=%22report-card%22%3E%0A                %3Cdiv class=%22report-header%22%3E%0A                    %3Ch3%3EB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%3C/h3%3E%0A                    %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22 class=%22btn btn-sm%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-content%22%3E%0A                    %3Cdiv class=%22chart-container%22%3E%0A                        %3Ccanvas id=%22serviceChart%22%3E%3C/canvas%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22report-card%22%3E%0A                %3Cdiv class=%22report-header%22%3E%0A                    %3Ch3%3EB%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%3C/h3%3E%0A                    %3Ca href=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22 class=%22btn btn-sm%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-content%22%3E%0A                    %3Cdiv class=%22chart-container%22%3E%0A                        %3Ccanvas id=%22patientChart%22%3E%3C/canvas%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22report-card%22%3E%0A                %3Cdiv class=%22report-header%22%3E%0A                    %3Ch3%3EB%C3%A1o c%C3%A1o doanh thu%3C/h3%3E%0A                    %3Ca href=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22 class=%22btn btn-sm%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-content%22%3E%0A                    %3Cdiv class=%22chart-container%22%3E%0A                        %3Ccanvas id=%22revenueChart%22%3E%3C/canvas%3E%0A                    %3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 d%E1%BB%8Bch v%E1%BB%A5%0A        const serviceCtx = document.getElementById('serviceChart').getContext('2d');%0A        const serviceChart = new Chart(serviceCtx, %7B%0A            type: 'pie',%0A            data: %7B%0A                labels: %7B%7B dich_vu_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    data: %7B%7B dich_vu_data%7Csafe %7D%7D,%0A                    backgroundColor: %5B%0A                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',%0A                        '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6'%0A                    %5D,%0A                    hoverOffset: 4%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                plugins: %7B%0A                    legend: %7B%0A                        position: 'right',%0A                    %7D,%0A                    title: %7B%0A                        display: true,%0A                        text: 'T%E1%BB%B7 l%E1%BB%87 s%E1%BB%AD d%E1%BB%A5ng d%E1%BB%8Bch v%E1%BB%A5'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 b%E1%BB%87nh nh%C3%A2n%0A        const patientCtx = document.getElementById('patientChart').getContext('2d');%0A        const patientChart = new Chart(patientCtx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: %7B%7B benh_nhan_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng b%E1%BB%87nh nh%C3%A2n',%0A                    data: %7B%7B benh_nhan_data%7Csafe %7D%7D,%0A                    backgroundColor: '#4e73df',%0A                    borderColor: '#4e73df',%0A                    borderWidth: 1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        ticks: %7B%0A                            precision: 0%0A                        %7D%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 doanh thu%0A        const revenueCtx = document.getElementById('revenueChart').getContext('2d');%0A        const revenueChart = new Chart(revenueCtx, %7B%0A            type: 'line',%0A            data: %7B%0A                labels: %7B%7B doanh_thu_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'Doanh thu (VN%C4%90)',%0A                    data: %7B%7B doanh_thu_data%7Csafe %7D%7D,%0A                    fill: false,%0A                    borderColor: '#1cc88a',%0A                    tension: 0.1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .dashboard-stats %7B%0A        display: grid;%0A        grid-template-columns: repeat(4, 1fr);%0A        gap: 20px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .stat-card %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        display: flex;%0A        align-items: center;%0A    %7D%0A    %0A    .stat-icon %7B%0A        width: 60px;%0A        height: 60px;%0A        border-radius: 50%25;%0A        background-color: rgba(78, 115, 223, 0.1);%0A        display: flex;%0A        align-items: center;%0A        justify-content: center;%0A        margin-right: 15px;%0A    %7D%0A    %0A    .stat-icon i %7B%0A        font-size: 24px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .stat-info h3 %7B%0A        margin: 0;%0A        font-size: 24px;%0A        font-weight: 700;%0A        color: #333;%0A    %7D%0A    %0A    .stat-info p %7B%0A        margin: 5px 0 0;%0A        font-size: 14px;%0A        color: #666;%0A    %7D%0A    %0A    .report-cards %7B%0A        display: grid;%0A        grid-template-columns: repeat(2, 1fr);%0A        gap: 20px;%0A    %7D%0A    %0A    .report-card %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        overflow: hidden;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .report-header %7B%0A        background-color: var(--secondary-color);%0A        padding: 15px 20px;%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A    %7D%0A    %0A    .report-header h3 %7B%0A        margin: 0;%0A        font-size: 18px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .report-content %7B%0A        padding: 20px;%0A    %7D%0A    %0A    .chart-container %7B%0A        height: 300px;%0A        position: relative;%0A    %7D%0A    %0A    .btn-sm %7B%0A        padding: 5px 10px;%0A        font-size: 12px;%0A        background-color: var(--primary-color);%0A        color: white;%0A        border-radius: 4px;%0A        text-decoration: none;%0A    %7D%0A    %0A    @media (max-width: 1200px) %7B%0A        .dashboard-stats %7B%0A            grid-template-columns: repeat(2, 1fr);%0A        %7D%0A        %0A        .report-cards %7B%0A            grid-template-columns: 1fr;%0A        %7D%0A    %7D%0A    %0A    @media (max-width: 768px) %7B%0A        .dashboard-stats %7B%0A            grid-template-columns: 1fr;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_benh_nhan.html","patch":"@@ -0,0 +1,22569 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O V%C3%80 TH%E1%BB%90NG K%C3%8A%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E B%C3%A1o c%C3%A1o v%C3%A0 Th%E1%BB%91ng k%C3%AA%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-hand-holding-heart%22%3E%3C/i%3E B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E B%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-money-bill-wave%22%3E%3C/i%3E B%C3%A1o c%C3%A1o doanh thu%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EB%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%3C/h2%3E%0A            %3Cdiv class=%22header-actions%22%3E%0A                %3Cbutton class=%22btn btn-primary%22 id=%22printBtn%22%3E%0A                    %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A                %3C/button%3E%0A                %3Cbutton class=%22btn btn-secondary%22 id=%22exportBtn%22%3E%0A                    %3Ci class=%22fas fa-file-export%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A                %3C/button%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22filter-container%22%3E%0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22 class=%22filter-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_ngay%22%3ET%E1%BB%AB ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22tu_ngay%22 name=%22tu_ngay%22 value=%22%7B%7B tu_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22den_ngay%22%3E%C4%90%E1%BA%BFn ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22den_ngay%22 name=%22den_ngay%22 value=%22%7B%7B den_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22loai_bao_cao%22%3ELo%E1%BA%A1i b%C3%A1o c%C3%A1o%3C/label%3E%0A                    %3Cselect id=%22loai_bao_cao%22 name=%22loai_bao_cao%22%3E%0A                        %3Coption value=%22all%22 %7B%25 if loai_bao_cao == 'all' %25%7Dselected%7B%25 endif %25%7D%3ET%E1%BA%A5t c%E1%BA%A3 b%E1%BB%87nh nh%C3%A2n%3C/option%3E%0A                        %3Coption value=%22new%22 %7B%25 if loai_bao_cao == 'new' %25%7Dselected%7B%25 endif %25%7D%3EB%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi%3C/option%3E%0A                        %3Coption value=%22returning%22 %7B%25 if loai_bao_cao == 'returning' %25%7Dselected%7B%25 endif %25%7D%3EB%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i%3C/option%3E%0A                    %3C/select%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E %C4%90%E1%BA%B7t l%E1%BA%A1i%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22report-container%22 id=%22reportContent%22%3E%0A            %3Cdiv class=%22report-header%22%3E%0A                %3Cdiv class=%22report-title%22%3E%0A                    %3Ch3%3EB%C3%81O C%C3%81O S%E1%BB%90 L%C6%AF%E1%BB%A2NG B%E1%BB%86NH NH%C3%82N%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%3C/p%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-logo%22%3E%0A                    %3Cimg src=%22%7B%7B url_for('static', filename='images/tooth-logo.png') %7D%7D%22 alt=%22Logo NHAKHOASO%22 onerror=%22this.src='https://via.placeholder.com/50x50?text=%F0%9F%A6%B7'%22%3E%0A                    %3Ch4%3EPH%C3%92NG KH%C3%81M NHA KHOA NHAKHOASO%3C/h4%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22report-summary%22%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ET%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B tong_benh_nhan %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3EB%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B benh_nhan_moi %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3EB%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B benh_nhan_quay_lai %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ET%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B %22%25.2f%22%7Cformat(ty_le_quay_lai) %7D%7D%25%3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22chart-section%22%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22patientTypeChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22patientTrendChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22chart-section%22%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22ageGroupChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22genderChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EChi ti%E1%BA%BFt b%E1%BB%87nh nh%C3%A2n theo th%E1%BB%9Di gian%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3ETh%E1%BB%9Di gian%3C/th%3E%0A                            %3Cth%3ET%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n%3C/th%3E%0A                            %3Cth%3EB%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi%3C/th%3E%0A                            %3Cth%3EB%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in benh_nhan_theo_thoi_gian %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.ThoiGian %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.TongSo %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.BenhNhanMoi %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.BenhNhanQuayLai %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLeQuayLai) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%222%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_benh_nhan %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B benh_nhan_moi %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B benh_nhan_quay_lai %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B %22%25.2f%22%7Cformat(ty_le_quay_lai) %7D%7D%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EPh%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo %C4%91%E1%BB%99 tu%E1%BB%95i%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3ENh%C3%B3m tu%E1%BB%95i%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in benh_nhan_theo_tuoi %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.NhomTuoi %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.SoLuong %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%222%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_benh_nhan %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EPh%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo gi%E1%BB%9Bi t%C3%ADnh%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3EGi%E1%BB%9Bi t%C3%ADnh%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for item in benh_nhan_theo_gioi_tinh %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.GioiTinh %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B item.SoLuong %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(item.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%222%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_benh_nhan %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript src=%22https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 ph%C3%A2n lo%E1%BA%A1i b%E1%BB%87nh nh%C3%A2n%0A        const patientTypeCtx = document.getElementById('patientTypeChart').getContext('2d');%0A        const patientTypeChart = new Chart(patientTypeCtx, %7B%0A            type: 'pie',%0A            data: %7B%0A                labels: %5B'B%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi', 'B%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i'%5D,%0A                datasets: %5B%7B%0A                    data: %5B%7B%7B benh_nhan_moi %7D%7D, %7B%7B benh_nhan_quay_lai %7D%7D%5D,%0A                    backgroundColor: %5B'#4e73df', '#1cc88a'%5D,%0A                    hoverOffset: 4%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                plugins: %7B%0A                    legend: %7B%0A                        position: 'right',%0A                    %7D,%0A                    title: %7B%0A                        display: true,%0A                        text: 'Ph%C3%A2n lo%E1%BA%A1i b%E1%BB%87nh nh%C3%A2n'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 xu h%C6%B0%E1%BB%9Bng b%E1%BB%87nh nh%C3%A2n theo th%E1%BB%9Di gian%0A        const patientTrendCtx = document.getElementById('patientTrendChart').getContext('2d');%0A        const patientTrendChart = new Chart(patientTrendCtx, %7B%0A            type: 'line',%0A            data: %7B%0A                labels: %7B%7B thoi_gian_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'T%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n',%0A                    data: %7B%7B tong_so_data%7Csafe %7D%7D,%0A                    fill: false,%0A                    borderColor: '#4e73df',%0A                    tension: 0.1%0A                %7D, %7B%0A                    label: 'B%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi',%0A                    data: %7B%7B benh_nhan_moi_data%7Csafe %7D%7D,%0A                    fill: false,%0A                    borderColor: '#1cc88a',%0A                    tension: 0.1%0A                %7D, %7B%0A                    label: 'B%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i',%0A                    data: %7B%7B benh_nhan_quay_lai_data%7Csafe %7D%7D,%0A                    fill: false,%0A                    borderColor: '#f6c23e',%0A                    tension: 0.1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        ticks: %7B%0A                            precision: 0%0A                        %7D%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Xu h%C6%B0%E1%BB%9Bng b%E1%BB%87nh nh%C3%A2n theo th%E1%BB%9Di gian'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo %C4%91%E1%BB%99 tu%E1%BB%95i%0A        const ageGroupCtx = document.getElementById('ageGroupChart').getContext('2d');%0A        const ageGroupChart = new Chart(ageGroupCtx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: %7B%7B nhom_tuoi_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng b%E1%BB%87nh nh%C3%A2n',%0A                    data: %7B%7B nhom_tuoi_data%7Csafe %7D%7D,%0A                    backgroundColor: '#36b9cc',%0A                    borderColor: '#36b9cc',%0A                    borderWidth: 1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        ticks: %7B%0A                            precision: 0%0A                        %7D%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo %C4%91%E1%BB%99 tu%E1%BB%95i'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // Bi%E1%BB%83u %C4%91%E1%BB%93 ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo gi%E1%BB%9Bi t%C3%ADnh%0A        const genderCtx = document.getElementById('genderChart').getContext('2d');%0A        const genderChart = new Chart(genderCtx, %7B%0A            type: 'doughnut',%0A            data: %7B%0A                labels: %7B%7B gioi_tinh_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    data: %7B%7B gioi_tinh_data%7Csafe %7D%7D,%0A                    backgroundColor: %5B'#4e73df', '#e74a3b', '#f6c23e'%5D,%0A                    hoverOffset: 4%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                plugins: %7B%0A                    legend: %7B%0A                        position: 'right',%0A                    %7D,%0A                    title: %7B%0A                        display: true,%0A                        text: 'Ph%C3%A2n b%E1%BB%91 b%E1%BB%87nh nh%C3%A2n theo gi%E1%BB%9Bi t%C3%ADnh'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n xu%E1%BA%A5t Excel%0A        document.getElementById('exportBtn').addEventListener('click', function() %7B%0A            exportToExcel();%0A        %7D);%0A        %0A        // H%C3%A0m xu%E1%BA%A5t Excel%0A        function exportToExcel() %7B%0A            // L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB c%C3%A1c b%E1%BA%A3ng%0A            const tables = document.querySelectorAll('.data-table');%0A            %0A            // T%E1%BA%A1o workbook%0A            const wb = XLSX.utils.book_new();%0A            %0A            // Th%C3%AAm ti%C3%AAu %C4%91%E1%BB%81 b%C3%A1o c%C3%A1o%0A            const headerData = %5B%0A                %5B'B%C3%81O C%C3%81O S%E1%BB%90 L%C6%AF%E1%BB%A2NG B%E1%BB%86NH NH%C3%82N'%5D,%0A                %5B%60T%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%60%5D,%0A                %5B%5D%0A            %5D;%0A            %0A            // Th%C3%AAm d%E1%BB%AF li%E1%BB%87u t%E1%BB%95ng quan%0A            const summaryData = %5B%0A                %5B'T%E1%BB%95ng s%E1%BB%91 b%E1%BB%87nh nh%C3%A2n', 'B%E1%BB%87nh nh%C3%A2n m%E1%BB%9Bi', 'B%E1%BB%87nh nh%C3%A2n quay l%E1%BA%A1i', 'T%E1%BB%B7 l%E1%BB%87 quay l%E1%BA%A1i'%5D,%0A                %5B%7B%7B tong_benh_nhan %7D%7D, %7B%7B benh_nhan_moi %7D%7D, %7B%7B benh_nhan_quay_lai %7D%7D, '%7B%7B %22%25.2f%22%7Cformat(ty_le_quay_lai) %7D%7D%25'%5D%0A            %5D;%0A            %0A            // Th%C3%AAm worksheet t%E1%BB%95ng quan%0A            const summarySheet = XLSX.utils.aoa_to_sheet(%5B...headerData, ...summaryData%5D);%0A            XLSX.utils.book_append_sheet(wb, summarySheet, 'T%E1%BB%95ng quan');%0A            %0A            // Th%C3%AAm worksheet cho t%E1%BB%ABng b%E1%BA%A3ng%0A            tables.forEach((table, index) =%3E %7B%0A                const rows = table.querySelectorAll('tr');%0A                const wsData = %5B%5D;%0A                %0A                // Th%C3%AAm ti%C3%AAu %C4%91%E1%BB%81 b%E1%BA%A3ng%0A                const tableTitle = table.previousElementSibling.textContent;%0A                wsData.push(%5BtableTitle%5D);%0A                wsData.push(%5B%5D);%0A                %0A                // Th%C3%AAm d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB b%E1%BA%A3ng%0A                rows.forEach(row =%3E %7B%0A                    const rowData = %5B%5D;%0A                    row.querySelectorAll('th, td').forEach(cell =%3E %7B%0A                        rowData.push(cell.textContent.trim());%0A                    %7D);%0A                    wsData.push(rowData);%0A                %7D);%0A                %0A                // T%E1%BA%A1o worksheet v%C3%A0 th%C3%AAm v%C3%A0o workbook%0A                const ws = XLSX.utils.aoa_to_sheet(wsData);%0A                XLSX.utils.book_append_sheet(wb, ws, %60B%E1%BA%A3ng $%7Bindex + 1%7D%60);%0A            %7D);%0A            %0A            // Xu%E1%BA%A5t file Excel%0A            XLSX.writeFile(wb, %60Bao_cao_benh_nhan_$%7Bnew Date().toISOString().slice(0, 10)%7D.xlsx%60);%0A        %7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .filter-form %7B%0A        display: flex;%0A        align-items: flex-end;%0A        gap: 20px;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form input,%0A    .filter-form select %7B%0A        width: 100%25;%0A        padding: 8px 12px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .form-actions %7B%0A        display: flex;%0A        gap: 10px;%0A    %7D%0A    %0A    .report-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .report-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A        padding-bottom: 20px;%0A        border-bottom: 1px solid #eee;%0A    %7D%0A    %0A    .report-logo %7B%0A        display: flex;%0A        align-items: center;%0A    %7D%0A    %0A    .report-logo img %7B%0A        width: 40px;%0A        height: 40px;%0A        margin-right: 10px;%0A    %7D%0A    %0A    .report-logo h4 %7B%0A        margin: 0;%0A        font-size: 16px;%0A    %7D%0A    %0A    .report-title h3 %7B%0A        margin: 0 0 5px;%0A        font-size: 20px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .report-title p %7B%0A        margin: 0;%0A        font-size: 14px;%0A        color: #666;%0A    %7D%0A    %0A    .report-summary %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-bottom: 20px;%0A        padding: 15px;%0A        background-color: #f8f9fc;%0A        border-radius: 5px;%0A    %7D%0A    %0A    .summary-item %7B%0A        text-align: center;%0A    %7D%0A    %0A    .summary-label %7B%0A        font-size: 14px;%0A        color: #666;%0A        margin-bottom: 5px;%0A    %7D%0A    %0A    .summary-value %7B%0A        font-size: 18px;%0A        font-weight: 700;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .chart-section %7B%0A        display: flex;%0A        gap: 20px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .chart-container %7B%0A        flex: 1;%0A        height: 300px;%0A        position: relative;%0A    %7D%0A    %0A    .table-section %7B%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .table-section h4 %7B%0A        margin-top: 0;%0A        margin-bottom: 15px;%0A        font-size: 18px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .data-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .data-table th, .data-table td %7B%0A        padding: 10px;%0A        text-align: left;%0A        border-bottom: 1px solid #ddd;%0A    %7D%0A    %0A    .data-table th %7B%0A        background-color: #f5f5f5;%0A        font-weight: 600;%0A    %7D%0A    %0A    .data-table tfoot td %7B%0A        font-weight: bold;%0A        border-top: 2px solid #ddd;%0A    %7D%0A    %0A    .text-right %7B%0A        text-align: right;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .section-title, .content-header, .filter-container, .header-actions %7B%0A            display: none;%0A        %7D%0A        %0A        .page-container %7B%0A            display: block;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A        %0A        .report-container %7B%0A            box-shadow: none;%0A            padding: 0;%0A        %7D%0A        %0A        .chart-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A        %0A        .table-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_dich_vu.html","patch":"@@ -0,0 +1,15338 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 - NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O V%C3%80 TH%E1%BB%90NG K%C3%8A%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Flash messages --%3E%0A%7B%25 with messages = get_flashed_messages(with_categories=true) %25%7D%0A    %7B%25 if messages %25%7D%0A        %3Cdiv class=%22flash-messages%22%3E%0A            %7B%25 for category, message in messages %25%7D%0A                %3Cdiv class=%22flash-message %7B%7B category %7D%7D%22%3E%7B%7B message %7D%7D%3C/div%3E%0A            %7B%25 endfor %25%7D%0A        %3C/div%3E%0A    %7B%25 endif %25%7D%0A%7B%25 endwith %25%7D%0A%0A%3Cdiv class=%22page-container%22%3E%0A    %3C!-- Sidebar --%3E%0A    %3Cdiv class=%22sidebar%22%3E%0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E B%C3%A1o c%C3%A1o v%C3%A0 Th%E1%BB%91ng k%C3%AA%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22 class=%22active%22%3E%0A                    %3Ci class=%22fas fa-hand-holding-heart%22%3E%3C/i%3E B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E B%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('bao_cao_doanh_thu') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-money-bill-wave%22%3E%3C/i%3E B%C3%A1o c%C3%A1o doanh thu%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-user-injured%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD b%E1%BB%87nh nh%C3%A2n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E Th%C3%AAm m%E1%BB%9Bi b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_benh_nhan') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('benh_nhan_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch b%E1%BB%87nh nh%C3%A2n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A        %0A        %3Cdiv class=%22sidebar-title%22%3E%0A            %3Ci class=%22fas fa-file-invoice-dollar%22%3E%3C/i%3E Qu%E1%BA%A3n l%C3%BD thanh to%C3%A1n%0A        %3C/div%3E%0A        %3Cul class=%22sidebar-menu%22%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('them_moi_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-plus%22%3E%3C/i%3E T%E1%BA%A1o h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('tim_kiem_hoa_don') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-search%22%3E%3C/i%3E T%C3%ACm ki%E1%BA%BFm h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A            %3Cli%3E%0A                %3Ca href=%22%7B%7B url_for('hoa_don_list') %7D%7D%22%3E%0A                    %3Ci class=%22fas fa-list%22%3E%3C/i%3E Danh s%C3%A1ch h%C3%B3a %C4%91%C6%A1n%0A                %3C/a%3E%0A            %3C/li%3E%0A        %3C/ul%3E%0A    %3C/div%3E%0A%0A    %3C!-- Main content --%3E%0A    %3Cdiv class=%22main-content%22%3E%0A        %3Cdiv class=%22content-header%22%3E%0A            %3Ch2%3EB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%3C/h2%3E%0A            %3Cdiv class=%22header-actions%22%3E%0A                %3Cbutton class=%22btn btn-primary%22 id=%22printBtn%22%3E%0A                    %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A                %3C/button%3E%0A                %3Cbutton class=%22btn btn-secondary%22 id=%22exportBtn%22%3E%0A                    %3Ci class=%22fas fa-file-export%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A                %3C/button%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22filter-container%22%3E%0A            %3Cform method=%22POST%22 action=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22 class=%22filter-form%22%3E%0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22tu_ngay%22%3ET%E1%BB%AB ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22tu_ngay%22 name=%22tu_ngay%22 value=%22%7B%7B tu_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-group%22%3E%0A                    %3Clabel for=%22den_ngay%22%3E%C4%90%E1%BA%BFn ng%C3%A0y%3C/label%3E%0A                    %3Cinput type=%22date%22 id=%22den_ngay%22 name=%22den_ngay%22 value=%22%7B%7B den_ngay %7D%7D%22%3E%0A                %3C/div%3E%0A                %0A                %3Cdiv class=%22form-actions%22%3E%0A                    %3Cbutton type=%22submit%22 class=%22btn btn-primary%22%3E%0A                        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc%0A                    %3C/button%3E%0A                    %3Cbutton type=%22reset%22 class=%22btn btn-secondary%22%3E%0A                        %3Ci class=%22fas fa-redo%22%3E%3C/i%3E %C4%90%E1%BA%B7t l%E1%BA%A1i%0A                    %3C/button%3E%0A                %3C/div%3E%0A            %3C/form%3E%0A        %3C/div%3E%0A        %0A        %3Cdiv class=%22report-container%22 id=%22reportContent%22%3E%0A            %3Cdiv class=%22report-header%22%3E%0A                %3Cdiv class=%22report-title%22%3E%0A                    %3Ch3%3EB%C3%81O C%C3%81O S%E1%BB%90 L%C6%AF%E1%BB%A2NG D%E1%BB%8ACH V%E1%BB%A4%3C/h3%3E%0A                    %3Cp%3ET%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%3C/p%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22report-logo%22%3E%0A                    %3Cimg src=%22%7B%7B url_for('static', filename='images/tooth-logo.png') %7D%7D%22 alt=%22Logo NHAKHOASO%22 onerror=%22this.src='https://via.placeholder.com/50x50?text=%F0%9F%A6%B7'%22%3E%0A                    %3Ch4%3EPH%C3%92NG KH%C3%81M NHA KHOA NHAKHOASO%3C/h4%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22report-summary%22%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ET%E1%BB%95ng s%E1%BB%91 d%E1%BB%8Bch v%E1%BB%A5:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B tong_dich_vu %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ED%E1%BB%8Bch v%E1%BB%A5 ph%E1%BB%95 bi%E1%BA%BFn nh%E1%BA%A5t:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B dich_vu_pho_bien %7D%7D%3C/div%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22summary-item%22%3E%0A                    %3Cdiv class=%22summary-label%22%3ET%E1%BB%95ng doanh thu t%E1%BB%AB d%E1%BB%8Bch v%E1%BB%A5:%3C/div%3E%0A                    %3Cdiv class=%22summary-value%22%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/div%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22chart-section%22%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22serviceChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A                %3Cdiv class=%22chart-container%22%3E%0A                    %3Ccanvas id=%22serviceRevenueChart%22%3E%3C/canvas%3E%0A                %3C/div%3E%0A            %3C/div%3E%0A            %0A            %3Cdiv class=%22table-section%22%3E%0A                %3Ch4%3EChi ti%E1%BA%BFt d%E1%BB%8Bch v%E1%BB%A5%3C/h4%3E%0A                %3Ctable class=%22data-table%22%3E%0A                    %3Cthead%3E%0A                        %3Ctr%3E%0A                            %3Cth%3ESTT%3C/th%3E%0A                            %3Cth%3EM%C3%A3 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                            %3Cth%3ET%C3%AAn d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                            %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3ng%3C/th%3E%0A                            %3Cth%3EGi%C3%A1 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                            %3Cth%3EDoanh thu%3C/th%3E%0A                            %3Cth%3ET%E1%BB%B7 l%E1%BB%87%3C/th%3E%0A                        %3C/tr%3E%0A                    %3C/thead%3E%0A                    %3Ctbody%3E%0A                        %7B%25 for dv in dich_vu_list %25%7D%0A                            %3Ctr%3E%0A                                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B dv.MaDV %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B dv.TenDV %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B dv.SoLuong %7D%7D%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.Gia) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.DoanhThu) %7D%7D VN%C4%90%3C/td%3E%0A                                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(dv.TyLe) %7D%7D%25%3C/td%3E%0A                            %3C/tr%3E%0A                        %7B%25 endfor %25%7D%0A                    %3C/tbody%3E%0A                    %3Ctfoot%3E%0A                        %3Ctr%3E%0A                            %3Ctd colspan=%223%22 class=%22text-right%22%3E%3Cstrong%3ET%E1%BB%95ng c%E1%BB%99ng:%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B tong_so_luong %7D%7D%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E%7B%7B %22%7B:,.0f%7D%22.format(tong_doanh_thu) %7D%7D VN%C4%90%3C/strong%3E%3C/td%3E%0A                            %3Ctd%3E%3Cstrong%3E100%25%3C/strong%3E%3C/td%3E%0A                        %3C/tr%3E%0A                    %3C/tfoot%3E%0A                %3C/table%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript src=%22https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 s%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5%0A        const serviceCtx = document.getElementById('serviceChart').getContext('2d');%0A        const serviceChart = new Chart(serviceCtx, %7B%0A            type: 'pie',%0A            data: %7B%0A                labels: %7B%7B dich_vu_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5',%0A                    data: %7B%7B dich_vu_data%7Csafe %7D%7D,%0A                    backgroundColor: %5B%0A                        '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',%0A                        '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6'%0A                    %5D,%0A                    hoverOffset: 4%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                plugins: %7B%0A                    legend: %7B%0A                        position: 'right',%0A                    %7D,%0A                    title: %7B%0A                        display: true,%0A                        text: 'T%E1%BB%B7 l%E1%BB%87 s%E1%BB%AD d%E1%BB%A5ng d%E1%BB%8Bch v%E1%BB%A5'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 doanh thu d%E1%BB%8Bch v%E1%BB%A5%0A        const revenueCtx = document.getElementById('serviceRevenueChart').getContext('2d');%0A        const revenueChart = new Chart(revenueCtx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: %7B%7B dich_vu_labels%7Csafe %7D%7D,%0A                datasets: %5B%7B%0A                    label: 'Doanh thu (VN%C4%90)',%0A                    data: %7B%7B doanh_thu_data%7Csafe %7D%7D,%0A                    backgroundColor: '#1cc88a',%0A                    borderColor: '#1cc88a',%0A                    borderWidth: 1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Doanh thu theo d%E1%BB%8Bch v%E1%BB%A5'%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n n%C3%BAt in%0A        document.getElementById('printBtn').addEventListener('click', function() %7B%0A            window.print();%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD s%E1%BB%B1 ki%E1%BB%87n xu%E1%BA%A5t Excel%0A        document.getElementById('exportBtn').addEventListener('click', function() %7B%0A            exportToExcel();%0A        %7D);%0A        %0A        // H%C3%A0m xu%E1%BA%A5t Excel%0A        function exportToExcel() %7B%0A            // L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB b%E1%BA%A3ng%0A            const table = document.querySelector('.data-table');%0A            const rows = table.querySelectorAll('tr');%0A            %0A            // T%E1%BA%A1o workbook v%C3%A0 worksheet%0A            const wb = XLSX.utils.book_new();%0A            const wsData = %5B%5D;%0A            %0A            // Th%C3%AAm ti%C3%AAu %C4%91%E1%BB%81 b%C3%A1o c%C3%A1o%0A            wsData.push(%5B'B%C3%81O C%C3%81O S%E1%BB%90 L%C6%AF%E1%BB%A2NG D%E1%BB%8ACH V%E1%BB%A4'%5D);%0A            wsData.push(%5B%60T%E1%BB%AB ng%C3%A0y: %7B%7B tu_ngay %7D%7D - %C4%90%E1%BA%BFn ng%C3%A0y: %7B%7B den_ngay %7D%7D%60%5D);%0A            wsData.push(%5B%5D);%0A            %0A            // Th%C3%AAm d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB b%E1%BA%A3ng%0A            rows.forEach(row =%3E %7B%0A                const rowData = %5B%5D;%0A                row.querySelectorAll('th, td').forEach(cell =%3E %7B%0A                    rowData.push(cell.textContent.trim());%0A                %7D);%0A                wsData.push(rowData);%0A            %7D);%0A            %0A            // T%E1%BA%A1o worksheet v%C3%A0 th%C3%AAm v%C3%A0o workbook%0A            const ws = XLSX.utils.aoa_to_sheet(wsData);%0A            XLSX.utils.book_append_sheet(wb, ws, 'B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5');%0A            %0A            // Xu%E1%BA%A5t file Excel%0A            XLSX.writeFile(wb, %60Bao_cao_dich_vu_$%7Bnew Date().toISOString().slice(0, 10)%7D.xlsx%60);%0A        %7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A        margin-bottom: 20px;%0A    %7D%0A    %0A    .filter-form %7B%0A        display: flex;%0A        align-items: flex-end;%0A        gap: 20px;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form input %7B%0A        width: 100%25;%0A        padding: 8px 12px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .form-actions %7B%0A        display: flex;%0A        gap: 10px;%0A    %7D%0A    %0A    .report-container %7B%0A        background-color: #fff;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 10px rgba(0,0,0,0.1);%0A        padding: 20px;%0A    %7D%0A    %0A    .report-header %7B%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A        margin-bottom: 20px;%0A        padding-bottom: 20px;%0A        border-bottom: 1px solid #eee;%0A    %7D%0A    %0A    .report-logo %7B%0A        display: flex;%0A        align-items: center;%0A    %7D%0A    %0A    .report-logo img %7B%0A        width: 40px;%0A        height: 40px;%0A        margin-right: 10px;%0A    %7D%0A    %0A    .report-logo h4 %7B%0A        margin: 0;%0A        font-size: 16px;%0A    %7D%0A    %0A    .report-title h3 %7B%0A        margin: 0 0 5px;%0A        font-size: 20px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .report-title p %7B%0A        margin: 0;%0A        font-size: 14px;%0A        color: #666;%0A    %7D%0A    %0A    .report-summary %7B%0A        display: flex;%0A        justify-content: space-between;%0A        margin-bottom: 20px;%0A        padding: 15px;%0A        background-color: #f8f9fc;%0A        border-radius: 5px;%0A    %7D%0A    %0A    .summary-item %7B%0A        text-align: center;%0A    %7D%0A    %0A    .summary-label %7B%0A        font-size: 14px;%0A        color: #666;%0A        margin-bottom: 5px;%0A    %7D%0A    %0A    .summary-value %7B%0A        font-size: 18px;%0A        font-weight: 700;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .chart-section %7B%0A        display: flex;%0A        gap: 20px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .chart-container %7B%0A        flex: 1;%0A        height: 300px;%0A        position: relative;%0A    %7D%0A    %0A    .table-section h4 %7B%0A        margin-top: 0;%0A        margin-bottom: 15px;%0A        font-size: 18px;%0A        color: var(--primary-color);%0A    %7D%0A    %0A    .data-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .data-table th, .data-table td %7B%0A        padding: 10px;%0A        text-align: left;%0A        border-bottom: 1px solid #ddd;%0A    %7D%0A    %0A    .data-table th %7B%0A        background-color: #f5f5f5;%0A        font-weight: 600;%0A    %7D%0A    %0A    .data-table tfoot td %7B%0A        font-weight: bold;%0A        border-top: 2px solid #ddd;%0A    %7D%0A    %0A    .text-right %7B%0A        text-align: right;%0A    %7D%0A    %0A    /* %C4%90%E1%BB%8Bnh d%E1%BA%A1ng cho ch%E1%BA%BF %C4%91%E1%BB%99 in */%0A    @media print %7B%0A        .sidebar, .section-title, .content-header, .filter-container, .header-actions %7B%0A            display: none;%0A        %7D%0A        %0A        .page-container %7B%0A            display: block;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A        %0A        .report-container %7B%0A            box-shadow: none;%0A            padding: 0;%0A        %7D%0A        %0A        .chart-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A        %0A        .table-section %7B%0A            page-break-inside: avoid;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false}]}],"context":{"author":"Coding Agent","operationId":"4117f0f6-8a33-408c-b7f7-89a4ee5b37c9","usedFilePaths":[{"fsPath":"/home/huong/insert/app.py","path":"insert/app.py","displayPath":"insert/app.py"},{"fsPath":"/home/huong/qtcsdl/app.py","path":"qtcsdl/app.py","displayPath":"qtcsdl/app.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/2d4a354c/HTbT.py","path":".vscode-server/data/User/History/2d4a354c/HTbT.py","displayPath":".vscode-server/data/User/History/2d4a354c/HTbT.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/test/app.py","path":"test/app.py","displayPath":"test/app.py"}]},"isInternal":false}],"isAgent":true,"isCustomAgent":false,"isUnitTestsAgent":false,"autoApply":false}