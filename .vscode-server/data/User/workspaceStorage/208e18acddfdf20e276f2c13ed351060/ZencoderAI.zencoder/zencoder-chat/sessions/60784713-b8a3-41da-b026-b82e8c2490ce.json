{"id":"60784713-b8a3-41da-b026-b82e8c2490ce","title":"B√°o C√°o D·ªãch V·ª• Th√°ng","createdAt":1745602798658,"updatedAt":1745603374084,"isNameGenerated":true,"isRenamedByUser":false,"messages":[{"id":"e1ef4177-fa53-4547-96be-326432aefba3","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"s·ª≠a cho t√¥i ch·ª©c nƒÉng b√°o c√°o d·ªãch v·ª• sao cho k·∫øt n·ªëi ƒë∆∞·ª£c v·ªõi csdl ·ªü b·∫£ng phi·∫øu kh√°m (ng√†y t·∫°o phi·∫øu kh√°m l√† ng√†y l·ªçc d·ªØ li·ªáu) m·ªõi bi·∫øt ƒë∆∞·ª£c s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng"}]}]},"content":[{"type":"text","text":"s·ª≠a cho t√¥i ch·ª©c nƒÉng b√°o c√°o d·ªãch v·ª• sao cho k·∫øt n·ªëi ƒë∆∞·ª£c v·ªõi csdl ·ªü b·∫£ng phi·∫øu kh√°m (ng√†y t·∫°o phi·∫øu kh√°m l√† ng√†y l·ªçc d·ªØ li·ªáu) m·ªõi bi·∫øt ƒë∆∞·ª£c s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html","content":"{% extends 'layout.html' %}\n\n{% block title %}B√°o c√°o d·ªãch v·ª• - NHAKHOASO{% endblock %}\n\n{% block content %}\n<div class=\"section-title\">\n    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n</div>\n\n<!-- Flash messages -->\n{% with messages = get_flashed_messages(with_categories=true) %}\n    {% if messages %}\n        <div class=\"flash-messages\">\n            {% for category, message in messages %}\n                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n            {% endfor %}\n        </div>\n    {% endif %}\n{% endwith %}\n\n<div class=\"content-header\">\n    <h2>B√°o c√°o d·ªãch v·ª•</h2>\n    <div class=\"header-actions\">\n        <button class=\"btn btn-primary\" id=\"printBtn\">\n            <i class=\"fas fa-print\"></i> In b√°o c√°o\n        </button>\n        <button class=\"btn btn-secondary\" id=\"exportBtn\">\n            <i class=\"fas fa-file-export\"></i> Xu·∫•t Excel\n        </button>\n    </div>\n</div>\n\n<div class=\"filter-container\">\n    <form method=\"POST\" action=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"filter-form\">\n        <div class=\"form-group\">\n            <label for=\"tu_ngay\">T·ª´ ng√†y</label>\n            <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n        </div>\n        \n        <div class=\"form-group\">\n            <label for=\"den_ngay\">ƒê·∫øn ng√†y</label>\n            <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n        </div>\n        \n        <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn btn-primary\">\n                <i class=\"fas fa-filter\"></i> L·ªçc\n            </button>\n            <button type=\"reset\" class=\"btn btn-secondary\">\n                <i class=\"fas fa-redo\"></i> ƒê·∫∑t l·∫°i\n            </button>\n        </div>\n    </form>\n</div>\n\n<div class=\"report-container\" id=\"reportContent\">\n    <div class=\"report-header\">\n        <div class=\"report-title\">\n            <h3>B√ÅO C√ÅO S·ª¨ D·ª§NG D·ªäCH V·ª§</h3>\n            <p>T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}</p>\n        </div>\n        <div class=\"report-logo\">\n            <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n            <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>\n        </div>\n    </div>\n    \n    <div class=\"report-summary\">\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-hand-holding-heart\"></i>\n            </div>\n            <div class=\"summary-label\">D·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng:</div>\n            <div class=\"summary-value\">{{ tong_dich_vu|default(0) }}/{{ tong_dich_vu_he_thong|default(0) }}</div>\n            <div class=\"summary-desc\">S·ªë d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng trong kho·∫£ng th·ªùi gian</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-star\"></i>\n            </div>\n            <div class=\"summary-label\">D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t:</div>\n            <div class=\"summary-value\">{{ dich_vu_pho_bien|default('Kh√¥ng c√≥ d·ªØ li·ªáu') }}</div>\n            <div class=\"summary-desc\">D·ªãch v·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu nh·∫•t</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-clipboard-list\"></i>\n            </div>\n            <div class=\"summary-label\">T·ªïng l∆∞·ª£t s·ª≠ d·ª•ng:</div>\n            <div class=\"summary-value\">{{ tong_so_luong|default(0) }}</div>\n            <div class=\"summary-desc\">T·ªïng s·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª•</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-money-bill-wave\"></i>\n            </div>\n            <div class=\"summary-label\">T·ªïng doanh thu:</div>\n            <div class=\"summary-value\">{{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê</div>\n            <div class=\"summary-desc\">T·ªïng doanh thu t·ª´ d·ªãch v·ª•</div>\n        </div>\n    </div>\n    \n    <div class=\"monthly-stats\">\n        <div class=\"monthly-stats-header\">\n            <h4><i class=\"fas fa-chart-line\"></i> Th·ªëng k√™ theo th√°ng</h4>\n            <p class=\"monthly-stats-description\">Th·ªëng k√™ s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng hi·ªán t·∫°i v√† so s√°nh v·ªõi th√°ng tr∆∞·ªõc</p>\n        </div>\n        <div class=\"monthly-stats-content\">\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    <i class=\"fas fa-calendar-check\"></i>\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">Th√°ng n√†y</div>\n                    <div class=\"monthly-stat-value\">{{ so_luong_thang|default(0) }}</div>\n                    <div class=\"monthly-stat-desc\">S·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª• trong th√°ng hi·ªán t·∫°i</div>\n                </div>\n            </div>\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    <i class=\"fas fa-calendar-minus\"></i>\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">Th√°ng tr∆∞·ªõc</div>\n                    <div class=\"monthly-stat-value\">{{ so_luong_thang_truoc|default(0) }}</div>\n                    <div class=\"monthly-stat-desc\">S·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª• trong th√°ng tr∆∞·ªõc</div>\n                </div>\n            </div>\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    {% if ty_le_tang_truong > 0 %}\n                        <i class=\"fas fa-arrow-up\" style=\"color: #28a745;\"></i>\n                    {% elif ty_le_tang_truong < 0 %}\n                        <i class=\"fas fa-arrow-down\" style=\"color: #dc3545;\"></i>\n                    {% else %}\n                        <i class=\"fas fa-equals\" style=\"color: #6c757d;\"></i>\n                    {% endif %}\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">T·ª∑ l·ªá tƒÉng tr∆∞·ªüng</div>\n                    <div class=\"monthly-stat-value {% if ty_le_tang_truong > 0 %}text-success{% elif ty_le_tang_truong < 0 %}text-danger{% endif %}\">\n                        {{ \"%.2f\"|format(ty_le_tang_truong|default(0)) }}%\n                    </div>\n                    <div class=\"monthly-stat-desc\">So v·ªõi th√°ng tr∆∞·ªõc</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <div class=\"chart-section\">\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h4><i class=\"fas fa-chart-pie\"></i> T·ª∑ l·ªá s·ª≠ d·ª•ng d·ªãch v·ª•</h4>\n                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán t·ª∑ l·ªá s·ª≠ d·ª•ng c√°c d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn</p>\n            </div>\n            <canvas id=\"serviceChart\"></canvas>\n        </div>\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h4><i class=\"fas fa-chart-bar\"></i> Doanh thu theo d·ªãch v·ª•</h4>\n                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán doanh thu c·ªßa t·ª´ng d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn</p>\n            </div>\n            <canvas id=\"serviceRevenueChart\"></canvas>\n        </div>\n    </div>\n    \n    <div class=\"table-section\">\n        <div class=\"table-header\">\n            <h4><i class=\"fas fa-table\"></i> Chi ti·∫øt d·ªãch v·ª•</h4>\n            <p class=\"table-description\">B·∫£ng th·ªÉ hi·ªán chi ti·∫øt s·ªë l∆∞·ª£ng, doanh thu v√† t·ª∑ l·ªá c·ªßa t·ª´ng d·ªãch v·ª•</p>\n        </div>\n        <div class=\"table-responsive\">\n            <table class=\"data-table\">\n                <thead>\n                    <tr>\n                        <th>STT</th>\n                        <th>M√£ d·ªãch v·ª•</th>\n                        <th>T√™n d·ªãch v·ª•</th>\n                        <th>S·ªë l∆∞·ª£ng</th>\n                        <th>Gi√° d·ªãch v·ª•</th>\n                        <th>Doanh thu</th>\n                        <th>T·ª∑ l·ªá</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for dv in dich_vu_list|default([]) %}\n                        <tr>\n                            <td>{{ loop.index }}</td>\n                            <td>{{ dv.MaDV }}</td>\n                            <td>{{ dv.TenDV }}</td>\n                            <td>{{ dv.SoLuong }}</td>\n                            <td>{{ \"{:,.0f}\".format(dv.Gia) }} VNƒê</td>\n                            <td>{{ \"{:,.0f}\".format(dv.DoanhThu) }} VNƒê</td>\n                            <td>{{ \"%.2f\"|format(dv.TyLe) }}%</td>\n                        </tr>\n                    {% endfor %}\n                </tbody>\n                <tfoot>\n                    <tr>\n                        <td colspan=\"3\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n                        <td><strong>{{ tong_so_luong|default(0) }}</strong></td>\n                        <td></td>\n                        <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê</strong></td>\n                        <td><strong>100%</strong></td>\n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n    </div>\n    \n    <div class=\"report-footer\">\n        <div class=\"footer-actions\">\n            <a href=\"{{ url_for('bao_cao') }}\" class=\"btn btn-secondary\">\n                <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n            </a>\n            <a href=\"{{ url_for('index') }}\" class=\"btn btn-primary\">\n                <i class=\"fas fa-home\"></i> Trang ch·ªß\n            </a>\n        </div>\n    </div>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js\"></script>\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        // ƒêƒÉng k√Ω plugin datalabels\n        Chart.register(ChartDataLabels);\n        \n        // ƒê·ªãnh d·∫°ng s·ªë ti·ªÅn VNƒê\n        function formatCurrency(value) {\n            return new Intl.NumberFormat('vi-VN', {\n                style: 'currency',\n                currency: 'VND',\n                maximumFractionDigits: 0\n            }).format(value);\n        }\n        \n        // M√†u s·∫Øc cho bi·ªÉu ƒë·ªì\n        const chartColors = [\n            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',\n            '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6',\n            '#3498db', '#9b59b6', '#e67e22', '#27ae60', '#2c3e50'\n        ];\n        \n        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª•\n        const serviceCtx = document.getElementById('serviceChart').getContext('2d');\n        const serviceLabels = {{ dich_vu_labels|default('[]')|safe }};\n        const serviceData = {{ dich_vu_data|default('[]')|safe }};\n        \n        if (serviceLabels.length > 0 && serviceData.length > 0) {\n            const serviceChart = new Chart(serviceCtx, {\n                type: 'doughnut',\n                data: {\n                    labels: serviceLabels,\n                    datasets: [{\n                        label: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•',\n                        data: serviceData,\n                        backgroundColor: chartColors,\n                        borderWidth: 1,\n                        hoverOffset: 15\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            position: 'right',\n                            labels: {\n                                boxWidth: 15,\n                                padding: 15,\n                                font: {\n                                    size: 12\n                                }\n                            }\n                        },\n                        tooltip: {\n                            callbacks: {\n                                label: function(context) {\n                                    const label = context.label || '';\n                                    const value = context.raw || 0;\n                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                    const percentage = Math.round((value / total) * 100);\n                                    return `${label}: ${value} (${percentage}%)`;\n                                }\n                            }\n                        },\n                        datalabels: {\n                            formatter: (value, ctx) => {\n                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);\n                                const percentage = Math.round((value / total) * 100);\n                                return percentage > 5 ? `${percentage}%` : '';\n                            },\n                            color: '#fff',\n                            font: {\n                                weight: 'bold',\n                                size: 12\n                            }\n                        }\n                    }\n                }\n            });\n        } else {\n            document.getElementById('serviceChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n        }\n        \n        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì doanh thu d·ªãch v·ª•\n        const revenueCtx = document.getElementById('serviceRevenueChart').getContext('2d');\n        const revenueData = {{ doanh_thu_data|default('[]')|safe }};\n        \n        if (serviceLabels.length > 0 && revenueData.length > 0) {\n            const revenueChart = new Chart(revenueCtx, {\n                type: 'bar',\n                data: {\n                    labels: serviceLabels,\n                    datasets: [{\n                        label: 'Doanh thu',\n                        data: revenueData,\n                        backgroundColor: chartColors.slice(0, serviceLabels.length),\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    scales: {\n                        y: {\n                            beginAtZero: true,\n                            ticks: {\n                                callback: function(value) {\n                                    return formatCurrency(value);\n                                }\n                            }\n                        }\n                    },\n                    plugins: {\n                        tooltip: {\n                            callbacks: {\n                                label: function(context) {\n                                    return `Doanh thu: ${formatCurrency(context.raw)}`;\n                                }\n                            }\n                        },\n                        datalabels: {\n                            anchor: 'end',\n                            align: 'top',\n                            formatter: (value) => {\n                                return formatCurrency(value);\n                            },\n                            color: '#333',\n                            font: {\n                                weight: 'bold',\n                                size: 11\n                            },\n                            padding: {\n                                top: 5\n                            }\n                        }\n                    }\n                }\n            });\n        } else {\n            document.getElementById('serviceRevenueChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n        }\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n        document.getElementById('printBtn').addEventListener('click', function() {\n            window.print();\n        });\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán xu·∫•t Excel\n        document.getElementById('exportBtn').addEventListener('click', function() {\n            exportToExcel();\n        });\n        \n        // H√†m xu·∫•t Excel\n        function exportToExcel() {\n            // L·∫•y d·ªØ li·ªáu t·ª´ b·∫£ng\n            const table = document.querySelector('.data-table');\n            const rows = table.querySelectorAll('tr');\n            \n            // T·∫°o workbook v√† worksheet\n            const wb = XLSX.utils.book_new();\n            const wsData = [];\n            \n            // Th√™m ti√™u ƒë·ªÅ b√°o c√°o\n            wsData.push(['B√ÅO C√ÅO S·ª¨ D·ª§NG D·ªäCH V·ª§']);\n            wsData.push([`T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}`]);\n            wsData.push([`T·ªïng s·ªë d·ªãch v·ª•: {{ tong_dich_vu|default(0) }}/{{ tong_dich_vu_he_thong|default(0) }}`]);\n            wsData.push([`D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t: {{ dich_vu_pho_bien|default('Kh√¥ng c√≥ d·ªØ li·ªáu') }}`]);\n            wsData.push([`T·ªïng l∆∞·ª£t s·ª≠ d·ª•ng: {{ tong_so_luong|default(0) }}`]);\n            wsData.push([`T·ªïng doanh thu: {{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê`]);\n            wsData.push([]);\n            \n            // Th√™m th√¥ng tin th·ªëng k√™ theo th√°ng\n            wsData.push(['TH·ªêNG K√ä THEO TH√ÅNG']);\n            wsData.push([`S·ªë l∆∞·ª£t s·ª≠ d·ª•ng trong th√°ng hi·ªán t·∫°i: {{ so_luong_thang|default(0) }}`]);\n            wsData.push([`S·ªë l∆∞·ª£t s·ª≠ d·ª•ng trong th√°ng tr∆∞·ªõc: {{ so_luong_thang_truoc|default(0) }}`]);\n            wsData.push([`T·ª∑ l·ªá tƒÉng tr∆∞·ªüng: {{ \"%.2f\"|format(ty_le_tang_truong|default(0)) }}%`]);\n            wsData.push([]);\n            \n            // Th√™m d·ªØ li·ªáu t·ª´ b·∫£ng\n            rows.forEach(row => {\n                const rowData = [];\n                row.querySelectorAll('th, td').forEach(cell => {\n                    rowData.push(cell.textContent.trim());\n                });\n                wsData.push(rowData);\n            });\n            \n            // T·∫°o worksheet v√† th√™m v√†o workbook\n            const ws = XLSX.utils.aoa_to_sheet(wsData);\n            \n            // ƒê·ªãnh d·∫°ng ti√™u ƒë·ªÅ\n            ws['!cols'] = [\n                { wch: 5 }, // STT\n                { wch: 10 }, // M√£ d·ªãch v·ª•\n                { wch: 30 }, // T√™n d·ªãch v·ª•\n                { wch: 10 }, // S·ªë l∆∞·ª£ng\n                { wch: 15 }, // Gi√° d·ªãch v·ª•\n                { wch: 15 }, // Doanh thu\n                { wch: 10 }  // T·ª∑ l·ªá\n            ];\n            \n            XLSX.utils.book_append_sheet(wb, ws, 'B√°o c√°o d·ªãch v·ª•');\n            \n            // Xu·∫•t file Excel\n            XLSX.writeFile(wb, `Bao_cao_dich_vu_${new Date().toISOString().slice(0, 10)}.xlsx`);\n            \n            // Th√¥ng b√°o xu·∫•t th√†nh c√¥ng\n            alert('Xu·∫•t b√°o c√°o Excel th√†nh c√¥ng!');\n        }\n    });\n</script>\n{% endblock %}\n\n{% block extra_css %}\n<style>\n    /* Thi·∫øt l·∫≠p chung */\n    .content-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n    }\n    \n    .content-header h2 {\n        margin: 0;\n        color: var(--primary-color);\n        font-size: 24px;\n    }\n    \n    .header-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Ph·∫ßn l·ªçc */\n    .filter-container {\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        padding: 20px;\n        margin-bottom: 20px;\n        border-left: 4px solid var(--primary-color);\n    }\n    \n    .filter-form {\n        display: flex;\n        align-items: flex-end;\n        gap: 20px;\n    }\n    \n    .filter-form .form-group {\n        flex: 1;\n    }\n    \n    .filter-form label {\n        display: block;\n        margin-bottom: 5px;\n        font-weight: 500;\n        color: #333;\n    }\n    \n    .filter-form input {\n        width: 100%;\n        padding: 10px 12px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        font-size: 14px;\n        transition: border-color 0.3s;\n    }\n    \n    .filter-form input:focus {\n        border-color: var(--primary-color);\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(78, 115, 223, 0.25);\n    }\n    \n    .form-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Container b√°o c√°o */\n    .report-container {\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        padding: 25px;\n    }\n    \n    /* Header b√°o c√°o */\n    .report-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 25px;\n        padding-bottom: 20px;\n        border-bottom: 1px solid #eee;\n    }\n    \n    .report-logo {\n        display: flex;\n        align-items: center;\n    }\n    \n    .report-logo img {\n        width: 45px;\n        height: 45px;\n        margin-right: 12px;\n        object-fit: contain;\n    }\n    \n    .report-logo h4 {\n        margin: 0;\n        font-size: 16px;\n        color: #333;\n    }\n    \n    .report-title h3 {\n        margin: 0 0 8px;\n        font-size: 22px;\n        color: var(--primary-color);\n        font-weight: 700;\n    }\n    \n    .report-title p {\n        margin: 0;\n        color: #666;\n        font-size: 14px;\n    }\n    \n    /* Ph·∫ßn t√≥m t·∫Øt */\n    .report-summary {\n        display: flex;\n        justify-content: space-between;\n        margin-bottom: 25px;\n        padding: 20px;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    }\n    \n    /* Th·ªëng k√™ theo th√°ng */\n    .monthly-stats {\n        margin-bottom: 25px;\n        padding: 20px;\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        border: 1px solid #eee;\n    }\n    \n    .monthly-stats-header {\n        margin-bottom: 15px;\n    }\n    \n    .monthly-stats-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .monthly-stats-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .monthly-stats-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    .monthly-stats-content {\n        display: flex;\n        justify-content: space-between;\n        gap: 20px;\n    }\n    \n    .monthly-stat-item {\n        flex: 1;\n        display: flex;\n        align-items: center;\n        padding: 15px;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        transition: transform 0.3s, box-shadow 0.3s;\n    }\n    \n    .monthly-stat-item:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n        background-color: #fff;\n    }\n    \n    .monthly-stat-icon {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: rgba(78, 115, 223, 0.1);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 15px;\n    }\n    \n    .monthly-stat-icon i {\n        font-size: 20px;\n        color: var(--primary-color);\n    }\n    \n    .monthly-stat-info {\n        flex: 1;\n    }\n    \n    .monthly-stat-label {\n        font-size: 14px;\n        color: #666;\n        margin-bottom: 5px;\n    }\n    \n    .monthly-stat-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: var(--primary-color);\n        margin-bottom: 5px;\n    }\n    \n    .monthly-stat-desc {\n        font-size: 12px;\n        color: #888;\n        font-style: italic;\n    }\n    \n    .text-success {\n        color: #28a745 !important;\n    }\n    \n    .text-danger {\n        color: #dc3545 !important;\n    }\n    \n    .summary-item {\n        text-align: center;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 15px;\n        border-radius: 6px;\n        transition: transform 0.3s, box-shadow 0.3s;\n    }\n    \n    .summary-item:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n        background-color: #fff;\n    }\n    \n    .summary-icon {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: rgba(78, 115, 223, 0.1);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom: 10px;\n    }\n    \n    .summary-icon i {\n        font-size: 20px;\n        color: var(--primary-color);\n    }\n    \n    .summary-label {\n        font-size: 14px;\n        color: #666;\n        margin-bottom: 8px;\n    }\n    \n    .summary-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: var(--primary-color);\n        margin-bottom: 5px;\n    }\n    \n    .summary-desc {\n        font-size: 12px;\n        color: #888;\n        font-style: italic;\n    }\n    \n    /* Ph·∫ßn bi·ªÉu ƒë·ªì */\n    .chart-section {\n        display: flex;\n        gap: 25px;\n        margin-bottom: 30px;\n    }\n    \n    .chart-container {\n        flex: 1;\n        background-color: #fff;\n        border-radius: 8px;\n        padding: 20px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        border: 1px solid #eee;\n        height: 400px;\n        position: relative;\n    }\n    \n    .chart-header {\n        margin-bottom: 15px;\n    }\n    \n    .chart-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .chart-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .chart-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    /* Ph·∫ßn b·∫£ng */\n    .table-section {\n        margin-bottom: 30px;\n        background-color: #fff;\n        border-radius: 8px;\n        padding: 20px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n    \n    .table-header {\n        margin-bottom: 15px;\n    }\n    \n    .table-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .table-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .table-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    .table-responsive {\n        overflow-x: auto;\n    }\n    \n    .data-table {\n        width: 100%;\n        border-collapse: collapse;\n        border: 1px solid #e3e6f0;\n    }\n    \n    .data-table th, .data-table td {\n        padding: 12px 15px;\n        text-align: left;\n        border-bottom: 1px solid #e3e6f0;\n    }\n    \n    .data-table th {\n        background-color: #f8f9fc;\n        font-weight: 600;\n        color: #4e73df;\n        white-space: nowrap;\n    }\n    \n    .data-table tbody tr:hover {\n        background-color: #f8f9fc;\n    }\n    \n    .data-table tbody tr:nth-child(even) {\n        background-color: #f9fafc;\n    }\n    \n    .data-table tfoot {\n        font-weight: bold;\n        background-color: #f1f3f9;\n    }\n    \n    .text-right {\n        text-align: right;\n    }\n    \n    /* Footer b√°o c√°o */\n    .report-footer {\n        margin-top: 30px;\n        display: flex;\n        justify-content: flex-end;\n        padding-top: 20px;\n        border-top: 1px solid #eee;\n    }\n    \n    .footer-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Th√¥ng b√°o kh√¥ng c√≥ d·ªØ li·ªáu */\n    .no-data-message {\n        padding: 30px;\n        text-align: center;\n        color: #666;\n        font-style: italic;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        margin: 20px 0;\n    }\n    \n    /* Responsive */\n    @media (max-width: 992px) {\n        .chart-section {\n            flex-direction: column;\n        }\n        \n        .chart-container {\n            height: 350px;\n        }\n    }\n    \n    @media (max-width: 768px) {\n        .filter-form {\n            flex-direction: column;\n            align-items: stretch;\n        }\n        \n        .report-summary {\n            flex-direction: column;\n            gap: 15px;\n        }\n        \n        .summary-item {\n            padding: 10px;\n        }\n        \n        .monthly-stats-content {\n            flex-direction: column;\n            gap: 15px;\n        }\n        \n        .monthly-stat-item {\n            padding: 10px;\n        }\n    }\n    \n    /* Thi·∫øt l·∫≠p in ·∫•n */\n    @media print {\n        body {\n            background-color: white;\n            font-size: 12pt;\n        }\n        \n        .section-title, .content-header, .filter-container, .footer-actions {\n            display: none !important;\n        }\n        \n        .report-container {\n            box-shadow: none !important;\n            padding: 0 !important;\n        }\n        \n        .report-summary, .monthly-stats {\n            page-break-inside: avoid;\n        }\n        \n        .chart-section {\n            page-break-inside: avoid;\n        }\n        \n        .chart-container {\n            height: 300px !important;\n            page-break-inside: avoid;\n        }\n        \n        .table-section {\n            page-break-inside: avoid;\n        }\n        \n        .data-table th, .data-table td {\n            padding: 8px;\n        }\n        \n        .monthly-stats {\n            border: 1px solid #ddd !important;\n            padding: 15px !important;\n            margin-bottom: 20px !important;\n        }\n        \n        .monthly-stat-item {\n            border: 1px solid #eee !important;\n        }\n    }\n</style>\n{% endblock %}","language":"html"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745602798658,"isInternal":false},{"id":"ea26dabc-74aa-4e9a-8e61-88f6383977a6","role":"assistant","createdAt":1745602809187,"content":[{"type":"text","text":"ƒê·ªÉ s·ª≠a ch·ª©c nƒÉng b√°o c√°o d·ªãch v·ª• k·∫øt n·ªëi v·ªõi CSDL t·ª´ b·∫£ng phi·∫øu kh√°m, t√¥i c·∫ßn hi·ªÉu r√µ h∆°n v·ªÅ c·∫•u tr√∫c c·ªßa ·ª©ng d·ª•ng v√† c√°c file li√™n quan. T√¥i s·∫Ω t√¨m hi·ªÉu v·ªÅ route x·ª≠ l√Ω b√°o c√°o d·ªãch v·ª• v√† c√°ch d·ªØ li·ªáu ƒë∆∞·ª£c truy v·∫•n."},{"type":"toolCall","toolCallId":"toolu_01REt7vQPePN1u8dqH4bwR2F","isHidden":false,"title":"","statusText":"Retrieved context","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5a2c45f2/7aNR.py","path":".vscode-server/data/User/History/-5a2c45f2/7aNR.py","displayPath":".vscode-server/data/User/History/-5a2c45f2/7aNR.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5a2c45f2/O1Dw.py","path":".vscode-server/data/User/History/-5a2c45f2/O1Dw.py","displayPath":".vscode-server/data/User/History/-5a2c45f2/O1Dw.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5a2c45f2/dler.py","path":".vscode-server/data/User/History/-5a2c45f2/dler.py","displayPath":".vscode-server/data/User/History/-5a2c45f2/dler.py"},{"fsPath":"/home/huong/nhakhoaso/database/dich_vu.py","path":"nhakhoaso/database/dich_vu.py","displayPath":"nhakhoaso/database/dich_vu.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5430bccd/2HOr.html","path":".vscode-server/data/User/History/-5430bccd/2HOr.html","displayPath":".vscode-server/data/User/History/-5430bccd/2HOr.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5430bccd/01mH.html","path":".vscode-server/data/User/History/-5430bccd/01mH.html","displayPath":".vscode-server/data/User/History/-5430bccd/01mH.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-2a6e9828/U5Rj.html","path":".vscode-server/data/User/History/-2a6e9828/U5Rj.html","displayPath":".vscode-server/data/User/History/-2a6e9828/U5Rj.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-2a6e9828/zl4H.html","path":".vscode-server/data/User/History/-2a6e9828/zl4H.html","displayPath":".vscode-server/data/User/History/-2a6e9828/zl4H.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5430bccd/16YG.html","path":".vscode-server/data/User/History/-5430bccd/16YG.html","displayPath":".vscode-server/data/User/History/-5430bccd/16YG.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/33c16031/EwLH.py","path":".vscode-server/data/User/History/33c16031/EwLH.py","displayPath":".vscode-server/data/User/History/33c16031/EwLH.py"}]}},{"type":"text","text":"T√¥i c·∫ßn t√¨m th√™m th√¥ng tin v·ªÅ route x·ª≠ l√Ω b√°o c√°o d·ªãch v·ª• ƒë·ªÉ hi·ªÉu c√°ch d·ªØ li·ªáu ƒë∆∞·ª£c truy v·∫•n v√† hi·ªÉn th·ªã."},{"type":"toolCall","toolCallId":"toolu_01VNGtUDYLrJMDhgYvrDQNG6","isHidden":false,"title":"","statusText":"Retrieved context","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/33c16031/EwLH.py","path":".vscode-server/data/User/History/33c16031/EwLH.py","displayPath":".vscode-server/data/User/History/33c16031/EwLH.py"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i c·∫ßn xem c·∫•u tr√∫c c·ªßa b·∫£ng PHIEUKHAM ƒë·ªÉ hi·ªÉu c√°ch k·∫øt n·ªëi v·ªõi d·ªØ li·ªáu."},{"type":"toolCall","toolCallId":"toolu_01MbjQnVrcBvTMizdU1534Ga","isHidden":false,"title":"","statusText":"Retrieved context","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/QC9J.sql","path":".vscode-server/data/User/History/-34b44c2c/QC9J.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/QC9J.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/qrKA.sql","path":".vscode-server/data/User/History/-34b44c2c/qrKA.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/qrKA.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/VFqm.sql","path":".vscode-server/data/User/History/-34b44c2c/VFqm.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/VFqm.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/IiiB.sql","path":".vscode-server/data/User/History/-34b44c2c/IiiB.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/IiiB.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/uMi6.sql","path":".vscode-server/data/User/History/-34b44c2c/uMi6.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/uMi6.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/0SN1.sql","path":".vscode-server/data/User/History/-34b44c2c/0SN1.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/0SN1.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/bFQh.py","path":".vscode-server/data/User/History/22d83b17/bFQh.py","displayPath":".vscode-server/data/User/History/22d83b17/bFQh.py"},{"fsPath":"/home/huong/nhakhoaso/database/init_db.sql","path":"nhakhoaso/database/init_db.sql","displayPath":"nhakhoaso/database/init_db.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/Rebj.py","path":".vscode-server/data/User/History/22d83b17/Rebj.py","displayPath":".vscode-server/data/User/History/22d83b17/Rebj.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/RQ1U.py","path":".vscode-server/data/User/History/22d83b17/RQ1U.py","displayPath":".vscode-server/data/User/History/22d83b17/RQ1U.py"},{"fsPath":"/home/huong/nhakhoaso/database/phieu_kham.py","path":"nhakhoaso/database/phieu_kham.py","displayPath":"nhakhoaso/database/phieu_kham.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/onga.py","path":".vscode-server/data/User/History/22d83b17/onga.py","displayPath":".vscode-server/data/User/History/22d83b17/onga.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/oCl0.py","path":".vscode-server/data/User/History/22d83b17/oCl0.py","displayPath":".vscode-server/data/User/History/22d83b17/oCl0.py"},{"fsPath":"/home/huong/.vscode-server/data/User/workspaceStorage/208e18acddfdf20e276f2c13ed351060/ZencoderAI.zencoder/zencoder-chat/sessions/337c95a5-b117-48d6-a6f8-94cf69aad4d9.json","path":".vscode-server/data/User/workspaceStorage/208e18acddfdf20e276f2c13ed351060/ZencoderAI.zencoder/zencoder-chat/sessions/337c95a5-b117-48d6-a6f8-94cf69aad4d9.json","displayPath":".vscode-server/data/User/workspaceStorage/208e18acddfdf20e276f2c13ed351060/ZencoderAI.zencoder/zencoder-chat/sessions/337c95a5-b117-48d6-a6f8-94cf69aad4d9.json"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/I1lq.py","path":".vscode-server/data/User/History/22d83b17/I1lq.py","displayPath":".vscode-server/data/User/History/22d83b17/I1lq.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/22d83b17/x111.py","path":".vscode-server/data/User/History/22d83b17/x111.py","displayPath":".vscode-server/data/User/History/22d83b17/x111.py"}]}},{"type":"text","text":"D·ª±a tr√™n th√¥ng tin ƒë√£ thu th·∫≠p, t√¥i hi·ªÉu r·∫±ng c·∫ßn s·ª≠a ch·ª©c nƒÉng b√°o c√°o d·ªãch v·ª• ƒë·ªÉ k·∫øt n·ªëi v·ªõi b·∫£ng PHIEUKHAM, s·ª≠ d·ª•ng ng√†y t·∫°o phi·∫øu kh√°m (NgayKham) l√†m ng√†y l·ªçc d·ªØ li·ªáu ƒë·ªÉ th·ªëng k√™ s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng.\n\nT√¥i s·∫Ω s·ª≠a h√†m `get_bao_cao_dich_vu` trong file `nhakhoaso/database/bao_cao.py`:"},{"type":"toolCall","toolCallId":"toolu_0124oyuvidtY2sNgrVUev9rw","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"text","text":"T√¥i s·∫Ω s·ª≠a h√†m `get_bao_cao_dich_vu` ƒë·ªÉ k·∫øt n·ªëi v·ªõi b·∫£ng PHIEUKHAM v√† s·ª≠ d·ª•ng ng√†y t·∫°o phi·∫øu kh√°m (NgayKham) l√†m ng√†y l·ªçc d·ªØ li·ªáu:"},{"type":"toolCall","toolCallId":"toolu_01MdfDUfxnyzoFYmCdYWiz2i","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/bao_cao.py\n+++ nhakhoaso/database/bao_cao.py\n@@ -123,6 +123,7 @@\n     \n     try:\n         # L·∫•y danh s√°ch d·ªãch v·ª• v√† s·ªë l∆∞·ª£ng s·ª≠ d·ª•ng t·ª´ b·∫£ng PHIEUKHAM\n+        # S·ª≠ d·ª•ng NgayKham t·ª´ b·∫£ng PHIEUKHAM l√†m ng√†y l·ªçc d·ªØ li·ªáu\n         cursor.execute(\"\"\"\n             SELECT \n                 dv.MaDV, \n@@ -130,7 +131,7 @@\n                 dv.Gia, \n                 COUNT(pk.MaDV) as SoLuong\n             FROM DICHVU dv\n-            LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV AND pk.NgayKham BETWEEN ? AND ?\n+            LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV AND date(pk.NgayKham) BETWEEN ? AND ?\n             GROUP BY dv.MaDV\n             ORDER BY SoLuong DESC\n         \"\"\", (tu_ngay, den_ngay))\n@@ -227,6 +228,27 @@\n         ty_le_tang_truong = 0\n         if so_luong_thang_truoc > 0:\n             ty_le_tang_truong = ((so_luong_thang - so_luong_thang_truoc) / so_luong_thang_truoc) * 100\n+        \n+        # L·∫•y th·ªëng k√™ d·ªãch v·ª• theo t·ª´ng th√°ng trong nƒÉm hi·ªán t·∫°i\n+        thong_ke_thang = []\n+        thang_labels = []\n+        thang_data = []\n+        \n+        for month in range(1, 13):\n+            cursor.execute(\"\"\"\n+                SELECT COUNT(*) as so_luong\n+                FROM PHIEUKHAM\n+                WHERE strftime('%Y', NgayKham) = ? AND strftime('%m', NgayKham) = ?\n+            \"\"\", (str(nam_hien_tai), f\"{month:02d}\"))\n+            \n+            so_luong = cursor.fetchone()['so_luong']\n+            thang_labels.append(f\"Th√°ng {month}\")\n+            thang_data.append(so_luong)\n+            \n+            thong_ke_thang.append({\n+                'Thang': month,\n+                'SoLuong': so_luong\n+            })\n         \n         return {\n             'tu_ngay': tu_ngay,\n@@ -242,7 +264,9 @@\n             'doanh_thu_data': json.dumps(doanh_thu_data),\n             'so_luong_thang': so_luong_thang,\n             'so_luong_thang_truoc': so_luong_thang_truoc,\n-            'ty_le_tang_truong': ty_le_tang_truong\n+            'ty_le_tang_truong': ty_le_tang_truong,\n+            'thang_labels': json.dumps(thang_labels),\n+            'thang_data': json.dumps(thang_data)\n         }\n     except Exception as e:\n         print(f\"L·ªói khi l·∫•y b√°o c√°o d·ªãch v·ª•: {str(e)}\")\n@@ -260,7 +284,9 @@\n             'doanh_thu_data': json.dumps([]),\n             'so_luong_thang': 0,\n             'so_luong_thang_truoc': 0,\n-            'ty_le_tang_truong': 0\n+            'ty_le_tang_truong': 0,\n+            'thang_labels': json.dumps([]),\n+            'thang_data': json.dumps([])\n         }\n     finally:\n         conn.close()","refToolCallId":"toolu_01MdfDUfxnyzoFYmCdYWiz2i"},{"type":"text","text":"B√¢y gi·ªù t√¥i c·∫ßn c·∫≠p nh·∫≠t template ƒë·ªÉ hi·ªÉn th·ªã th·ªëng k√™ d·ªãch v·ª• theo th√°ng. T√¥i s·∫Ω th√™m m·ªôt bi·ªÉu ƒë·ªì m·ªõi v√†o trang b√°o c√°o d·ªãch v·ª•:"},{"type":"toolCall","toolCallId":"toolu_01XemZhjB54ujVddhUV1THT7","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"toolCall","toolCallId":"toolu_01H1dWs6P7vp89pyiKKFtG4X","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"toolCall","toolCallId":"toolu_01HWXqTvVYFhoL2KBaNkC84u","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu.html\n+++ nhakhoaso/templates/bao_cao_dich_vu.html\n@@ -161,6 +161,16 @@\n                 <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán doanh thu c·ªßa t·ª´ng d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn</p>\n             </div>\n             <canvas id=\"serviceRevenueChart\"></canvas>\n+        </div>\n+    </div>\n+    \n+    <div class=\"chart-section\">\n+        <div class=\"chart-container full-width\">\n+            <div class=\"chart-header\">\n+                <h4><i class=\"fas fa-chart-line\"></i> S·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng</h4>\n+                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng theo t·ª´ng th√°ng trong nƒÉm hi·ªán t·∫°i</p>\n+            </div>\n+            <canvas id=\"monthlyServiceChart\"></canvas>\n         </div>\n     </div>\n     ","refToolCallId":"toolu_01HWXqTvVYFhoL2KBaNkC84u"},{"type":"text","text":"B√¢y gi·ªù t√¥i c·∫ßn th√™m JavaScript ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng:"},{"type":"toolCall","toolCallId":"toolu_01H9CUs8hyBqFuso362a9ZoB","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"toolCall","toolCallId":"toolu_016WqYU7txsfq54YguU8wDry","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"toolCall","toolCallId":"toolu_016jfpxFxc43udbMUAvTiqx6","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu.html\n+++ nhakhoaso/templates/bao_cao_dich_vu.html\n@@ -375,6 +375,73 @@\n             });\n         } else {\n             document.getElementById('serviceRevenueChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n+        }\n+        \n+        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng\n+        const monthlyCtx = document.getElementById('monthlyServiceChart').getContext('2d');\n+        const monthLabels = {{ thang_labels|default('[]')|safe }};\n+        const monthData = {{ thang_data|default('[]')|safe }};\n+        \n+        if (monthLabels.length > 0) {\n+            const monthlyChart = new Chart(monthlyCtx, {\n+                type: 'line',\n+                data: {\n+                    labels: monthLabels,\n+                    datasets: [{\n+                        label: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•',\n+                        data: monthData,\n+                        backgroundColor: 'rgba(78, 115, 223, 0.2)',\n+                        borderColor: 'rgba(78, 115, 223, 1)',\n+                        borderWidth: 2,\n+                        pointBackgroundColor: 'rgba(78, 115, 223, 1)',\n+                        pointBorderColor: '#fff',\n+                        pointHoverBackgroundColor: '#fff',\n+                        pointHoverBorderColor: 'rgba(78, 115, 223, 1)',\n+                        pointRadius: 4,\n+                        tension: 0.3\n+                    }]\n+                },\n+                options: {\n+                    responsive: true,\n+                    maintainAspectRatio: false,\n+                    plugins: {\n+                        legend: {\n+                            display: true,\n+                            position: 'top'\n+                        },\n+                        tooltip: {\n+                            callbacks: {\n+                                label: function(context) {\n+                                    return `S·ªë l∆∞·ª£ng: ${context.raw}`;\n+                                }\n+                            }\n+                        },\n+                        datalabels: {\n+                            display: false\n+                        }\n+                    },\n+                    scales: {\n+                        y: {\n+                            beginAtZero: true,\n+                            ticks: {\n+                                precision: 0\n+                            },\n+                            title: {\n+                                display: true,\n+                                text: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•'\n+                            }\n+                        },\n+                        x: {\n+                            title: {\n+                                display: true,\n+                                text: 'Th√°ng'\n+                            }\n+                        }\n+                    }\n+                }\n+            });\n+        } else {\n+            document.getElementById('monthlyServiceChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n         }\n         \n         // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in","refToolCallId":"toolu_016jfpxFxc43udbMUAvTiqx6"},{"type":"text","text":"Cu·ªëi c√πng, t√¥i c·∫ßn th√™m m·ªôt ch√∫t CSS ƒë·ªÉ ƒë·∫£m b·∫£o bi·ªÉu ƒë·ªì m·ªõi hi·ªÉn th·ªã ƒë√∫ng:"},{"type":"toolCall","toolCallId":"toolu_01E2EpGgSwV5LcZemLCRM5Hz","isHidden":false,"title":"","statusText":"File not found","status":"WARNING","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/static/css/style.css","path":"nhakhoaso/static/css/style.css","displayPath":"nhakhoaso/static/css/style.css"}]}},{"type":"text","text":"T√¥i s·∫Ω t√¨m file CSS ch√≠nh c·ªßa ·ª©ng d·ª•ng:"},{"type":"toolCall","toolCallId":"toolu_01BjVD5t1hSeVzC854BirZZX","isHidden":false,"title":"","statusText":"Retrieved context","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/.vscode-server/data/User/History/365ff48/YKVL.html","path":".vscode-server/data/User/History/365ff48/YKVL.html","displayPath":".vscode-server/data/User/History/365ff48/YKVL.html"},{"fsPath":"/home/huong/qtcsdl/templates/thong-ke-giao-dich.html","path":"qtcsdl/templates/thong-ke-giao-dich.html","displayPath":"qtcsdl/templates/thong-ke-giao-dich.html"}]}},{"type":"text","text":"T√¥i s·∫Ω th√™m CSS cho bi·ªÉu ƒë·ªì m·ªõi v√†o template:"},{"type":"toolCall","toolCallId":"toolu_019W4C9YicBrioHWbfsZHru7","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu.html\n+++ nhakhoaso/templates/bao_cao_dich_vu.html\n@@ -1,6 +1,64 @@\n {% extends 'layout.html' %}\n \n {% block title %}B√°o c√°o d·ªãch v·ª• - NHAKHOASO{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .chart-section {\n+        display: flex;\n+        flex-wrap: wrap;\n+        gap: 20px;\n+        margin-bottom: 30px;\n+    }\n+    \n+    .chart-container {\n+        flex: 1;\n+        min-width: 300px;\n+        background: white;\n+        border-radius: 8px;\n+        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n+        padding: 15px;\n+        height: 350px;\n+        position: relative;\n+    }\n+    \n+    .chart-container.full-width {\n+        flex-basis: 100%;\n+        height: 400px;\n+    }\n+    \n+    .chart-header {\n+        margin-bottom: 15px;\n+    }\n+    \n+    .chart-header h4 {\n+        margin: 0 0 5px 0;\n+        font-size: 18px;\n+        color: #333;\n+    }\n+    \n+    .chart-description {\n+        margin: 0;\n+        font-size: 14px;\n+        color: #666;\n+    }\n+    \n+    .no-data-message {\n+        display: flex;\n+        height: 100%;\n+        align-items: center;\n+        justify-content: center;\n+        color: #666;\n+        font-style: italic;\n+    }\n+    \n+    @media (max-width: 768px) {\n+        .chart-container {\n+            flex-basis: 100%;\n+        }\n+    }\n+</style>\n+{% endblock %}\n \n {% block content %}\n <div class=\"section-title\">","refToolCallId":"toolu_019W4C9YicBrioHWbfsZHru7"},{"type":"text","text":"T√¥i ƒë√£ ho√†n th√†nh vi·ªác s·ª≠a ch·ª©c nƒÉng b√°o c√°o d·ªãch v·ª• ƒë·ªÉ k·∫øt n·ªëi v·ªõi CSDL t·ª´ b·∫£ng PHIEUKHAM. C√°c thay ƒë·ªïi ch√≠nh bao g·ªìm:\n\n1. S·ª≠a h√†m `get_bao_cao_dich_vu` trong file `nhakhoaso/database/bao_cao.py`:\n   - S·ª≠ d·ª•ng `NgayKham` t·ª´ b·∫£ng PHIEUKHAM l√†m ng√†y l·ªçc d·ªØ li·ªáu\n   - Th√™m th·ªëng k√™ d·ªãch v·ª• theo t·ª´ng th√°ng trong nƒÉm hi·ªán t·∫°i\n   - Tr·∫£ v·ªÅ d·ªØ li·ªáu th·ªëng k√™ theo th√°ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n bi·ªÉu ƒë·ªì\n\n2. C·∫≠p nh·∫≠t template `nhakhoaso/templates/bao_cao_dich_vu.html`:\n   - Th√™m bi·ªÉu ƒë·ªì m·ªõi hi·ªÉn th·ªã s·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng\n   - Th√™m CSS ƒë·ªÉ ƒë·ªãnh d·∫°ng bi·ªÉu ƒë·ªì\n   - Th√™m JavaScript ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì\n\nV·ªõi nh·ªØng thay ƒë·ªïi n√†y, b√°o c√°o d·ªãch v·ª• s·∫Ω hi·ªÉn th·ªã ch√≠nh x√°c s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng d·ª±a tr√™n ng√†y t·∫°o phi·∫øu kh√°m. Bi·ªÉu ƒë·ªì m·ªõi s·∫Ω gi√∫p ng∆∞·ªùi d√πng theo d√µi xu h∆∞·ªõng s·ª≠ d·ª•ng d·ªãch v·ª• theo th·ªùi gian."},{"type":"codePatch","diffs":[{"path":"nhakhoaso/database/bao_cao.py","patch":"@@ -4338,32 +4338,98 @@\n  b%E1%BA%A3ng PHIEUKHAM%0A\n+        # S%E1%BB%AD d%E1%BB%A5ng NgayKham t%E1%BB%AB b%E1%BA%A3ng PHIEUKHAM l%C3%A0m ng%C3%A0y l%E1%BB%8Dc d%E1%BB%AF li%E1%BB%87u%0A\n         cursor.e\n@@ -4666,16 +4666,21 @@\n aDV AND \n+date(\n pk.NgayK\n@@ -4674,32 +4674,33 @@\n date(pk.NgayKham\n+)\n  BETWEEN ? AND ?\n@@ -8502,32 +8502,761 @@\n  * 100%0A        %0A\n+        # L%E1%BA%A5y th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 theo t%E1%BB%ABng th%C3%A1ng trong n%C4%83m hi%E1%BB%87n t%E1%BA%A1i%0A        thong_ke_thang = %5B%5D%0A        thang_labels = %5B%5D%0A        thang_data = %5B%5D%0A        %0A        for month in range(1, 13):%0A            cursor.execute(%22%22%22%0A                SELECT COUNT(*) as so_luong%0A                FROM PHIEUKHAM%0A                WHERE strftime('%25Y', NgayKham) = ? AND strftime('%25m', NgayKham) = ?%0A            %22%22%22, (str(nam_hien_tai), f%22%7Bmonth:02d%7D%22))%0A            %0A            so_luong = cursor.fetchone()%5B'so_luong'%5D%0A            thang_labels.append(f%22Th%C3%A1ng %7Bmonth%7D%22)%0A            thang_data.append(so_luong)%0A            %0A            thong_ke_thang.append(%7B%0A                'Thang': month,%0A                'SoLuong': so_luong%0A            %7D)%0A        %0A\n         return %7B\n@@ -9248,32 +9248,32 @@\n        return %7B%0A\n-\n             'tu_\n@@ -9934,24 +9934,128 @@\n _tang_truong\n+,%0A            'thang_labels': json.dumps(thang_labels),%0A            'thang_data': json.dumps(thang_data)\n %0A        %7D%0A \n@@ -10643,24 +10643,24 @@\n _truoc': 0,%0A\n-\n             \n@@ -10677,24 +10677,110 @@\n g_truong': 0\n+,%0A            'thang_labels': json.dumps(%5B%5D),%0A            'thang_data': json.dumps(%5B%5D)\n %0A        %7D%0A \n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_dich_vu.html","patch":"@@ -74,32 +74,1125 @@\n %7B%25 endblock %25%7D%0A%0A\n+%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .chart-section %7B%0A        display: flex;%0A        flex-wrap: wrap;%0A        gap: 20px;%0A        margin-bottom: 30px;%0A    %7D%0A    %0A    .chart-container %7B%0A        flex: 1;%0A        min-width: 300px;%0A        background: white;%0A        border-radius: 8px;%0A        box-shadow: 0 2px 8px rgba(0,0,0,0.1);%0A        padding: 15px;%0A        height: 350px;%0A        position: relative;%0A    %7D%0A    %0A    .chart-container.full-width %7B%0A        flex-basis: 100%25;%0A        height: 400px;%0A    %7D%0A    %0A    .chart-header %7B%0A        margin-bottom: 15px;%0A    %7D%0A    %0A    .chart-header h4 %7B%0A        margin: 0 0 5px 0;%0A        font-size: 18px;%0A        color: #333;%0A    %7D%0A    %0A    .chart-description %7B%0A        margin: 0;%0A        font-size: 14px;%0A        color: #666;%0A    %7D%0A    %0A    .no-data-message %7B%0A        display: flex;%0A        height: 100%25;%0A        align-items: center;%0A        justify-content: center;%0A        color: #666;%0A        font-style: italic;%0A    %7D%0A    %0A    @media (max-width: 768px) %7B%0A        .chart-container %7B%0A            flex-basis: 100%25;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D%0A%0A\n %7B%25 block content\n@@ -1195,16 +1195,16 @@\n tent %25%7D%0A\n-\n %3Cdiv cla\n@@ -8201,32 +8201,470 @@\n     %3C/div%3E%0A    %0A\n+    %3Cdiv class=%22chart-section%22%3E%0A        %3Cdiv class=%22chart-container full-width%22%3E%0A            %3Cdiv class=%22chart-header%22%3E%0A                %3Ch4%3E%3Ci class=%22fas fa-chart-line%22%3E%3C/i%3E S%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng%3C/h4%3E%0A                %3Cp class=%22chart-description%22%3EBi%E1%BB%83u %C4%91%E1%BB%93 th%E1%BB%83 hi%E1%BB%87n s%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo t%E1%BB%ABng th%C3%A1ng trong n%C4%83m hi%E1%BB%87n t%E1%BA%A1i%3C/p%3E%0A            %3C/div%3E%0A            %3Ccanvas id=%22monthlyServiceChart%22%3E%3C/canvas%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A    %0A\n     %3Cdiv class=%22\n@@ -16974,32 +16974,32 @@\n        %7D else %7B%0A\n-\n             docu\n@@ -17150,32 +17150,2778 @@\n      %7D%0A        %0A\n+        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 s%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng%0A        const monthlyCtx = document.getElementById('monthlyServiceChart').getContext('2d');%0A        const monthLabels = %7B%7B thang_labels%7Cdefault('%5B%5D')%7Csafe %7D%7D;%0A        const monthData = %7B%7B thang_data%7Cdefault('%5B%5D')%7Csafe %7D%7D;%0A        %0A        if (monthLabels.length %3E 0) %7B%0A            const monthlyChart = new Chart(monthlyCtx, %7B%0A                type: 'line',%0A                data: %7B%0A                    labels: monthLabels,%0A                    datasets: %5B%7B%0A                        label: 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5',%0A                        data: monthData,%0A                        backgroundColor: 'rgba(78, 115, 223, 0.2)',%0A                        borderColor: 'rgba(78, 115, 223, 1)',%0A                        borderWidth: 2,%0A                        pointBackgroundColor: 'rgba(78, 115, 223, 1)',%0A                        pointBorderColor: '#fff',%0A                        pointHoverBackgroundColor: '#fff',%0A                        pointHoverBorderColor: 'rgba(78, 115, 223, 1)',%0A                        pointRadius: 4,%0A                        tension: 0.3%0A                    %7D%5D%0A                %7D,%0A                options: %7B%0A                    responsive: true,%0A                    maintainAspectRatio: false,%0A                    plugins: %7B%0A                        legend: %7B%0A                            display: true,%0A                            position: 'top'%0A                        %7D,%0A                        tooltip: %7B%0A                            callbacks: %7B%0A                                label: function(context) %7B%0A                                    return %60S%E1%BB%91 l%C6%B0%E1%BB%A3ng: $%7Bcontext.raw%7D%60;%0A                                %7D%0A                            %7D%0A                        %7D,%0A                        datalabels: %7B%0A                            display: false%0A                        %7D%0A                    %7D,%0A                    scales: %7B%0A                        y: %7B%0A                            beginAtZero: true,%0A                            ticks: %7B%0A                                precision: 0%0A                            %7D,%0A                            title: %7B%0A                                display: true,%0A                                text: 'S%E1%BB%91 l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5'%0A                            %7D%0A                        %7D,%0A                        x: %7B%0A                            title: %7B%0A                                display: true,%0A                                text: 'Th%C3%A1ng'%0A                            %7D%0A                        %7D%0A                    %7D%0A                %7D%0A            %7D);%0A        %7D else %7B%0A            document.getElementById('monthlyServiceChart').parentNode.innerHTML = '%3Cdiv class=%22no-data-message%22%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u %C4%91%E1%BB%83 hi%E1%BB%83n th%E1%BB%8B bi%E1%BB%83u %C4%91%E1%BB%93%3C/div%3E';%0A        %7D%0A        %0A\n         // X%E1%BB%AD l%C3%BD\n","isNew":false,"isApplied":true,"isUnread":false}]}],"context":{"author":"Coding Agent","operationId":"5dea136b-0c6b-43be-936b-f734f48dd0af","usedFilePaths":[{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/QC9J.sql","path":".vscode-server/data/User/History/-34b44c2c/QC9J.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/QC9J.sql"},{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/IiiB.sql","path":".vscode-server/data/User/History/-34b44c2c/IiiB.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/IiiB.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/365ff48/YKVL.html","path":".vscode-server/data/User/History/365ff48/YKVL.html","displayPath":".vscode-server/data/User/History/365ff48/YKVL.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/uMi6.sql","path":".vscode-server/data/User/History/-34b44c2c/uMi6.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/uMi6.sql"},{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/qrKA.sql","path":".vscode-server/data/User/History/-34b44c2c/qrKA.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/qrKA.sql"},{"fsPath":"/home/huong/qtcsdl/templates/thong-ke-giao-dich.html","path":"qtcsdl/templates/thong-ke-giao-dich.html","displayPath":"qtcsdl/templates/thong-ke-giao-dich.html"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-34b44c2c/VFqm.sql","path":".vscode-server/data/User/History/-34b44c2c/VFqm.sql","displayPath":".vscode-server/data/User/History/-34b44c2c/VFqm.sql"},{"fsPath":"/home/huong/.vscode-server/data/User/History/33c16031/EwLH.py","path":".vscode-server/data/User/History/33c16031/EwLH.py","displayPath":".vscode-server/data/User/History/33c16031/EwLH.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5a2c45f2/7aNR.py","path":".vscode-server/data/User/History/-5a2c45f2/7aNR.py","displayPath":".vscode-server/data/User/History/-5a2c45f2/7aNR.py"},{"fsPath":"/home/huong/nhakhoaso/database/dich_vu.py","path":"nhakhoaso/database/dich_vu.py","displayPath":"nhakhoaso/database/dich_vu.py"},{"fsPath":"/home/huong/.vscode-server/data/User/History/-5430bccd/2HOr.html","path":".vscode-server/data/User/History/-5430bccd/2HOr.html","displayPath":".vscode-server/data/User/History/-5430bccd/2HOr.html"}]},"isInternal":false},{"id":"8df655b7-84bf-4dcf-b878-f0c3b275cfba","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"th√¥i b√¢y gi·ªù b·∫°n x√≥a t·∫•t c·∫£ ch·ª©c nƒÉng con c·ªßa B√°o c√°o -th·ªëng k√™, ƒë·ªÉ l·∫°i m·ªói ch√∫c nƒÉng ch√≠nh, v√† nh·ªõ x√≥a h·∫≥n ·ªü c√°c file lu√¥n ƒëi cho t√¥i nh√©"}]}]},"content":[{"type":"text","text":"th√¥i b√¢y gi·ªù b·∫°n x√≥a t·∫•t c·∫£ ch·ª©c nƒÉng con c·ªßa B√°o c√°o -th·ªëng k√™, ƒë·ªÉ l·∫°i m·ªói ch√∫c nƒÉng ch√≠nh, v√† nh·ªõ x√≥a h·∫≥n ·ªü c√°c file lu√¥n ƒëi cho t√¥i nh√©"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html","content":"{% extends 'layout.html' %}\n\n{% block title %}B√°o c√°o d·ªãch v·ª• - NHAKHOASO{% endblock %}\n\n{% block extra_css %}\n<style>\n    .chart-section {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 20px;\n        margin-bottom: 30px;\n    }\n    \n    .chart-container {\n        flex: 1;\n        min-width: 300px;\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n        padding: 15px;\n        height: 350px;\n        position: relative;\n    }\n    \n    .chart-container.full-width {\n        flex-basis: 100%;\n        height: 400px;\n    }\n    \n    .chart-header {\n        margin-bottom: 15px;\n    }\n    \n    .chart-header h4 {\n        margin: 0 0 5px 0;\n        font-size: 18px;\n        color: #333;\n    }\n    \n    .chart-description {\n        margin: 0;\n        font-size: 14px;\n        color: #666;\n    }\n    \n    .no-data-message {\n        display: flex;\n        height: 100%;\n        align-items: center;\n        justify-content: center;\n        color: #666;\n        font-style: italic;\n    }\n    \n    @media (max-width: 768px) {\n        .chart-container {\n            flex-basis: 100%;\n        }\n    }\n</style>\n{% endblock %}\n\n{% block content %}\n<div class=\"section-title\">\n    <h2>B√ÅO C√ÅO V√Ä TH·ªêNG K√ä</h2>\n</div>\n\n<!-- Flash messages -->\n{% with messages = get_flashed_messages(with_categories=true) %}\n    {% if messages %}\n        <div class=\"flash-messages\">\n            {% for category, message in messages %}\n                <div class=\"flash-message {{ category }}\">{{ message }}</div>\n            {% endfor %}\n        </div>\n    {% endif %}\n{% endwith %}\n\n<div class=\"content-header\">\n    <h2>B√°o c√°o d·ªãch v·ª•</h2>\n    <div class=\"header-actions\">\n        <button class=\"btn btn-primary\" id=\"printBtn\">\n            <i class=\"fas fa-print\"></i> In b√°o c√°o\n        </button>\n        <button class=\"btn btn-secondary\" id=\"exportBtn\">\n            <i class=\"fas fa-file-export\"></i> Xu·∫•t Excel\n        </button>\n    </div>\n</div>\n\n<div class=\"filter-container\">\n    <form method=\"POST\" action=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"filter-form\">\n        <div class=\"form-group\">\n            <label for=\"tu_ngay\">T·ª´ ng√†y</label>\n            <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n        </div>\n        \n        <div class=\"form-group\">\n            <label for=\"den_ngay\">ƒê·∫øn ng√†y</label>\n            <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n        </div>\n        \n        <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn btn-primary\">\n                <i class=\"fas fa-filter\"></i> L·ªçc\n            </button>\n            <button type=\"reset\" class=\"btn btn-secondary\">\n                <i class=\"fas fa-redo\"></i> ƒê·∫∑t l·∫°i\n            </button>\n        </div>\n    </form>\n</div>\n\n<div class=\"report-container\" id=\"reportContent\">\n    <div class=\"report-header\">\n        <div class=\"report-title\">\n            <h3>B√ÅO C√ÅO S·ª¨ D·ª§NG D·ªäCH V·ª§</h3>\n            <p>T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}</p>\n        </div>\n        <div class=\"report-logo\">\n            <img src=\"{{ url_for('static', filename='images/tooth-logo.png') }}\" alt=\"Logo NHAKHOASO\" onerror=\"this.src='https://via.placeholder.com/50x50?text=ü¶∑'\">\n            <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>\n        </div>\n    </div>\n    \n    <div class=\"report-summary\">\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-hand-holding-heart\"></i>\n            </div>\n            <div class=\"summary-label\">D·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng:</div>\n            <div class=\"summary-value\">{{ tong_dich_vu|default(0) }}/{{ tong_dich_vu_he_thong|default(0) }}</div>\n            <div class=\"summary-desc\">S·ªë d·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng trong kho·∫£ng th·ªùi gian</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-star\"></i>\n            </div>\n            <div class=\"summary-label\">D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t:</div>\n            <div class=\"summary-value\">{{ dich_vu_pho_bien|default('Kh√¥ng c√≥ d·ªØ li·ªáu') }}</div>\n            <div class=\"summary-desc\">D·ªãch v·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng nhi·ªÅu nh·∫•t</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-clipboard-list\"></i>\n            </div>\n            <div class=\"summary-label\">T·ªïng l∆∞·ª£t s·ª≠ d·ª•ng:</div>\n            <div class=\"summary-value\">{{ tong_so_luong|default(0) }}</div>\n            <div class=\"summary-desc\">T·ªïng s·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª•</div>\n        </div>\n        <div class=\"summary-item\">\n            <div class=\"summary-icon\">\n                <i class=\"fas fa-money-bill-wave\"></i>\n            </div>\n            <div class=\"summary-label\">T·ªïng doanh thu:</div>\n            <div class=\"summary-value\">{{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê</div>\n            <div class=\"summary-desc\">T·ªïng doanh thu t·ª´ d·ªãch v·ª•</div>\n        </div>\n    </div>\n    \n    <div class=\"monthly-stats\">\n        <div class=\"monthly-stats-header\">\n            <h4><i class=\"fas fa-chart-line\"></i> Th·ªëng k√™ theo th√°ng</h4>\n            <p class=\"monthly-stats-description\">Th·ªëng k√™ s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng trong th√°ng hi·ªán t·∫°i v√† so s√°nh v·ªõi th√°ng tr∆∞·ªõc</p>\n        </div>\n        <div class=\"monthly-stats-content\">\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    <i class=\"fas fa-calendar-check\"></i>\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">Th√°ng n√†y</div>\n                    <div class=\"monthly-stat-value\">{{ so_luong_thang|default(0) }}</div>\n                    <div class=\"monthly-stat-desc\">S·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª• trong th√°ng hi·ªán t·∫°i</div>\n                </div>\n            </div>\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    <i class=\"fas fa-calendar-minus\"></i>\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">Th√°ng tr∆∞·ªõc</div>\n                    <div class=\"monthly-stat-value\">{{ so_luong_thang_truoc|default(0) }}</div>\n                    <div class=\"monthly-stat-desc\">S·ªë l∆∞·ª£t s·ª≠ d·ª•ng d·ªãch v·ª• trong th√°ng tr∆∞·ªõc</div>\n                </div>\n            </div>\n            <div class=\"monthly-stat-item\">\n                <div class=\"monthly-stat-icon\">\n                    {% if ty_le_tang_truong > 0 %}\n                        <i class=\"fas fa-arrow-up\" style=\"color: #28a745;\"></i>\n                    {% elif ty_le_tang_truong < 0 %}\n                        <i class=\"fas fa-arrow-down\" style=\"color: #dc3545;\"></i>\n                    {% else %}\n                        <i class=\"fas fa-equals\" style=\"color: #6c757d;\"></i>\n                    {% endif %}\n                </div>\n                <div class=\"monthly-stat-info\">\n                    <div class=\"monthly-stat-label\">T·ª∑ l·ªá tƒÉng tr∆∞·ªüng</div>\n                    <div class=\"monthly-stat-value {% if ty_le_tang_truong > 0 %}text-success{% elif ty_le_tang_truong < 0 %}text-danger{% endif %}\">\n                        {{ \"%.2f\"|format(ty_le_tang_truong|default(0)) }}%\n                    </div>\n                    <div class=\"monthly-stat-desc\">So v·ªõi th√°ng tr∆∞·ªõc</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    \n    <div class=\"chart-section\">\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h4><i class=\"fas fa-chart-pie\"></i> T·ª∑ l·ªá s·ª≠ d·ª•ng d·ªãch v·ª•</h4>\n                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán t·ª∑ l·ªá s·ª≠ d·ª•ng c√°c d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn</p>\n            </div>\n            <canvas id=\"serviceChart\"></canvas>\n        </div>\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h4><i class=\"fas fa-chart-bar\"></i> Doanh thu theo d·ªãch v·ª•</h4>\n                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán doanh thu c·ªßa t·ª´ng d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn</p>\n            </div>\n            <canvas id=\"serviceRevenueChart\"></canvas>\n        </div>\n    </div>\n    \n    <div class=\"chart-section\">\n        <div class=\"chart-container full-width\">\n            <div class=\"chart-header\">\n                <h4><i class=\"fas fa-chart-line\"></i> S·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng</h4>\n                <p class=\"chart-description\">Bi·ªÉu ƒë·ªì th·ªÉ hi·ªán s·ªë l∆∞·ª£ng d·ªãch v·ª• s·ª≠ d·ª•ng theo t·ª´ng th√°ng trong nƒÉm hi·ªán t·∫°i</p>\n            </div>\n            <canvas id=\"monthlyServiceChart\"></canvas>\n        </div>\n    </div>\n    \n    <div class=\"table-section\">\n        <div class=\"table-header\">\n            <h4><i class=\"fas fa-table\"></i> Chi ti·∫øt d·ªãch v·ª•</h4>\n            <p class=\"table-description\">B·∫£ng th·ªÉ hi·ªán chi ti·∫øt s·ªë l∆∞·ª£ng, doanh thu v√† t·ª∑ l·ªá c·ªßa t·ª´ng d·ªãch v·ª•</p>\n        </div>\n        <div class=\"table-responsive\">\n            <table class=\"data-table\">\n                <thead>\n                    <tr>\n                        <th>STT</th>\n                        <th>M√£ d·ªãch v·ª•</th>\n                        <th>T√™n d·ªãch v·ª•</th>\n                        <th>S·ªë l∆∞·ª£ng</th>\n                        <th>Gi√° d·ªãch v·ª•</th>\n                        <th>Doanh thu</th>\n                        <th>T·ª∑ l·ªá</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    {% for dv in dich_vu_list|default([]) %}\n                        <tr>\n                            <td>{{ loop.index }}</td>\n                            <td>{{ dv.MaDV }}</td>\n                            <td>{{ dv.TenDV }}</td>\n                            <td>{{ dv.SoLuong }}</td>\n                            <td>{{ \"{:,.0f}\".format(dv.Gia) }} VNƒê</td>\n                            <td>{{ \"{:,.0f}\".format(dv.DoanhThu) }} VNƒê</td>\n                            <td>{{ \"%.2f\"|format(dv.TyLe) }}%</td>\n                        </tr>\n                    {% endfor %}\n                </tbody>\n                <tfoot>\n                    <tr>\n                        <td colspan=\"3\" class=\"text-right\"><strong>T·ªïng c·ªông:</strong></td>\n                        <td><strong>{{ tong_so_luong|default(0) }}</strong></td>\n                        <td></td>\n                        <td><strong>{{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê</strong></td>\n                        <td><strong>100%</strong></td>\n                    </tr>\n                </tfoot>\n            </table>\n        </div>\n    </div>\n    \n    <div class=\"report-footer\">\n        <div class=\"footer-actions\">\n            <a href=\"{{ url_for('bao_cao') }}\" class=\"btn btn-secondary\">\n                <i class=\"fas fa-arrow-left\"></i> Quay l·∫°i\n            </a>\n            <a href=\"{{ url_for('index') }}\" class=\"btn btn-primary\">\n                <i class=\"fas fa-home\"></i> Trang ch·ªß\n            </a>\n        </div>\n    </div>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js\"></script>\n<script>\n    document.addEventListener('DOMContentLoaded', function() {\n        // ƒêƒÉng k√Ω plugin datalabels\n        Chart.register(ChartDataLabels);\n        \n        // ƒê·ªãnh d·∫°ng s·ªë ti·ªÅn VNƒê\n        function formatCurrency(value) {\n            return new Intl.NumberFormat('vi-VN', {\n                style: 'currency',\n                currency: 'VND',\n                maximumFractionDigits: 0\n            }).format(value);\n        }\n        \n        // M√†u s·∫Øc cho bi·ªÉu ƒë·ªì\n        const chartColors = [\n            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',\n            '#5a5c69', '#858796', '#6610f2', '#fd7e14', '#20c9a6',\n            '#3498db', '#9b59b6', '#e67e22', '#27ae60', '#2c3e50'\n        ];\n        \n        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª•\n        const serviceCtx = document.getElementById('serviceChart').getContext('2d');\n        const serviceLabels = {{ dich_vu_labels|default('[]')|safe }};\n        const serviceData = {{ dich_vu_data|default('[]')|safe }};\n        \n        if (serviceLabels.length > 0 && serviceData.length > 0) {\n            const serviceChart = new Chart(serviceCtx, {\n                type: 'doughnut',\n                data: {\n                    labels: serviceLabels,\n                    datasets: [{\n                        label: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•',\n                        data: serviceData,\n                        backgroundColor: chartColors,\n                        borderWidth: 1,\n                        hoverOffset: 15\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            position: 'right',\n                            labels: {\n                                boxWidth: 15,\n                                padding: 15,\n                                font: {\n                                    size: 12\n                                }\n                            }\n                        },\n                        tooltip: {\n                            callbacks: {\n                                label: function(context) {\n                                    const label = context.label || '';\n                                    const value = context.raw || 0;\n                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                    const percentage = Math.round((value / total) * 100);\n                                    return `${label}: ${value} (${percentage}%)`;\n                                }\n                            }\n                        },\n                        datalabels: {\n                            formatter: (value, ctx) => {\n                                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);\n                                const percentage = Math.round((value / total) * 100);\n                                return percentage > 5 ? `${percentage}%` : '';\n                            },\n                            color: '#fff',\n                            font: {\n                                weight: 'bold',\n                                size: 12\n                            }\n                        }\n                    }\n                }\n            });\n        } else {\n            document.getElementById('serviceChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n        }\n        \n        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì doanh thu d·ªãch v·ª•\n        const revenueCtx = document.getElementById('serviceRevenueChart').getContext('2d');\n        const revenueData = {{ doanh_thu_data|default('[]')|safe }};\n        \n        if (serviceLabels.length > 0 && revenueData.length > 0) {\n            const revenueChart = new Chart(revenueCtx, {\n                type: 'bar',\n                data: {\n                    labels: serviceLabels,\n                    datasets: [{\n                        label: 'Doanh thu',\n                        data: revenueData,\n                        backgroundColor: chartColors.slice(0, serviceLabels.length),\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    scales: {\n                        y: {\n                            beginAtZero: true,\n                            ticks: {\n                                callback: function(value) {\n                                    return formatCurrency(value);\n                                }\n                            }\n                        }\n                    },\n                    plugins: {\n                        tooltip: {\n                            callbacks: {\n                                label: function(context) {\n                                    return `Doanh thu: ${formatCurrency(context.raw)}`;\n                                }\n                            }\n                        },\n                        datalabels: {\n                            anchor: 'end',\n                            align: 'top',\n                            formatter: (value) => {\n                                return formatCurrency(value);\n                            },\n                            color: '#333',\n                            font: {\n                                weight: 'bold',\n                                size: 11\n                            },\n                            padding: {\n                                top: 5\n                            }\n                        }\n                    }\n                }\n            });\n        } else {\n            document.getElementById('serviceRevenueChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n        }\n        \n        // D·ªØ li·ªáu cho bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng d·ªãch v·ª• theo th√°ng\n        const monthlyCtx = document.getElementById('monthlyServiceChart').getContext('2d');\n        const monthLabels = {{ thang_labels|default('[]')|safe }};\n        const monthData = {{ thang_data|default('[]')|safe }};\n        \n        if (monthLabels.length > 0) {\n            const monthlyChart = new Chart(monthlyCtx, {\n                type: 'line',\n                data: {\n                    labels: monthLabels,\n                    datasets: [{\n                        label: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•',\n                        data: monthData,\n                        backgroundColor: 'rgba(78, 115, 223, 0.2)',\n                        borderColor: 'rgba(78, 115, 223, 1)',\n                        borderWidth: 2,\n                        pointBackgroundColor: 'rgba(78, 115, 223, 1)',\n                        pointBorderColor: '#fff',\n                        pointHoverBackgroundColor: '#fff',\n                        pointHoverBorderColor: 'rgba(78, 115, 223, 1)',\n                        pointRadius: 4,\n                        tension: 0.3\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: true,\n                            position: 'top'\n                        },\n                        tooltip: {\n                            callbacks: {\n                                label: function(context) {\n                                    return `S·ªë l∆∞·ª£ng: ${context.raw}`;\n                                }\n                            }\n                        },\n                        datalabels: {\n                            display: false\n                        }\n                    },\n                    scales: {\n                        y: {\n                            beginAtZero: true,\n                            ticks: {\n                                precision: 0\n                            },\n                            title: {\n                                display: true,\n                                text: 'S·ªë l∆∞·ª£ng d·ªãch v·ª•'\n                            }\n                        },\n                        x: {\n                            title: {\n                                display: true,\n                                text: 'Th√°ng'\n                            }\n                        }\n                    }\n                }\n            });\n        } else {\n            document.getElementById('monthlyServiceChart').parentNode.innerHTML = '<div class=\"no-data-message\">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì</div>';\n        }\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán n√∫t in\n        document.getElementById('printBtn').addEventListener('click', function() {\n            window.print();\n        });\n        \n        // X·ª≠ l√Ω s·ª± ki·ªán xu·∫•t Excel\n        document.getElementById('exportBtn').addEventListener('click', function() {\n            exportToExcel();\n        });\n        \n        // H√†m xu·∫•t Excel\n        function exportToExcel() {\n            // L·∫•y d·ªØ li·ªáu t·ª´ b·∫£ng\n            const table = document.querySelector('.data-table');\n            const rows = table.querySelectorAll('tr');\n            \n            // T·∫°o workbook v√† worksheet\n            const wb = XLSX.utils.book_new();\n            const wsData = [];\n            \n            // Th√™m ti√™u ƒë·ªÅ b√°o c√°o\n            wsData.push(['B√ÅO C√ÅO S·ª¨ D·ª§NG D·ªäCH V·ª§']);\n            wsData.push([`T·ª´ ng√†y: {{ tu_ngay }} - ƒê·∫øn ng√†y: {{ den_ngay }}`]);\n            wsData.push([`T·ªïng s·ªë d·ªãch v·ª•: {{ tong_dich_vu|default(0) }}/{{ tong_dich_vu_he_thong|default(0) }}`]);\n            wsData.push([`D·ªãch v·ª• ph·ªï bi·∫øn nh·∫•t: {{ dich_vu_pho_bien|default('Kh√¥ng c√≥ d·ªØ li·ªáu') }}`]);\n            wsData.push([`T·ªïng l∆∞·ª£t s·ª≠ d·ª•ng: {{ tong_so_luong|default(0) }}`]);\n            wsData.push([`T·ªïng doanh thu: {{ \"{:,.0f}\".format(tong_doanh_thu|default(0)) }} VNƒê`]);\n            wsData.push([]);\n            \n            // Th√™m th√¥ng tin th·ªëng k√™ theo th√°ng\n            wsData.push(['TH·ªêNG K√ä THEO TH√ÅNG']);\n            wsData.push([`S·ªë l∆∞·ª£t s·ª≠ d·ª•ng trong th√°ng hi·ªán t·∫°i: {{ so_luong_thang|default(0) }}`]);\n            wsData.push([`S·ªë l∆∞·ª£t s·ª≠ d·ª•ng trong th√°ng tr∆∞·ªõc: {{ so_luong_thang_truoc|default(0) }}`]);\n            wsData.push([`T·ª∑ l·ªá tƒÉng tr∆∞·ªüng: {{ \"%.2f\"|format(ty_le_tang_truong|default(0)) }}%`]);\n            wsData.push([]);\n            \n            // Th√™m d·ªØ li·ªáu t·ª´ b·∫£ng\n            rows.forEach(row => {\n                const rowData = [];\n                row.querySelectorAll('th, td').forEach(cell => {\n                    rowData.push(cell.textContent.trim());\n                });\n                wsData.push(rowData);\n            });\n            \n            // T·∫°o worksheet v√† th√™m v√†o workbook\n            const ws = XLSX.utils.aoa_to_sheet(wsData);\n            \n            // ƒê·ªãnh d·∫°ng ti√™u ƒë·ªÅ\n            ws['!cols'] = [\n                { wch: 5 }, // STT\n                { wch: 10 }, // M√£ d·ªãch v·ª•\n                { wch: 30 }, // T√™n d·ªãch v·ª•\n                { wch: 10 }, // S·ªë l∆∞·ª£ng\n                { wch: 15 }, // Gi√° d·ªãch v·ª•\n                { wch: 15 }, // Doanh thu\n                { wch: 10 }  // T·ª∑ l·ªá\n            ];\n            \n            XLSX.utils.book_append_sheet(wb, ws, 'B√°o c√°o d·ªãch v·ª•');\n            \n            // Xu·∫•t file Excel\n            XLSX.writeFile(wb, `Bao_cao_dich_vu_${new Date().toISOString().slice(0, 10)}.xlsx`);\n            \n            // Th√¥ng b√°o xu·∫•t th√†nh c√¥ng\n            alert('Xu·∫•t b√°o c√°o Excel th√†nh c√¥ng!');\n        }\n    });\n</script>\n{% endblock %}\n\n{% block extra_css %}\n<style>\n    /* Thi·∫øt l·∫≠p chung */\n    .content-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 20px;\n    }\n    \n    .content-header h2 {\n        margin: 0;\n        color: var(--primary-color);\n        font-size: 24px;\n    }\n    \n    .header-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Ph·∫ßn l·ªçc */\n    .filter-container {\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        padding: 20px;\n        margin-bottom: 20px;\n        border-left: 4px solid var(--primary-color);\n    }\n    \n    .filter-form {\n        display: flex;\n        align-items: flex-end;\n        gap: 20px;\n    }\n    \n    .filter-form .form-group {\n        flex: 1;\n    }\n    \n    .filter-form label {\n        display: block;\n        margin-bottom: 5px;\n        font-weight: 500;\n        color: #333;\n    }\n    \n    .filter-form input {\n        width: 100%;\n        padding: 10px 12px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        font-size: 14px;\n        transition: border-color 0.3s;\n    }\n    \n    .filter-form input:focus {\n        border-color: var(--primary-color);\n        outline: none;\n        box-shadow: 0 0 0 2px rgba(78, 115, 223, 0.25);\n    }\n    \n    .form-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Container b√°o c√°o */\n    .report-container {\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        padding: 25px;\n    }\n    \n    /* Header b√°o c√°o */\n    .report-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        margin-bottom: 25px;\n        padding-bottom: 20px;\n        border-bottom: 1px solid #eee;\n    }\n    \n    .report-logo {\n        display: flex;\n        align-items: center;\n    }\n    \n    .report-logo img {\n        width: 45px;\n        height: 45px;\n        margin-right: 12px;\n        object-fit: contain;\n    }\n    \n    .report-logo h4 {\n        margin: 0;\n        font-size: 16px;\n        color: #333;\n    }\n    \n    .report-title h3 {\n        margin: 0 0 8px;\n        font-size: 22px;\n        color: var(--primary-color);\n        font-weight: 700;\n    }\n    \n    .report-title p {\n        margin: 0;\n        color: #666;\n        font-size: 14px;\n    }\n    \n    /* Ph·∫ßn t√≥m t·∫Øt */\n    .report-summary {\n        display: flex;\n        justify-content: space-between;\n        margin-bottom: 25px;\n        padding: 20px;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.05);\n    }\n    \n    /* Th·ªëng k√™ theo th√°ng */\n    .monthly-stats {\n        margin-bottom: 25px;\n        padding: 20px;\n        background-color: #fff;\n        border-radius: 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        border: 1px solid #eee;\n    }\n    \n    .monthly-stats-header {\n        margin-bottom: 15px;\n    }\n    \n    .monthly-stats-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .monthly-stats-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .monthly-stats-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    .monthly-stats-content {\n        display: flex;\n        justify-content: space-between;\n        gap: 20px;\n    }\n    \n    .monthly-stat-item {\n        flex: 1;\n        display: flex;\n        align-items: center;\n        padding: 15px;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        transition: transform 0.3s, box-shadow 0.3s;\n    }\n    \n    .monthly-stat-item:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n        background-color: #fff;\n    }\n    \n    .monthly-stat-icon {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: rgba(78, 115, 223, 0.1);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 15px;\n    }\n    \n    .monthly-stat-icon i {\n        font-size: 20px;\n        color: var(--primary-color);\n    }\n    \n    .monthly-stat-info {\n        flex: 1;\n    }\n    \n    .monthly-stat-label {\n        font-size: 14px;\n        color: #666;\n        margin-bottom: 5px;\n    }\n    \n    .monthly-stat-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: var(--primary-color);\n        margin-bottom: 5px;\n    }\n    \n    .monthly-stat-desc {\n        font-size: 12px;\n        color: #888;\n        font-style: italic;\n    }\n    \n    .text-success {\n        color: #28a745 !important;\n    }\n    \n    .text-danger {\n        color: #dc3545 !important;\n    }\n    \n    .summary-item {\n        text-align: center;\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 15px;\n        border-radius: 6px;\n        transition: transform 0.3s, box-shadow 0.3s;\n    }\n    \n    .summary-item:hover {\n        transform: translateY(-5px);\n        box-shadow: 0 5px 15px rgba(0,0,0,0.1);\n        background-color: #fff;\n    }\n    \n    .summary-icon {\n        width: 50px;\n        height: 50px;\n        border-radius: 50%;\n        background-color: rgba(78, 115, 223, 0.1);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom: 10px;\n    }\n    \n    .summary-icon i {\n        font-size: 20px;\n        color: var(--primary-color);\n    }\n    \n    .summary-label {\n        font-size: 14px;\n        color: #666;\n        margin-bottom: 8px;\n    }\n    \n    .summary-value {\n        font-size: 20px;\n        font-weight: 700;\n        color: var(--primary-color);\n        margin-bottom: 5px;\n    }\n    \n    .summary-desc {\n        font-size: 12px;\n        color: #888;\n        font-style: italic;\n    }\n    \n    /* Ph·∫ßn bi·ªÉu ƒë·ªì */\n    .chart-section {\n        display: flex;\n        gap: 25px;\n        margin-bottom: 30px;\n    }\n    \n    .chart-container {\n        flex: 1;\n        background-color: #fff;\n        border-radius: 8px;\n        padding: 20px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n        border: 1px solid #eee;\n        height: 400px;\n        position: relative;\n    }\n    \n    .chart-header {\n        margin-bottom: 15px;\n    }\n    \n    .chart-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .chart-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .chart-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    /* Ph·∫ßn b·∫£ng */\n    .table-section {\n        margin-bottom: 30px;\n        background-color: #fff;\n        border-radius: 8px;\n        padding: 20px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n    }\n    \n    .table-header {\n        margin-bottom: 15px;\n    }\n    \n    .table-header h4 {\n        margin: 0 0 5px;\n        font-size: 16px;\n        color: #333;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n    }\n    \n    .table-header h4 i {\n        color: var(--primary-color);\n    }\n    \n    .table-description {\n        margin: 0;\n        font-size: 13px;\n        color: #666;\n        font-style: italic;\n    }\n    \n    .table-responsive {\n        overflow-x: auto;\n    }\n    \n    .data-table {\n        width: 100%;\n        border-collapse: collapse;\n        border: 1px solid #e3e6f0;\n    }\n    \n    .data-table th, .data-table td {\n        padding: 12px 15px;\n        text-align: left;\n        border-bottom: 1px solid #e3e6f0;\n    }\n    \n    .data-table th {\n        background-color: #f8f9fc;\n        font-weight: 600;\n        color: #4e73df;\n        white-space: nowrap;\n    }\n    \n    .data-table tbody tr:hover {\n        background-color: #f8f9fc;\n    }\n    \n    .data-table tbody tr:nth-child(even) {\n        background-color: #f9fafc;\n    }\n    \n    .data-table tfoot {\n        font-weight: bold;\n        background-color: #f1f3f9;\n    }\n    \n    .text-right {\n        text-align: right;\n    }\n    \n    /* Footer b√°o c√°o */\n    .report-footer {\n        margin-top: 30px;\n        display: flex;\n        justify-content: flex-end;\n        padding-top: 20px;\n        border-top: 1px solid #eee;\n    }\n    \n    .footer-actions {\n        display: flex;\n        gap: 10px;\n    }\n    \n    /* Th√¥ng b√°o kh√¥ng c√≥ d·ªØ li·ªáu */\n    .no-data-message {\n        padding: 30px;\n        text-align: center;\n        color: #666;\n        font-style: italic;\n        background-color: #f8f9fc;\n        border-radius: 8px;\n        margin: 20px 0;\n    }\n    \n    /* Responsive */\n    @media (max-width: 992px) {\n        .chart-section {\n            flex-direction: column;\n        }\n        \n        .chart-container {\n            height: 350px;\n        }\n    }\n    \n    @media (max-width: 768px) {\n        .filter-form {\n            flex-direction: column;\n            align-items: stretch;\n        }\n        \n        .report-summary {\n            flex-direction: column;\n            gap: 15px;\n        }\n        \n        .summary-item {\n            padding: 10px;\n        }\n        \n        .monthly-stats-content {\n            flex-direction: column;\n            gap: 15px;\n        }\n        \n        .monthly-stat-item {\n            padding: 10px;\n        }\n    }\n    \n    /* Thi·∫øt l·∫≠p in ·∫•n */\n    @media print {\n        body {\n            background-color: white;\n            font-size: 12pt;\n        }\n        \n        .section-title, .content-header, .filter-container, .footer-actions {\n            display: none !important;\n        }\n        \n        .report-container {\n            box-shadow: none !important;\n            padding: 0 !important;\n        }\n        \n        .report-summary, .monthly-stats {\n            page-break-inside: avoid;\n        }\n        \n        .chart-section {\n            page-break-inside: avoid;\n        }\n        \n        .chart-container {\n            height: 300px !important;\n            page-break-inside: avoid;\n        }\n        \n        .table-section {\n            page-break-inside: avoid;\n        }\n        \n        .data-table th, .data-table td {\n            padding: 8px;\n        }\n        \n        .monthly-stats {\n            border: 1px solid #ddd !important;\n            padding: 15px !important;\n            margin-bottom: 20px !important;\n        }\n        \n        .monthly-stat-item {\n            border: 1px solid #eee !important;\n        }\n    }\n</style>\n{% endblock %}","language":"html"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745603137692,"isInternal":false},{"id":"643efc91-0f2b-47ae-b113-d3528bc5eace","role":"assistant","createdAt":1745603152467,"content":[{"type":"text","text":"T√¥i s·∫Ω x√≥a t·∫•t c·∫£ c√°c ch·ª©c nƒÉng con c·ªßa B√°o c√°o - Th·ªëng k√™, ch·ªâ gi·ªØ l·∫°i ch·ª©c nƒÉng ch√≠nh. ƒê·∫ßu ti√™n, t√¥i s·∫Ω xem c·∫•u tr√∫c c·ªßa c√°c ch·ª©c nƒÉng b√°o c√°o trong app.py:"},{"type":"toolCall","toolCallId":"toolu_017YjQ4m7sgroi16TNQQBV3o","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω x√≥a t·∫•t c·∫£ c√°c ch·ª©c nƒÉng con, ch·ªâ gi·ªØ l·∫°i ch·ª©c nƒÉng ch√≠nh `/bao-cao`:"},{"type":"toolCall","toolCallId":"toolu_01HxnR3dWdZeV3QNrsk3GX52","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -699,79 +699,5 @@\n         flash(f'L·ªói khi t·∫£i d·ªØ li·ªáu b√°o c√°o: {str(e)}', 'error')\n         return render_template('bao_cao.html')\n \n-@app.route('/bao-cao/luot-kham', methods=['GET', 'POST'])\n-def bao_cao_luot_kham():\n-    \"\"\"Th·ªëng k√™ s·ªë l∆∞·ª£t kh√°m t·ª´ b·∫£ng PHIEUKHAM t·ª´ c∆° s·ªü d·ªØ li·ªáu theo ng√†y, th√°ng ho·∫∑c kho·∫£ng th·ªùi gian\"\"\"\n-    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n-    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n-    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'\n-    \n-    try:\n-        # L·∫•y d·ªØ li·ªáu b√°o c√°o l∆∞·ª£t kh√°m\n-        data = get_bao_cao_luot_kham(tu_ngay, den_ngay, loai_bao_cao)\n-        return render_template('bao_cao_luot_kham.html', **data)\n-    except Exception as e:\n-        flash(f'L·ªói khi t·∫£i d·ªØ li·ªáu b√°o c√°o l∆∞·ª£t kh√°m: {str(e)}', 'error')\n-        return render_template('bao_cao_luot_kham.html')\n-\n-@app.route('/bao-cao/dich-vu', methods=['GET', 'POST'])\n-def bao_cao_dich_vu():\n-    \"\"\"B√°o c√°o chi ti·∫øt v·ªÅ d·ªãch v·ª•\"\"\"\n-    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n-    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n-    \n-    # L·∫•y d·ªØ li·ªáu b√°o c√°o d·ªãch v·ª• - h√†m ƒë√£ x·ª≠ l√Ω l·ªói b√™n trong\n-    data = get_bao_cao_dich_vu(tu_ngay, den_ngay)\n-    \n-    # N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu, hi·ªÉn th·ªã th√¥ng b√°o\n-    if not data.get('dich_vu_list'):\n-        flash('Kh√¥ng c√≥ d·ªØ li·ªáu d·ªãch v·ª• trong kho·∫£ng th·ªùi gian ƒë√£ ch·ªçn', 'info')\n-    \n-    return render_template('bao_cao_dich_vu.html', **data)\n-\n-@app.route('/bao-cao/luong-dich-vu', methods=['GET', 'POST'])\n-def bao_cao_luong_dich_vu():\n-    \"\"\"B√°o c√°o l∆∞·ª£ng d·ªãch v·ª• - hi·ªÉn th·ªã t·ª∑ l·ªá s·ª≠ d·ª•ng c√°c d·ªãch v·ª• t·ª´ b·∫£ng PHIEUKHAM\"\"\"\n-    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n-    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n-    \n-    try:\n-        # S·ª≠ d·ª•ng h√†m get_bao_cao_luong_dich_vu ƒë·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ b·∫£ng PHIEUKHAM\n-        data = get_bao_cao_luong_dich_vu(tu_ngay, den_ngay)\n-        return render_template('bao_cao_luong_dich_vu.html', **data)\n-    except Exception as e:\n-        flash(f'L·ªói khi t·∫£i d·ªØ li·ªáu b√°o c√°o l∆∞·ª£ng d·ªãch v·ª•: {str(e)}', 'error')\n-        return render_template('bao_cao_luong_dich_vu.html')\n-\n-@app.route('/bao-cao/benh-nhan', methods=['GET', 'POST'])\n-def bao_cao_benh_nhan():\n-    \"\"\"B√°o c√°o chi ti·∫øt v·ªÅ b·ªánh nh√¢n\"\"\"\n-    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n-    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n-    loai_bao_cao = request.form.get('loai_bao_cao', 'all') if request.method == 'POST' else 'all'\n-    \n-    try:\n-        # L·∫•y d·ªØ li·ªáu b√°o c√°o b·ªánh nh√¢n\n-        data = get_bao_cao_benh_nhan(tu_ngay, den_ngay, loai_bao_cao)\n-        return render_template('bao_cao_benh_nhan.html', **data)\n-    except Exception as e:\n-        flash(f'L·ªói khi t·∫£i d·ªØ li·ªáu b√°o c√°o b·ªánh nh√¢n: {str(e)}', 'error')\n-        return render_template('bao_cao_benh_nhan.html')\n-\n-@app.route('/bao-cao/doanh-thu', methods=['GET', 'POST'])\n-def bao_cao_doanh_thu():\n-    \"\"\"B√°o c√°o chi ti·∫øt v·ªÅ doanh thu\"\"\"\n-    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None\n-    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None\n-    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'\n-    \n-    try:\n-        # L·∫•y d·ªØ li·ªáu b√°o c√°o doanh thu\n-        data = get_bao_cao_doanh_thu(tu_ngay, den_ngay, loai_bao_cao)\n-        return render_template('bao_cao_doanh_thu.html', **data)\n-    except Exception as e:\n-        flash(f'L·ªói khi t·∫£i d·ªØ li·ªáu b√°o c√°o doanh thu: {str(e)}', 'error')\n-        return render_template('bao_cao_doanh_thu.html')\n-\n if __name__ == '__main__':\n     app.run(host='0.0.0.0', port=5001, debug=True)","refToolCallId":"toolu_01HxnR3dWdZeV3QNrsk3GX52"},{"type":"text","text":"B√¢y gi·ªù t√¥i s·∫Ω x√≥a c√°c h√†m li√™n quan ƒë·∫øn b√°o c√°o con trong file database/bao_cao.py, ch·ªâ gi·ªØ l·∫°i h√†m get_tong_quan_bao_cao:"},{"type":"toolCall","toolCallId":"toolu_01HVeGEEBDRFU3isGBfHi95S","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"toolCall","toolCallId":"toolu_01RMjoTBxiBFGFEUP1P3QC1y","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"text","text":"T√¥i s·∫Ω x√≥a t·∫•t c·∫£ c√°c h√†m b√°o c√°o con, ch·ªâ gi·ªØ l·∫°i h√†m get_tong_quan_bao_cao:"},{"type":"toolCall","toolCallId":"toolu_01P9wugRxKwAg92WtF5Nzy3R","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"codeHunk","lineBasedDiff":"","refToolCallId":"toolu_01P9wugRxKwAg92WtF5Nzy3R"},{"type":"text","text":"T√¥i c·∫ßn x√≥a t·∫•t c·∫£ c√°c h√†m b√°o c√°o con c√≤n l·∫°i:"},{"type":"toolCall","toolCallId":"toolu_016CJ2oncDs2kjme2N3Gn2Ff","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"toolCall","toolCallId":"toolu_01DhDHDA8fgff4Xu4C3nW3nW","isHidden":true,"title":"","statusText":"","status":"IN_PROGRESS","localResult":"{\"status\":\"UNRECOGNIZED\",\"output\":\"1172 /home/huong/nhakhoaso/database/bao_cao.py\\n\"}"},{"type":"codePatch","diffs":[{"path":"nhakhoaso/database/bao_cao.py","patch":"","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/app.py","patch":"@@ -26300,3634 +26300,8 @@\n ')%0A%0A\n-@app.route('/bao-cao/luot-kham', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_luot_kham():%0A    %22%22%22Th%E1%BB%91ng k%C3%AA s%E1%BB%91 l%C6%B0%E1%BB%A3t kh%C3%A1m t%E1%BB%AB b%E1%BA%A3ng PHIEUKHAM t%E1%BB%AB c%C6%A1 s%E1%BB%9F d%E1%BB%AF li%E1%BB%87u theo ng%C3%A0y, th%C3%A1ng ho%E1%BA%B7c kho%E1%BA%A3ng th%E1%BB%9Di gian%22%22%22%0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'%0A    %0A    try:%0A        # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o l%C6%B0%E1%BB%A3t kh%C3%A1m%0A        data = get_bao_cao_luot_kham(tu_ngay, den_ngay, loai_bao_cao)%0A        return render_template('bao_cao_luot_kham.html', **data)%0A    except Exception as e:%0A        flash(f'L%E1%BB%97i khi t%E1%BA%A3i d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o l%C6%B0%E1%BB%A3t kh%C3%A1m: %7Bstr(e)%7D', 'error')%0A        return render_template('bao_cao_luot_kham.html')%0A%0A@app.route('/bao-cao/dich-vu', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_dich_vu():%0A    %22%22%22B%C3%A1o c%C3%A1o chi ti%E1%BA%BFt v%E1%BB%81 d%E1%BB%8Bch v%E1%BB%A5%22%22%22%0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 - h%C3%A0m %C4%91%C3%A3 x%E1%BB%AD l%C3%BD l%E1%BB%97i b%C3%AAn trong%0A    data = get_bao_cao_dich_vu(tu_ngay, den_ngay)%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u, hi%E1%BB%83n th%E1%BB%8B th%C3%B4ng b%C3%A1o%0A    if not data.get('dich_vu_list'):%0A        flash('Kh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u d%E1%BB%8Bch v%E1%BB%A5 trong kho%E1%BA%A3ng th%E1%BB%9Di gian %C4%91%C3%A3 ch%E1%BB%8Dn', 'info')%0A    %0A    return render_template('bao_cao_dich_vu.html', **data)%0A%0A@app.route('/bao-cao/luong-dich-vu', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_luong_dich_vu():%0A    %22%22%22B%C3%A1o c%C3%A1o l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5 - hi%E1%BB%83n th%E1%BB%8B t%E1%BB%B7 l%E1%BB%87 s%E1%BB%AD d%E1%BB%A5ng c%C3%A1c d%E1%BB%8Bch v%E1%BB%A5 t%E1%BB%AB b%E1%BA%A3ng PHIEUKHAM%22%22%22%0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    %0A    try:%0A        # S%E1%BB%AD d%E1%BB%A5ng h%C3%A0m get_bao_cao_luong_dich_vu %C4%91%E1%BB%83 l%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u t%E1%BB%AB b%E1%BA%A3ng PHIEUKHAM%0A        data = get_bao_cao_luong_dich_vu(tu_ngay, den_ngay)%0A        return render_template('bao_cao_luong_dich_vu.html', **data)%0A    except Exception as e:%0A        flash(f'L%E1%BB%97i khi t%E1%BA%A3i d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o l%C6%B0%E1%BB%A3ng d%E1%BB%8Bch v%E1%BB%A5: %7Bstr(e)%7D', 'error')%0A        return render_template('bao_cao_luong_dich_vu.html')%0A%0A@app.route('/bao-cao/benh-nhan', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_benh_nhan():%0A    %22%22%22B%C3%A1o c%C3%A1o chi ti%E1%BA%BFt v%E1%BB%81 b%E1%BB%87nh nh%C3%A2n%22%22%22%0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    loai_bao_cao = request.form.get('loai_bao_cao', 'all') if request.method == 'POST' else 'all'%0A    %0A    try:%0A        # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n%0A        data = get_bao_cao_benh_nhan(tu_ngay, den_ngay, loai_bao_cao)%0A        return render_template('bao_cao_benh_nhan.html', **data)%0A    except Exception as e:%0A        flash(f'L%E1%BB%97i khi t%E1%BA%A3i d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o b%E1%BB%87nh nh%C3%A2n: %7Bstr(e)%7D', 'error')%0A        return render_template('bao_cao_benh_nhan.html')%0A%0A@app.route('/bao-cao/doanh-thu', methods=%5B'GET', 'POST'%5D)%0Adef bao_cao_doanh_thu():%0A    %22%22%22B%C3%A1o c%C3%A1o chi ti%E1%BA%BFt v%E1%BB%81 doanh thu%22%22%22%0A    tu_ngay = request.form.get('tu_ngay') if request.method == 'POST' else None%0A    den_ngay = request.form.get('den_ngay') if request.method == 'POST' else None%0A    loai_bao_cao = request.form.get('loai_bao_cao', 'day') if request.method == 'POST' else 'day'%0A    %0A    try:%0A        # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o doanh thu%0A        data = get_bao_cao_doanh_thu(tu_ngay, den_ngay, loai_bao_cao)%0A        return render_template('bao_cao_doanh_thu.html', **data)%0A    except Exception as e:%0A        flash(f'L%E1%BB%97i khi t%E1%BA%A3i d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o doanh thu: %7Bstr(e)%7D', 'error')%0A        return render_template('bao_cao_doanh_thu.html')%0A%0A\n if _\n","isNew":false,"isApplied":true,"isUnread":false}]},{"id":"2fc9964f-32f6-49e2-9199-b7d5e310e0fe","type":"shellCommand","status":"UNRECOGNIZED","shell":"bash","command":"wc -l /home/huong/nhakhoaso/database/bao_cao.py","toolCallId":"toolu_01DhDHDA8fgff4Xu4C3nW3nW","requiresConfirmation":true,"commandsRequiringConfirmation":[],"output":"1172 /home/huong/nhakhoaso/database/bao_cao.py\n","outputPath":"/tmp/8c261190-48e3-4162-b731-0c9214d9a3e1.log"}],"context":{"author":"Coding Agent","operationId":"580a6e1c-0e0e-49cc-a27c-824af8ade99d"},"isInternal":false},{"id":"c475778a-1b55-4263-be39-8f5785c1a9ad","role":"assistant","createdAt":1745603374063,"content":[{"type":"text","text":"T√¥i s·∫Ω x√≥a t·∫•t c·∫£ c√°c h√†m b√°o c√°o con c√≤n l·∫°i:"},{"type":"toolCall","toolCallId":"toolu_01BxG83RP5jmZ5UG8dSA7zxh","isHidden":false,"title":"","statusText":"Analyzing file","status":"IN_PROGRESS"}],"context":{"author":"Coding Agent","operationId":"3825fb85-fd00-48e6-9c22-ab709dab5206"},"isInternal":false}],"isAgent":true,"isCustomAgent":false,"isUnitTestsAgent":false,"autoApply":false}