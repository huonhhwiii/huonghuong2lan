{"id":"a92e2536-ef07-4879-803a-fd8ee2abe21c","title":"Báo Cáo Thống Kê Nhakhoaso","createdAt":1745605982858,"updatedAt":1745606534296,"isNameGenerated":true,"isRenamedByUser":false,"messages":[{"id":"76b53507-57b9-457f-889c-6d91a1a6961c","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"vào nhakhoaso, bạn hãy tạo chức năng lớn Báo cáo-Thống Kê cho tôi: trong đó gồm 1 chức năng con là Báo các dịch vụ sử dụng (thông qua phiếu khám) sao cho chỉ lấy được lấy dữ liệu ở CSDL mà tôi tạo thôi, bạn hãy tự sáng tạo chức năng này"}]}]},"content":[{"type":"text","text":"vào nhakhoaso, bạn hãy tạo chức năng lớn Báo cáo-Thống Kê cho tôi: trong đó gồm 1 chức năng con là Báo các dịch vụ sử dụng (thông qua phiếu khám) sao cho chỉ lấy được lấy dữ liệu ở CSDL mà tôi tạo thôi, bạn hãy tự sáng tạo chức năng này"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/templates/index.html","path":"nhakhoaso/templates/index.html","displayPath":"nhakhoaso/templates/index.html","content":"{% extends 'layout.html' %}\n\n{% block content %}\n<div class=\"section-title\">\n    <h2>SERVICES</h2>\n</div>\n\n<div class=\"services-grid\">\n    <!-- Quản lý bệnh nhân -->\n    <div class=\"service-card\" data-link=\"{{ url_for('benh_nhan_list') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-user-injured\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý bệnh nhân</h3>\n        <p class=\"service-description\">Theo dõi thông tin cá nhân, lịch sử điều trị, hồ sơ bệnh án của bệnh nhân.</p>\n        <a href=\"{{ url_for('benh_nhan_list') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n\n    <!-- Quản lý bác sĩ -->\n    <div class=\"service-card\" data-link=\"{{ url_for('bac_si_list') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-user-md\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý bác sĩ</h3>\n        <p class=\"service-description\">Quản lý thông tin cá nhân, lịch làm việc và chuyên môn của các bác sĩ.</p>\n        <a href=\"{{ url_for('bac_si_list') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n\n    <!-- Quản lý phiếu khám -->\n    <div class=\"service-card\" data-link=\"{{ url_for('phieu_kham_list') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-clipboard-list\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý phiếu khám</h3>\n        <p class=\"service-description\">Tạo và quản lý phiếu khám, lưu trữ nội dung khám bệnh.</p>\n        <a href=\"{{ url_for('phieu_kham_list') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n\n    <!-- Quản lý lịch hẹn -->\n    <div class=\"service-card\" data-link=\"{{ url_for('lich_hen_list') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-calendar-check\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý lịch hẹn</h3>\n        <p class=\"service-description\">Đặt lịch hẹn khám, nhắc lịch, điều phối thời gian giữa bệnh nhân và bác sĩ.</p>\n        <a href=\"{{ url_for('lich_hen_list') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n\n    <!-- Quản lý dịch vụ -->\n    <div class=\"service-card\" data-link=\"{{ url_for('dich_vu_list') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-hand-holding-heart\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý dịch vụ</h3>\n        <p class=\"service-description\">Quản lý các loại dịch vụ nha khoa như nhổ răng, trám răng, tẩy trắng...</p>\n        <a href=\"{{ url_for('dich_vu_list') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n\n\n\n    <!-- Quản lý phòng khám -->\n    <div class=\"service-card\" data-link=\"{{ url_for('index') }}\">\n        <div class=\"service-icon\">\n            <i class=\"fas fa-hospital\"></i>\n        </div>\n        <h3 class=\"service-title\">Quản lý phòng khám</h3>\n        <p class=\"service-description\">Quản lý thông tin phòng khám, cài đặt hệ thống và tùy chỉnh.</p>\n        <a href=\"{{ url_for('index') }}\" class=\"btn\">Xem chi tiết</a>\n    </div>\n</div>\n{% endblock %}","language":"html"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745605982858,"isInternal":false},{"id":"d3b865a8-7f03-4c1f-aa1e-2631954db017","role":"assistant","createdAt":1745605989181,"content":[{"type":"text","text":"Tôi sẽ giúp bạn tạo chức năng Báo cáo-Thống kê với chức năng con là Báo cáo dịch vụ sử dụng thông qua phiếu khám. Trước tiên, tôi cần tìm hiểu cấu trúc dự án và mô hình dữ liệu để có thể triển khai chức năng này một cách phù hợp."},{"type":"toolCall","toolCallId":"toolu_011BoMHaJsdXMvY4fG9AgjU7","isHidden":false,"title":"","statusText":"Viewed root folder","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong","path":"","displayPath":""}]}},{"type":"text","text":"Tôi sẽ tìm hiểu cấu trúc của dự án nhakhoaso để hiểu rõ hơn về mô hình dữ liệu và cách triển khai chức năng báo cáo."},{"type":"toolCall","toolCallId":"toolu_016oCFLhc1AvyBZtWpeSKqVE","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"text","text":"Tôi cần xem thêm cấu trúc cơ sở dữ liệu để hiểu mối quan hệ giữa phiếu khám và dịch vụ:"},{"type":"toolCall","toolCallId":"toolu_01XUNSSJL2iaG8u7U5tE9wyh","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/init_db.sql","path":"nhakhoaso/database/init_db.sql","displayPath":"nhakhoaso/database/init_db.sql"}]}},{"type":"text","text":"Bây giờ tôi sẽ xem cách triển khai của module phiếu khám để hiểu cách truy vấn dữ liệu:"},{"type":"toolCall","toolCallId":"toolu_01EqpgkiV8vfWa4fsgWqX97N","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/phieu_kham.py","path":"nhakhoaso/database/phieu_kham.py","displayPath":"nhakhoaso/database/phieu_kham.py"}]}},{"type":"text","text":"Bây giờ tôi sẽ xem module dịch vụ để hiểu cách quản lý dịch vụ:"},{"type":"toolCall","toolCallId":"toolu_01UcgZFPY7vpXqccAbXeT4kg","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/dich_vu.py","path":"nhakhoaso/database/dich_vu.py","displayPath":"nhakhoaso/database/dich_vu.py"}]}},{"type":"text","text":"Bây giờ tôi sẽ xem module db để hiểu cách kết nối và truy vấn cơ sở dữ liệu:"},{"type":"toolCall","toolCallId":"toolu_01W5wYouJVtnAx4CCSNurqMR","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/db.py","path":"nhakhoaso/database/db.py","displayPath":"nhakhoaso/database/db.py"}]}},{"type":"text","text":"Bây giờ tôi sẽ xem file layout.html để hiểu cấu trúc giao diện:"},{"type":"toolCall","toolCallId":"toolu_01NRbaTtpo5f3dzT5TFPo1oQ","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/layout.html","path":"nhakhoaso/templates/layout.html","displayPath":"nhakhoaso/templates/layout.html"}]}},{"type":"text","text":"Tôi sẽ xem file sidebar.html để hiểu cấu trúc menu:"},{"type":"toolCall","toolCallId":"toolu_01M8BhiXfM91qzgdKYNGWbz8","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/sidebar.html","path":"nhakhoaso/templates/sidebar.html","displayPath":"nhakhoaso/templates/sidebar.html"}]}},{"type":"text","text":"Dựa trên thông tin đã thu thập, tôi sẽ tạo chức năng Báo cáo-Thống kê với chức năng con là Báo cáo dịch vụ sử dụng thông qua phiếu khám. Đầu tiên, tôi sẽ tạo các file cần thiết:\n\n1. Đầu tiên, tôi sẽ tạo module báo cáo trong thư mục database:"},{"type":"toolCall","toolCallId":"toolu_01G8892wmEEE3h6uAe2RVDhM","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/database/bao_cao.py\n+++ nhakhoaso/database/bao_cao.py\n@@ -0,0 +1,228 @@\n+from .db import execute_query\n+import datetime\n+\n+def thong_ke_dich_vu_su_dung(tu_ngay=None, den_ngay=None):\n+    \"\"\"\n+    Thống kê dịch vụ sử dụng thông qua phiếu khám\n+    \n+    Args:\n+        tu_ngay (str, optional): Ngày bắt đầu thống kê (định dạng YYYY-MM-DD)\n+        den_ngay (str, optional): Ngày kết thúc thống kê (định dạng YYYY-MM-DD)\n+        \n+    Returns:\n+        list: Danh sách dịch vụ đã sử dụng và số lượng\n+    \"\"\"\n+    try:\n+        # Xây dựng câu truy vấn cơ bản\n+        query = \"\"\"\n+        SELECT \n+            dv.MaDV, \n+            dv.TenDV, \n+            dv.Gia, \n+            COUNT(pk.MaPK) as SoLuotSuDung,\n+            SUM(dv.Gia) as TongTien\n+        FROM DICHVU dv\n+        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        \"\"\"\n+        \n+        params = []\n+        where_clauses = []\n+        \n+        # Thêm điều kiện lọc theo ngày nếu có\n+        if tu_ngay:\n+            where_clauses.append(\"pk.NgayKham >= ?\")\n+            params.append(tu_ngay)\n+            \n+        if den_ngay:\n+            where_clauses.append(\"pk.NgayKham <= ?\")\n+            params.append(den_ngay + \" 23:59:59\")  # Kết thúc ngày\n+            \n+        # Thêm điều kiện WHERE nếu có\n+        if where_clauses:\n+            query += \" WHERE \" + \" AND \".join(where_clauses)\n+            \n+        # Nhóm theo dịch vụ và sắp xếp theo số lượt sử dụng giảm dần\n+        query += \"\"\"\n+        GROUP BY dv.MaDV, dv.TenDV, dv.Gia\n+        ORDER BY SoLuotSuDung DESC, dv.TenDV\n+        \"\"\"\n+        \n+        # Thực thi truy vấn\n+        result = execute_query(query, tuple(params) if params else None, fetch=True)\n+        \n+        # Tính tổng số lượt sử dụng và tổng tiền\n+        tong_luot_su_dung = sum(item['SoLuotSuDung'] for item in result)\n+        tong_tien = sum(item['TongTien'] if item['TongTien'] else 0 for item in result)\n+        \n+        # Thêm thông tin tổng hợp\n+        summary = {\n+            'tong_luot_su_dung': tong_luot_su_dung,\n+            'tong_tien': tong_tien\n+        }\n+        \n+        return result, summary\n+        \n+    except Exception as e:\n+        print(f\"Lỗi khi thống kê dịch vụ sử dụng: {e}\")\n+        return [], {'tong_luot_su_dung': 0, 'tong_tien': 0}\n+\n+def thong_ke_dich_vu_theo_thang(nam=None, thang=None):\n+    \"\"\"\n+    Thống kê dịch vụ sử dụng theo tháng\n+    \n+    Args:\n+        nam (int, optional): Năm thống kê (mặc định là năm hiện tại)\n+        thang (int, optional): Tháng thống kê (mặc định là tất cả các tháng trong năm)\n+        \n+    Returns:\n+        list: Danh sách dịch vụ đã sử dụng và số lượng theo tháng\n+    \"\"\"\n+    try:\n+        # Nếu không có năm, lấy năm hiện tại\n+        if not nam:\n+            nam = datetime.datetime.now().year\n+            \n+        # Xây dựng câu truy vấn cơ bản\n+        query = \"\"\"\n+        SELECT \n+            strftime('%m', pk.NgayKham) as Thang,\n+            dv.MaDV, \n+            dv.TenDV, \n+            COUNT(pk.MaPK) as SoLuotSuDung,\n+            SUM(dv.Gia) as TongTien\n+        FROM DICHVU dv\n+        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        WHERE strftime('%Y', pk.NgayKham) = ?\n+        \"\"\"\n+        \n+        params = [str(nam)]\n+        \n+        # Thêm điều kiện lọc theo tháng nếu có\n+        if thang:\n+            query += \" AND strftime('%m', pk.NgayKham) = ?\"\n+            # Đảm bảo tháng có 2 chữ số\n+            params.append(f\"{thang:02d}\")\n+            \n+        # Nhóm theo tháng và dịch vụ, sắp xếp theo tháng và số lượt sử dụng\n+        query += \"\"\"\n+        GROUP BY Thang, dv.MaDV, dv.TenDV\n+        ORDER BY Thang, SoLuotSuDung DESC\n+        \"\"\"\n+        \n+        # Thực thi truy vấn\n+        result = execute_query(query, tuple(params), fetch=True)\n+        \n+        # Tổ chức kết quả theo tháng\n+        thong_ke_theo_thang = {}\n+        for item in result:\n+            thang_key = item['Thang']\n+            if thang_key not in thong_ke_theo_thang:\n+                thong_ke_theo_thang[thang_key] = {\n+                    'thang': int(thang_key),\n+                    'dich_vu': [],\n+                    'tong_luot_su_dung': 0,\n+                    'tong_tien': 0\n+                }\n+                \n+            thong_ke_theo_thang[thang_key]['dich_vu'].append(item)\n+            thong_ke_theo_thang[thang_key]['tong_luot_su_dung'] += item['SoLuotSuDung']\n+            thong_ke_theo_thang[thang_key]['tong_tien'] += item['TongTien'] if item['TongTien'] else 0\n+            \n+        # Chuyển từ dictionary sang list và sắp xếp theo tháng\n+        ket_qua = list(thong_ke_theo_thang.values())\n+        ket_qua.sort(key=lambda x: x['thang'])\n+        \n+        return ket_qua\n+        \n+    except Exception as e:\n+        print(f\"Lỗi khi thống kê dịch vụ theo tháng: {e}\")\n+        return []\n+\n+def thong_ke_dich_vu_theo_bac_si(ma_bac_si=None, tu_ngay=None, den_ngay=None):\n+    \"\"\"\n+    Thống kê dịch vụ sử dụng theo bác sĩ\n+    \n+    Args:\n+        ma_bac_si (str, optional): Mã bác sĩ cần thống kê (mặc định là tất cả bác sĩ)\n+        tu_ngay (str, optional): Ngày bắt đầu thống kê (định dạng YYYY-MM-DD)\n+        den_ngay (str, optional): Ngày kết thúc thống kê (định dạng YYYY-MM-DD)\n+        \n+    Returns:\n+        list: Danh sách dịch vụ đã sử dụng và số lượng theo bác sĩ\n+    \"\"\"\n+    try:\n+        # Xây dựng câu truy vấn cơ bản\n+        query = \"\"\"\n+        SELECT \n+            bs.MaBS,\n+            bs.HoTen as TenBacSi,\n+            dv.MaDV, \n+            dv.TenDV, \n+            COUNT(pk.MaPK) as SoLuotSuDung,\n+            SUM(dv.Gia) as TongTien\n+        FROM DICHVU dv\n+        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n+        JOIN BACSI bs ON pk.MaBS = bs.MaBS\n+        \"\"\"\n+        \n+        params = []\n+        where_clauses = []\n+        \n+        # Thêm điều kiện lọc theo bác sĩ nếu có\n+        if ma_bac_si:\n+            where_clauses.append(\"bs.MaBS = ?\")\n+            params.append(ma_bac_si)\n+            \n+        # Thêm điều kiện lọc theo ngày nếu có\n+        if tu_ngay:\n+            where_clauses.append(\"pk.NgayKham >= ?\")\n+            params.append(tu_ngay)\n+            \n+        if den_ngay:\n+            where_clauses.append(\"pk.NgayKham <= ?\")\n+            params.append(den_ngay + \" 23:59:59\")  # Kết thúc ngày\n+            \n+        # Thêm điều kiện WHERE nếu có\n+        if where_clauses:\n+            query += \" WHERE \" + \" AND \".join(where_clauses)\n+            \n+        # Nhóm theo bác sĩ và dịch vụ, sắp xếp theo bác sĩ và số lượt sử dụng\n+        query += \"\"\"\n+        GROUP BY bs.MaBS, bs.HoTen, dv.MaDV, dv.TenDV\n+        ORDER BY bs.HoTen, SoLuotSuDung DESC\n+        \"\"\"\n+        \n+        # Thực thi truy vấn\n+        result = execute_query(query, tuple(params) if params else None, fetch=True)\n+        \n+        # Tổ chức kết quả theo bác sĩ\n+        thong_ke_theo_bac_si = {}\n+        for item in result:\n+            ma_bs = item['MaBS']\n+            if ma_bs not in thong_ke_theo_bac_si:\n+                thong_ke_theo_bac_si[ma_bs] = {\n+                    'ma_bac_si': ma_bs,\n+                    'ten_bac_si': item['TenBacSi'],\n+                    'dich_vu': [],\n+                    'tong_luot_su_dung': 0,\n+                    'tong_tien': 0\n+                }\n+                \n+            thong_ke_theo_bac_si[ma_bs]['dich_vu'].append({\n+                'MaDV': item['MaDV'],\n+                'TenDV': item['TenDV'],\n+                'SoLuotSuDung': item['SoLuotSuDung'],\n+                'TongTien': item['TongTien']\n+            })\n+            thong_ke_theo_bac_si[ma_bs]['tong_luot_su_dung'] += item['SoLuotSuDung']\n+            thong_ke_theo_bac_si[ma_bs]['tong_tien'] += item['TongTien'] if item['TongTien'] else 0\n+            \n+        # Chuyển từ dictionary sang list và sắp xếp theo tên bác sĩ\n+        ket_qua = list(thong_ke_theo_bac_si.values())\n+        ket_qua.sort(key=lambda x: x['ten_bac_si'])\n+        \n+        return ket_qua\n+        \n+    except Exception as e:\n+        print(f\"Lỗi khi thống kê dịch vụ theo bác sĩ: {e}\")\n+        return []","refToolCallId":"toolu_01G8892wmEEE3h6uAe2RVDhM"},{"type":"text","text":"2. Bây giờ tôi sẽ tạo các template cho chức năng báo cáo:"},{"type":"toolCall","toolCallId":"toolu_01WMXJkFwPKegBn55pXRVyWe","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao.html","path":"nhakhoaso/templates/bao_cao.html","displayPath":"nhakhoaso/templates/bao_cao.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao.html\n+++ nhakhoaso/templates/bao_cao.html\n@@ -0,0 +1,41 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Báo cáo - Thống kê | NHAKHOASO{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>BÁO CÁO - THỐNG KÊ</h2>\n+</div>\n+\n+<div class=\"services-grid\">\n+    <!-- Báo cáo dịch vụ sử dụng -->\n+    <div class=\"service-card\" data-link=\"{{ url_for('bao_cao_dich_vu') }}\">\n+        <div class=\"service-icon\">\n+            <i class=\"fas fa-chart-pie\"></i>\n+        </div>\n+        <h3 class=\"service-title\">Báo cáo dịch vụ sử dụng</h3>\n+        <p class=\"service-description\">Thống kê các dịch vụ đã sử dụng thông qua phiếu khám, số lượt sử dụng và doanh thu.</p>\n+        <a href=\"{{ url_for('bao_cao_dich_vu') }}\" class=\"btn\">Xem chi tiết</a>\n+    </div>\n+\n+    <!-- Thống kê theo tháng -->\n+    <div class=\"service-card\" data-link=\"{{ url_for('bao_cao_dich_vu_theo_thang') }}\">\n+        <div class=\"service-icon\">\n+            <i class=\"fas fa-calendar-alt\"></i>\n+        </div>\n+        <h3 class=\"service-title\">Thống kê theo tháng</h3>\n+        <p class=\"service-description\">Thống kê dịch vụ sử dụng theo từng tháng trong năm, phân tích xu hướng sử dụng.</p>\n+        <a href=\"{{ url_for('bao_cao_dich_vu_theo_thang') }}\" class=\"btn\">Xem chi tiết</a>\n+    </div>\n+\n+    <!-- Thống kê theo bác sĩ -->\n+    <div class=\"service-card\" data-link=\"{{ url_for('bao_cao_dich_vu_theo_bac_si') }}\">\n+        <div class=\"service-icon\">\n+            <i class=\"fas fa-user-md\"></i>\n+        </div>\n+        <h3 class=\"service-title\">Thống kê theo bác sĩ</h3>\n+        <p class=\"service-description\">Thống kê dịch vụ sử dụng theo từng bác sĩ, đánh giá hiệu suất và chuyên môn.</p>\n+        <a href=\"{{ url_for('bao_cao_dich_vu_theo_bac_si') }}\" class=\"btn\">Xem chi tiết</a>\n+    </div>\n+</div>\n+{% endblock %}","refToolCallId":"toolu_01WMXJkFwPKegBn55pXRVyWe"},{"type":"text","text":"3. Tạo template cho báo cáo dịch vụ sử dụng:"},{"type":"toolCall","toolCallId":"toolu_019S7sjNtAFoQZha1Z5bHHqA","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu.html","path":"nhakhoaso/templates/bao_cao_dich_vu.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu.html\n+++ nhakhoaso/templates/bao_cao_dich_vu.html\n@@ -0,0 +1,324 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Báo cáo dịch vụ sử dụng | NHAKHOASO{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-form {\n+        background-color: #f5f5f5;\n+        padding: 20px;\n+        border-radius: 8px;\n+        margin-bottom: 20px;\n+        display: flex;\n+        flex-wrap: wrap;\n+        gap: 15px;\n+        align-items: flex-end;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+        min-width: 200px;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form input[type=\"date\"] {\n+        width: 100%;\n+        padding: 8px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .filter-form button {\n+        padding: 8px 15px;\n+        background-color: #4CAF50;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        transition: background-color 0.3s;\n+    }\n+    \n+    .filter-form button:hover {\n+        background-color: #45a049;\n+    }\n+    \n+    .report-summary {\n+        background-color: #e9f7ef;\n+        padding: 15px;\n+        border-radius: 8px;\n+        margin-bottom: 20px;\n+        display: flex;\n+        justify-content: space-around;\n+        flex-wrap: wrap;\n+    }\n+    \n+    .summary-item {\n+        text-align: center;\n+        padding: 10px;\n+    }\n+    \n+    .summary-item .value {\n+        font-size: 24px;\n+        font-weight: bold;\n+        color: #2E7D32;\n+    }\n+    \n+    .summary-item .label {\n+        font-size: 14px;\n+        color: #555;\n+    }\n+    \n+    .report-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+        margin-top: 20px;\n+    }\n+    \n+    .report-table th, .report-table td {\n+        border: 1px solid #ddd;\n+        padding: 12px;\n+        text-align: left;\n+    }\n+    \n+    .report-table th {\n+        background-color: #4CAF50;\n+        color: white;\n+    }\n+    \n+    .report-table tr:nth-child(even) {\n+        background-color: #f2f2f2;\n+    }\n+    \n+    .report-table tr:hover {\n+        background-color: #e9f7ef;\n+    }\n+    \n+    .no-data {\n+        text-align: center;\n+        padding: 30px;\n+        color: #777;\n+        font-style: italic;\n+    }\n+    \n+    .chart-container {\n+        margin-top: 30px;\n+        height: 400px;\n+    }\n+    \n+    .export-buttons {\n+        margin-top: 20px;\n+        display: flex;\n+        gap: 10px;\n+        justify-content: flex-end;\n+    }\n+    \n+    .export-buttons button {\n+        padding: 8px 15px;\n+        background-color: #2196F3;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        display: flex;\n+        align-items: center;\n+        gap: 5px;\n+    }\n+    \n+    .export-buttons button:hover {\n+        background-color: #0b7dda;\n+    }\n+    \n+    @media print {\n+        .filter-form, .export-buttons, .sidebar, .header, .footer {\n+            display: none;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+    }\n+</style>\n+{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>BÁO CÁO DỊCH VỤ SỬ DỤNG</h2>\n+</div>\n+\n+<!-- Form lọc báo cáo -->\n+<form class=\"filter-form\" method=\"GET\" action=\"{{ url_for('bao_cao_dich_vu') }}\">\n+    <div class=\"form-group\">\n+        <label for=\"tu_ngay\">Từ ngày:</label>\n+        <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n+    </div>\n+    \n+    <div class=\"form-group\">\n+        <label for=\"den_ngay\">Đến ngày:</label>\n+        <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n+    </div>\n+    \n+    <button type=\"submit\">\n+        <i class=\"fas fa-filter\"></i> Lọc báo cáo\n+    </button>\n+</form>\n+\n+<!-- Tóm tắt báo cáo -->\n+<div class=\"report-summary\">\n+    <div class=\"summary-item\">\n+        <div class=\"value\">{{ summary.tong_luot_su_dung }}</div>\n+        <div class=\"label\">Tổng lượt sử dụng</div>\n+    </div>\n+    \n+    <div class=\"summary-item\">\n+        <div class=\"value\">{{ \"{:,.0f}\".format(summary.tong_tien) }} VNĐ</div>\n+        <div class=\"label\">Tổng doanh thu</div>\n+    </div>\n+    \n+    <div class=\"summary-item\">\n+        <div class=\"value\">{{ dich_vu_list|length }}</div>\n+        <div class=\"label\">Số dịch vụ đã sử dụng</div>\n+    </div>\n+</div>\n+\n+<!-- Bảng báo cáo -->\n+{% if dich_vu_list %}\n+<div class=\"table-responsive\">\n+    <table class=\"report-table\">\n+        <thead>\n+            <tr>\n+                <th>STT</th>\n+                <th>Mã dịch vụ</th>\n+                <th>Tên dịch vụ</th>\n+                <th>Đơn giá (VNĐ)</th>\n+                <th>Số lượt sử dụng</th>\n+                <th>Tỷ lệ (%)</th>\n+                <th>Doanh thu (VNĐ)</th>\n+            </tr>\n+        </thead>\n+        <tbody>\n+            {% for dv in dich_vu_list %}\n+            <tr>\n+                <td>{{ loop.index }}</td>\n+                <td>{{ dv.MaDV }}</td>\n+                <td>{{ dv.TenDV }}</td>\n+                <td>{{ \"{:,.0f}\".format(dv.Gia) }}</td>\n+                <td>{{ dv.SoLuotSuDung }}</td>\n+                <td>{{ \"%.2f\"|format(dv.SoLuotSuDung / summary.tong_luot_su_dung * 100) if summary.tong_luot_su_dung > 0 else 0 }}</td>\n+                <td>{{ \"{:,.0f}\".format(dv.TongTien) }}</td>\n+            </tr>\n+            {% endfor %}\n+        </tbody>\n+    </table>\n+</div>\n+\n+<!-- Biểu đồ -->\n+<div class=\"chart-container\">\n+    <canvas id=\"dichVuChart\"></canvas>\n+</div>\n+\n+<!-- Nút xuất báo cáo -->\n+<div class=\"export-buttons\">\n+    <button onclick=\"window.print()\">\n+        <i class=\"fas fa-print\"></i> In báo cáo\n+    </button>\n+    <button id=\"exportExcel\">\n+        <i class=\"fas fa-file-excel\"></i> Xuất Excel\n+    </button>\n+    <button id=\"exportPDF\">\n+        <i class=\"fas fa-file-pdf\"></i> Xuất PDF\n+    </button>\n+</div>\n+{% else %}\n+<div class=\"no-data\">\n+    <p>Không có dữ liệu báo cáo trong khoảng thời gian đã chọn</p>\n+</div>\n+{% endif %}\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        {% if dich_vu_list %}\n+        // Dữ liệu cho biểu đồ\n+        const labels = [{% for dv in dich_vu_list %}{% if loop.index <= 10 %}'{{ dv.TenDV }}',{% endif %}{% endfor %}];\n+        const data = [{% for dv in dich_vu_list %}{% if loop.index <= 10 %}{{ dv.SoLuotSuDung }},{% endif %}{% endfor %}];\n+        const backgroundColors = [\n+            'rgba(75, 192, 192, 0.7)',\n+            'rgba(54, 162, 235, 0.7)',\n+            'rgba(255, 206, 86, 0.7)',\n+            'rgba(255, 99, 132, 0.7)',\n+            'rgba(153, 102, 255, 0.7)',\n+            'rgba(255, 159, 64, 0.7)',\n+            'rgba(199, 199, 199, 0.7)',\n+            'rgba(83, 102, 255, 0.7)',\n+            'rgba(40, 159, 64, 0.7)',\n+            'rgba(210, 199, 199, 0.7)'\n+        ];\n+        \n+        // Tạo biểu đồ\n+        const ctx = document.getElementById('dichVuChart').getContext('2d');\n+        const myChart = new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [{\n+                    label: 'Số lượt sử dụng',\n+                    data: data,\n+                    backgroundColor: backgroundColors,\n+                    borderColor: backgroundColors.map(color => color.replace('0.7', '1')),\n+                    borderWidth: 1\n+                }]\n+            },\n+            options: {\n+                responsive: true,\n+                maintainAspectRatio: false,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        title: {\n+                            display: true,\n+                            text: 'Số lượt sử dụng'\n+                        }\n+                    },\n+                    x: {\n+                        title: {\n+                            display: true,\n+                            text: 'Dịch vụ'\n+                        }\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Top 10 dịch vụ được sử dụng nhiều nhất',\n+                        font: {\n+                            size: 16\n+                        }\n+                    },\n+                    legend: {\n+                        display: false\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Xử lý xuất Excel và PDF (giả lập)\n+        document.getElementById('exportExcel').addEventListener('click', function() {\n+            alert('Chức năng xuất Excel đang được phát triển');\n+        });\n+        \n+        document.getElementById('exportPDF').addEventListener('click', function() {\n+            alert('Chức năng xuất PDF đang được phát triển');\n+        });\n+        {% endif %}\n+    });\n+</script>\n+{% endblock %}","refToolCallId":"toolu_019S7sjNtAFoQZha1Z5bHHqA"},{"type":"text","text":"4. Tạo template cho báo cáo dịch vụ theo tháng:"},{"type":"toolCall","toolCallId":"toolu_019w5916F46Wj8TX8W2PPTK1","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html","path":"nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html\n+++ nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html\n@@ -0,0 +1,334 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Báo cáo dịch vụ theo tháng | NHAKHOASO{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-form {\n+        background-color: #f5f5f5;\n+        padding: 20px;\n+        border-radius: 8px;\n+        margin-bottom: 20px;\n+        display: flex;\n+        flex-wrap: wrap;\n+        gap: 15px;\n+        align-items: flex-end;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+        min-width: 200px;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form select {\n+        width: 100%;\n+        padding: 8px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .filter-form button {\n+        padding: 8px 15px;\n+        background-color: #4CAF50;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        transition: background-color 0.3s;\n+    }\n+    \n+    .filter-form button:hover {\n+        background-color: #45a049;\n+    }\n+    \n+    .month-section {\n+        margin-bottom: 30px;\n+        border: 1px solid #ddd;\n+        border-radius: 8px;\n+        overflow: hidden;\n+    }\n+    \n+    .month-header {\n+        background-color: #4CAF50;\n+        color: white;\n+        padding: 15px;\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+    }\n+    \n+    .month-title {\n+        font-size: 18px;\n+        font-weight: bold;\n+    }\n+    \n+    .month-summary {\n+        display: flex;\n+        gap: 20px;\n+    }\n+    \n+    .month-summary-item {\n+        font-size: 14px;\n+    }\n+    \n+    .month-content {\n+        padding: 15px;\n+    }\n+    \n+    .report-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .report-table th, .report-table td {\n+        border: 1px solid #ddd;\n+        padding: 12px;\n+        text-align: left;\n+    }\n+    \n+    .report-table th {\n+        background-color: #f2f2f2;\n+    }\n+    \n+    .report-table tr:hover {\n+        background-color: #f9f9f9;\n+    }\n+    \n+    .no-data {\n+        text-align: center;\n+        padding: 30px;\n+        color: #777;\n+        font-style: italic;\n+    }\n+    \n+    .chart-container {\n+        margin-top: 30px;\n+        height: 400px;\n+    }\n+    \n+    .export-buttons {\n+        margin-top: 20px;\n+        display: flex;\n+        gap: 10px;\n+        justify-content: flex-end;\n+    }\n+    \n+    .export-buttons button {\n+        padding: 8px 15px;\n+        background-color: #2196F3;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        display: flex;\n+        align-items: center;\n+        gap: 5px;\n+    }\n+    \n+    .export-buttons button:hover {\n+        background-color: #0b7dda;\n+    }\n+    \n+    @media print {\n+        .filter-form, .export-buttons, .sidebar, .header, .footer {\n+            display: none;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+    }\n+</style>\n+{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>BÁO CÁO DỊCH VỤ THEO THÁNG</h2>\n+</div>\n+\n+<!-- Form lọc báo cáo -->\n+<form class=\"filter-form\" method=\"GET\" action=\"{{ url_for('bao_cao_dich_vu_theo_thang') }}\">\n+    <div class=\"form-group\">\n+        <label for=\"nam\">Năm:</label>\n+        <select id=\"nam\" name=\"nam\">\n+            {% for year in range(2024, 2020, -1) %}\n+            <option value=\"{{ year }}\" {% if nam == year %}selected{% endif %}>{{ year }}</option>\n+            {% endfor %}\n+        </select>\n+    </div>\n+    \n+    <div class=\"form-group\">\n+        <label for=\"thang\">Tháng:</label>\n+        <select id=\"thang\" name=\"thang\">\n+            <option value=\"\">Tất cả các tháng</option>\n+            {% for month in range(1, 13) %}\n+            <option value=\"{{ month }}\" {% if thang == month %}selected{% endif %}>Tháng {{ month }}</option>\n+            {% endfor %}\n+        </select>\n+    </div>\n+    \n+    <button type=\"submit\">\n+        <i class=\"fas fa-filter\"></i> Lọc báo cáo\n+    </button>\n+</form>\n+\n+<!-- Biểu đồ tổng quan -->\n+<div class=\"chart-container\">\n+    <canvas id=\"overviewChart\"></canvas>\n+</div>\n+\n+<!-- Danh sách báo cáo theo tháng -->\n+{% if thong_ke_list %}\n+    {% for thang_data in thong_ke_list %}\n+    <div class=\"month-section\">\n+        <div class=\"month-header\">\n+            <div class=\"month-title\">Tháng {{ thang_data.thang }}/{{ nam }}</div>\n+            <div class=\"month-summary\">\n+                <div class=\"month-summary-item\">\n+                    <strong>Tổng lượt sử dụng:</strong> {{ thang_data.tong_luot_su_dung }}\n+                </div>\n+                <div class=\"month-summary-item\">\n+                    <strong>Tổng doanh thu:</strong> {{ \"{:,.0f}\".format(thang_data.tong_tien) }} VNĐ\n+                </div>\n+            </div>\n+        </div>\n+        <div class=\"month-content\">\n+            <table class=\"report-table\">\n+                <thead>\n+                    <tr>\n+                        <th>STT</th>\n+                        <th>Mã dịch vụ</th>\n+                        <th>Tên dịch vụ</th>\n+                        <th>Số lượt sử dụng</th>\n+                        <th>Tỷ lệ (%)</th>\n+                        <th>Doanh thu (VNĐ)</th>\n+                    </tr>\n+                </thead>\n+                <tbody>\n+                    {% for dv in thang_data.dich_vu %}\n+                    <tr>\n+                        <td>{{ loop.index }}</td>\n+                        <td>{{ dv.MaDV }}</td>\n+                        <td>{{ dv.TenDV }}</td>\n+                        <td>{{ dv.SoLuotSuDung }}</td>\n+                        <td>{{ \"%.2f\"|format(dv.SoLuotSuDung / thang_data.tong_luot_su_dung * 100) if thang_data.tong_luot_su_dung > 0 else 0 }}</td>\n+                        <td>{{ \"{:,.0f}\".format(dv.TongTien) }}</td>\n+                    </tr>\n+                    {% endfor %}\n+                </tbody>\n+            </table>\n+        </div>\n+    </div>\n+    {% endfor %}\n+\n+<!-- Nút xuất báo cáo -->\n+<div class=\"export-buttons\">\n+    <button onclick=\"window.print()\">\n+        <i class=\"fas fa-print\"></i> In báo cáo\n+    </button>\n+    <button id=\"exportExcel\">\n+        <i class=\"fas fa-file-excel\"></i> Xuất Excel\n+    </button>\n+    <button id=\"exportPDF\">\n+        <i class=\"fas fa-file-pdf\"></i> Xuất PDF\n+    </button>\n+</div>\n+{% else %}\n+<div class=\"no-data\">\n+    <p>Không có dữ liệu báo cáo trong khoảng thời gian đã chọn</p>\n+</div>\n+{% endif %}\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        {% if thong_ke_list %}\n+        // Dữ liệu cho biểu đồ tổng quan\n+        const labels = [{% for thang_data in thong_ke_list %}'Tháng {{ thang_data.thang }}',{% endfor %}];\n+        const luotSuDung = [{% for thang_data in thong_ke_list %}{{ thang_data.tong_luot_su_dung }},{% endfor %}];\n+        const doanhThu = [{% for thang_data in thong_ke_list %}{{ thang_data.tong_tien }},{% endfor %}];\n+        \n+        // Tạo biểu đồ tổng quan\n+        const ctx = document.getElementById('overviewChart').getContext('2d');\n+        const myChart = new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [\n+                    {\n+                        label: 'Lượt sử dụng',\n+                        data: luotSuDung,\n+                        backgroundColor: 'rgba(54, 162, 235, 0.7)',\n+                        borderColor: 'rgba(54, 162, 235, 1)',\n+                        borderWidth: 1,\n+                        yAxisID: 'y'\n+                    },\n+                    {\n+                        label: 'Doanh thu (VNĐ)',\n+                        data: doanhThu,\n+                        backgroundColor: 'rgba(255, 99, 132, 0.7)',\n+                        borderColor: 'rgba(255, 99, 132, 1)',\n+                        borderWidth: 1,\n+                        type: 'line',\n+                        yAxisID: 'y1'\n+                    }\n+                ]\n+            },\n+            options: {\n+                responsive: true,\n+                maintainAspectRatio: false,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        position: 'left',\n+                        title: {\n+                            display: true,\n+                            text: 'Lượt sử dụng'\n+                        }\n+                    },\n+                    y1: {\n+                        beginAtZero: true,\n+                        position: 'right',\n+                        title: {\n+                            display: true,\n+                            text: 'Doanh thu (VNĐ)'\n+                        },\n+                        grid: {\n+                            drawOnChartArea: false\n+                        }\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Thống kê dịch vụ theo tháng năm {{ nam }}',\n+                        font: {\n+                            size: 16\n+                        }\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Xử lý xuất Excel và PDF (giả lập)\n+        document.getElementById('exportExcel').addEventListener('click', function() {\n+            alert('Chức năng xuất Excel đang được phát triển');\n+        });\n+        \n+        document.getElementById('exportPDF').addEventListener('click', function() {\n+            alert('Chức năng xuất PDF đang được phát triển');\n+        });\n+        {% endif %}\n+    });\n+</script>\n+{% endblock %}","refToolCallId":"toolu_019w5916F46Wj8TX8W2PPTK1"},{"type":"text","text":"5. Tạo template cho báo cáo dịch vụ theo bác sĩ:"},{"type":"toolCall","toolCallId":"toolu_01WhNpqtDogceSwMssPDUZh8","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html","path":"nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html","displayPath":"nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html\n+++ nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html\n@@ -0,0 +1,335 @@\n+{% extends 'layout.html' %}\n+\n+{% block title %}Báo cáo dịch vụ theo bác sĩ | NHAKHOASO{% endblock %}\n+\n+{% block extra_css %}\n+<style>\n+    .filter-form {\n+        background-color: #f5f5f5;\n+        padding: 20px;\n+        border-radius: 8px;\n+        margin-bottom: 20px;\n+        display: flex;\n+        flex-wrap: wrap;\n+        gap: 15px;\n+        align-items: flex-end;\n+    }\n+    \n+    .filter-form .form-group {\n+        flex: 1;\n+        min-width: 200px;\n+    }\n+    \n+    .filter-form label {\n+        display: block;\n+        margin-bottom: 5px;\n+        font-weight: 500;\n+    }\n+    \n+    .filter-form select, .filter-form input[type=\"date\"] {\n+        width: 100%;\n+        padding: 8px;\n+        border: 1px solid #ddd;\n+        border-radius: 4px;\n+    }\n+    \n+    .filter-form button {\n+        padding: 8px 15px;\n+        background-color: #4CAF50;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        transition: background-color 0.3s;\n+    }\n+    \n+    .filter-form button:hover {\n+        background-color: #45a049;\n+    }\n+    \n+    .doctor-section {\n+        margin-bottom: 30px;\n+        border: 1px solid #ddd;\n+        border-radius: 8px;\n+        overflow: hidden;\n+    }\n+    \n+    .doctor-header {\n+        background-color: #2196F3;\n+        color: white;\n+        padding: 15px;\n+        display: flex;\n+        justify-content: space-between;\n+        align-items: center;\n+    }\n+    \n+    .doctor-title {\n+        font-size: 18px;\n+        font-weight: bold;\n+    }\n+    \n+    .doctor-summary {\n+        display: flex;\n+        gap: 20px;\n+    }\n+    \n+    .doctor-summary-item {\n+        font-size: 14px;\n+    }\n+    \n+    .doctor-content {\n+        padding: 15px;\n+    }\n+    \n+    .report-table {\n+        width: 100%;\n+        border-collapse: collapse;\n+    }\n+    \n+    .report-table th, .report-table td {\n+        border: 1px solid #ddd;\n+        padding: 12px;\n+        text-align: left;\n+    }\n+    \n+    .report-table th {\n+        background-color: #f2f2f2;\n+    }\n+    \n+    .report-table tr:hover {\n+        background-color: #f9f9f9;\n+    }\n+    \n+    .no-data {\n+        text-align: center;\n+        padding: 30px;\n+        color: #777;\n+        font-style: italic;\n+    }\n+    \n+    .chart-container {\n+        margin-top: 30px;\n+        height: 400px;\n+    }\n+    \n+    .export-buttons {\n+        margin-top: 20px;\n+        display: flex;\n+        gap: 10px;\n+        justify-content: flex-end;\n+    }\n+    \n+    .export-buttons button {\n+        padding: 8px 15px;\n+        background-color: #2196F3;\n+        color: white;\n+        border: none;\n+        border-radius: 4px;\n+        cursor: pointer;\n+        display: flex;\n+        align-items: center;\n+        gap: 5px;\n+    }\n+    \n+    .export-buttons button:hover {\n+        background-color: #0b7dda;\n+    }\n+    \n+    @media print {\n+        .filter-form, .export-buttons, .sidebar, .header, .footer {\n+            display: none;\n+        }\n+        \n+        .main-content {\n+            width: 100%;\n+            margin: 0;\n+            padding: 0;\n+        }\n+    }\n+</style>\n+{% endblock %}\n+\n+{% block content %}\n+<div class=\"section-title\">\n+    <h2>BÁO CÁO DỊCH VỤ THEO BÁC SĨ</h2>\n+</div>\n+\n+<!-- Form lọc báo cáo -->\n+<form class=\"filter-form\" method=\"GET\" action=\"{{ url_for('bao_cao_dich_vu_theo_bac_si') }}\">\n+    <div class=\"form-group\">\n+        <label for=\"ma_bac_si\">Bác sĩ:</label>\n+        <select id=\"ma_bac_si\" name=\"ma_bac_si\">\n+            <option value=\"\">Tất cả bác sĩ</option>\n+            {% for bs in bac_si_list %}\n+            <option value=\"{{ bs.MaBS }}\" {% if ma_bac_si == bs.MaBS %}selected{% endif %}>{{ bs.HoTen }}</option>\n+            {% endfor %}\n+        </select>\n+    </div>\n+    \n+    <div class=\"form-group\">\n+        <label for=\"tu_ngay\">Từ ngày:</label>\n+        <input type=\"date\" id=\"tu_ngay\" name=\"tu_ngay\" value=\"{{ tu_ngay }}\">\n+    </div>\n+    \n+    <div class=\"form-group\">\n+        <label for=\"den_ngay\">Đến ngày:</label>\n+        <input type=\"date\" id=\"den_ngay\" name=\"den_ngay\" value=\"{{ den_ngay }}\">\n+    </div>\n+    \n+    <button type=\"submit\">\n+        <i class=\"fas fa-filter\"></i> Lọc báo cáo\n+    </button>\n+</form>\n+\n+<!-- Biểu đồ tổng quan -->\n+<div class=\"chart-container\">\n+    <canvas id=\"overviewChart\"></canvas>\n+</div>\n+\n+<!-- Danh sách báo cáo theo bác sĩ -->\n+{% if thong_ke_list %}\n+    {% for bac_si_data in thong_ke_list %}\n+    <div class=\"doctor-section\">\n+        <div class=\"doctor-header\">\n+            <div class=\"doctor-title\">{{ bac_si_data.ten_bac_si }} ({{ bac_si_data.ma_bac_si }})</div>\n+            <div class=\"doctor-summary\">\n+                <div class=\"doctor-summary-item\">\n+                    <strong>Tổng lượt sử dụng:</strong> {{ bac_si_data.tong_luot_su_dung }}\n+                </div>\n+                <div class=\"doctor-summary-item\">\n+                    <strong>Tổng doanh thu:</strong> {{ \"{:,.0f}\".format(bac_si_data.tong_tien) }} VNĐ\n+                </div>\n+            </div>\n+        </div>\n+        <div class=\"doctor-content\">\n+            <table class=\"report-table\">\n+                <thead>\n+                    <tr>\n+                        <th>STT</th>\n+                        <th>Mã dịch vụ</th>\n+                        <th>Tên dịch vụ</th>\n+                        <th>Số lượt sử dụng</th>\n+                        <th>Tỷ lệ (%)</th>\n+                        <th>Doanh thu (VNĐ)</th>\n+                    </tr>\n+                </thead>\n+                <tbody>\n+                    {% for dv in bac_si_data.dich_vu %}\n+                    <tr>\n+                        <td>{{ loop.index }}</td>\n+                        <td>{{ dv.MaDV }}</td>\n+                        <td>{{ dv.TenDV }}</td>\n+                        <td>{{ dv.SoLuotSuDung }}</td>\n+                        <td>{{ \"%.2f\"|format(dv.SoLuotSuDung / bac_si_data.tong_luot_su_dung * 100) if bac_si_data.tong_luot_su_dung > 0 else 0 }}</td>\n+                        <td>{{ \"{:,.0f}\".format(dv.TongTien) }}</td>\n+                    </tr>\n+                    {% endfor %}\n+                </tbody>\n+            </table>\n+        </div>\n+    </div>\n+    {% endfor %}\n+\n+<!-- Nút xuất báo cáo -->\n+<div class=\"export-buttons\">\n+    <button onclick=\"window.print()\">\n+        <i class=\"fas fa-print\"></i> In báo cáo\n+    </button>\n+    <button id=\"exportExcel\">\n+        <i class=\"fas fa-file-excel\"></i> Xuất Excel\n+    </button>\n+    <button id=\"exportPDF\">\n+        <i class=\"fas fa-file-pdf\"></i> Xuất PDF\n+    </button>\n+</div>\n+{% else %}\n+<div class=\"no-data\">\n+    <p>Không có dữ liệu báo cáo trong khoảng thời gian đã chọn</p>\n+</div>\n+{% endif %}\n+{% endblock %}\n+\n+{% block extra_js %}\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n+<script>\n+    document.addEventListener('DOMContentLoaded', function() {\n+        {% if thong_ke_list %}\n+        // Dữ liệu cho biểu đồ tổng quan\n+        const labels = [{% for bac_si_data in thong_ke_list %}'{{ bac_si_data.ten_bac_si }}',{% endfor %}];\n+        const luotSuDung = [{% for bac_si_data in thong_ke_list %}{{ bac_si_data.tong_luot_su_dung }},{% endfor %}];\n+        const doanhThu = [{% for bac_si_data in thong_ke_list %}{{ bac_si_data.tong_tien }},{% endfor %}];\n+        \n+        // Tạo biểu đồ tổng quan\n+        const ctx = document.getElementById('overviewChart').getContext('2d');\n+        const myChart = new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [\n+                    {\n+                        label: 'Lượt sử dụng',\n+                        data: luotSuDung,\n+                        backgroundColor: 'rgba(54, 162, 235, 0.7)',\n+                        borderColor: 'rgba(54, 162, 235, 1)',\n+                        borderWidth: 1,\n+                        yAxisID: 'y'\n+                    },\n+                    {\n+                        label: 'Doanh thu (VNĐ)',\n+                        data: doanhThu,\n+                        backgroundColor: 'rgba(255, 99, 132, 0.7)',\n+                        borderColor: 'rgba(255, 99, 132, 1)',\n+                        borderWidth: 1,\n+                        type: 'line',\n+                        yAxisID: 'y1'\n+                    }\n+                ]\n+            },\n+            options: {\n+                responsive: true,\n+                maintainAspectRatio: false,\n+                scales: {\n+                    y: {\n+                        beginAtZero: true,\n+                        position: 'left',\n+                        title: {\n+                            display: true,\n+                            text: 'Lượt sử dụng'\n+                        }\n+                    },\n+                    y1: {\n+                        beginAtZero: true,\n+                        position: 'right',\n+                        title: {\n+                            display: true,\n+                            text: 'Doanh thu (VNĐ)'\n+                        },\n+                        grid: {\n+                            drawOnChartArea: false\n+                        }\n+                    }\n+                },\n+                plugins: {\n+                    title: {\n+                        display: true,\n+                        text: 'Thống kê dịch vụ theo bác sĩ',\n+                        font: {\n+                            size: 16\n+                        }\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // Xử lý xuất Excel và PDF (giả lập)\n+        document.getElementById('exportExcel').addEventListener('click', function() {\n+            alert('Chức năng xuất Excel đang được phát triển');\n+        });\n+        \n+        document.getElementById('exportPDF').addEventListener('click', function() {\n+            alert('Chức năng xuất PDF đang được phát triển');\n+        });\n+        {% endif %}\n+    });\n+</script>\n+{% endblock %}","refToolCallId":"toolu_01WhNpqtDogceSwMssPDUZh8"},{"type":"text","text":"6. Cập nhật file app.py để thêm các route cho chức năng báo cáo:"},{"type":"toolCall","toolCallId":"toolu_01FphWcj93MBLTWzSbyEqkvQ","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"toolCall","toolCallId":"toolu_01MWUKqchQEZwhQF36VMnwt9","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -11,6 +11,7 @@\n from database.lich_hen import get_all_lich_hen, get_lich_hen_by_id, search_lich_hen, create_lich_hen, update_lich_hen, delete_lich_hen\n from database.dich_vu import get_all_dich_vu, get_dich_vu_by_id, search_dich_vu, create_dich_vu, update_dich_vu, delete_dich_vu\n from database.utils import get_next_benh_nhan_id, get_next_bac_si_id, get_next_dich_vu_id, get_next_lich_hen_id, get_next_phieu_kham_id\n+from database.bao_cao import thong_ke_dich_vu_su_dung, thong_ke_dich_vu_theo_thang, thong_ke_dich_vu_theo_bac_si\n import datetime, json\n \n app = Flask(__name__)","refToolCallId":"toolu_01MWUKqchQEZwhQF36VMnwt9"},{"type":"text","text":"Bây giờ tôi sẽ thêm các route cho chức năng báo cáo vào cuối file app.py:"},{"type":"toolCall","toolCallId":"toolu_01AGopKynA8bbUKUbRs35inF","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"toolCall","toolCallId":"toolu_01W3UM7YBynvsUR5audf4RsY","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/app.py","path":"nhakhoaso/app.py","displayPath":"nhakhoaso/app.py"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/app.py\n+++ nhakhoaso/app.py\n@@ -688,6 +688,91 @@\n         return jsonify({\"error\": \"Loại không hợp lệ\"}), 400\n \n \n+# Báo cáo - Thống kê\n+@app.route('/bao-cao')\n+def bao_cao():\n+    \"\"\"Trang chủ báo cáo - thống kê\"\"\"\n+    return render_template('bao_cao.html')\n+\n+# Báo cáo dịch vụ sử dụng\n+@app.route('/bao-cao/dich-vu')\n+def bao_cao_dich_vu():\n+    \"\"\"Báo cáo dịch vụ sử dụng\"\"\"\n+    # Lấy tham số từ request\n+    tu_ngay = request.args.get('tu_ngay')\n+    den_ngay = request.args.get('den_ngay')\n+    \n+    # Nếu không có ngày, mặc định lấy tháng hiện tại\n+    if not tu_ngay and not den_ngay:\n+        today = datetime.datetime.now()\n+        first_day = datetime.datetime(today.year, today.month, 1)\n+        tu_ngay = first_day.strftime('%Y-%m-%d')\n+        den_ngay = today.strftime('%Y-%m-%d')\n+    \n+    # Lấy dữ liệu báo cáo\n+    dich_vu_list, summary = thong_ke_dich_vu_su_dung(tu_ngay, den_ngay)\n+    \n+    return render_template('bao_cao_dich_vu.html', \n+                          dich_vu_list=dich_vu_list, \n+                          summary=summary,\n+                          tu_ngay=tu_ngay,\n+                          den_ngay=den_ngay)\n+\n+# Báo cáo dịch vụ theo tháng\n+@app.route('/bao-cao/dich-vu/theo-thang')\n+def bao_cao_dich_vu_theo_thang():\n+    \"\"\"Báo cáo dịch vụ sử dụng theo tháng\"\"\"\n+    # Lấy tham số từ request\n+    nam = request.args.get('nam')\n+    thang = request.args.get('thang')\n+    \n+    # Nếu không có năm, mặc định lấy năm hiện tại\n+    if not nam:\n+        nam = datetime.datetime.now().year\n+    else:\n+        nam = int(nam)\n+    \n+    # Nếu có tháng, chuyển đổi sang số\n+    if thang:\n+        thang = int(thang)\n+    \n+    # Lấy dữ liệu báo cáo\n+    thong_ke_list = thong_ke_dich_vu_theo_thang(nam, thang)\n+    \n+    return render_template('bao_cao_dich_vu_theo_thang.html', \n+                          thong_ke_list=thong_ke_list,\n+                          nam=nam,\n+                          thang=thang)\n+\n+# Báo cáo dịch vụ theo bác sĩ\n+@app.route('/bao-cao/dich-vu/theo-bac-si')\n+def bao_cao_dich_vu_theo_bac_si():\n+    \"\"\"Báo cáo dịch vụ sử dụng theo bác sĩ\"\"\"\n+    # Lấy tham số từ request\n+    ma_bac_si = request.args.get('ma_bac_si')\n+    tu_ngay = request.args.get('tu_ngay')\n+    den_ngay = request.args.get('den_ngay')\n+    \n+    # Nếu không có ngày, mặc định lấy tháng hiện tại\n+    if not tu_ngay and not den_ngay:\n+        today = datetime.datetime.now()\n+        first_day = datetime.datetime(today.year, today.month, 1)\n+        tu_ngay = first_day.strftime('%Y-%m-%d')\n+        den_ngay = today.strftime('%Y-%m-%d')\n+    \n+    # Lấy danh sách bác sĩ\n+    bac_si_list = get_all_bac_si()\n+    \n+    # Lấy dữ liệu báo cáo\n+    thong_ke_list = thong_ke_dich_vu_theo_bac_si(ma_bac_si, tu_ngay, den_ngay)\n+    \n+    return render_template('bao_cao_dich_vu_theo_bac_si.html', \n+                          thong_ke_list=thong_ke_list,\n+                          bac_si_list=bac_si_list,\n+                          ma_bac_si=ma_bac_si,\n+                          tu_ngay=tu_ngay,\n+                          den_ngay=den_ngay)\n+\n \n if __name__ == '__main__':\n     app.run(host='0.0.0.0', port=5001, debug=True)","refToolCallId":"toolu_01W3UM7YBynvsUR5audf4RsY"},{"type":"text","text":"7. Cuối cùng, cập nhật sidebar.html để thêm menu báo cáo:"},{"type":"toolCall","toolCallId":"toolu_01VZ5AF5zjn4T7mn7hB7meTZ","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/sidebar.html","path":"nhakhoaso/templates/sidebar.html","displayPath":"nhakhoaso/templates/sidebar.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/sidebar.html\n+++ nhakhoaso/templates/sidebar.html\n@@ -107,6 +107,26 @@\n         </li>\n     </ul>\n     \n+    <div class=\"sidebar-title\">\n+        <i class=\"fas fa-chart-bar\"></i> Báo cáo - Thống kê\n+    </div>\n+    <ul class=\"sidebar-menu\">\n+        <li>\n+            <a href=\"{{ url_for('bao_cao_dich_vu') }}\" {% if request.endpoint == 'bao_cao_dich_vu' %}class=\"active\"{% endif %}>\n+                <i class=\"fas fa-chart-pie\"></i> Báo cáo dịch vụ\n+            </a>\n+        </li>\n+        <li>\n+            <a href=\"{{ url_for('bao_cao_dich_vu_theo_thang') }}\" {% if request.endpoint == 'bao_cao_dich_vu_theo_thang' %}class=\"active\"{% endif %}>\n+                <i class=\"fas fa-calendar-alt\"></i> Thống kê theo tháng\n+            </a>\n+        </li>\n+        <li>\n+            <a href=\"{{ url_for('bao_cao_dich_vu_theo_bac_si') }}\" {% if request.endpoint == 'bao_cao_dich_vu_theo_bac_si' %}class=\"active\"{% endif %}>\n+                <i class=\"fas fa-user-md\"></i> Thống kê theo bác sĩ\n+            </a>\n+        </li>\n+    </ul>\n \n \n </div>","refToolCallId":"toolu_01VZ5AF5zjn4T7mn7hB7meTZ"},{"type":"text","text":"8. Cập nhật trang chủ (index.html) để thêm chức năng báo cáo:"},{"type":"toolCall","toolCallId":"toolu_01QL8UXjgRMHk9aeNVbajCu2","isHidden":false,"title":"","statusText":"Change generated","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/templates/index.html","path":"nhakhoaso/templates/index.html","displayPath":"nhakhoaso/templates/index.html"}]}},{"type":"codeHunk","lineBasedDiff":"--- nhakhoaso/templates/index.html\n+++ nhakhoaso/templates/index.html\n@@ -58,6 +58,16 @@\n \n \n \n+    <!-- Báo cáo - Thống kê -->\n+    <div class=\"service-card\" data-link=\"{{ url_for('bao_cao') }}\">\n+        <div class=\"service-icon\">\n+            <i class=\"fas fa-chart-bar\"></i>\n+        </div>\n+        <h3 class=\"service-title\">Báo cáo - Thống kê</h3>\n+        <p class=\"service-description\">Xem báo cáo và thống kê về dịch vụ sử dụng, phân tích theo thời gian và bác sĩ.</p>\n+        <a href=\"{{ url_for('bao_cao') }}\" class=\"btn\">Xem chi tiết</a>\n+    </div>\n+    \n     <!-- Quản lý phòng khám -->\n     <div class=\"service-card\" data-link=\"{{ url_for('index') }}\">\n         <div class=\"service-icon\">","refToolCallId":"toolu_01QL8UXjgRMHk9aeNVbajCu2"},{"type":"text","text":"Tôi đã hoàn thành việc tạo chức năng Báo cáo-Thống kê với chức năng con là Báo cáo dịch vụ sử dụng thông qua phiếu khám. Dưới đây là tổng kết những gì đã thực hiện:\n\n1. **Tạo module báo cáo trong database**:\n   - Tạo file `bao_cao.py` với các hàm thống kê dịch vụ sử dụng\n   - Thêm các chức năng thống kê theo tháng và theo bác sĩ\n\n2. **Tạo các template cho báo cáo**:\n   - `bao_cao.html`: Trang chủ báo cáo thống kê\n   - `bao_cao_dich_vu.html`: Báo cáo dịch vụ sử dụng\n   - `bao_cao_dich_vu_theo_thang.html`: Thống kê theo tháng\n   - `bao_cao_dich_vu_theo_bac_si.html`: Thống kê theo bác sĩ\n\n3. **Cập nhật app.py**:\n   - Thêm import module báo cáo\n   - Thêm các route cho chức năng báo cáo\n\n4. **Cập nhật sidebar.html**:\n   - Thêm menu Báo cáo-Thống kê vào sidebar\n\n5. **Cập nhật trang chủ (index.html)**:\n   - Thêm card Báo cáo-Thống kê vào trang chủ\n\nChức năng báo cáo này cho phép:\n- Xem thống kê dịch vụ sử dụng trong khoảng thời gian\n- Phân tích dịch vụ theo tháng để xem xu hướng sử dụng\n- Phân tích dịch vụ theo bác sĩ để đánh giá hiệu suất\n\nCác báo cáo đều có biểu đồ trực quan và bảng dữ liệu chi tiết, cùng với tính năng in ấn và xuất báo cáo (đã chuẩn bị giao diện, chức năng xuất Excel và PDF có thể phát triển thêm sau).\n\nBạn có thể chạy ứng dụng và truy cập vào đường dẫn `/bao-cao` hoặc nhấp vào card \"Báo cáo - Thống kê\" trên trang chủ để sử dụng chức năng này."},{"type":"codePatch","diffs":[{"path":"nhakhoaso/app.py","patch":"@@ -914,16 +914,129 @@\n kham_id%0A\n+from database.bao_cao import thong_ke_dich_vu_su_dung, thong_ke_dich_vu_theo_thang, thong_ke_dich_vu_theo_bac_si%0A\n import d\n@@ -25865,16 +25865,2900 @@\n , 400%0A%0A%0A\n+# B%C3%A1o c%C3%A1o - Th%E1%BB%91ng k%C3%AA%0A@app.route('/bao-cao')%0Adef bao_cao():%0A    %22%22%22Trang ch%E1%BB%A7 b%C3%A1o c%C3%A1o - th%E1%BB%91ng k%C3%AA%22%22%22%0A    return render_template('bao_cao.html')%0A%0A# B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng%0A@app.route('/bao-cao/dich-vu')%0Adef bao_cao_dich_vu():%0A    %22%22%22B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng%22%22%22%0A    # L%E1%BA%A5y tham s%E1%BB%91 t%E1%BB%AB request%0A    tu_ngay = request.args.get('tu_ngay')%0A    den_ngay = request.args.get('den_ngay')%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y, m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%E1%BA%A5y th%C3%A1ng hi%E1%BB%87n t%E1%BA%A1i%0A    if not tu_ngay and not den_ngay:%0A        today = datetime.datetime.now()%0A        first_day = datetime.datetime(today.year, today.month, 1)%0A        tu_ngay = first_day.strftime('%25Y-%25m-%25d')%0A        den_ngay = today.strftime('%25Y-%25m-%25d')%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o%0A    dich_vu_list, summary = thong_ke_dich_vu_su_dung(tu_ngay, den_ngay)%0A    %0A    return render_template('bao_cao_dich_vu.html', %0A                          dich_vu_list=dich_vu_list, %0A                          summary=summary,%0A                          tu_ngay=tu_ngay,%0A                          den_ngay=den_ngay)%0A%0A# B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng%0A@app.route('/bao-cao/dich-vu/theo-thang')%0Adef bao_cao_dich_vu_theo_thang():%0A    %22%22%22B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo th%C3%A1ng%22%22%22%0A    # L%E1%BA%A5y tham s%E1%BB%91 t%E1%BB%AB request%0A    nam = request.args.get('nam')%0A    thang = request.args.get('thang')%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 n%C4%83m, m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%E1%BA%A5y n%C4%83m hi%E1%BB%87n t%E1%BA%A1i%0A    if not nam:%0A        nam = datetime.datetime.now().year%0A    else:%0A        nam = int(nam)%0A    %0A    # N%E1%BA%BFu c%C3%B3 th%C3%A1ng, chuy%E1%BB%83n %C4%91%E1%BB%95i sang s%E1%BB%91%0A    if thang:%0A        thang = int(thang)%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o%0A    thong_ke_list = thong_ke_dich_vu_theo_thang(nam, thang)%0A    %0A    return render_template('bao_cao_dich_vu_theo_thang.html', %0A                          thong_ke_list=thong_ke_list,%0A                          nam=nam,%0A                          thang=thang)%0A%0A# B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 theo b%C3%A1c s%C4%A9%0A@app.route('/bao-cao/dich-vu/theo-bac-si')%0Adef bao_cao_dich_vu_theo_bac_si():%0A    %22%22%22B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo b%C3%A1c s%C4%A9%22%22%22%0A    # L%E1%BA%A5y tham s%E1%BB%91 t%E1%BB%AB request%0A    ma_bac_si = request.args.get('ma_bac_si')%0A    tu_ngay = request.args.get('tu_ngay')%0A    den_ngay = request.args.get('den_ngay')%0A    %0A    # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 ng%C3%A0y, m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%E1%BA%A5y th%C3%A1ng hi%E1%BB%87n t%E1%BA%A1i%0A    if not tu_ngay and not den_ngay:%0A        today = datetime.datetime.now()%0A        first_day = datetime.datetime(today.year, today.month, 1)%0A        tu_ngay = first_day.strftime('%25Y-%25m-%25d')%0A        den_ngay = today.strftime('%25Y-%25m-%25d')%0A    %0A    # L%E1%BA%A5y danh s%C3%A1ch b%C3%A1c s%C4%A9%0A    bac_si_list = get_all_bac_si()%0A    %0A    # L%E1%BA%A5y d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o%0A    thong_ke_list = thong_ke_dich_vu_theo_bac_si(ma_bac_si, tu_ngay, den_ngay)%0A    %0A    return render_template('bao_cao_dich_vu_theo_bac_si.html', %0A                          thong_ke_list=thong_ke_list,%0A                          bac_si_list=bac_si_list,%0A                          ma_bac_si=ma_bac_si,%0A                          tu_ngay=tu_ngay,%0A                          den_ngay=den_ngay)%0A%0A\n %0Aif __na\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/sidebar.html","patch":"@@ -4327,16 +4327,926 @@\n l%3E%0A    %0A\n+    %3Cdiv class=%22sidebar-title%22%3E%0A        %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E B%C3%A1o c%C3%A1o - Th%E1%BB%91ng k%C3%AA%0A    %3C/div%3E%0A    %3Cul class=%22sidebar-menu%22%3E%0A        %3Cli%3E%0A            %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22 %7B%25 if request.endpoint == 'bao_cao_dich_vu' %25%7Dclass=%22active%22%7B%25 endif %25%7D%3E%0A                %3Ci class=%22fas fa-chart-pie%22%3E%3C/i%3E B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5%0A            %3C/a%3E%0A        %3C/li%3E%0A        %3Cli%3E%0A            %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu_theo_thang') %7D%7D%22 %7B%25 if request.endpoint == 'bao_cao_dich_vu_theo_thang' %25%7Dclass=%22active%22%7B%25 endif %25%7D%3E%0A                %3Ci class=%22fas fa-calendar-alt%22%3E%3C/i%3E Th%E1%BB%91ng k%C3%AA theo th%C3%A1ng%0A            %3C/a%3E%0A        %3C/li%3E%0A        %3Cli%3E%0A            %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu_theo_bac_si') %7D%7D%22 %7B%25 if request.endpoint == 'bao_cao_dich_vu_theo_bac_si' %25%7Dclass=%22active%22%7B%25 endif %25%7D%3E%0A                %3Ci class=%22fas fa-user-md%22%3E%3C/i%3E Th%E1%BB%91ng k%C3%AA theo b%C3%A1c s%C4%A9%0A            %3C/a%3E%0A        %3C/li%3E%0A    %3C/ul%3E%0A\n %0A%0A%3C/div%3E\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/index.html","patch":"@@ -2439,16 +2439,480 @@\n div%3E%0A%0A%0A%0A\n+    %3C!-- B%C3%A1o c%C3%A1o - Th%E1%BB%91ng k%C3%AA --%3E%0A    %3Cdiv class=%22service-card%22 data-link=%22%7B%7B url_for('bao_cao') %7D%7D%22%3E%0A        %3Cdiv class=%22service-icon%22%3E%0A            %3Ci class=%22fas fa-chart-bar%22%3E%3C/i%3E%0A        %3C/div%3E%0A        %3Ch3 class=%22service-title%22%3EB%C3%A1o c%C3%A1o - Th%E1%BB%91ng k%C3%AA%3C/h3%3E%0A        %3Cp class=%22service-description%22%3EXem b%C3%A1o c%C3%A1o v%C3%A0 th%E1%BB%91ng k%C3%AA v%E1%BB%81 d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng, ph%C3%A2n t%C3%ADch theo th%E1%BB%9Di gian v%C3%A0 b%C3%A1c s%C4%A9.%3C/p%3E%0A        %3Ca href=%22%7B%7B url_for('bao_cao') %7D%7D%22 class=%22btn%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A    %3C/div%3E%0A    %0A\n     %3C!--\n","isNew":false,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/database/bao_cao.py","patch":"@@ -0,0 +1,7760 @@\n+from .db import execute_query%0Aimport datetime%0A%0Adef thong_ke_dich_vu_su_dung(tu_ngay=None, den_ngay=None):%0A    %22%22%22%0A    Th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng th%C3%B4ng qua phi%E1%BA%BFu kh%C3%A1m%0A    %0A    Args:%0A        tu_ngay (str, optional): Ng%C3%A0y b%E1%BA%AFt %C4%91%E1%BA%A7u th%E1%BB%91ng k%C3%AA (%C4%91%E1%BB%8Bnh d%E1%BA%A1ng YYYY-MM-DD)%0A        den_ngay (str, optional): Ng%C3%A0y k%E1%BA%BFt th%C3%BAc th%E1%BB%91ng k%C3%AA (%C4%91%E1%BB%8Bnh d%E1%BA%A1ng YYYY-MM-DD)%0A        %0A    Returns:%0A        list: Danh s%C3%A1ch d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3ng%0A    %22%22%22%0A    try:%0A        # X%C3%A2y d%E1%BB%B1ng c%C3%A2u truy v%E1%BA%A5n c%C6%A1 b%E1%BA%A3n%0A        query = %22%22%22%0A        SELECT %0A            dv.MaDV, %0A            dv.TenDV, %0A            dv.Gia, %0A            COUNT(pk.MaPK) as SoLuotSuDung,%0A            SUM(dv.Gia) as TongTien%0A        FROM DICHVU dv%0A        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        %22%22%22%0A        %0A        params = %5B%5D%0A        where_clauses = %5B%5D%0A        %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n l%E1%BB%8Dc theo ng%C3%A0y n%E1%BA%BFu c%C3%B3%0A        if tu_ngay:%0A            where_clauses.append(%22pk.NgayKham %3E= ?%22)%0A            params.append(tu_ngay)%0A            %0A        if den_ngay:%0A            where_clauses.append(%22pk.NgayKham %3C= ?%22)%0A            params.append(den_ngay + %22 23:59:59%22)  # K%E1%BA%BFt th%C3%BAc ng%C3%A0y%0A            %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n WHERE n%E1%BA%BFu c%C3%B3%0A        if where_clauses:%0A            query += %22 WHERE %22 + %22 AND %22.join(where_clauses)%0A            %0A        # Nh%C3%B3m theo d%E1%BB%8Bch v%E1%BB%A5 v%C3%A0 s%E1%BA%AFp x%E1%BA%BFp theo s%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng gi%E1%BA%A3m d%E1%BA%A7n%0A        query += %22%22%22%0A        GROUP BY dv.MaDV, dv.TenDV, dv.Gia%0A        ORDER BY SoLuotSuDung DESC, dv.TenDV%0A        %22%22%22%0A        %0A        # Th%E1%BB%B1c thi truy v%E1%BA%A5n%0A        result = execute_query(query, tuple(params) if params else None, fetch=True)%0A        %0A        # T%C3%ADnh t%E1%BB%95ng s%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng v%C3%A0 t%E1%BB%95ng ti%E1%BB%81n%0A        tong_luot_su_dung = sum(item%5B'SoLuotSuDung'%5D for item in result)%0A        tong_tien = sum(item%5B'TongTien'%5D if item%5B'TongTien'%5D else 0 for item in result)%0A        %0A        # Th%C3%AAm th%C3%B4ng tin t%E1%BB%95ng h%E1%BB%A3p%0A        summary = %7B%0A            'tong_luot_su_dung': tong_luot_su_dung,%0A            'tong_tien': tong_tien%0A        %7D%0A        %0A        return result, summary%0A        %0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng: %7Be%7D%22)%0A        return %5B%5D, %7B'tong_luot_su_dung': 0, 'tong_tien': 0%7D%0A%0Adef thong_ke_dich_vu_theo_thang(nam=None, thang=None):%0A    %22%22%22%0A    Th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo th%C3%A1ng%0A    %0A    Args:%0A        nam (int, optional): N%C4%83m th%E1%BB%91ng k%C3%AA (m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%C3%A0 n%C4%83m hi%E1%BB%87n t%E1%BA%A1i)%0A        thang (int, optional): Th%C3%A1ng th%E1%BB%91ng k%C3%AA (m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%C3%A0 t%E1%BA%A5t c%E1%BA%A3 c%C3%A1c th%C3%A1ng trong n%C4%83m)%0A        %0A    Returns:%0A        list: Danh s%C3%A1ch d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3ng theo th%C3%A1ng%0A    %22%22%22%0A    try:%0A        # N%E1%BA%BFu kh%C3%B4ng c%C3%B3 n%C4%83m, l%E1%BA%A5y n%C4%83m hi%E1%BB%87n t%E1%BA%A1i%0A        if not nam:%0A            nam = datetime.datetime.now().year%0A            %0A        # X%C3%A2y d%E1%BB%B1ng c%C3%A2u truy v%E1%BA%A5n c%C6%A1 b%E1%BA%A3n%0A        query = %22%22%22%0A        SELECT %0A            strftime('%25m', pk.NgayKham) as Thang,%0A            dv.MaDV, %0A            dv.TenDV, %0A            COUNT(pk.MaPK) as SoLuotSuDung,%0A            SUM(dv.Gia) as TongTien%0A        FROM DICHVU dv%0A        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        WHERE strftime('%25Y', pk.NgayKham) = ?%0A        %22%22%22%0A        %0A        params = %5Bstr(nam)%5D%0A        %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n l%E1%BB%8Dc theo th%C3%A1ng n%E1%BA%BFu c%C3%B3%0A        if thang:%0A            query += %22 AND strftime('%25m', pk.NgayKham) = ?%22%0A            # %C4%90%E1%BA%A3m b%E1%BA%A3o th%C3%A1ng c%C3%B3 2 ch%E1%BB%AF s%E1%BB%91%0A            params.append(f%22%7Bthang:02d%7D%22)%0A            %0A        # Nh%C3%B3m theo th%C3%A1ng v%C3%A0 d%E1%BB%8Bch v%E1%BB%A5, s%E1%BA%AFp x%E1%BA%BFp theo th%C3%A1ng v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%0A        query += %22%22%22%0A        GROUP BY Thang, dv.MaDV, dv.TenDV%0A        ORDER BY Thang, SoLuotSuDung DESC%0A        %22%22%22%0A        %0A        # Th%E1%BB%B1c thi truy v%E1%BA%A5n%0A        result = execute_query(query, tuple(params), fetch=True)%0A        %0A        # T%E1%BB%95 ch%E1%BB%A9c k%E1%BA%BFt qu%E1%BA%A3 theo th%C3%A1ng%0A        thong_ke_theo_thang = %7B%7D%0A        for item in result:%0A            thang_key = item%5B'Thang'%5D%0A            if thang_key not in thong_ke_theo_thang:%0A                thong_ke_theo_thang%5Bthang_key%5D = %7B%0A                    'thang': int(thang_key),%0A                    'dich_vu': %5B%5D,%0A                    'tong_luot_su_dung': 0,%0A                    'tong_tien': 0%0A                %7D%0A                %0A            thong_ke_theo_thang%5Bthang_key%5D%5B'dich_vu'%5D.append(item)%0A            thong_ke_theo_thang%5Bthang_key%5D%5B'tong_luot_su_dung'%5D += item%5B'SoLuotSuDung'%5D%0A            thong_ke_theo_thang%5Bthang_key%5D%5B'tong_tien'%5D += item%5B'TongTien'%5D if item%5B'TongTien'%5D else 0%0A            %0A        # Chuy%E1%BB%83n t%E1%BB%AB dictionary sang list v%C3%A0 s%E1%BA%AFp x%E1%BA%BFp theo th%C3%A1ng%0A        ket_qua = list(thong_ke_theo_thang.values())%0A        ket_qua.sort(key=lambda x: x%5B'thang'%5D)%0A        %0A        return ket_qua%0A        %0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng: %7Be%7D%22)%0A        return %5B%5D%0A%0Adef thong_ke_dich_vu_theo_bac_si(ma_bac_si=None, tu_ngay=None, den_ngay=None):%0A    %22%22%22%0A    Th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo b%C3%A1c s%C4%A9%0A    %0A    Args:%0A        ma_bac_si (str, optional): M%C3%A3 b%C3%A1c s%C4%A9 c%E1%BA%A7n th%E1%BB%91ng k%C3%AA (m%E1%BA%B7c %C4%91%E1%BB%8Bnh l%C3%A0 t%E1%BA%A5t c%E1%BA%A3 b%C3%A1c s%C4%A9)%0A        tu_ngay (str, optional): Ng%C3%A0y b%E1%BA%AFt %C4%91%E1%BA%A7u th%E1%BB%91ng k%C3%AA (%C4%91%E1%BB%8Bnh d%E1%BA%A1ng YYYY-MM-DD)%0A        den_ngay (str, optional): Ng%C3%A0y k%E1%BA%BFt th%C3%BAc th%E1%BB%91ng k%C3%AA (%C4%91%E1%BB%8Bnh d%E1%BA%A1ng YYYY-MM-DD)%0A        %0A    Returns:%0A        list: Danh s%C3%A1ch d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3ng theo b%C3%A1c s%C4%A9%0A    %22%22%22%0A    try:%0A        # X%C3%A2y d%E1%BB%B1ng c%C3%A2u truy v%E1%BA%A5n c%C6%A1 b%E1%BA%A3n%0A        query = %22%22%22%0A        SELECT %0A            bs.MaBS,%0A            bs.HoTen as TenBacSi,%0A            dv.MaDV, %0A            dv.TenDV, %0A            COUNT(pk.MaPK) as SoLuotSuDung,%0A            SUM(dv.Gia) as TongTien%0A        FROM DICHVU dv%0A        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV%0A        JOIN BACSI bs ON pk.MaBS = bs.MaBS%0A        %22%22%22%0A        %0A        params = %5B%5D%0A        where_clauses = %5B%5D%0A        %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n l%E1%BB%8Dc theo b%C3%A1c s%C4%A9 n%E1%BA%BFu c%C3%B3%0A        if ma_bac_si:%0A            where_clauses.append(%22bs.MaBS = ?%22)%0A            params.append(ma_bac_si)%0A            %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n l%E1%BB%8Dc theo ng%C3%A0y n%E1%BA%BFu c%C3%B3%0A        if tu_ngay:%0A            where_clauses.append(%22pk.NgayKham %3E= ?%22)%0A            params.append(tu_ngay)%0A            %0A        if den_ngay:%0A            where_clauses.append(%22pk.NgayKham %3C= ?%22)%0A            params.append(den_ngay + %22 23:59:59%22)  # K%E1%BA%BFt th%C3%BAc ng%C3%A0y%0A            %0A        # Th%C3%AAm %C4%91i%E1%BB%81u ki%E1%BB%87n WHERE n%E1%BA%BFu c%C3%B3%0A        if where_clauses:%0A            query += %22 WHERE %22 + %22 AND %22.join(where_clauses)%0A            %0A        # Nh%C3%B3m theo b%C3%A1c s%C4%A9 v%C3%A0 d%E1%BB%8Bch v%E1%BB%A5, s%E1%BA%AFp x%E1%BA%BFp theo b%C3%A1c s%C4%A9 v%C3%A0 s%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%0A        query += %22%22%22%0A        GROUP BY bs.MaBS, bs.HoTen, dv.MaDV, dv.TenDV%0A        ORDER BY bs.HoTen, SoLuotSuDung DESC%0A        %22%22%22%0A        %0A        # Th%E1%BB%B1c thi truy v%E1%BA%A5n%0A        result = execute_query(query, tuple(params) if params else None, fetch=True)%0A        %0A        # T%E1%BB%95 ch%E1%BB%A9c k%E1%BA%BFt qu%E1%BA%A3 theo b%C3%A1c s%C4%A9%0A        thong_ke_theo_bac_si = %7B%7D%0A        for item in result:%0A            ma_bs = item%5B'MaBS'%5D%0A            if ma_bs not in thong_ke_theo_bac_si:%0A                thong_ke_theo_bac_si%5Bma_bs%5D = %7B%0A                    'ma_bac_si': ma_bs,%0A                    'ten_bac_si': item%5B'TenBacSi'%5D,%0A                    'dich_vu': %5B%5D,%0A                    'tong_luot_su_dung': 0,%0A                    'tong_tien': 0%0A                %7D%0A                %0A            thong_ke_theo_bac_si%5Bma_bs%5D%5B'dich_vu'%5D.append(%7B%0A                'MaDV': item%5B'MaDV'%5D,%0A                'TenDV': item%5B'TenDV'%5D,%0A                'SoLuotSuDung': item%5B'SoLuotSuDung'%5D,%0A                'TongTien': item%5B'TongTien'%5D%0A            %7D)%0A            thong_ke_theo_bac_si%5Bma_bs%5D%5B'tong_luot_su_dung'%5D += item%5B'SoLuotSuDung'%5D%0A            thong_ke_theo_bac_si%5Bma_bs%5D%5B'tong_tien'%5D += item%5B'TongTien'%5D if item%5B'TongTien'%5D else 0%0A            %0A        # Chuy%E1%BB%83n t%E1%BB%AB dictionary sang list v%C3%A0 s%E1%BA%AFp x%E1%BA%BFp theo t%C3%AAn b%C3%A1c s%C4%A9%0A        ket_qua = list(thong_ke_theo_bac_si.values())%0A        ket_qua.sort(key=lambda x: x%5B'ten_bac_si'%5D)%0A        %0A        return ket_qua%0A        %0A    except Exception as e:%0A        print(f%22L%E1%BB%97i khi th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 theo b%C3%A1c s%C4%A9: %7Be%7D%22)%0A        return %5B%5D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_dich_vu.html","patch":"@@ -0,0 +1,8687 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng %7C NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-form %7B%0A        background-color: #f5f5f5;%0A        padding: 20px;%0A        border-radius: 8px;%0A        margin-bottom: 20px;%0A        display: flex;%0A        flex-wrap: wrap;%0A        gap: 15px;%0A        align-items: flex-end;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A        min-width: 200px;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form input%5Btype=%22date%22%5D %7B%0A        width: 100%25;%0A        padding: 8px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .filter-form button %7B%0A        padding: 8px 15px;%0A        background-color: #4CAF50;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        transition: background-color 0.3s;%0A    %7D%0A    %0A    .filter-form button:hover %7B%0A        background-color: #45a049;%0A    %7D%0A    %0A    .report-summary %7B%0A        background-color: #e9f7ef;%0A        padding: 15px;%0A        border-radius: 8px;%0A        margin-bottom: 20px;%0A        display: flex;%0A        justify-content: space-around;%0A        flex-wrap: wrap;%0A    %7D%0A    %0A    .summary-item %7B%0A        text-align: center;%0A        padding: 10px;%0A    %7D%0A    %0A    .summary-item .value %7B%0A        font-size: 24px;%0A        font-weight: bold;%0A        color: #2E7D32;%0A    %7D%0A    %0A    .summary-item .label %7B%0A        font-size: 14px;%0A        color: #555;%0A    %7D%0A    %0A    .report-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A        margin-top: 20px;%0A    %7D%0A    %0A    .report-table th, .report-table td %7B%0A        border: 1px solid #ddd;%0A        padding: 12px;%0A        text-align: left;%0A    %7D%0A    %0A    .report-table th %7B%0A        background-color: #4CAF50;%0A        color: white;%0A    %7D%0A    %0A    .report-table tr:nth-child(even) %7B%0A        background-color: #f2f2f2;%0A    %7D%0A    %0A    .report-table tr:hover %7B%0A        background-color: #e9f7ef;%0A    %7D%0A    %0A    .no-data %7B%0A        text-align: center;%0A        padding: 30px;%0A        color: #777;%0A        font-style: italic;%0A    %7D%0A    %0A    .chart-container %7B%0A        margin-top: 30px;%0A        height: 400px;%0A    %7D%0A    %0A    .export-buttons %7B%0A        margin-top: 20px;%0A        display: flex;%0A        gap: 10px;%0A        justify-content: flex-end;%0A    %7D%0A    %0A    .export-buttons button %7B%0A        padding: 8px 15px;%0A        background-color: #2196F3;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        display: flex;%0A        align-items: center;%0A        gap: 5px;%0A    %7D%0A    %0A    .export-buttons button:hover %7B%0A        background-color: #0b7dda;%0A    %7D%0A    %0A    @media print %7B%0A        .filter-form, .export-buttons, .sidebar, .header, .footer %7B%0A            display: none;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O D%E1%BB%8ACH V%E1%BB%A4 S%E1%BB%AC D%E1%BB%A4NG%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Form l%E1%BB%8Dc b%C3%A1o c%C3%A1o --%3E%0A%3Cform class=%22filter-form%22 method=%22GET%22 action=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22%3E%0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22tu_ngay%22%3ET%E1%BB%AB ng%C3%A0y:%3C/label%3E%0A        %3Cinput type=%22date%22 id=%22tu_ngay%22 name=%22tu_ngay%22 value=%22%7B%7B tu_ngay %7D%7D%22%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22den_ngay%22%3E%C4%90%E1%BA%BFn ng%C3%A0y:%3C/label%3E%0A        %3Cinput type=%22date%22 id=%22den_ngay%22 name=%22den_ngay%22 value=%22%7B%7B den_ngay %7D%7D%22%3E%0A    %3C/div%3E%0A    %0A    %3Cbutton type=%22submit%22%3E%0A        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A%3C/form%3E%0A%0A%3C!-- T%C3%B3m t%E1%BA%AFt b%C3%A1o c%C3%A1o --%3E%0A%3Cdiv class=%22report-summary%22%3E%0A    %3Cdiv class=%22summary-item%22%3E%0A        %3Cdiv class=%22value%22%3E%7B%7B summary.tong_luot_su_dung %7D%7D%3C/div%3E%0A        %3Cdiv class=%22label%22%3ET%E1%BB%95ng l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%3C/div%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22summary-item%22%3E%0A        %3Cdiv class=%22value%22%3E%7B%7B %22%7B:,.0f%7D%22.format(summary.tong_tien) %7D%7D VN%C4%90%3C/div%3E%0A        %3Cdiv class=%22label%22%3ET%E1%BB%95ng doanh thu%3C/div%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22summary-item%22%3E%0A        %3Cdiv class=%22value%22%3E%7B%7B dich_vu_list%7Clength %7D%7D%3C/div%3E%0A        %3Cdiv class=%22label%22%3ES%E1%BB%91 d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng%3C/div%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%0A%3C!-- B%E1%BA%A3ng b%C3%A1o c%C3%A1o --%3E%0A%7B%25 if dich_vu_list %25%7D%0A%3Cdiv class=%22table-responsive%22%3E%0A    %3Ctable class=%22report-table%22%3E%0A        %3Cthead%3E%0A            %3Ctr%3E%0A                %3Cth%3ESTT%3C/th%3E%0A                %3Cth%3EM%C3%A3 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                %3Cth%3ET%C3%AAn d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                %3Cth%3E%C4%90%C6%A1n gi%C3%A1 (VN%C4%90)%3C/th%3E%0A                %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%3C/th%3E%0A                %3Cth%3ET%E1%BB%B7 l%E1%BB%87 (%25)%3C/th%3E%0A                %3Cth%3EDoanh thu (VN%C4%90)%3C/th%3E%0A            %3C/tr%3E%0A        %3C/thead%3E%0A        %3Ctbody%3E%0A            %7B%25 for dv in dich_vu_list %25%7D%0A            %3Ctr%3E%0A                %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B dv.MaDV %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B dv.TenDV %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.Gia) %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B dv.SoLuotSuDung %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(dv.SoLuotSuDung / summary.tong_luot_su_dung * 100) if summary.tong_luot_su_dung %3E 0 else 0 %7D%7D%3C/td%3E%0A                %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.TongTien) %7D%7D%3C/td%3E%0A            %3C/tr%3E%0A            %7B%25 endfor %25%7D%0A        %3C/tbody%3E%0A    %3C/table%3E%0A%3C/div%3E%0A%0A%3C!-- Bi%E1%BB%83u %C4%91%E1%BB%93 --%3E%0A%3Cdiv class=%22chart-container%22%3E%0A    %3Ccanvas id=%22dichVuChart%22%3E%3C/canvas%3E%0A%3C/div%3E%0A%0A%3C!-- N%C3%BAt xu%E1%BA%A5t b%C3%A1o c%C3%A1o --%3E%0A%3Cdiv class=%22export-buttons%22%3E%0A    %3Cbutton onclick=%22window.print()%22%3E%0A        %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A    %3Cbutton id=%22exportExcel%22%3E%0A        %3Ci class=%22fas fa-file-excel%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A    %3C/button%3E%0A    %3Cbutton id=%22exportPDF%22%3E%0A        %3Ci class=%22fas fa-file-pdf%22%3E%3C/i%3E Xu%E1%BA%A5t PDF%0A    %3C/button%3E%0A%3C/div%3E%0A%7B%25 else %25%7D%0A%3Cdiv class=%22no-data%22%3E%0A    %3Cp%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o trong kho%E1%BA%A3ng th%E1%BB%9Di gian %C4%91%C3%A3 ch%E1%BB%8Dn%3C/p%3E%0A%3C/div%3E%0A%7B%25 endif %25%7D%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        %7B%25 if dich_vu_list %25%7D%0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93%0A        const labels = %5B%7B%25 for dv in dich_vu_list %25%7D%7B%25 if loop.index %3C= 10 %25%7D'%7B%7B dv.TenDV %7D%7D',%7B%25 endif %25%7D%7B%25 endfor %25%7D%5D;%0A        const data = %5B%7B%25 for dv in dich_vu_list %25%7D%7B%25 if loop.index %3C= 10 %25%7D%7B%7B dv.SoLuotSuDung %7D%7D,%7B%25 endif %25%7D%7B%25 endfor %25%7D%5D;%0A        const backgroundColors = %5B%0A            'rgba(75, 192, 192, 0.7)',%0A            'rgba(54, 162, 235, 0.7)',%0A            'rgba(255, 206, 86, 0.7)',%0A            'rgba(255, 99, 132, 0.7)',%0A            'rgba(153, 102, 255, 0.7)',%0A            'rgba(255, 159, 64, 0.7)',%0A            'rgba(199, 199, 199, 0.7)',%0A            'rgba(83, 102, 255, 0.7)',%0A            'rgba(40, 159, 64, 0.7)',%0A            'rgba(210, 199, 199, 0.7)'%0A        %5D;%0A        %0A        // T%E1%BA%A1o bi%E1%BB%83u %C4%91%E1%BB%93%0A        const ctx = document.getElementById('dichVuChart').getContext('2d');%0A        const myChart = new Chart(ctx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: labels,%0A                datasets: %5B%7B%0A                    label: 'S%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng',%0A                    data: data,%0A                    backgroundColor: backgroundColors,%0A                    borderColor: backgroundColors.map(color =%3E color.replace('0.7', '1')),%0A                    borderWidth: 1%0A                %7D%5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                maintainAspectRatio: false,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        title: %7B%0A                            display: true,%0A                            text: 'S%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng'%0A                        %7D%0A                    %7D,%0A                    x: %7B%0A                        title: %7B%0A                            display: true,%0A                            text: 'D%E1%BB%8Bch v%E1%BB%A5'%0A                        %7D%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Top 10 d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C6%B0%E1%BB%A3c s%E1%BB%AD d%E1%BB%A5ng nhi%E1%BB%81u nh%E1%BA%A5t',%0A                        font: %7B%0A                            size: 16%0A                        %7D%0A                    %7D,%0A                    legend: %7B%0A                        display: false%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD xu%E1%BA%A5t Excel v%C3%A0 PDF (gi%E1%BA%A3 l%E1%BA%ADp)%0A        document.getElementById('exportExcel').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t Excel %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %0A        document.getElementById('exportPDF').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t PDF %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %7B%25 endif %25%7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_dich_vu_theo_thang.html","patch":"@@ -0,0 +1,9529 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng %7C NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-form %7B%0A        background-color: #f5f5f5;%0A        padding: 20px;%0A        border-radius: 8px;%0A        margin-bottom: 20px;%0A        display: flex;%0A        flex-wrap: wrap;%0A        gap: 15px;%0A        align-items: flex-end;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A        min-width: 200px;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form select %7B%0A        width: 100%25;%0A        padding: 8px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .filter-form button %7B%0A        padding: 8px 15px;%0A        background-color: #4CAF50;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        transition: background-color 0.3s;%0A    %7D%0A    %0A    .filter-form button:hover %7B%0A        background-color: #45a049;%0A    %7D%0A    %0A    .month-section %7B%0A        margin-bottom: 30px;%0A        border: 1px solid #ddd;%0A        border-radius: 8px;%0A        overflow: hidden;%0A    %7D%0A    %0A    .month-header %7B%0A        background-color: #4CAF50;%0A        color: white;%0A        padding: 15px;%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A    %7D%0A    %0A    .month-title %7B%0A        font-size: 18px;%0A        font-weight: bold;%0A    %7D%0A    %0A    .month-summary %7B%0A        display: flex;%0A        gap: 20px;%0A    %7D%0A    %0A    .month-summary-item %7B%0A        font-size: 14px;%0A    %7D%0A    %0A    .month-content %7B%0A        padding: 15px;%0A    %7D%0A    %0A    .report-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .report-table th, .report-table td %7B%0A        border: 1px solid #ddd;%0A        padding: 12px;%0A        text-align: left;%0A    %7D%0A    %0A    .report-table th %7B%0A        background-color: #f2f2f2;%0A    %7D%0A    %0A    .report-table tr:hover %7B%0A        background-color: #f9f9f9;%0A    %7D%0A    %0A    .no-data %7B%0A        text-align: center;%0A        padding: 30px;%0A        color: #777;%0A        font-style: italic;%0A    %7D%0A    %0A    .chart-container %7B%0A        margin-top: 30px;%0A        height: 400px;%0A    %7D%0A    %0A    .export-buttons %7B%0A        margin-top: 20px;%0A        display: flex;%0A        gap: 10px;%0A        justify-content: flex-end;%0A    %7D%0A    %0A    .export-buttons button %7B%0A        padding: 8px 15px;%0A        background-color: #2196F3;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        display: flex;%0A        align-items: center;%0A        gap: 5px;%0A    %7D%0A    %0A    .export-buttons button:hover %7B%0A        background-color: #0b7dda;%0A    %7D%0A    %0A    @media print %7B%0A        .filter-form, .export-buttons, .sidebar, .header, .footer %7B%0A            display: none;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O D%E1%BB%8ACH V%E1%BB%A4 THEO TH%C3%81NG%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Form l%E1%BB%8Dc b%C3%A1o c%C3%A1o --%3E%0A%3Cform class=%22filter-form%22 method=%22GET%22 action=%22%7B%7B url_for('bao_cao_dich_vu_theo_thang') %7D%7D%22%3E%0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22nam%22%3EN%C4%83m:%3C/label%3E%0A        %3Cselect id=%22nam%22 name=%22nam%22%3E%0A            %7B%25 for year in range(2024, 2020, -1) %25%7D%0A            %3Coption value=%22%7B%7B year %7D%7D%22 %7B%25 if nam == year %25%7Dselected%7B%25 endif %25%7D%3E%7B%7B year %7D%7D%3C/option%3E%0A            %7B%25 endfor %25%7D%0A        %3C/select%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22thang%22%3ETh%C3%A1ng:%3C/label%3E%0A        %3Cselect id=%22thang%22 name=%22thang%22%3E%0A            %3Coption value=%22%22%3ET%E1%BA%A5t c%E1%BA%A3 c%C3%A1c th%C3%A1ng%3C/option%3E%0A            %7B%25 for month in range(1, 13) %25%7D%0A            %3Coption value=%22%7B%7B month %7D%7D%22 %7B%25 if thang == month %25%7Dselected%7B%25 endif %25%7D%3ETh%C3%A1ng %7B%7B month %7D%7D%3C/option%3E%0A            %7B%25 endfor %25%7D%0A        %3C/select%3E%0A    %3C/div%3E%0A    %0A    %3Cbutton type=%22submit%22%3E%0A        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A%3C/form%3E%0A%0A%3C!-- Bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan --%3E%0A%3Cdiv class=%22chart-container%22%3E%0A    %3Ccanvas id=%22overviewChart%22%3E%3C/canvas%3E%0A%3C/div%3E%0A%0A%3C!-- Danh s%C3%A1ch b%C3%A1o c%C3%A1o theo th%C3%A1ng --%3E%0A%7B%25 if thong_ke_list %25%7D%0A    %7B%25 for thang_data in thong_ke_list %25%7D%0A    %3Cdiv class=%22month-section%22%3E%0A        %3Cdiv class=%22month-header%22%3E%0A            %3Cdiv class=%22month-title%22%3ETh%C3%A1ng %7B%7B thang_data.thang %7D%7D/%7B%7B nam %7D%7D%3C/div%3E%0A            %3Cdiv class=%22month-summary%22%3E%0A                %3Cdiv class=%22month-summary-item%22%3E%0A                    %3Cstrong%3ET%E1%BB%95ng l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng:%3C/strong%3E %7B%7B thang_data.tong_luot_su_dung %7D%7D%0A                %3C/div%3E%0A                %3Cdiv class=%22month-summary-item%22%3E%0A                    %3Cstrong%3ET%E1%BB%95ng doanh thu:%3C/strong%3E %7B%7B %22%7B:,.0f%7D%22.format(thang_data.tong_tien) %7D%7D VN%C4%90%0A                %3C/div%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %3Cdiv class=%22month-content%22%3E%0A            %3Ctable class=%22report-table%22%3E%0A                %3Cthead%3E%0A                    %3Ctr%3E%0A                        %3Cth%3ESTT%3C/th%3E%0A                        %3Cth%3EM%C3%A3 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                        %3Cth%3ET%C3%AAn d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                        %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%3C/th%3E%0A                        %3Cth%3ET%E1%BB%B7 l%E1%BB%87 (%25)%3C/th%3E%0A                        %3Cth%3EDoanh thu (VN%C4%90)%3C/th%3E%0A                    %3C/tr%3E%0A                %3C/thead%3E%0A                %3Ctbody%3E%0A                    %7B%25 for dv in thang_data.dich_vu %25%7D%0A                    %3Ctr%3E%0A                        %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.MaDV %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.TenDV %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.SoLuotSuDung %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(dv.SoLuotSuDung / thang_data.tong_luot_su_dung * 100) if thang_data.tong_luot_su_dung %3E 0 else 0 %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.TongTien) %7D%7D%3C/td%3E%0A                    %3C/tr%3E%0A                    %7B%25 endfor %25%7D%0A                %3C/tbody%3E%0A            %3C/table%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A    %7B%25 endfor %25%7D%0A%0A%3C!-- N%C3%BAt xu%E1%BA%A5t b%C3%A1o c%C3%A1o --%3E%0A%3Cdiv class=%22export-buttons%22%3E%0A    %3Cbutton onclick=%22window.print()%22%3E%0A        %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A    %3Cbutton id=%22exportExcel%22%3E%0A        %3Ci class=%22fas fa-file-excel%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A    %3C/button%3E%0A    %3Cbutton id=%22exportPDF%22%3E%0A        %3Ci class=%22fas fa-file-pdf%22%3E%3C/i%3E Xu%E1%BA%A5t PDF%0A    %3C/button%3E%0A%3C/div%3E%0A%7B%25 else %25%7D%0A%3Cdiv class=%22no-data%22%3E%0A    %3Cp%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o trong kho%E1%BA%A3ng th%E1%BB%9Di gian %C4%91%C3%A3 ch%E1%BB%8Dn%3C/p%3E%0A%3C/div%3E%0A%7B%25 endif %25%7D%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        %7B%25 if thong_ke_list %25%7D%0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan%0A        const labels = %5B%7B%25 for thang_data in thong_ke_list %25%7D'Th%C3%A1ng %7B%7B thang_data.thang %7D%7D',%7B%25 endfor %25%7D%5D;%0A        const luotSuDung = %5B%7B%25 for thang_data in thong_ke_list %25%7D%7B%7B thang_data.tong_luot_su_dung %7D%7D,%7B%25 endfor %25%7D%5D;%0A        const doanhThu = %5B%7B%25 for thang_data in thong_ke_list %25%7D%7B%7B thang_data.tong_tien %7D%7D,%7B%25 endfor %25%7D%5D;%0A        %0A        // T%E1%BA%A1o bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan%0A        const ctx = document.getElementById('overviewChart').getContext('2d');%0A        const myChart = new Chart(ctx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: labels,%0A                datasets: %5B%0A                    %7B%0A                        label: 'L%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng',%0A                        data: luotSuDung,%0A                        backgroundColor: 'rgba(54, 162, 235, 0.7)',%0A                        borderColor: 'rgba(54, 162, 235, 1)',%0A                        borderWidth: 1,%0A                        yAxisID: 'y'%0A                    %7D,%0A                    %7B%0A                        label: 'Doanh thu (VN%C4%90)',%0A                        data: doanhThu,%0A                        backgroundColor: 'rgba(255, 99, 132, 0.7)',%0A                        borderColor: 'rgba(255, 99, 132, 1)',%0A                        borderWidth: 1,%0A                        type: 'line',%0A                        yAxisID: 'y1'%0A                    %7D%0A                %5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                maintainAspectRatio: false,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        position: 'left',%0A                        title: %7B%0A                            display: true,%0A                            text: 'L%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng'%0A                        %7D%0A                    %7D,%0A                    y1: %7B%0A                        beginAtZero: true,%0A                        position: 'right',%0A                        title: %7B%0A                            display: true,%0A                            text: 'Doanh thu (VN%C4%90)'%0A                        %7D,%0A                        grid: %7B%0A                            drawOnChartArea: false%0A                        %7D%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 theo th%C3%A1ng n%C4%83m %7B%7B nam %7D%7D',%0A                        font: %7B%0A                            size: 16%0A                        %7D%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD xu%E1%BA%A5t Excel v%C3%A0 PDF (gi%E1%BA%A3 l%E1%BA%ADp)%0A        document.getElementById('exportExcel').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t Excel %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %0A        document.getElementById('exportPDF').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t PDF %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %7B%25 endif %25%7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao.html","patch":"@@ -0,0 +1,1720 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o - Th%E1%BB%91ng k%C3%AA %7C NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O - TH%E1%BB%90NG K%C3%8A%3C/h2%3E%0A%3C/div%3E%0A%0A%3Cdiv class=%22services-grid%22%3E%0A    %3C!-- B%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng --%3E%0A    %3Cdiv class=%22service-card%22 data-link=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22%3E%0A        %3Cdiv class=%22service-icon%22%3E%0A            %3Ci class=%22fas fa-chart-pie%22%3E%3C/i%3E%0A        %3C/div%3E%0A        %3Ch3 class=%22service-title%22%3EB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng%3C/h3%3E%0A        %3Cp class=%22service-description%22%3ETh%E1%BB%91ng k%C3%AA c%C3%A1c d%E1%BB%8Bch v%E1%BB%A5 %C4%91%C3%A3 s%E1%BB%AD d%E1%BB%A5ng th%C3%B4ng qua phi%E1%BA%BFu kh%C3%A1m, s%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng v%C3%A0 doanh thu.%3C/p%3E%0A        %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu') %7D%7D%22 class=%22btn%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A    %3C/div%3E%0A%0A    %3C!-- Th%E1%BB%91ng k%C3%AA theo th%C3%A1ng --%3E%0A    %3Cdiv class=%22service-card%22 data-link=%22%7B%7B url_for('bao_cao_dich_vu_theo_thang') %7D%7D%22%3E%0A        %3Cdiv class=%22service-icon%22%3E%0A            %3Ci class=%22fas fa-calendar-alt%22%3E%3C/i%3E%0A        %3C/div%3E%0A        %3Ch3 class=%22service-title%22%3ETh%E1%BB%91ng k%C3%AA theo th%C3%A1ng%3C/h3%3E%0A        %3Cp class=%22service-description%22%3ETh%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo t%E1%BB%ABng th%C3%A1ng trong n%C4%83m, ph%C3%A2n t%C3%ADch xu h%C6%B0%E1%BB%9Bng s%E1%BB%AD d%E1%BB%A5ng.%3C/p%3E%0A        %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu_theo_thang') %7D%7D%22 class=%22btn%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A    %3C/div%3E%0A%0A    %3C!-- Th%E1%BB%91ng k%C3%AA theo b%C3%A1c s%C4%A9 --%3E%0A    %3Cdiv class=%22service-card%22 data-link=%22%7B%7B url_for('bao_cao_dich_vu_theo_bac_si') %7D%7D%22%3E%0A        %3Cdiv class=%22service-icon%22%3E%0A            %3Ci class=%22fas fa-user-md%22%3E%3C/i%3E%0A        %3C/div%3E%0A        %3Ch3 class=%22service-title%22%3ETh%E1%BB%91ng k%C3%AA theo b%C3%A1c s%C4%A9%3C/h3%3E%0A        %3Cp class=%22service-description%22%3ETh%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 s%E1%BB%AD d%E1%BB%A5ng theo t%E1%BB%ABng b%C3%A1c s%C4%A9, %C4%91%C3%A1nh gi%C3%A1 hi%E1%BB%87u su%E1%BA%A5t v%C3%A0 chuy%C3%AAn m%C3%B4n.%3C/p%3E%0A        %3Ca href=%22%7B%7B url_for('bao_cao_dich_vu_theo_bac_si') %7D%7D%22 class=%22btn%22%3EXem chi ti%E1%BA%BFt%3C/a%3E%0A    %3C/div%3E%0A%3C/div%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false},{"path":"nhakhoaso/templates/bao_cao_dich_vu_theo_bac_si.html","patch":"@@ -0,0 +1,9637 @@\n+%7B%25 extends 'layout.html' %25%7D%0A%0A%7B%25 block title %25%7DB%C3%A1o c%C3%A1o d%E1%BB%8Bch v%E1%BB%A5 theo b%C3%A1c s%C4%A9 %7C NHAKHOASO%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_css %25%7D%0A%3Cstyle%3E%0A    .filter-form %7B%0A        background-color: #f5f5f5;%0A        padding: 20px;%0A        border-radius: 8px;%0A        margin-bottom: 20px;%0A        display: flex;%0A        flex-wrap: wrap;%0A        gap: 15px;%0A        align-items: flex-end;%0A    %7D%0A    %0A    .filter-form .form-group %7B%0A        flex: 1;%0A        min-width: 200px;%0A    %7D%0A    %0A    .filter-form label %7B%0A        display: block;%0A        margin-bottom: 5px;%0A        font-weight: 500;%0A    %7D%0A    %0A    .filter-form select, .filter-form input%5Btype=%22date%22%5D %7B%0A        width: 100%25;%0A        padding: 8px;%0A        border: 1px solid #ddd;%0A        border-radius: 4px;%0A    %7D%0A    %0A    .filter-form button %7B%0A        padding: 8px 15px;%0A        background-color: #4CAF50;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        transition: background-color 0.3s;%0A    %7D%0A    %0A    .filter-form button:hover %7B%0A        background-color: #45a049;%0A    %7D%0A    %0A    .doctor-section %7B%0A        margin-bottom: 30px;%0A        border: 1px solid #ddd;%0A        border-radius: 8px;%0A        overflow: hidden;%0A    %7D%0A    %0A    .doctor-header %7B%0A        background-color: #2196F3;%0A        color: white;%0A        padding: 15px;%0A        display: flex;%0A        justify-content: space-between;%0A        align-items: center;%0A    %7D%0A    %0A    .doctor-title %7B%0A        font-size: 18px;%0A        font-weight: bold;%0A    %7D%0A    %0A    .doctor-summary %7B%0A        display: flex;%0A        gap: 20px;%0A    %7D%0A    %0A    .doctor-summary-item %7B%0A        font-size: 14px;%0A    %7D%0A    %0A    .doctor-content %7B%0A        padding: 15px;%0A    %7D%0A    %0A    .report-table %7B%0A        width: 100%25;%0A        border-collapse: collapse;%0A    %7D%0A    %0A    .report-table th, .report-table td %7B%0A        border: 1px solid #ddd;%0A        padding: 12px;%0A        text-align: left;%0A    %7D%0A    %0A    .report-table th %7B%0A        background-color: #f2f2f2;%0A    %7D%0A    %0A    .report-table tr:hover %7B%0A        background-color: #f9f9f9;%0A    %7D%0A    %0A    .no-data %7B%0A        text-align: center;%0A        padding: 30px;%0A        color: #777;%0A        font-style: italic;%0A    %7D%0A    %0A    .chart-container %7B%0A        margin-top: 30px;%0A        height: 400px;%0A    %7D%0A    %0A    .export-buttons %7B%0A        margin-top: 20px;%0A        display: flex;%0A        gap: 10px;%0A        justify-content: flex-end;%0A    %7D%0A    %0A    .export-buttons button %7B%0A        padding: 8px 15px;%0A        background-color: #2196F3;%0A        color: white;%0A        border: none;%0A        border-radius: 4px;%0A        cursor: pointer;%0A        display: flex;%0A        align-items: center;%0A        gap: 5px;%0A    %7D%0A    %0A    .export-buttons button:hover %7B%0A        background-color: #0b7dda;%0A    %7D%0A    %0A    @media print %7B%0A        .filter-form, .export-buttons, .sidebar, .header, .footer %7B%0A            display: none;%0A        %7D%0A        %0A        .main-content %7B%0A            width: 100%25;%0A            margin: 0;%0A            padding: 0;%0A        %7D%0A    %7D%0A%3C/style%3E%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block content %25%7D%0A%3Cdiv class=%22section-title%22%3E%0A    %3Ch2%3EB%C3%81O C%C3%81O D%E1%BB%8ACH V%E1%BB%A4 THEO B%C3%81C S%C4%A8%3C/h2%3E%0A%3C/div%3E%0A%0A%3C!-- Form l%E1%BB%8Dc b%C3%A1o c%C3%A1o --%3E%0A%3Cform class=%22filter-form%22 method=%22GET%22 action=%22%7B%7B url_for('bao_cao_dich_vu_theo_bac_si') %7D%7D%22%3E%0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22ma_bac_si%22%3EB%C3%A1c s%C4%A9:%3C/label%3E%0A        %3Cselect id=%22ma_bac_si%22 name=%22ma_bac_si%22%3E%0A            %3Coption value=%22%22%3ET%E1%BA%A5t c%E1%BA%A3 b%C3%A1c s%C4%A9%3C/option%3E%0A            %7B%25 for bs in bac_si_list %25%7D%0A            %3Coption value=%22%7B%7B bs.MaBS %7D%7D%22 %7B%25 if ma_bac_si == bs.MaBS %25%7Dselected%7B%25 endif %25%7D%3E%7B%7B bs.HoTen %7D%7D%3C/option%3E%0A            %7B%25 endfor %25%7D%0A        %3C/select%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22tu_ngay%22%3ET%E1%BB%AB ng%C3%A0y:%3C/label%3E%0A        %3Cinput type=%22date%22 id=%22tu_ngay%22 name=%22tu_ngay%22 value=%22%7B%7B tu_ngay %7D%7D%22%3E%0A    %3C/div%3E%0A    %0A    %3Cdiv class=%22form-group%22%3E%0A        %3Clabel for=%22den_ngay%22%3E%C4%90%E1%BA%BFn ng%C3%A0y:%3C/label%3E%0A        %3Cinput type=%22date%22 id=%22den_ngay%22 name=%22den_ngay%22 value=%22%7B%7B den_ngay %7D%7D%22%3E%0A    %3C/div%3E%0A    %0A    %3Cbutton type=%22submit%22%3E%0A        %3Ci class=%22fas fa-filter%22%3E%3C/i%3E L%E1%BB%8Dc b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A%3C/form%3E%0A%0A%3C!-- Bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan --%3E%0A%3Cdiv class=%22chart-container%22%3E%0A    %3Ccanvas id=%22overviewChart%22%3E%3C/canvas%3E%0A%3C/div%3E%0A%0A%3C!-- Danh s%C3%A1ch b%C3%A1o c%C3%A1o theo b%C3%A1c s%C4%A9 --%3E%0A%7B%25 if thong_ke_list %25%7D%0A    %7B%25 for bac_si_data in thong_ke_list %25%7D%0A    %3Cdiv class=%22doctor-section%22%3E%0A        %3Cdiv class=%22doctor-header%22%3E%0A            %3Cdiv class=%22doctor-title%22%3E%7B%7B bac_si_data.ten_bac_si %7D%7D (%7B%7B bac_si_data.ma_bac_si %7D%7D)%3C/div%3E%0A            %3Cdiv class=%22doctor-summary%22%3E%0A                %3Cdiv class=%22doctor-summary-item%22%3E%0A                    %3Cstrong%3ET%E1%BB%95ng l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng:%3C/strong%3E %7B%7B bac_si_data.tong_luot_su_dung %7D%7D%0A                %3C/div%3E%0A                %3Cdiv class=%22doctor-summary-item%22%3E%0A                    %3Cstrong%3ET%E1%BB%95ng doanh thu:%3C/strong%3E %7B%7B %22%7B:,.0f%7D%22.format(bac_si_data.tong_tien) %7D%7D VN%C4%90%0A                %3C/div%3E%0A            %3C/div%3E%0A        %3C/div%3E%0A        %3Cdiv class=%22doctor-content%22%3E%0A            %3Ctable class=%22report-table%22%3E%0A                %3Cthead%3E%0A                    %3Ctr%3E%0A                        %3Cth%3ESTT%3C/th%3E%0A                        %3Cth%3EM%C3%A3 d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                        %3Cth%3ET%C3%AAn d%E1%BB%8Bch v%E1%BB%A5%3C/th%3E%0A                        %3Cth%3ES%E1%BB%91 l%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng%3C/th%3E%0A                        %3Cth%3ET%E1%BB%B7 l%E1%BB%87 (%25)%3C/th%3E%0A                        %3Cth%3EDoanh thu (VN%C4%90)%3C/th%3E%0A                    %3C/tr%3E%0A                %3C/thead%3E%0A                %3Ctbody%3E%0A                    %7B%25 for dv in bac_si_data.dich_vu %25%7D%0A                    %3Ctr%3E%0A                        %3Ctd%3E%7B%7B loop.index %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.MaDV %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.TenDV %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B dv.SoLuotSuDung %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B %22%25.2f%22%7Cformat(dv.SoLuotSuDung / bac_si_data.tong_luot_su_dung * 100) if bac_si_data.tong_luot_su_dung %3E 0 else 0 %7D%7D%3C/td%3E%0A                        %3Ctd%3E%7B%7B %22%7B:,.0f%7D%22.format(dv.TongTien) %7D%7D%3C/td%3E%0A                    %3C/tr%3E%0A                    %7B%25 endfor %25%7D%0A                %3C/tbody%3E%0A            %3C/table%3E%0A        %3C/div%3E%0A    %3C/div%3E%0A    %7B%25 endfor %25%7D%0A%0A%3C!-- N%C3%BAt xu%E1%BA%A5t b%C3%A1o c%C3%A1o --%3E%0A%3Cdiv class=%22export-buttons%22%3E%0A    %3Cbutton onclick=%22window.print()%22%3E%0A        %3Ci class=%22fas fa-print%22%3E%3C/i%3E In b%C3%A1o c%C3%A1o%0A    %3C/button%3E%0A    %3Cbutton id=%22exportExcel%22%3E%0A        %3Ci class=%22fas fa-file-excel%22%3E%3C/i%3E Xu%E1%BA%A5t Excel%0A    %3C/button%3E%0A    %3Cbutton id=%22exportPDF%22%3E%0A        %3Ci class=%22fas fa-file-pdf%22%3E%3C/i%3E Xu%E1%BA%A5t PDF%0A    %3C/button%3E%0A%3C/div%3E%0A%7B%25 else %25%7D%0A%3Cdiv class=%22no-data%22%3E%0A    %3Cp%3EKh%C3%B4ng c%C3%B3 d%E1%BB%AF li%E1%BB%87u b%C3%A1o c%C3%A1o trong kho%E1%BA%A3ng th%E1%BB%9Di gian %C4%91%C3%A3 ch%E1%BB%8Dn%3C/p%3E%0A%3C/div%3E%0A%7B%25 endif %25%7D%0A%7B%25 endblock %25%7D%0A%0A%7B%25 block extra_js %25%7D%0A%3Cscript src=%22https://cdn.jsdelivr.net/npm/chart.js%22%3E%3C/script%3E%0A%3Cscript%3E%0A    document.addEventListener('DOMContentLoaded', function() %7B%0A        %7B%25 if thong_ke_list %25%7D%0A        // D%E1%BB%AF li%E1%BB%87u cho bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan%0A        const labels = %5B%7B%25 for bac_si_data in thong_ke_list %25%7D'%7B%7B bac_si_data.ten_bac_si %7D%7D',%7B%25 endfor %25%7D%5D;%0A        const luotSuDung = %5B%7B%25 for bac_si_data in thong_ke_list %25%7D%7B%7B bac_si_data.tong_luot_su_dung %7D%7D,%7B%25 endfor %25%7D%5D;%0A        const doanhThu = %5B%7B%25 for bac_si_data in thong_ke_list %25%7D%7B%7B bac_si_data.tong_tien %7D%7D,%7B%25 endfor %25%7D%5D;%0A        %0A        // T%E1%BA%A1o bi%E1%BB%83u %C4%91%E1%BB%93 t%E1%BB%95ng quan%0A        const ctx = document.getElementById('overviewChart').getContext('2d');%0A        const myChart = new Chart(ctx, %7B%0A            type: 'bar',%0A            data: %7B%0A                labels: labels,%0A                datasets: %5B%0A                    %7B%0A                        label: 'L%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng',%0A                        data: luotSuDung,%0A                        backgroundColor: 'rgba(54, 162, 235, 0.7)',%0A                        borderColor: 'rgba(54, 162, 235, 1)',%0A                        borderWidth: 1,%0A                        yAxisID: 'y'%0A                    %7D,%0A                    %7B%0A                        label: 'Doanh thu (VN%C4%90)',%0A                        data: doanhThu,%0A                        backgroundColor: 'rgba(255, 99, 132, 0.7)',%0A                        borderColor: 'rgba(255, 99, 132, 1)',%0A                        borderWidth: 1,%0A                        type: 'line',%0A                        yAxisID: 'y1'%0A                    %7D%0A                %5D%0A            %7D,%0A            options: %7B%0A                responsive: true,%0A                maintainAspectRatio: false,%0A                scales: %7B%0A                    y: %7B%0A                        beginAtZero: true,%0A                        position: 'left',%0A                        title: %7B%0A                            display: true,%0A                            text: 'L%C6%B0%E1%BB%A3t s%E1%BB%AD d%E1%BB%A5ng'%0A                        %7D%0A                    %7D,%0A                    y1: %7B%0A                        beginAtZero: true,%0A                        position: 'right',%0A                        title: %7B%0A                            display: true,%0A                            text: 'Doanh thu (VN%C4%90)'%0A                        %7D,%0A                        grid: %7B%0A                            drawOnChartArea: false%0A                        %7D%0A                    %7D%0A                %7D,%0A                plugins: %7B%0A                    title: %7B%0A                        display: true,%0A                        text: 'Th%E1%BB%91ng k%C3%AA d%E1%BB%8Bch v%E1%BB%A5 theo b%C3%A1c s%C4%A9',%0A                        font: %7B%0A                            size: 16%0A                        %7D%0A                    %7D%0A                %7D%0A            %7D%0A        %7D);%0A        %0A        // X%E1%BB%AD l%C3%BD xu%E1%BA%A5t Excel v%C3%A0 PDF (gi%E1%BA%A3 l%E1%BA%ADp)%0A        document.getElementById('exportExcel').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t Excel %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %0A        document.getElementById('exportPDF').addEventListener('click', function() %7B%0A            alert('Ch%E1%BB%A9c n%C4%83ng xu%E1%BA%A5t PDF %C4%91ang %C4%91%C6%B0%E1%BB%A3c ph%C3%A1t tri%E1%BB%83n');%0A        %7D);%0A        %7B%25 endif %25%7D%0A    %7D);%0A%3C/script%3E%0A%7B%25 endblock %25%7D\n","isNew":true,"isApplied":true,"isUnread":false}]}],"context":{"author":"Coding Agent","operationId":"35703f7f-bbe9-4cfb-9726-b5340493c39e"},"isInternal":false},{"id":"f3212293-7614-4181-be91-316b4faff611","role":"user","rawContent":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"thay đổi một chút sao cho màu chủ đạo là màu xanh xanh giống phòng khám"}]}]},"content":[{"type":"text","text":"thay đổi một chút sao cho màu chủ đạo là màu xanh xanh giống phòng khám"}],"context":{"currentFile":{"fsPath":"/home/huong/nhakhoaso/database/bao_cao.py","path":"nhakhoaso/database/bao_cao.py","displayPath":"nhakhoaso/database/bao_cao.py","content":"from .db import execute_query\nimport datetime\n\ndef thong_ke_dich_vu_su_dung(tu_ngay=None, den_ngay=None):\n    \"\"\"\n    Thống kê dịch vụ sử dụng thông qua phiếu khám\n    \n    Args:\n        tu_ngay (str, optional): Ngày bắt đầu thống kê (định dạng YYYY-MM-DD)\n        den_ngay (str, optional): Ngày kết thúc thống kê (định dạng YYYY-MM-DD)\n        \n    Returns:\n        list: Danh sách dịch vụ đã sử dụng và số lượng\n    \"\"\"\n    try:\n        # Xây dựng câu truy vấn cơ bản\n        query = \"\"\"\n        SELECT \n            dv.MaDV, \n            dv.TenDV, \n            dv.Gia, \n            COUNT(pk.MaPK) as SoLuotSuDung,\n            SUM(dv.Gia) as TongTien\n        FROM DICHVU dv\n        LEFT JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n        \"\"\"\n        \n        params = []\n        where_clauses = []\n        \n        # Thêm điều kiện lọc theo ngày nếu có\n        if tu_ngay:\n            where_clauses.append(\"pk.NgayKham >= ?\")\n            params.append(tu_ngay)\n            \n        if den_ngay:\n            where_clauses.append(\"pk.NgayKham <= ?\")\n            params.append(den_ngay + \" 23:59:59\")  # Kết thúc ngày\n            \n        # Thêm điều kiện WHERE nếu có\n        if where_clauses:\n            query += \" WHERE \" + \" AND \".join(where_clauses)\n            \n        # Nhóm theo dịch vụ và sắp xếp theo số lượt sử dụng giảm dần\n        query += \"\"\"\n        GROUP BY dv.MaDV, dv.TenDV, dv.Gia\n        ORDER BY SoLuotSuDung DESC, dv.TenDV\n        \"\"\"\n        \n        # Thực thi truy vấn\n        result = execute_query(query, tuple(params) if params else None, fetch=True)\n        \n        # Tính tổng số lượt sử dụng và tổng tiền\n        tong_luot_su_dung = sum(item['SoLuotSuDung'] for item in result)\n        tong_tien = sum(item['TongTien'] if item['TongTien'] else 0 for item in result)\n        \n        # Thêm thông tin tổng hợp\n        summary = {\n            'tong_luot_su_dung': tong_luot_su_dung,\n            'tong_tien': tong_tien\n        }\n        \n        return result, summary\n        \n    except Exception as e:\n        print(f\"Lỗi khi thống kê dịch vụ sử dụng: {e}\")\n        return [], {'tong_luot_su_dung': 0, 'tong_tien': 0}\n\ndef thong_ke_dich_vu_theo_thang(nam=None, thang=None):\n    \"\"\"\n    Thống kê dịch vụ sử dụng theo tháng\n    \n    Args:\n        nam (int, optional): Năm thống kê (mặc định là năm hiện tại)\n        thang (int, optional): Tháng thống kê (mặc định là tất cả các tháng trong năm)\n        \n    Returns:\n        list: Danh sách dịch vụ đã sử dụng và số lượng theo tháng\n    \"\"\"\n    try:\n        # Nếu không có năm, lấy năm hiện tại\n        if not nam:\n            nam = datetime.datetime.now().year\n            \n        # Xây dựng câu truy vấn cơ bản\n        query = \"\"\"\n        SELECT \n            strftime('%m', pk.NgayKham) as Thang,\n            dv.MaDV, \n            dv.TenDV, \n            COUNT(pk.MaPK) as SoLuotSuDung,\n            SUM(dv.Gia) as TongTien\n        FROM DICHVU dv\n        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n        WHERE strftime('%Y', pk.NgayKham) = ?\n        \"\"\"\n        \n        params = [str(nam)]\n        \n        # Thêm điều kiện lọc theo tháng nếu có\n        if thang:\n            query += \" AND strftime('%m', pk.NgayKham) = ?\"\n            # Đảm bảo tháng có 2 chữ số\n            params.append(f\"{thang:02d}\")\n            \n        # Nhóm theo tháng và dịch vụ, sắp xếp theo tháng và số lượt sử dụng\n        query += \"\"\"\n        GROUP BY Thang, dv.MaDV, dv.TenDV\n        ORDER BY Thang, SoLuotSuDung DESC\n        \"\"\"\n        \n        # Thực thi truy vấn\n        result = execute_query(query, tuple(params), fetch=True)\n        \n        # Tổ chức kết quả theo tháng\n        thong_ke_theo_thang = {}\n        for item in result:\n            thang_key = item['Thang']\n            if thang_key not in thong_ke_theo_thang:\n                thong_ke_theo_thang[thang_key] = {\n                    'thang': int(thang_key),\n                    'dich_vu': [],\n                    'tong_luot_su_dung': 0,\n                    'tong_tien': 0\n                }\n                \n            thong_ke_theo_thang[thang_key]['dich_vu'].append(item)\n            thong_ke_theo_thang[thang_key]['tong_luot_su_dung'] += item['SoLuotSuDung']\n            thong_ke_theo_thang[thang_key]['tong_tien'] += item['TongTien'] if item['TongTien'] else 0\n            \n        # Chuyển từ dictionary sang list và sắp xếp theo tháng\n        ket_qua = list(thong_ke_theo_thang.values())\n        ket_qua.sort(key=lambda x: x['thang'])\n        \n        return ket_qua\n        \n    except Exception as e:\n        print(f\"Lỗi khi thống kê dịch vụ theo tháng: {e}\")\n        return []\n\ndef thong_ke_dich_vu_theo_bac_si(ma_bac_si=None, tu_ngay=None, den_ngay=None):\n    \"\"\"\n    Thống kê dịch vụ sử dụng theo bác sĩ\n    \n    Args:\n        ma_bac_si (str, optional): Mã bác sĩ cần thống kê (mặc định là tất cả bác sĩ)\n        tu_ngay (str, optional): Ngày bắt đầu thống kê (định dạng YYYY-MM-DD)\n        den_ngay (str, optional): Ngày kết thúc thống kê (định dạng YYYY-MM-DD)\n        \n    Returns:\n        list: Danh sách dịch vụ đã sử dụng và số lượng theo bác sĩ\n    \"\"\"\n    try:\n        # Xây dựng câu truy vấn cơ bản\n        query = \"\"\"\n        SELECT \n            bs.MaBS,\n            bs.HoTen as TenBacSi,\n            dv.MaDV, \n            dv.TenDV, \n            COUNT(pk.MaPK) as SoLuotSuDung,\n            SUM(dv.Gia) as TongTien\n        FROM DICHVU dv\n        JOIN PHIEUKHAM pk ON dv.MaDV = pk.MaDV\n        JOIN BACSI bs ON pk.MaBS = bs.MaBS\n        \"\"\"\n        \n        params = []\n        where_clauses = []\n        \n        # Thêm điều kiện lọc theo bác sĩ nếu có\n        if ma_bac_si:\n            where_clauses.append(\"bs.MaBS = ?\")\n            params.append(ma_bac_si)\n            \n        # Thêm điều kiện lọc theo ngày nếu có\n        if tu_ngay:\n            where_clauses.append(\"pk.NgayKham >= ?\")\n            params.append(tu_ngay)\n            \n        if den_ngay:\n            where_clauses.append(\"pk.NgayKham <= ?\")\n            params.append(den_ngay + \" 23:59:59\")  # Kết thúc ngày\n            \n        # Thêm điều kiện WHERE nếu có\n        if where_clauses:\n            query += \" WHERE \" + \" AND \".join(where_clauses)\n            \n        # Nhóm theo bác sĩ và dịch vụ, sắp xếp theo bác sĩ và số lượt sử dụng\n        query += \"\"\"\n        GROUP BY bs.MaBS, bs.HoTen, dv.MaDV, dv.TenDV\n        ORDER BY bs.HoTen, SoLuotSuDung DESC\n        \"\"\"\n        \n        # Thực thi truy vấn\n        result = execute_query(query, tuple(params) if params else None, fetch=True)\n        \n        # Tổ chức kết quả theo bác sĩ\n        thong_ke_theo_bac_si = {}\n        for item in result:\n            ma_bs = item['MaBS']\n            if ma_bs not in thong_ke_theo_bac_si:\n                thong_ke_theo_bac_si[ma_bs] = {\n                    'ma_bac_si': ma_bs,\n                    'ten_bac_si': item['TenBacSi'],\n                    'dich_vu': [],\n                    'tong_luot_su_dung': 0,\n                    'tong_tien': 0\n                }\n                \n            thong_ke_theo_bac_si[ma_bs]['dich_vu'].append({\n                'MaDV': item['MaDV'],\n                'TenDV': item['TenDV'],\n                'SoLuotSuDung': item['SoLuotSuDung'],\n                'TongTien': item['TongTien']\n            })\n            thong_ke_theo_bac_si[ma_bs]['tong_luot_su_dung'] += item['SoLuotSuDung']\n            thong_ke_theo_bac_si[ma_bs]['tong_tien'] += item['TongTien'] if item['TongTien'] else 0\n            \n        # Chuyển từ dictionary sang list và sắp xếp theo tên bác sĩ\n        ket_qua = list(thong_ke_theo_bac_si.values())\n        ket_qua.sort(key=lambda x: x['ten_bac_si'])\n        \n        return ket_qua\n        \n    except Exception as e:\n        print(f\"Lỗi khi thống kê dịch vụ theo bác sĩ: {e}\")\n        return []","language":"python"},"codebaseEnabled":true,"attachedFiles":[]},"createdAt":1745606520462,"isInternal":false},{"id":"c134914f-7ea4-4cda-874e-47e9ba8c9669","role":"assistant","createdAt":1745606534279,"content":[{"type":"text","text":"Tôi sẽ thay đổi màu chủ đạo của ứng dụng sang màu xanh phù hợp với phòng khám nha khoa. Tôi sẽ cập nhật các file CSS và các template để đảm bảo giao diện nhất quán.\n\nĐầu tiên, tôi sẽ kiểm tra file CSS hiện tại:"},{"type":"toolCall","toolCallId":"toolu_016cSL2kzD6r6m4r3DMHQKwt","isHidden":false,"title":"","statusText":"Viewed file","status":"SUCCESS","context":{"files":[{"fsPath":"/home/huong/nhakhoaso/static/style.css","path":"nhakhoaso/static/style.css","displayPath":"nhakhoaso/static/style.css"}]}},{"type":"text","text":"Tôi sẽ cập nhật file CSS để thay đổi màu chủ đạo sang màu xanh phù hợp với phòng khám nha khoa:"},{"type":"toolCall","toolCallId":"toolu_01Smxgid8ku1x8KmwBjWuu7o","isHidden":false,"title":"","statusText":"Analyzing file","status":"IN_PROGRESS"}],"context":{"author":"Coding Agent","operationId":"bfa255f1-76a5-4403-a2b5-519fe1eb6a3e"},"isInternal":false}],"isAgent":true,"isCustomAgent":false,"isUnitTestsAgent":false,"autoApply":false}