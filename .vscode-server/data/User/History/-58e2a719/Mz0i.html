{% extends 'layout.html' %}

{% block title %}Thanh to√°n - NHAKHOASO{% endblock %}

{% block content %}
<div class="section-title">
    <h2>QU·∫¢N L√ù THANH TO√ÅN</h2>
</div>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
                <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<div class="page-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-title">
            <i class="fas fa-file-invoice-dollar"></i> Qu·∫£n l√Ω thanh to√°n
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="{{ url_for('thanh_toan') }}" class="active">
                    <i class="fas fa-credit-card"></i> Thanh to√°n
                </a>
            </li>
            <li>
                <a href="{{ url_for('bao_cao_doanh_thu') }}">
                    <i class="fas fa-chart-line"></i> B√°o c√°o doanh thu
                </a>
            </li>
        </ul>
        
        <div class="sidebar-title">
            <i class="fas fa-user-injured"></i> Qu·∫£n l√Ω b·ªánh nh√¢n
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="{{ url_for('them_moi_benh_nhan') }}">
                    <i class="fas fa-plus"></i> Th√™m m·ªõi b·ªánh nh√¢n
                </a>
            </li>
            <li>
                <a href="{{ url_for('tim_kiem_benh_nhan') }}">
                    <i class="fas fa-search"></i> T√¨m ki·∫øm b·ªánh nh√¢n
                </a>
            </li>
            <li>
                <a href="{{ url_for('benh_nhan_list') }}">
                    <i class="fas fa-list"></i> Danh s√°ch b·ªánh nh√¢n
                </a>
            </li>
        </ul>
        
        <div class="sidebar-title">
            <i class="fas fa-chart-bar"></i> B√°o c√°o v√† Th·ªëng k√™
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="{{ url_for('bao_cao') }}">
                    <i class="fas fa-chart-pie"></i> T·ªïng quan
                </a>
            </li>
            <li>
                <a href="{{ url_for('bao_cao_dich_vu') }}">
                    <i class="fas fa-hand-holding-heart"></i> B√°o c√°o d·ªãch v·ª•
                </a>
            </li>
            <li>
                <a href="{{ url_for('bao_cao_benh_nhan') }}">
                    <i class="fas fa-user-injured"></i> B√°o c√°o b·ªánh nh√¢n
                </a>
            </li>
        </ul>
    </div>

    <!-- Main content -->
    <div class="main-content">
        <div class="content-header">
            <h2>Thanh to√°n</h2>
        </div>
        
        <div class="search-container">
            <form id="searchForm" class="search-form">
                <div class="form-group">
                    <label for="searchType">T√¨m ki·∫øm theo:</label>
                    <select id="searchType" name="searchType">
                        <option value="ma_benh_nhan">M√£ b·ªánh nh√¢n</option>
                        <option value="ho_ten">H·ªç t√™n</option>
                        <option value="so_dien_thoai">S·ªë ƒëi·ªán tho·∫°i</option>
                    </select>
                </div>
                <div class="form-group search-input-group">
                    <input type="text" id="searchTerm" name="searchTerm" placeholder="Nh·∫≠p th√¥ng tin t√¨m ki·∫øm...">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> T√¨m ki·∫øm
                    </button>
                </div>
            </form>
        </div>
        
        <div class="patient-info-container" id="patientInfo" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h3>Th√¥ng tin b·ªánh nh√¢n</h3>
                </div>
                <div class="card-body">
                    <div class="patient-details">
                        <div class="patient-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="patient-data">
                            <div class="data-row">
                                <div class="data-label">M√£ b·ªánh nh√¢n:</div>
                                <div class="data-value" id="patientId">BN00001</div>
                            </div>
                            <div class="data-row">
                                <div class="data-label">H·ªç t√™n:</div>
                                <div class="data-value" id="patientName">Nguy·ªÖn Th·ªã Mai</div>
                            </div>
                            <div class="data-row">
                                <div class="data-label">S·ªë ƒëi·ªán tho·∫°i:</div>
                                <div class="data-value" id="patientPhone">0901122334</div>
                            </div>
                            <div class="data-row">
                                <div class="data-label">Gi·ªõi t√≠nh:</div>
                                <div class="data-value" id="patientGender">N·ªØ</div>
                            </div>
                            <div class="data-row">
                                <div class="data-label">Ng√†y sinh:</div>
                                <div class="data-value" id="patientDob">10/03/1992</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="services-container" id="servicesContainer" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h3>D·ªãch v·ª• ƒë√£ s·ª≠ d·ª•ng</h3>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>M√£ phi·∫øu kh√°m</th>
                                <th>Ng√†y kh√°m</th>
                                <th>D·ªãch v·ª•</th>
                                <th>ƒê∆°n gi√°</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="servicesList">
                            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o b·∫±ng JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="payment-container" id="paymentContainer" style="display: none;">
            <div class="card">
                <div class="card-header">
                    <h3>Thanh to√°n</h3>
                </div>
                <div class="card-body">
                    <form id="paymentForm">
                        <div class="form-group">
                            <label for="paymentMethod">Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
                            <select id="paymentMethod" name="paymentMethod">
                                <option value="cash">Ti·ªÅn m·∫∑t</option>
                                <option value="card">Th·∫ª t√≠n d·ª•ng/ghi n·ª£</option>
                                <option value="transfer">Chuy·ªÉn kho·∫£n</option>
                                <option value="ewallet">V√≠ ƒëi·ªán t·ª≠</option>
                            </select>
                        </div>
                        
                        <div class="payment-summary">
                            <div class="summary-row">
                                <div class="summary-label">T·ªïng ti·ªÅn d·ªãch v·ª•:</div>
                                <div class="summary-value" id="totalAmount">0 VNƒê</div>
                            </div>
                            <div class="summary-row">
                                <div class="summary-label">Gi·∫£m gi√°:</div>
                                <div class="summary-value">
                                    <input type="number" id="discountAmount" name="discountAmount" value="0" min="0">
                                </div>
                            </div>
                            <div class="summary-row total">
                                <div class="summary-label">Th√†nh ti·ªÅn:</div>
                                <div class="summary-value" id="finalAmount">0 VNƒê</div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="completePaymentBtn">
                                <i class="fas fa-check-circle"></i> Ho√†n t·∫•t thanh to√°n
                            </button>
                            <button type="button" class="btn btn-secondary" id="printReceiptBtn">
                                <i class="fas fa-print"></i> In h√≥a ƒë∆°n
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Receipt Modal -->
        <div class="modal" id="receiptModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>H√≥a ƒë∆°n thanh to√°n</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body" id="receiptContent">
                    <div class="receipt-header">
                        <div class="receipt-logo">
                            <img src="{{ url_for('static', filename='images/tooth-logo.png') }}" alt="Logo NHAKHOASO" onerror="this.src='https://via.placeholder.com/50x50?text=ü¶∑'">
                            <h4>PH√íNG KH√ÅM NHA KHOA NHAKHOASO</h4>
                        </div>
                        <div class="receipt-title">
                            <h3>H√ìA ƒê∆†N THANH TO√ÅN</h3>
                            <p>M√£ h√≥a ƒë∆°n: <span id="receiptId">HD00001</span></p>
                            <p>Ng√†y: <span id="receiptDate">01/01/2023</span></p>
                        </div>
                    </div>
                    
                    <div class="receipt-patient">
                        <p><strong>B·ªánh nh√¢n:</strong> <span id="receiptPatientName">Nguy·ªÖn Th·ªã Mai</span></p>
                        <p><strong>M√£ b·ªánh nh√¢n:</strong> <span id="receiptPatientId">BN00001</span></p>
                        <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="receiptPatientPhone">0901122334</span></p>
                    </div>
                    
                    <div class="receipt-services">
                        <h4>Chi ti·∫øt d·ªãch v·ª•</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>M√£ phi·∫øu kh√°m</th>
                                    <th>D·ªãch v·ª•</th>
                                    <th>ƒê∆°n gi√°</th>
                                </tr>
                            </thead>
                            <tbody id="receiptServicesList">
                                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o b·∫±ng JavaScript -->
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3" class="text-right"><strong>T·ªïng ti·ªÅn:</strong></td>
                                    <td id="receiptTotalAmount">0 VNƒê</td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-right"><strong>Gi·∫£m gi√°:</strong></td>
                                    <td id="receiptDiscountAmount">0 VNƒê</td>
                                </tr>
                                <tr>
                                    <td colspan="3" class="text-right"><strong>Th√†nh ti·ªÅn:</strong></td>
                                    <td id="receiptFinalAmount">0 VNƒê</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    
                    <div class="receipt-footer">
                        <div class="receipt-payment-method">
                            <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> <span id="receiptPaymentMethod">Ti·ªÅn m·∫∑t</span></p>
                        </div>
                        <div class="receipt-signatures">
                            <div class="signature">
                                <p>Ng∆∞·ªùi thanh to√°n</p>
                                <p>(K√Ω, ghi r√µ h·ªç t√™n)</p>
                            </div>
                            <div class="signature">
                                <p>Ng∆∞·ªùi thu ti·ªÅn</p>
                                <p>(K√Ω, ghi r√µ h·ªç t√™n)</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="printModalBtn">
                        <i class="fas fa-print"></i> In h√≥a ƒë∆°n
                    </button>
                    <button class="btn btn-secondary" id="closeModalBtn">
                        <i class="fas fa-times"></i> ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // D·ªØ li·ªáu m·∫´u cho b·ªánh nh√¢n
        const samplePatients = [
            { id: 'BN00001', name: 'Nguy·ªÖn Th·ªã Mai', phone: '0901122334', gender: 'N·ªØ', dob: '10/03/1992' },
            { id: 'BN00002', name: 'Tr·∫ßn VƒÉn H√πng', phone: '0912233445', gender: 'Nam', dob: '22/11/1985' },
            { id: 'BN00003', name: 'L√™ Ho√†ng Nam', phone: '0923344556', gender: 'Nam', dob: '15/06/1990' },
            { id: 'BN00004', name: 'Ph·∫°m Th·ªã H√≤a', phone: '0934455667', gender: 'N·ªØ', dob: '30/01/1996' },
            { id: 'BN00005', name: 'Ho√†ng Qu·ªëc Tu·∫•n', phone: '0945566778', gender: 'Nam', dob: '08/08/1988' }
        ];
        
        // D·ªØ li·ªáu m·∫´u cho d·ªãch v·ª•
        const sampleServices = [
            { id: 'PK00001', patientId: 'BN00001', date: '20/04/2025', service: 'Kh√°m rƒÉng ƒë·ªãnh k·ª≥', price: 150000, status: 'Ch∆∞a thanh to√°n' },
            { id: 'PK00002', patientId: 'BN00002', date: '21/04/2025', service: 'Nh·ªï rƒÉng kh√¥n', price: 500000, status: 'ƒê√£ thanh to√°n' },
            { id: 'PK00003', patientId: 'BN00003', date: '22/04/2025', service: 'T·∫©y tr·∫Øng rƒÉng', price: 700000, status: 'Ch∆∞a thanh to√°n' },
            { id: 'PK00004', patientId: 'BN00004', date: '23/04/2025', service: 'Tr√°m rƒÉng th·∫©m m·ªπ', price: 300000, status: 'ƒê√£ thanh to√°n' },
            { id: 'PK00005', patientId: 'BN00005', date: '24/04/2025', service: 'Ni·ªÅng rƒÉng ch·ªânh nha', price: 25000000, status: 'Ch∆∞a thanh to√°n' }
        ];
        
        // X·ª≠ l√Ω t√¨m ki·∫øm b·ªánh nh√¢n
        const searchForm = document.getElementById('searchForm');
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const searchType = document.getElementById('searchType').value;
            const searchTerm = document.getElementById('searchTerm').value.trim();
            
            if (!searchTerm) {
                alert('Vui l√≤ng nh·∫≠p th√¥ng tin t√¨m ki·∫øm!');
                return;
            }
            
            // T√¨m ki·∫øm b·ªánh nh√¢n trong d·ªØ li·ªáu m·∫´u
            let foundPatient = null;
            
            if (searchType === 'ma_benh_nhan') {
                foundPatient = samplePatients.find(p => p.id.toLowerCase() === searchTerm.toLowerCase());
            } else if (searchType === 'ho_ten') {
                foundPatient = samplePatients.find(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()));
            } else if (searchType === 'so_dien_thoai') {
                foundPatient = samplePatients.find(p => p.phone.includes(searchTerm));
            }
            
            if (foundPatient) {
                displayPatientInfo(foundPatient);
                displayServices(foundPatient.id);
            } else {
                alert('Kh√¥ng t√¨m th·∫•y b·ªánh nh√¢n!');
                hideAllContainers();
            }
        });
        
        // Hi·ªÉn th·ªã th√¥ng tin b·ªánh nh√¢n
        function displayPatientInfo(patient) {
            document.getElementById('patientId').textContent = patient.id;
            document.getElementById('patientName').textContent = patient.name;
            document.getElementById('patientPhone').textContent = patient.phone;
            document.getElementById('patientGender').textContent = patient.gender;
            document.getElementById('patientDob').textContent = patient.dob;
            
            document.getElementById('patientInfo').style.display = 'block';
        }
        
        // Hi·ªÉn th·ªã d·ªãch v·ª• c·ªßa b·ªánh nh√¢n
        function displayServices(patientId) {
            const patientServices = sampleServices.filter(s => s.patientId === patientId && s.status === 'Ch∆∞a thanh to√°n');
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            if (patientServices.length === 0) {
                servicesList.innerHTML = '<tr><td colspan="7" class="text-center">Kh√¥ng c√≥ d·ªãch v·ª• n√†o c·∫ßn thanh to√°n</td></tr>';
                document.getElementById('servicesContainer').style.display = 'block';
                document.getElementById('paymentContainer').style.display = 'none';
                return;
            }
            
            let totalAmount = 0;
            
            patientServices.forEach((service, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${service.id}</td>
                    <td>${service.date}</td>
                    <td>${service.service}</td>
                    <td>${formatCurrency(service.price)}</td>
                    <td><span class="status ${service.status === 'ƒê√£ thanh to√°n' ? 'paid' : 'unpaid'}">${service.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary view-btn" data-id="${service.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-danger remove-btn" data-id="${service.id}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                servicesList.appendChild(row);
                totalAmount += service.price;
            });
            
            document.getElementById('servicesContainer').style.display = 'block';
            document.getElementById('paymentContainer').style.display = 'block';
            
            // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
            updatePaymentSummary(totalAmount);
            
            // X·ª≠ l√Ω s·ª± ki·ªán x√≥a d·ªãch v·ª•
            const removeButtons = document.querySelectorAll('.remove-btn');
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const serviceId = this.getAttribute('data-id');
                    const serviceIndex = sampleServices.findIndex(s => s.id === serviceId);
                    
                    if (serviceIndex !== -1) {
                        sampleServices.splice(serviceIndex, 1);
                        displayServices(patientId);
                    }
                });
            });
        }
        
        // C·∫≠p nh·∫≠t th√¥ng tin thanh to√°n
        function updatePaymentSummary(totalAmount) {
            document.getElementById('totalAmount').textContent = formatCurrency(totalAmount);
            
            const discountInput = document.getElementById('discountAmount');
            const discount = parseInt(discountInput.value) || 0;
            const finalAmount = totalAmount - discount;
            
            document.getElementById('finalAmount').textContent = formatCurrency(finalAmount);
            
            // X·ª≠ l√Ω s·ª± ki·ªán thay ƒë·ªïi gi·∫£m gi√°
            discountInput.addEventListener('input', function() {
                const discount = parseInt(this.value) || 0;
                const finalAmount = totalAmount - discount;
                document.getElementById('finalAmount').textContent = formatCurrency(finalAmount);
            });
        }
        
        // X·ª≠ l√Ω s·ª± ki·ªán ho√†n t·∫•t thanh to√°n
        const paymentForm = document.getElementById('paymentForm');
        paymentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const patientId = document.getElementById('patientId').textContent;
            const patientServices = sampleServices.filter(s => s.patientId === patientId && s.status === 'Ch∆∞a thanh to√°n');
            
            if (patientServices.length === 0) {
                alert('Kh√¥ng c√≥ d·ªãch v·ª• n√†o c·∫ßn thanh to√°n!');
                return;
            }
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i d·ªãch v·ª•
            patientServices.forEach(service => {
                service.status = 'ƒê√£ thanh to√°n';
            });
            
            // Hi·ªÉn th·ªã h√≥a ƒë∆°n
            showReceipt();
        });
        
        // Hi·ªÉn th·ªã h√≥a ƒë∆°n
        function showReceipt() {
            const modal = document.getElementById('receiptModal');
            const patientId = document.getElementById('patientId').textContent;
            const patient = samplePatients.find(p => p.id === patientId);
            const patientServices = sampleServices.filter(s => s.patientId === patientId && s.status === 'ƒê√£ thanh to√°n');
            
            // C·∫≠p nh·∫≠t th√¥ng tin h√≥a ƒë∆°n
            document.getElementById('receiptId').textContent = 'HD' + Date.now().toString().substring(5);
            document.getElementById('receiptDate').textContent = new Date().toLocaleDateString('vi-VN');
            document.getElementById('receiptPatientName').textContent = patient.name;
            document.getElementById('receiptPatientId').textContent = patient.id;
            document.getElementById('receiptPatientPhone').textContent = patient.phone;
            
            // C·∫≠p nh·∫≠t danh s√°ch d·ªãch v·ª•
            const servicesList = document.getElementById('receiptServicesList');
            servicesList.innerHTML = '';
            
            let totalAmount = 0;
            
            patientServices.forEach((service, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${service.id}</td>
                    <td>${service.service}</td>
                    <td>${formatCurrency(service.price)}</td>
                `;
                
                servicesList.appendChild(row);
                totalAmount += service.price;
            });
            
            const discount = parseInt(document.getElementById('discountAmount').value) || 0;
            const finalAmount = totalAmount - discount;
            
            document.getElementById('receiptTotalAmount').textContent = formatCurrency(totalAmount);
            document.getElementById('receiptDiscountAmount').textContent = formatCurrency(discount);
            document.getElementById('receiptFinalAmount').textContent = formatCurrency(finalAmount);
            
            const paymentMethod = document.getElementById('paymentMethod');
            let paymentMethodText = 'Ti·ªÅn m·∫∑t';
            
            switch (paymentMethod.value) {
                case 'cash':
                    paymentMethodText = 'Ti·ªÅn m·∫∑t';
                    break;
                case 'card':
                    paymentMethodText = 'Th·∫ª t√≠n d·ª•ng/ghi n·ª£';
                    break;
                case 'transfer':
                    paymentMethodText = 'Chuy·ªÉn kho·∫£n';
                    break;
                case 'ewallet':
                    paymentMethodText = 'V√≠ ƒëi·ªán t·ª≠';
                    break;
            }
            
            document.getElementById('receiptPaymentMethod').textContent = paymentMethodText;
            
            // Hi·ªÉn th·ªã modal
            modal.style.display = 'block';
            
            // C·∫≠p nh·∫≠t l·∫°i danh s√°ch d·ªãch v·ª•
            displayServices(patientId);
        }
        
        // X·ª≠ l√Ω s·ª± ki·ªán ƒë√≥ng modal
        const closeBtn = document.querySelector('.close');
        const closeModalBtn = document.getElementById('closeModalBtn');
        
        closeBtn.addEventListener('click', function() {
            document.getElementById('receiptModal').style.display = 'none';
        });
        
        closeModalBtn.addEventListener('click', function() {
            document.getElementById('receiptModal').style.display = 'none';
        });
        
        // X·ª≠ l√Ω s·ª± ki·ªán in h√≥a ƒë∆°n
        const printReceiptBtn = document.getElementById('printReceiptBtn');
        const printModalBtn = document.getElementById('printModalBtn');
        
        printReceiptBtn.addEventListener('click', function() {
            showReceipt();
        });
        
        printModalBtn.addEventListener('click', function() {
            const receiptContent = document.getElementById('receiptContent').innerHTML;
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>H√≥a ƒë∆°n thanh to√°n</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .receipt-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
                        .receipt-logo { display: flex; align-items: center; }
                        .receipt-logo img { width: 40px; height: 40px; margin-right: 10px; }
                        .receipt-title h3 { margin: 0; }
                        .receipt-patient { margin-bottom: 20px; }
                        .receipt-services table { width: 100%; border-collapse: collapse; }
                        .receipt-services th, .receipt-services td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .receipt-footer { margin-top: 30px; }
                        .receipt-signatures { display: flex; justify-content: space-between; margin-top: 50px; }
                        .signature { text-align: center; width: 40%; }
                        .text-right { text-align: right; }
                    </style>
                </head>
                <body>
                    ${receiptContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        });
        
        // H√†m ·∫©n t·∫•t c·∫£ c√°c container
        function hideAllContainers() {
            document.getElementById('patientInfo').style.display = 'none';
            document.getElementById('servicesContainer').style.display = 'none';
            document.getElementById('paymentContainer').style.display = 'none';
        }
        
        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
    .search-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .search-form {
        display: flex;
        align-items: flex-end;
        gap: 20px;
    }
    
    .search-input-group {
        display: flex;
        flex: 1;
    }
    
    .search-input-group input {
        flex: 1;
        margin-right: 10px;
    }
    
    .patient-info-container, .services-container, .payment-container {
        margin-bottom: 20px;
    }
    
    .card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .card-header {
        background-color: var(--primary-color);
        color: #fff;
        padding: 15px 20px;
    }
    
    .card-header h3 {
        margin: 0;
        font-size: 18px;
    }
    
    .card-body {
        padding: 20px;
    }
    
    .patient-details {
        display: flex;
        align-items: center;
    }
    
    .patient-avatar {
        font-size: 60px;
        color: var(--primary-color);
        margin-right: 20px;
    }
    
    .patient-data {
        flex: 1;
    }
    
    .data-row {
        display: flex;
        margin-bottom: 10px;
    }
    
    .data-label {
        width: 150px;
        font-weight: 600;
    }
    
    .data-value {
        flex: 1;
    }
    
    .status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .status.paid {
        background-color: #e6f7ee;
        color: #28a745;
    }
    
    .status.unpaid {
        background-color: #fff5e6;
        color: #fd7e14;
    }
    
    .action-buttons {
        display: flex;
        gap: 5px;
    }
    
    .payment-summary {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    
    .summary-row.total {
        border-top: 1px solid #ddd;
        padding-top: 10px;
        font-weight: 600;
        font-size: 18px;
    }
    
    .summary-label {
        font-weight: 600;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
    }
    
    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
        background-color: #fff;
        margin: 5% auto;
        width: 80%;
        max-width: 800px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background-color: var(--primary-color);
        color: #fff;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
    }
    
    .modal-header h3 {
        margin: 0;
    }
    
    .close {
        color: #fff;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .modal-body {
        padding: 20px;
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .modal-footer {
        padding: 15px 20px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        border-top: 1px solid #ddd;
    }
    
    /* Receipt styles */
    .receipt-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    
    .receipt-logo {
        display: flex;
        align-items: center;
    }
    
    .receipt-logo img {
        width: 40px;
        height: 40px;
        margin-right: 10px;
    }
    
    .receipt-title h3 {
        margin: 0 0 10px;
        color: var(--primary-color);
    }
    
    .receipt-title p {
        margin: 5px 0;
    }
    
    .receipt-patient {
        margin-bottom: 20px;
    }
    
    .receipt-services {
        margin-bottom: 20px;
    }
    
    .receipt-services h4 {
        margin-top: 0;
        margin-bottom: 10px;
        color: var(--primary-color);
    }
    
    .receipt-services table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .receipt-services th, .receipt-services td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    
    .receipt-services th {
        background-color: #f8f9fa;
    }
    
    .receipt-services tfoot tr {
        font-weight: 600;
    }
    
    .text-right {
        text-align: right;
    }
    
    .receipt-footer {
        margin-top: 30px;
    }
    
    .receipt-payment-method {
        margin-bottom: 20px;
    }
    
    .receipt-signatures {
        display: flex;
        justify-content: space-between;
        margin-top: 50px;
    }
    
    .signature {
        text-align: center;
        width: 40%;
    }
    
    @media (max-width: 768px) {
        .search-form {
            flex-direction: column;
            align-items: stretch;
        }
        
        .search-input-group {
            flex-direction: column;
        }
        
        .search-input-group input {
            margin-right: 0;
            margin-bottom: 10px;
        }
        
        .patient-details {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .patient-avatar {
            margin-right: 0;
            margin-bottom: 20px;
        }
        
        .data-row {
            flex-direction: column;
        }
        
        .data-label {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .modal-content {
            width: 95%;
            margin: 10% auto;
        }
        
        .receipt-header, .receipt-signatures {
            flex-direction: column;
        }
        
        .receipt-logo, .signature {
            width: 100%;
            margin-bottom: 20px;
        }
    }
</style>
{% endblock %}